

<!DOCTYPE html>
<html
  lang="en"
  dir="ltr"
  class="scroll-smooth"
  data-default-appearance="light"
  data-auto-appearance="true"
><head>
  <meta charset="utf-8" />
  
    <meta http-equiv="content-language" content="en" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  
  <title>Deep dive in CORS: History, how it works, and best practices &middot; Ilija Eftimov üë®‚ÄçüöÄ</title>
    <meta name="title" content="Deep dive in CORS: History, how it works, and best practices &middot; Ilija Eftimov üë®‚ÄçüöÄ" />
  
  <meta name="description" content="Documenting my experiences and learnings, with the goal of helping other software engineers on their journey" />
  
  
  
  <link rel="canonical" href="https://ieftimov.com/posts/deep-dive-cors-history-how-it-works-best-practices/" />
  
  
  
  
  
  
  
  
  
    
  
  
  <link
    type="text/css"
    rel="stylesheet"
    href="/css/main.bundle.min.c0352009de6b79b67580e55f0d8ffab169eefd09d189e1be6affbb7ccb9f29a819bbddb429d1ae07b7814d5cf0074de6df16d1145a386e70219d79c1894e9b77.css"
    integrity="sha512-wDUgCd5rebZ1gOVfDY/6sWnu/QnRieG&#43;av&#43;7fMufKagZu920KdGuB7eBTVzwB03m3xbRFFo4bnAhnXnBiU6bdw=="
  />
  
  
  <script type="text/javascript" src="/js/appearance.min.4df8309499991be53c71b2b39ba0f5d5e77ea7d411d0710ce48c24218e7cc24ded28f19e85838fdc56db2306195cb001f049f577be0cf0ffb2dd6e2037ede1b9.js" integrity="sha512-TfgwlJmZG&#43;U8cbKzm6D11ed&#43;p9QR0HEM5IwkIY58wk3tKPGehYOP3FbbIwYZXLAB8En1d74M8P&#43;y3W4gN&#43;3huQ=="></script>
  
    
    
    
  
  
    
    
  
  
  
    
    <script defer type="text/javascript" id="script-bundle" src="/js/main.bundle.min.bbbc21fe00162ca986299c3aa2587e88662408cef57709874b7c316048a5ff80b7e342fc03812cff1393cb2be2ce65593299494d88df71ec6eb48ee261fc0fd6.js" integrity="sha512-u7wh/gAWLKmGKZw6olh&#43;iGYkCM71dwmHS3wxYEil/4C340L8A4Es/xOTyyvizmVZMplJTYjfcexutI7iYfwP1g==" data-copy="Copy" data-copied="Copied"></script>
  
  
  
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />
  
  
  
  
  
  
  
  <meta property="og:title" content="Deep dive in CORS: History, how it works, and best practices" />
<meta property="og:description" content="Learn the history and evolution of same-origin policy and CORS, understand CORS and the different types of cross-origin access in depth, and learn (some) best practices." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ieftimov.com/posts/deep-dive-cors-history-how-it-works-best-practices/" /><meta property="og:image" content="https://ieftimov.com/cards/deep-dive-cors-history-how-it-works-best-practices.png" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-04-12T20:40:00+01:00" />
<meta property="article:modified_time" content="2021-04-12T20:40:00+01:00" /><meta property="og:site_name" content="Ilija Eftimov üë®‚ÄçüöÄ" />


  <meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://ieftimov.com/cards/deep-dive-cors-history-how-it-works-best-practices.png"/>

<meta name="twitter:title" content="Deep dive in CORS: History, how it works, and best practices"/>
<meta name="twitter:description" content="Learn the history and evolution of same-origin policy and CORS, understand CORS and the different types of cross-origin access in depth, and learn (some) best practices."/>

  
  <script type="application/ld+json">
  [{
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "Posts",
    "name": "Deep dive in CORS: History, how it works, and best practices",
    "headline": "Deep dive in CORS: History, how it works, and best practices",
    "description": "Learn the history and evolution of same-origin policy and CORS, understand CORS and the different types of cross-origin access in depth, and learn (some) best practices.",
    "abstract": "The error in your browser\u0026rsquo;s console #  No \u0026lsquo;Access-Control-Allow-Origin\u0026rsquo; header is present on the requested resource.",
    "inLanguage": "en",
    "url" : "https:\/\/ieftimov.com\/posts\/deep-dive-cors-history-how-it-works-best-practices\/",
    "author" : {
      "@type": "Person",
      "name": "Ilija Eftimov"
    },
    "copyrightYear": "2021",
    "dateCreated": "2021-04-12T00:00:00\u002b00:00",
    "datePublished": "2021-04-12T20:40:00\u002b01:00",
    
    "dateModified": "2021-04-12T20:40:00\u002b01:00",
    
    
    
    "mainEntityOfPage": "true",
    "wordCount": "4151"
  }]
  </script>


  
  <meta name="author" content="Ilija Eftimov" />
  
    
      <link href="https://twitter.com/efilija" rel="me" />
    
      <link href="https://www.linkedin.com/in/ieftimov/" rel="me" />
    
      <link href="mailto:blog@ieftimov.com" rel="me" />
    
      <link href="https://dev.to/fteem" rel="me" />
    
      <link href="https://github.com/fteem" rel="me" />
    
      <link href="https://t.me/ieftimovcom" rel="me" />
    
  
  
  






  
  <script async defer data-domain="ieftimov.com" src="https://plausible.io/js/plausible.js"></script>

  
  
</head>
<body
    class="flex flex-col h-screen px-6 m-auto text-lg leading-7 bg-neutral text-neutral-900 sm:px-14 md:px-24 lg:px-32 dark:bg-neutral-800 dark:text-neutral max-w-7xl"
  >
    <div id="the-top" class="absolute flex self-center">
      <a
        class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 dark:bg-neutral-600 focus:translate-y-0"
        href="#main-content"
        ><span class="font-bold ltr:pr-2 rtl:pl-2 text-primary-600 dark:text-primary-400"
          >&darr;</span
        >Skip to main content</a
      >
    </div>
    
    
      <header class="py-6 font-semibold sm:py-10 text-neutral-900 dark:text-neutral print:hidden">
  <nav class="flex justify-between">
    
    <div>
      
        <a
          class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
          rel="me"
          href="/"
          >Ilija Eftimov üë®‚ÄçüöÄ</a
        >
      

    </div>
    
    
      <ul class="flex flex-col list-none ltr:text-right rtl:text-left sm:flex-row">
        
          
            <li class="mb-1 sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
              <a
                class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
                href="/"
                title=""
                >Home</a
              >
            </li>
          
            <li class="mb-1 sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
              <a
                class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
                href="/posts/"
                title="Posts"
                >Writing</a
              >
            </li>
          
            <li class="mb-1 sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
              <a
                class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
                href="/work"
                title=""
                >Work</a
              >
            </li>
          
            <li class="mb-1 sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
              <a
                class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
                href="https://www.getrevue.co/profile/itsilija"
                title=""
                >Subscribe</a
              >
            </li>
          
        
        
          <li class="ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
            <button
              id="search-button"
              class="text-base hover:text-primary-600 dark:hover:text-primary-400"
              title="Search (/)"
            >
              

  <span class="relative inline-block align-text-bottom icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


            </button>
          </li>
        
      </ul>
    
  </nav>
</header>

    
    <div class="relative flex flex-col grow">
      <main id="main-content" class="grow">
        
  <article>
    <header class="max-w-prose">
      
      <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
        Deep dive in CORS: History, how it works, and best practices
      </h1>
      <div class="mt-8 mb-12 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
        





  
  



  

  
  
    
  

  

  

  
    
  

  


  <div class="flex flex-row flex-wrap items-center">
    
    
      <time datetime="2021-04-12 00:00:00 &#43;0000 UTC">12 April 2021</time><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">20 mins</span>
    

    
    
  </div>

  
  


      </div>
    </header>
    <section class="flex flex-col max-w-full mt-0 prose lg:flex-row dark:prose-invert">
      
        <div class="order-first px-0 lg:max-w-xs ltr:lg:pl-8 rtl:lg:pr-8 lg:order-last">
          <div class="ltr:pl-5 rtl:pr-5 toc lg:sticky lg:top-10 print:hidden">
            <details open class="mt-0 overflow-hidden rounded-lg rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5">
  <summary
    class="block py-1 text-lg font-semibold cursor-pointer rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 text-neutral-800 dark:text-neutral-100 lg:hidden bg-neutral-100 dark:bg-neutral-700"
  >
    Table of Contents
  </summary>
  <div
    class="py-2 border-dotted ltr:border-l rtl:border-r rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 border-neutral-300 dark:border-neutral-600"
  >
    <nav id="TableOfContents">
  <ul>
    <li><a href="#the-error-in-your-browsers-console">The error in your browser&rsquo;s console</a></li>
    <li><a href="#in-the-beginning-was-the-first-subresource">In the beginning was the first subresource</a>
      <ul>
        <li><a href="#origins--cross-origin">Origins &amp; cross-origin</a></li>
        <li><a href="#the-many-dangers-of-cross-origin-requests">The many dangers of cross-origin requests</a></li>
      </ul>
    </li>
    <li><a href="#same-origin-policy">Same-origin policy</a></li>
    <li><a href="#enter-cors">Enter CORS</a>
      <ul>
        <li><a href="#cross-origin-writes">Cross-origin writes</a></li>
        <li><a href="#preflight-requests">Preflight requests</a></li>
        <li><a href="#cross-origin-reads">Cross-origin reads</a></li>
      </ul>
    </li>
    <li><a href="#fine-tuning-cors">Fine-tuning CORS</a></li>
    <li><a href="#some-best-practices">Some best practices</a>
      <ul>
        <li><a href="#free-for-all">Free for all</a></li>
        <li><a href="#keeping-it-in-the-family">Keeping it in the family</a></li>
        <li><a href="#null-origins">NULL origins</a></li>
        <li><a href="#skip-cookies-if-you-can">Skip cookies, if you can</a></li>
      </ul>
    </li>
    <li><a href="#additional-reading">Additional reading</a></li>
  </ul>
</nav>
  </div>
</details>

          </div>
        </div>
      
      <div class="min-w-0 min-h-0 max-w-prose">
        <h2 id="the-error-in-your-browsers-console" class="relative group">The error in your browser&rsquo;s console <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#the-error-in-your-browsers-console" aria-label="Anchor">#</a></span></h2>
<blockquote>
<p>No &lsquo;Access-Control-Allow-Origin&rsquo; header is present on the requested resource.</p>
</blockquote>
<blockquote>
<p>Cross-Origin Request Blocked: The Same Origin Policy disallows reading the
remote resource at <a href="https://example.com/">https://example.com/</a></p>
</blockquote>
<blockquote>
<p>Access to fetch at &lsquo;<a href="https://example.com">https://example.com</a>&rsquo; from origin &lsquo;http://localhost:3000&rsquo;
has been blocked by CORS policy.</p>
</blockquote>
<p>I am sure you&rsquo;ve seen one of these errors, or a variation, in your browser&rsquo;s
console. If you have not ‚Äì don&rsquo;t fret, you soon will. There are enough CORS
errors for all developers out there.</p>
<p>These popping-up during development can be annoying. But in fact, CORS is an
incredibly useful mechanism in a world of misconfigured web servers, hostile
actors on the web and organizations pushing the web standards ahead.</p>
<p>But let&rsquo;s go back the beginning&hellip;</p>
<h2 id="in-the-beginning-was-the-first-subresource" class="relative group">In the beginning was the first subresource <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#in-the-beginning-was-the-first-subresource" aria-label="Anchor">#</a></span></h2>
<p>A subresource is an HTML element that is requested to be embedded into the
document, or executed in its context. <a href="http://1997.webhistory.org/www.lists/www-talk.1993q1/0182.html">In the year of
1993</a>, the
first subresource <code>&lt;img&gt;</code> was introduced. By introducing <code>&lt;img&gt;</code>, the web got
prettier. And more complex.</p>












<figure class="imagecaption">
  <img class="caption" src="/back-to-the-origin-with-cors/meet-img.png" caption="Back to 1993" alt="Back to 1993">
  <span class="caption-text" style="font-size: 0.75em;display: table;margin: 0 auto 1.5em;">Back to 1993</span>
</figure>

<p>You see, if your browser would render a page with an <code>&lt;img&gt;</code> on it, it would
actually have to go fetch that sub<strong>resource</strong> from an origin. When a browser
fetches said subresource from an origin that does not reside on the same
scheme, fully qualified hostname or port ‚Äì that&rsquo;s a <strong>cross-origin request</strong>.</p>
<h3 id="origins--cross-origin" class="relative group">Origins &amp; cross-origin <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#origins--cross-origin" aria-label="Anchor">#</a></span></h3>
<p>An origin is identified by a triple: scheme, fully qualified hostname and port.
For example, <code>http://example.com</code> and <code>https://example.com</code> are different
origins ‚Äì¬†the first uses <code>http</code> scheme and the second <code>https</code>. Also, the
default <code>http</code> port is 80, while the <code>https</code> is 443. Therefore, in this
example, the two origins differ by scheme and port, although the host is the
same (<code>example.com</code>).</p>
<p>You get the idea ‚Äì if any of the three items in the triple are different, then
the origin is different.</p>
<p>As an exercise if we run a comparison of the
<code>https://blog.example.com/posts/foo.html</code> origin against other origins, we
would get the following results:</p>
<table>
<thead>
<tr>
<th>URL</th>
<th>Result</th>
<th>Reason</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>https://blog.example.com/posts/bar.html</code></td>
<td>Same</td>
<td>Only the path differs</td>
</tr>
<tr>
<td><code>https://blog.example.com/contact.html</code></td>
<td>Same</td>
<td>Only the path differs</td>
</tr>
<tr>
<td><code>http://blog.example.com/posts/bar.html</code></td>
<td>Different</td>
<td>Different protocol</td>
</tr>
<tr>
<td><code>https://blog.example.com:8080/posts/bar.html</code></td>
<td>Different</td>
<td>Different port (<code>https://</code> is port 443 by default)</td>
</tr>
<tr>
<td><code>https://example.com/posts/bar.html</code></td>
<td>Different</td>
<td>Different host</td>
</tr>
</tbody>
</table>
<p>A cross-origin request means, for example, a resource (i.e. page) such as
<code>http://example.com/posts/bar.html</code> that would try to render a subresource from
the <code>https://example.com</code> origin (note the scheme change!).</p>
<h3 id="the-many-dangers-of-cross-origin-requests" class="relative group">The many dangers of cross-origin requests <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#the-many-dangers-of-cross-origin-requests" aria-label="Anchor">#</a></span></h3>
<p>Now that we defined what same- and cross-origin is, let&rsquo;s see what is the big
deal.</p>
<p>When we introduced <code>&lt;img&gt;</code> to the web, we opened the floodgates. Soon after the
web got <code>&lt;script&gt;</code>, <code>&lt;frame&gt;</code>, <code>&lt;video&gt;</code>, <code>&lt;audio&gt;</code>, <code>&lt;iframe&gt;</code>, <code>&lt;link&gt;</code>,
<code>&lt;form&gt;</code> and so on. These subresources can be fetched by the browser after
loading the page, therefore they can all be same- or cross-origin requests.</p>
<p>Let&rsquo;s travel to an imaginary world where CORS does not exist and web browsers
allow all sorts of cross-origin requests.</p>
<p>Imagine I got a page on my website <code>evil.com</code> with a <code>&lt;script&gt;</code>. On the surface
it looks like a simple page, where you read some useful information. But in the
<code>&lt;script&gt;</code>, I have specially crafted code that will send a specially-crafted
request to bank&rsquo;s <code>DELETE /account</code> endpoint. Once you load the page, the
JavaScript is executed and an AJAX call hits the bank&rsquo;s API.</p>












<figure class="imagecaption">
  <img class="caption" src="/back-to-the-origin-with-cors/malicious-javascript-injection.png" caption="Puff, your account is gone. üå¨" alt="Puff, your account is gone. üå¨">
  <span class="caption-text" style="font-size: 0.75em;display: table;margin: 0 auto 1.5em;">Puff, your account is gone. üå¨</span>
</figure>

<p>Mind-blowing ‚Äì¬†imagine while reading some information on a web page, you get an
email from your bank that you&rsquo;ve successfully deleted your account. I know I
know&hellip; if it was THAT easy to do <em>anything</em> with a bank&rsquo;s. I digress.</p>
<p>For my evil <code>&lt;script&gt;</code> to work, as part of the request your browser would also
have to send your credentials (cookies) from the bank&rsquo;s website. That&rsquo;s how the
bank&rsquo;s servers would identify you and know which account to delete.</p>
<p>Let&rsquo;s look at a different, not-so-evil scenario.</p>
<p>I want to detect folks that work for <strong>Awesome Corp</strong>, whose internal website
is on <code>intra.awesome-corp.com</code>. On my website, <code>dangerous.com</code> I got an <code>&lt;img src=&quot;https://intra.awesome-corp.com/avatars/john-doe.png&quot;&gt;</code>.</p>
<p>For users that do not have a session active with <code>intra.awesome-corp.com</code>, the
avatar won&rsquo;t render ‚Äì¬†it will produce an error. But, if you&rsquo;re logged in the
intranet of Awesome Corp., once you open my <code>dangerous.com</code> website I&rsquo;ll know
that you have access.</p>
<p>That means that I will be able to derive some information about you. While it&rsquo;s
definitely harder for me to craft an attack, the knowledge that you have access
to Awesome Corp. is still a potential attack vector.</p>












<figure class="imagecaption">
  <img class="caption" src="/back-to-the-origin-with-cors/resource-embed-attack-vector.png" caption="Leaking info to 3rd parties üí¶" alt="Leaking info to 3rd parties üí¶">
  <span class="caption-text" style="font-size: 0.75em;display: table;margin: 0 auto 1.5em;">Leaking info to 3rd parties üí¶</span>
</figure>

<p>While these two are overly-simplistic examples, it is this kind of threats that
have made the same-origin policy &amp; CORS necessary. These are all different
dangers of cross-origin requests. Some have been mitigated, others <strong>can&rsquo;t be</strong>
mitigated ‚Äì they&rsquo;re rooted in the nature of the web. But for the plethora of
attack vectors that have been squashed ‚Äì¬†it&rsquo;s because of CORS.</p>
<p>But before CORS, there was the same-origin policy.</p>
<h2 id="same-origin-policy" class="relative group">Same-origin policy <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#same-origin-policy" aria-label="Anchor">#</a></span></h2>
<p>The same-origin policy prevents cross-origin attacks by blocking read access to
resources loaded from a different origin. This policy still allows some tags,
like <code>&lt;img&gt;</code>, to embeds resources from a different origin.</p>
<p>The same-origin policy was introduced by Netscape Navigator 2.02 in 1995,
originally intended to protect cross-origin access to the DOM.</p>
<p>Even though same-origin policy implementations are not required to follow an
exact specification, all modern browsers implement some form of it. The
principles of the policy are described in
<a href="https://tools.ietf.org/html/rfc6454">RFC6454</a> of the Internet Engineering Task
Force (IETF).</p>
<p>The implementation of the same-origin policy is defined with this ruleset:</p>
<table>
<thead>
<tr>
<th>Tags</th>
<th>Cross-origin</th>
<th>Note</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>&lt;iframe&gt;</code></td>
<td>Embedding permitted</td>
<td>Depends on <code>X-Frame-Options</code></td>
</tr>
<tr>
<td><code>&lt;link&gt;</code></td>
<td>Embedding permitted</td>
<td>Proper <code>Content-Type</code> might be required</td>
</tr>
<tr>
<td><code>&lt;form&gt;</code></td>
<td>Writing permitted</td>
<td>Cross-origin writes are common</td>
</tr>
<tr>
<td><code>&lt;img&gt;</code></td>
<td>Embedding permitted</td>
<td>Cross-origin reading via JavaScript and loading it in a <code>&lt;canvas&gt;</code> is forbidden</td>
</tr>
<tr>
<td><code>&lt;audio&gt;</code> / <code>&lt;video&gt;</code></td>
<td>Embedding permitted</td>
<td></td>
</tr>
<tr>
<td><code>&lt;script&gt;</code></td>
<td>Embedding permitted</td>
<td>Access to certain APIs might be forbidden</td>
</tr>
</tbody>
</table>
<p>Same-origin policy solves many challenges, but it is pretty restrictive. In the
age of single-page applications and media-heavy websites, same-origin does not
leave a lot of room for relaxation of or fine-tuning of these rules.</p>
<p>CORS was born with the goals to relax the same-origin policy and to fine-tune
cross-origin access.</p>
<h2 id="enter-cors" class="relative group">Enter CORS <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#enter-cors" aria-label="Anchor">#</a></span></h2>
<p>So far we covered what is an origin, how it&rsquo;s defined, what the drawbacks of
cross-origin requests are and the same-origin policy that browsers implement.</p>
<p>Now it&rsquo;s time to familiarize ourselves with Cross Origin Resource Sharing
(CORS). CORS is a mechanism that allows control of access to subresources on a
web page over a network. The mechanism classifies three different categories of
subresource access:</p>
<ol>
<li>Cross-origin writes</li>
<li>Cross-origin embeds</li>
<li>Cross-origin reads</li>
</ol>
<p>Before we go on to explain each of these categories, it&rsquo;s important to
realize that although your browser (by default) might allow a certain type
of cross-origin request, that <strong>does not mean that said request will be
accepted by the server</strong>.</p>
<p><strong>Cross-origin writes</strong> are links, redirects, and form submissions. With CORS
active in your browser, these are all <strong>allowed</strong>. There is also a thing called
<strong>preflight request</strong> that fine-tunes cross-origin writes, so while some writes
might be permitted by default it doesn&rsquo;t mean they can go through in practice.
We&rsquo;ll look into that a bit later.</p>
<p><strong>Cross-origin embeds</strong> are subresources loaded via: <code>&lt;script&gt;</code>, <code>&lt;link&gt;</code>,
<code>&lt;img&gt;</code>, <code>&lt;video&gt;</code>, <code>&lt;audio&gt;</code>, <code>&lt;object&gt;</code>, <code>&lt;embed&gt;</code>, <code>&lt;iframe&gt;</code> and more.
These are all <strong>allowed</strong> by default. <code>&lt;iframe&gt;</code> is a special one ‚Äì as it&rsquo;s
purpose is to literally load a different page inside the frame, its
cross-origin framing can be controlled by using the <code>X-Frame-options</code> header.</p>
<p>When it comes to <code>&lt;img&gt;</code> and the other embeddable subresources ‚Äì it&rsquo;s in their
nature to trigger cross-origin requests. That&rsquo;s why in CORS differentiates
between cross-origin embeds and cross-origin reads, and treats them
differently.</p>
<p><strong>Cross-origin reads</strong> are subresources loaded via AJAX / <code>fetch</code> calls. These
are by default <strong>blocked</strong> in your browser. There&rsquo;s the workaround of embedding
such subresources in a page, but such tricks are handled by another policy
present in modern browsers.</p>
<p>If your browser is up to date, all of these heuristics are already implemented
in it.</p>
<h3 id="cross-origin-writes" class="relative group">Cross-origin writes <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#cross-origin-writes" aria-label="Anchor">#</a></span></h3>
<p>Cross-origin writes can be the very problematic. Let&rsquo;s look into an example and
see CORS in action.</p>
<p>First, we&rsquo;ll have a simple <a href="https://crystal-lang.org/">Crystal</a> (using
<a href="https://kemalcr.com/">Kemal</a>) HTTP server:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-crystal" data-lang="crystal"><span class="k">require</span> <span class="s2">&#34;kemal&#34;</span>

<span class="n">port</span> <span class="o">=</span> <span class="no">ENV</span><span class="o">[</span><span class="s2">&#34;PORT&#34;</span><span class="o">].</span><span class="n">to_i</span> <span class="o">||</span> <span class="mi">4000</span>

<span class="n">get</span> <span class="s2">&#34;/&#34;</span> <span class="k">do</span>
  <span class="s2">&#34;Hello world!&#34;</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s2">&#34;/greet&#34;</span> <span class="k">do</span>
  <span class="s2">&#34;Hey!&#34;</span>
<span class="k">end</span>

<span class="n">post</span> <span class="s2">&#34;/greet&#34;</span> <span class="k">do</span> <span class="o">|</span><span class="n">env</span><span class="o">|</span>
  <span class="n">name</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">json</span><span class="o">[</span><span class="s2">&#34;name&#34;</span><span class="o">].</span><span class="n">as</span><span class="p">(</span><span class="nb">String</span><span class="p">)</span>
  <span class="s2">&#34;Hello, </span><span class="si">#{</span><span class="n">name</span><span class="si">}</span><span class="s2">!&#34;</span>
<span class="k">end</span>

<span class="n">Kemal</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="n">port</span>
<span class="n">Kemal</span><span class="o">.</span><span class="n">run</span>
</code></pre></div><p>It simply takes a request at the <code>/greet</code> path, with a <code>name</code> in the request
body, and returns a <code>Hello #{name}!</code>. To run this tiny Crystal server, we can
boot it with:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">$ crystal run server.cr
</code></pre></div><p>This will boot the server and listen on <code>localhost:4000</code>. If we navigate to
<code>localhost:4000</code> in our browser, we will be presented a simple &ldquo;Hello World&rdquo;
page:</p>












<figure class="imagecaption">
  <img class="caption" src="/back-to-the-origin-with-cors/hello-world-localhost.png" caption="Hello, world! üåç" alt="Hello, world! üåç">
  <span class="caption-text" style="font-size: 0.75em;display: table;margin: 0 auto 1.5em;">Hello, world! üåç</span>
</figure>

<p>Now that we know our server is running, let&rsquo;s execute a <code>POST /greet</code> to the
server listening on <code>localhost:4000</code>, from the console of our browser page. We
can do that by using <code>fetch</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nx">fetch</span><span class="p">(</span>
  <span class="s1">&#39;http://localhost:4000/greet&#39;</span><span class="p">,</span>
  <span class="p">{</span>
    <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span>
    <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span> <span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span> <span class="s1">&#39;application/json&#39;</span> <span class="p">},</span>
    <span class="nx">body</span><span class="o">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Ilija&#39;</span><span class="p">})</span>
  <span class="p">}</span>
<span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">resp</span> <span class="p">=&gt;</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">text</span><span class="p">()).</span><span class="nx">then</span><span class="p">(</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">)</span>
</code></pre></div><p>Once we run it, we will see the greeting come back from the server:</p>












<figure class="imagecaption">
  <img class="caption" src="/back-to-the-origin-with-cors/hello-world-localhost-post.png" caption="Hi there! üëã" alt="Hi there! üëã">
  <span class="caption-text" style="font-size: 0.75em;display: table;margin: 0 auto 1.5em;">Hi there! üëã</span>
</figure>

<p>This was a <code>POST</code> request, but it was not cross-origin. We sent the request
from the browser where <code>http://localhost:4000</code> (the origin) was rendered, to
that same origin.</p>
<p>Now, let&rsquo;s try the same request, but cross-origin. We will open
<code>https://google.com</code> and try to send that same request from that tab in our
browser:</p>












<figure class="imagecaption">
  <img class="caption" src="/back-to-the-origin-with-cors/google-cross-origin-post.png" caption="Hello, CORS! üí£" alt="Hello, CORS! üí£">
  <span class="caption-text" style="font-size: 0.75em;display: table;margin: 0 auto 1.5em;">Hello, CORS! üí£</span>
</figure>

<p>We managed to get the famous CORS error. Although our Crystal server can fulfil
the request, our browser is protecting us from ourselves. It is basically
telling us that a website that we have opened wants to make changes to another
website as ourselves.</p>
<p>In the first example, where we sent the request to
<code>http://localhost:4000/greet</code> from the tab that rendered
<code>http://localhost:4000</code>, our browser looks at that request and lets it through
because it appears that our website is calling our server (which is fine). But
in the second example where our website (<code>https://google.com</code>) wants to write
to <code>http://localhost:4000</code>, then our browser flags that request and does not
let it go through.</p>
<h3 id="preflight-requests" class="relative group">Preflight requests <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#preflight-requests" aria-label="Anchor">#</a></span></h3>
<p>If we look deeper in our developer console, in the Network tab in particular,
we will in fact notice two requests in place of the one that we sent:</p>












<figure class="imagecaption">
  <img class="caption" src="/back-to-the-origin-with-cors/google-cross-origin-post-network.png" caption="Two outbound requests as seen in the Network panel" alt="Two outbound requests as seen in the Network panel">
  <span class="caption-text" style="font-size: 0.75em;display: table;margin: 0 auto 1.5em;">Two outbound requests as seen in the Network panel</span>
</figure>

<p>What is interesting to notice is that the first request has a HTTP method of
<code>OPTIONS</code>, while the second has <code>POST.</code></p>
<p>If we explore the <code>OPTIONS</code> request we will see that this is a request that has
been sent by our browser prior to sending our <code>POST</code> request:</p>












<figure class="imagecaption">
  <img class="caption" src="/back-to-the-origin-with-cors/google-cross-origin-post-network-options.png" caption="Looking into the OPTIONS request üîç" alt="Looking into the OPTIONS request üîç">
  <span class="caption-text" style="font-size: 0.75em;display: table;margin: 0 auto 1.5em;">Looking into the <code>OPTIONS</code> request üîç</span>
</figure>

<p>What is interesting is that even though the response to the <code>OPTIONS</code> request
was a HTTP 200, it was still marked as red in the request list. Why?</p>
<p>This is the <strong>preflight request</strong> that modern browsers do. A preflight request
is performed for requests which CORS deems as complex. The criteria for
<em>complex</em> request is:</p>
<ul>
<li>A request that uses methods other than <code>GET</code>, <code>POST</code>, or <code>HEAD</code></li>
<li>A request that includes headers other than <code>Accept</code>, <code>Accept-Language</code> or
<code>Content-Language</code></li>
<li>A request that has a <code>Content-Type</code> header value other than
<code>application/x-www-form-urlencoded</code>, <code>multipart/form-data</code>, or <code>text/plain</code></li>
</ul>
<p>Therefore in the above example, although we send a <code>POST</code> request, the browser
considers our request complex due to the <code>Content-Type: application/json</code>
header.</p>
<p>If we would change our server to handle <code>text/plain</code> content (instead of JSON),
we can work around the need for a preflight request:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-crystal" data-lang="crystal"><span class="k">require</span> <span class="s2">&#34;kemal&#34;</span>

<span class="n">get</span> <span class="s2">&#34;/&#34;</span> <span class="k">do</span>
  <span class="s2">&#34;Hello world!&#34;</span>
<span class="k">end</span>

<span class="n">get</span> <span class="s2">&#34;/greet&#34;</span> <span class="k">do</span>
  <span class="s2">&#34;Hey!&#34;</span>
<span class="k">end</span>

<span class="n">post</span> <span class="s2">&#34;/greet&#34;</span> <span class="k">do</span> <span class="o">|</span><span class="n">env</span><span class="o">|</span>
  <span class="n">body</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">body</span>

  <span class="n">name</span> <span class="o">=</span> <span class="s2">&#34;there&#34;</span>
  <span class="n">name</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">gets</span><span class="o">.</span><span class="n">as</span><span class="p">(</span><span class="nb">String</span><span class="p">)</span> <span class="k">if</span> <span class="o">!</span><span class="n">body</span><span class="o">.</span><span class="n">nil?</span>

  <span class="s2">&#34;Hello, </span><span class="si">#{</span><span class="n">name</span><span class="si">}</span><span class="s2">!&#34;</span>
<span class="k">end</span>

<span class="n">Kemal</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="mi">4000</span>
<span class="n">Kemal</span><span class="o">.</span><span class="n">run</span>
</code></pre></div><p>Now, when we can send our request with the <code>Content-type: text/plain</code> header:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nx">fetch</span><span class="p">(</span>
  <span class="s1">&#39;http://localhost:4000/greet&#39;</span><span class="p">,</span>
  <span class="p">{</span>
    <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span>
    <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
      <span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span> <span class="s1">&#39;text/plain&#39;</span>
    <span class="p">},</span>
    <span class="nx">body</span><span class="o">:</span> <span class="s1">&#39;Ilija&#39;</span>
  <span class="p">}</span>
<span class="p">)</span>
<span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">resp</span> <span class="p">=&gt;</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">text</span><span class="p">())</span>
<span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">)</span>
</code></pre></div><p>Now, while the preflight request will not be sent, the CORS policy of the
browser will keep on blocking:</p>












<figure class="imagecaption">
  <img class="caption" src="/back-to-the-origin-with-cors/google-cross-origin-post-text-plain.png" caption="CORS standing strong" alt="CORS standing strong">
  <span class="caption-text" style="font-size: 0.75em;display: table;margin: 0 auto 1.5em;">CORS standing strong</span>
</figure>

<p>But because we have crafted a request which does not classify as <em>complex</em>, our
browser actually <strong>won&rsquo;t block the request</strong>:</p>












<figure class="imagecaption">
  <img class="caption" src="/back-to-the-origin-with-cors/google-cross-origin-post-text-plain-response-blocked.png" caption="Request went through ‚û°Ô∏è" alt="Request went through ‚û°Ô∏è">
  <span class="caption-text" style="font-size: 0.75em;display: table;margin: 0 auto 1.5em;">Request went through ‚û°Ô∏è</span>
</figure>

<p>Simply put: our server is <em>misconfigured</em> to accept <code>text/plain</code> cross-origin
requests, without any other protection in place, and our browser can&rsquo;t do much
about that. But still, it does the next best thing ‚Äì it does not expose our
opened page / tab to the response of that request. Therefore in this case, CORS
does not block the request - <strong>it blocks the response</strong>.</p>
<p>The CORS policy of our browser considers this effectively a cross-origin read,
because although the request is sent as <code>POST</code>, the <code>Content-type</code> header value
makes it essentially the same as a <code>GET</code>. And cross-origin reads are blocked by
default, hence the blocked response we are seeing in our network tab.</p>
<p>Working around preflight requests like in the example above is not recommended.
In fact, if you expect that your server will have to gracefully handle preflight requests,
it should implement the <code>OPTIONS</code> endpoints and return the correct headers.</p>
<p>When implementing the <code>OPTIONS</code> endpoint, you need to know that the preflight
request of the browser looks for three headers in particular that can be
present on the response:</p>
<ul>
<li><code>Access-Control-Allow-Methods</code> ‚Äì it indicates which methods are supported by
the response‚Äôs URL for the purposes of the CORS protocol.</li>
<li><code>Access-Control-Allow-Headers</code> - it indicates which headers are supported by
the response‚Äôs URL for the purposes of the CORS protocol.</li>
<li><code>Access-Control-Max-Age</code> - it indicates the number of seconds (5 by default)
the information provided by the <code>Access-Control-Allow-Methods</code> and
<code>Access-Control-Allow-Headers</code> headers can be cached.</li>
</ul>
<p>Let&rsquo;s go back to our previous example where we sent a complex request:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nx">fetch</span><span class="p">(</span>
  <span class="s1">&#39;http://localhost:4000/greet&#39;</span><span class="p">,</span>
  <span class="p">{</span>
    <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span>
    <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span> <span class="s1">&#39;Content-Type&#39;</span><span class="o">:</span> <span class="s1">&#39;application/json&#39;</span> <span class="p">},</span>
    <span class="nx">body</span><span class="o">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span> <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;Ilija&#39;</span><span class="p">})</span>
  <span class="p">}</span>
<span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="nx">resp</span> <span class="p">=&gt;</span> <span class="nx">resp</span><span class="p">.</span><span class="nx">text</span><span class="p">()).</span><span class="nx">then</span><span class="p">(</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">)</span>
</code></pre></div><p>We already confirmed that when we send this request, our browser will check
with the server if it can perform the cross-origin request. To get this request
working in a cross-origin environment, we have to first add the <code>OPTIONS /greet</code> endpoint to our server. In its response header, the new endpoint will
have to inform the browser that the request to <code>POST /greet</code>, with
<code>Content-type: application/json</code> header, from the origin
<code>https://www.google.com</code>, can be accepted.</p>
<p>We&rsquo;ll do this by using the <code>Access-Control-Allow-*</code> headers:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-crystal" data-lang="crystal"><span class="n">options</span> <span class="s2">&#34;/greet&#34;</span> <span class="k">do</span> <span class="o">|</span><span class="n">env</span><span class="o">|</span>
  <span class="c1"># Allow `POST /greet`...</span>
  <span class="n">env</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">[</span><span class="s2">&#34;Access-Control-Allow-Methods&#34;</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&#34;POST&#34;</span>
  <span class="c1"># ...with `Content-type` header in the request...</span>
  <span class="n">env</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">[</span><span class="s2">&#34;Access-Control-Allow-Headers&#34;</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&#34;Content-type&#34;</span>
  <span class="c1"># ...from https://www.google.com origin.</span>
  <span class="n">env</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">[</span><span class="s2">&#34;Access-Control-Allow-Origin&#34;</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&#34;https://www.google.com&#34;</span>
<span class="k">end</span>
</code></pre></div><p>If we boot our server and send the request:</p>












<figure class="imagecaption">
  <img class="caption" src="/back-to-the-origin-with-cors/google-cross-origin-post-blocked.png" caption="Still blocked? ü§î" alt="Still blocked? ü§î">
  <span class="caption-text" style="font-size: 0.75em;display: table;margin: 0 auto 1.5em;">Still blocked? ü§î</span>
</figure>

<p>Our request remains blocked. Even though our <code>OPTIONS /greet</code> endpoint did
allow the request, we are still seeing the error message. In our network tab
there&rsquo;s something interesting going on:</p>












<figure class="imagecaption">
  <img class="caption" src="/back-to-the-origin-with-cors/google-cross-origin-post-blocked-network-inspect.png" caption="OPTIONS is green! üéâ" alt="OPTIONS is green! üéâ">
  <span class="caption-text" style="font-size: 0.75em;display: table;margin: 0 auto 1.5em;">OPTIONS is green! üéâ</span>
</figure>

<p>The request to the <code>OPTIONS /greet</code> endpoint was a success! But the <code>POST /greet</code> call still failed. If we take a peek in the internals of the <code>POST /greet</code> request we will see a familiar sight:</p>












<figure class="imagecaption">
  <img class="caption" src="/back-to-the-origin-with-cors/google-cross-origin-post-blocked-post-inspect.png" caption="POST is green too? üò≤" alt="POST is green too? üò≤">
  <span class="caption-text" style="font-size: 0.75em;display: table;margin: 0 auto 1.5em;">POST is green too? üò≤</span>
</figure>

<p>In fact, the request did succeed ‚Äì the server returned a HTTP 200. The
preflight request did work ‚Äì the browser did make the <code>POST</code> request instead of
blocking it. But the response of the <code>POST</code> request did not contain any CORS
headers, so even though the browser did make the request, it blocked any
response processing.</p>
<p>To allow the browser also process the response from the <code>POST /greet</code> request,
we need to add a CORS header to the <code>POST</code> endpoint as well:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-crystal" data-lang="crystal"><span class="n">post</span> <span class="s2">&#34;/greet&#34;</span> <span class="k">do</span> <span class="o">|</span><span class="n">env</span><span class="o">|</span>
  <span class="n">name</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">json</span><span class="o">[</span><span class="s2">&#34;name&#34;</span><span class="o">].</span><span class="n">as</span><span class="p">(</span><span class="nb">String</span><span class="p">)</span>

  <span class="n">env</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">[</span><span class="s2">&#34;Access-Control-Allow-Origin&#34;</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&#34;https://www.google.com&#34;</span>

  <span class="s2">&#34;Hello, </span><span class="si">#{</span><span class="n">name</span><span class="si">}</span><span class="s2">!&#34;</span>
<span class="k">end</span>
</code></pre></div><p>By adding the <code>Access-Control-Allow-Origin</code> header response header, we tell the
browser that a tab that has <code>https://www.google.com</code> open can also access the
response payload.</p>
<p>If we give this another shot:</p>












<figure class="imagecaption">
  <img class="caption" src="/back-to-the-origin-with-cors/google-cross-origin-post-success.png" caption="POST works!" alt="POST works!">
  <span class="caption-text" style="font-size: 0.75em;display: table;margin: 0 auto 1.5em;">POST works!</span>
</figure>

<p>We will see that <code>POST /greet</code> did get us a response, without any errors. If
we take a peek in the Network tab, we&rsquo;ll see that both requests are green:</p>












<figure class="imagecaption">
  <img class="caption" src="/back-to-the-origin-with-cors/google-cross-origin-post-success-network.png" caption="OPTIONS &amp; POST in action! üí™" alt="OPTIONS &amp; POST in action! üí™">
  <span class="caption-text" style="font-size: 0.75em;display: table;margin: 0 auto 1.5em;">OPTIONS &amp; POST in action! üí™</span>
</figure>

<p>By using proper response headers on our preflight endpoint <code>OPTIONS /greet</code>, we
unlocked our server&rsquo;s <code>POST /greet</code> endpoint to be accessed across different
origin. On top of that, by providing a correct CORS response header on the
response of the <code>POST /greet</code> endpoint, we freed the browser to process the
response without any blocking.</p>
<h3 id="cross-origin-reads" class="relative group">Cross-origin reads <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#cross-origin-reads" aria-label="Anchor">#</a></span></h3>
<p>As we mentioned before, cross-origin reads are blocked by default. That&rsquo;s on
purpose - we wouldn&rsquo;t want to load other resources from other origins in the
scope of our origin.</p>
<p>Say, we have a <code>GET /greet</code> action in our Crystal server:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-crystal" data-lang="crystal"><span class="n">get</span> <span class="s2">&#34;/greet&#34;</span> <span class="k">do</span>
  <span class="s2">&#34;Hey!&#34;</span>
<span class="k">end</span>
</code></pre></div><p>From our tab that has <code>www.google.com</code> rendered, if we try to <code>fetch</code> the <code>GET /greet</code> endpoint we will get blocked by CORS:</p>












<figure class="imagecaption">
  <img class="caption" src="/back-to-the-origin-with-cors/google-cross-origin-get.png" caption="CORS blocking üôÖ" alt="CORS blocking üôÖ">
  <span class="caption-text" style="font-size: 0.75em;display: table;margin: 0 auto 1.5em;">CORS blocking üôÖ</span>
</figure>

<p>If we look deeper in the request, we will found out something interesting:</p>












<figure class="imagecaption">
  <img class="caption" src="/back-to-the-origin-with-cors/google-cross-origin-get-blocked-inspect.png" caption="A successful GET üéâ" alt="A successful GET üéâ">
  <span class="caption-text" style="font-size: 0.75em;display: table;margin: 0 auto 1.5em;">A successful GET üéâ</span>
</figure>

<p>In fact, just like before, our browser did let the request through ‚Äì¬†we got a
HTTP 200 back. But it did not expose our opened page / tab to the response of
that request. Again, in this case CORS does not block the request - <strong>it blocks
the response</strong>.</p>
<p>Just like with cross-origin writes, we can relax CORS and make it available for
cross-origin reading - by adding the <code>Access-Control-Allow-Origin</code> header:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-crystal" data-lang="crystal"><span class="n">get</span> <span class="s2">&#34;/greet&#34;</span> <span class="k">do</span> <span class="o">|</span><span class="n">env</span><span class="o">|</span>
  <span class="n">env</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">[</span><span class="s2">&#34;Access-Control-Allow-Origin&#34;</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&#34;https://www.google.com&#34;</span>
  <span class="s2">&#34;Hey!&#34;</span>
<span class="k">end</span>
</code></pre></div><p>When the browser gets the response back from the server, it will look at the
<code>Access-Control-Allow-Origin</code> header and will decide based on its value if it
can let the page read the response. Given that the value in this case is
<code>https://www.google.com</code> which is the page that we use in our example the
outcome will be a success:</p>












<figure class="imagecaption">
  <img class="caption" src="/back-to-the-origin-with-cors/google-cross-origin-get-success.png" caption="A successful cross-origin GET üéâ" alt="A successful cross-origin GET üéâ">
  <span class="caption-text" style="font-size: 0.75em;display: table;margin: 0 auto 1.5em;">A successful cross-origin GET üéâ</span>
</figure>

<p>This is how the browser shields us from cross-origin reads and respects the
server directives that are sent via the headers.</p>
<h2 id="fine-tuning-cors" class="relative group">Fine-tuning CORS <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#fine-tuning-cors" aria-label="Anchor">#</a></span></h2>
<p>As we already saw in previous examples, to relax the CORS policy of our
website, we can set the <code>Access-Control-Allow-Origin</code> of our <code>/greet</code> action to
the <code>https://www.google.com</code> value:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-crystal" data-lang="crystal"><span class="n">post</span> <span class="s2">&#34;/greet&#34;</span> <span class="k">do</span> <span class="o">|</span><span class="n">env</span><span class="o">|</span>
  <span class="n">body</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">body</span>

  <span class="n">name</span> <span class="o">=</span> <span class="s2">&#34;there&#34;</span>
  <span class="n">name</span> <span class="o">=</span> <span class="n">body</span><span class="o">.</span><span class="n">gets</span><span class="o">.</span><span class="n">as</span><span class="p">(</span><span class="nb">String</span><span class="p">)</span> <span class="k">if</span> <span class="o">!</span><span class="n">body</span><span class="o">.</span><span class="n">nil?</span>

  <span class="n">env</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">[</span><span class="s2">&#34;Access-Control-Allow-Origin&#34;</span><span class="o">]</span> <span class="o">=</span> <span class="s2">&#34;https://www.google.com&#34;</span>
  <span class="s2">&#34;Hello, </span><span class="si">#{</span><span class="n">name</span><span class="si">}</span><span class="s2">!&#34;</span>
<span class="k">end</span>
</code></pre></div><p>This will allow the <code>https://www.google.com</code> origin to call our server, and our
browser will feel fine about that. Having the <code>Access-Control-Allow-Origin</code> in
place, we can try to execute the <code>fetch</code> call again:</p>












<figure class="imagecaption">
  <img class="caption" src="/back-to-the-origin-with-cors/google-cross-origin-post-text-plain-success.png" caption="Success! üéâ" alt="Success! üéâ">
  <span class="caption-text" style="font-size: 0.75em;display: table;margin: 0 auto 1.5em;">Success! üéâ</span>
</figure>

<p>This made it work! With the new CORS policy, we can call our <code>/greet</code> action
from our tab that has <code>https://www.google.com</code> rendered. Alternatively, we
could also set the header value to <code>*</code>, which would tell the browser that the
server can be called from any origin.</p>
<p>Such a configuration has to be carefully considered. Yet, putting relaxed CORS
headers is <strong>almost always</strong> safe. One rule of thumb is: if you open the URL in
an incognito tab, and you are happy with the information you are exposing, then
you can set a permissive (<code>*</code>) CORS policy on said URL.</p>
<p>Another way to fine-tune CORS on our website is to use the
<code>Access-Control-Allow-Credentials</code> response header.
<code>Access-Control-Allow-Credentials</code> instructs browsers whether to expose the
response to the frontend JavaScript code when the request&rsquo;s credentials mode is
<code>include</code>.</p>
<p>The request&rsquo;s credentials mode comes from the introduction of <a href="https://fetch.spec.whatwg.org/">the Fetch
API</a>, which has its roots back the original
<code>XMLHttpRequest</code> objects:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="kd">var</span> <span class="nx">client</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">()</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s2">&#34;GET&#34;</span><span class="p">,</span> <span class="s2">&#34;./&#34;</span><span class="p">)</span>
<span class="nx">client</span><span class="p">.</span><span class="nx">withCredentials</span> <span class="o">=</span> <span class="kc">true</span>
</code></pre></div><p>With the introduction of <code>fetch</code>, the <code>withCredentials</code> option was transformed
into an optional argument to the <code>fetch</code> call:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="nx">fetch</span><span class="p">(</span><span class="s2">&#34;./&#34;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">credentials</span><span class="o">:</span> <span class="s2">&#34;include&#34;</span> <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="cm">/* ... */</span><span class="p">)</span>
</code></pre></div><p>The available options for the <code>credentials</code> options are <code>omit</code>, <code>same-origin</code>
and <code>include</code>. The different modes are available so developers can fine-tune
the outbound request, whereas the response from the server will inform the
browser how to behave when credentials are sent with the request (via the
<code>Access-Control-Allow-Credentials</code> header).</p>
<p>The Fetch API spec contains a well-written and thorough
<a href="https://fetch.spec.whatwg.org/#cors-protocol-and-credentials">breakdown</a> of
the interplay of CORS and the <code>fetch</code> Web API, and the security mechanisms put
in place by browsers.</p>
<h2 id="some-best-practices" class="relative group">Some best practices <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#some-best-practices" aria-label="Anchor">#</a></span></h2>
<p>Before we wrap it up, let&rsquo;s cover some best practices when it comes to Cross
Origin Resource Sharing (CORS).</p>
<h3 id="free-for-all" class="relative group">Free for all <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#free-for-all" aria-label="Anchor">#</a></span></h3>
<p>A common example is if you own a website that displays content for the public,
that is not behind paywalls, or requiring authentication or authorization ‚Äì¬†you
should be able to set <code>Access-Control-Allow-Origin: *</code> to its resources.</p>
<p>The <code>*</code> value is a good choice in cases when:</p>
<ul>
<li>No authentication or authorization is required</li>
<li>The resource should be accessible to a wide range of users without
restrictions</li>
<li>The origins &amp; clients that will access the resource is of great variety, you
don&rsquo;t have knowledge of it or you simply don&rsquo;t care</li>
</ul>
<p>A dangerous prospect of such configuration is when it comes to content served
on private networks (i.e. behind firewall or VPN). When you are connected via a
VPN, you have access to the files on the company&rsquo;s network:</p>












<figure class="imagecaption">
  <img class="caption" src="/back-to-the-origin-with-cors/vpn-access-diagram.png" caption="Oversimplification of VPNs" alt="Oversimplification of VPNs">
  <span class="caption-text" style="font-size: 0.75em;display: table;margin: 0 auto 1.5em;">Oversimplification of VPNs</span>
</figure>

<p>Now, if an attacker hosts as website <code>dangerous.com</code>, which contains a link to
a file within the VPN, they can (in theory) create a script on their website
that can access that file:</p>












<figure class="imagecaption">
  <img class="caption" src="/back-to-the-origin-with-cors/vpn-access-attacker-diagram.png" caption="File leak" alt="File leak">
  <span class="caption-text" style="font-size: 0.75em;display: table;margin: 0 auto 1.5em;">File leak</span>
</figure>

<p>While such an attack is hard and requires a lot of knowledge about the VPN and
the files stored within it, it is a potential attack vector that we must be
aware of.</p>
<h3 id="keeping-it-in-the-family" class="relative group">Keeping it in the family <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#keeping-it-in-the-family" aria-label="Anchor">#</a></span></h3>
<p>Continuing with the example from above, imagine we want to implement analytics
for our website. We would like our users' browsers to send us data about the
experience and behavior of our users on our website.</p>
<p>A common way to do this is to send that data periodically using asynchronous
requests using JavaScript in the browser. On the backend we have a simple API
that takes these requests from our users' browsers and stores the data on the
backend for further processing.</p>
<p>In such cases, our API is public, but we don&rsquo;t want <em>any</em> website to send data to our
analytics API. In fact, we are interested only in requests that originate from
browsers that have our website rendered ‚Äì¬†that is all.</p>












<figure class="imagecaption">
  <img class="caption" src="/back-to-the-origin-with-cors/no-cross-origin-api.png" caption="" alt="">
  <span class="caption-text" style="font-size: 0.75em;display: table;margin: 0 auto 1.5em;"></span>
</figure>

<p>In such cases, we want our API to set the <code>Access-Control-Allow-Origin</code> header
to our website&rsquo;s URL. That will make sure browsers never send requests to our
API from other pages.</p>
<p>If users or other websites try to cram data in our analytics API, the
<code>Access-Control-Allow-Origin</code> headers set on the resources of our API won&rsquo;t let
the request to go through:</p>












<figure class="imagecaption">
  <img class="caption" src="/back-to-the-origin-with-cors/failed-cross-origin-api.png" caption="" alt="">
  <span class="caption-text" style="font-size: 0.75em;display: table;margin: 0 auto 1.5em;"></span>
</figure>

<h3 id="null-origins" class="relative group">NULL origins <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#null-origins" aria-label="Anchor">#</a></span></h3>
<p>Another interesting case are <code>null</code> origins. They occur when a resource is
accessed by a browser that renders a local file. For example, requests coming
from some JavaScript running in a static file on your local machine have the
<code>Origin</code> header set to <code>null</code>.</p>
<p>In such cases, if our servers do now allow access to resources for the <code>null</code>
origin, then it can be a hindrance to the developer productivity. Allowing the
<code>null</code> origin within your CORS policy has to be deliberately done, and only if
the users of your website / product are developers.</p>
<h3 id="skip-cookies-if-you-can" class="relative group">Skip cookies, if you can <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#skip-cookies-if-you-can" aria-label="Anchor">#</a></span></h3>
<p>As we saw before with the <code>Access-Control-Allow-Credentials</code>, cookies are not
enabled by default. To allow cross-origin sending cookies, it as easy as
returning <code>Access-Control-Allow-Credentials: true</code>. This header will tell
browsers that they are allowed to send credentials (i.e. cookies) in
cross-origin requests.</p>
<p>Allowing and accepting cross-origin cookies can be tricky. You could expose
yourself to potential attack vectors, so enable them only when <strong>absolutely
necessary</strong>.</p>
<p>Cross-origin cookies work best in situations when you know exactly which
clients will be accessing your server. That is why the CORS semantics do not
allow us to set <code>Access-Control-Allow-Origin: *</code> when cross-origin credentials
are allowed.</p>
<p>While the <code>Access-Control-Allow-Origin: *</code> and
<code>Access-Control-Allow-Credentials: true</code> combination is technically allowed,
it&rsquo;s a anti-pattern and should absolutely be avoided.</p>
<p>If you would like your servers to be accessed by different clients and origins,
you should probably look into building an API (with token-based authentication)
instead of using cookies. But if going down the API path is not an option, then
make sure you implement cross-site request forgery (CSRF) protection.</p>
<h2 id="additional-reading" class="relative group">Additional reading <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#additional-reading" aria-label="Anchor">#</a></span></h2>
<p>I hope this (long) read gave you a good idea about CORS, how it came to be, and
why it&rsquo;s neccesary. Here are a few more links that I used while writing this
article, or that I believe are a good read on the topic:</p>
<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">Cross-Origin Resource Sharing (CORS)</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Access-Control-Allow-Credentials"><code>Access-Control-Allow-Credentials</code> header</a> on MDN Web Docs</li>
<li><a href="https://www.moesif.com/blog/technical/cors/Authoritative-Guide-to-CORS-Cross-Origin-Resource-Sharing-for-REST-APIs/">Authoritative guide to CORS (Cross-Origin Resource Sharing) for REST APIs</a></li>
<li>The <a href="https://fetch.spec.whatwg.org/#http-cors-protocol">&ldquo;CORS protocol&rdquo; section</a> of the <a href="https://fetch.spec.whatwg.org">Fetch API spec</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy">Same-origin policy</a> on MDN Web Docs</li>
<li><a href="https://stackoverflow.com/users/19068/quentin">Quentin&rsquo;s</a> great <a href="https://stackoverflow.com/a/35553666">summary of CORS</a> on StackOverflow</li>
</ul>
<div id="revue-embed">
  <form action="https://www.getrevue.co/profile/itsilija/add_subscriber" method="post" id="revue-form" name="revue-form"  target="_blank">
    <p><b>Liked this article?</b>
Subscribe to my newsletter and get future articles in your inbox. It's a
short and sweet read, going out to hundreds of other engineers.</p>
    <div class="revue-form-group">
      <input class="revue-form-field" placeholder="Your email address..." type="email" name="member[email]" id="member_email">
    </div>
    <div class="revue-form-actions">
      <input type="submit" value="Subscribe" name="member[subscribe]" id="member_submit">
    </div>
  </form>
</div>


      </div>
    </section>
    <footer class="pt-8 max-w-prose print:hidden">
      
  <div class="flex">
    
      
      
        
        <img
          class="w-24 h-24 !mt-0 !mb-0 ltr:mr-4 rtl:ml-4 rounded-full"
          width="96"
          height="96"
          alt="Ilija Eftimov"
          src="/img/avatar_huae39953c6189b6aa60e47103b358d088_112612_192x192_fill_q75_box_smart1.jpg"
        />
      
    
    <div class="place-self-center">
      
        <div class="text-[0.6rem] leading-3 text-neutral-500 dark:text-neutral-400 uppercase">
          Author
        </div>
        <div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">
          Ilija Eftimov
        </div>
      
      
      <div class="text-2xl sm:text-lg">
  <div class="flex flex-wrap text-neutral-400 dark:text-neutral-500">
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://twitter.com/efilija"
          target="_blank"
          aria-label="Twitter"
          rel="me noopener noreferrer"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>

  </span>

</a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://www.linkedin.com/in/ieftimov/"
          target="_blank"
          aria-label="Linkedin"
          rel="me noopener noreferrer"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>

  </span>

</a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="mailto:blog@ieftimov.com"
          target="_blank"
          aria-label="Email"
          rel="me noopener noreferrer"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1c-27.64 140.9 68.65 266.2 199.1 285.1c19.01 2.888 36.17-12.26 36.17-31.49l.0001-.6631c0-15.74-11.44-28.88-26.84-31.24c-84.35-12.98-149.2-86.13-149.2-174.2c0-102.9 88.61-185.5 193.4-175.4c91.54 8.869 158.6 91.25 158.6 183.2l0 16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98 .0036c-7.299 0-13.2 4.992-15.12 11.68c-24.85-12.15-54.24-16.38-86.06-5.106c-38.75 13.73-68.12 48.91-73.72 89.64c-9.483 69.01 43.81 128 110.9 128c26.44 0 50.43-9.544 69.59-24.88c24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3C495.1 107.1 361.2-9.332 207.8 20.73zM239.1 304.3c-26.47 0-48-21.56-48-48.05s21.53-48.05 48-48.05s48 21.56 48 48.05S266.5 304.3 239.1 304.3z"/></svg>

  </span>

</a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://dev.to/fteem"
          target="_blank"
          aria-label="Dev"
          rel="me noopener noreferrer"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M120.12 208.29c-3.88-2.9-7.77-4.35-11.65-4.35H91.03v104.47h17.45c3.88 0 7.77-1.45 11.65-4.35 3.88-2.9 5.82-7.25 5.82-13.06v-69.65c-.01-5.8-1.96-10.16-5.83-13.06zM404.1 32H43.9C19.7 32 .06 51.59 0 75.8v360.4C.06 460.41 19.7 480 43.9 480h360.2c24.21 0 43.84-19.59 43.9-43.8V75.8c-.06-24.21-19.7-43.8-43.9-43.8zM154.2 291.19c0 18.81-11.61 47.31-48.36 47.25h-46.4V172.98h47.38c35.44 0 47.36 28.46 47.37 47.28l.01 70.93zm100.68-88.66H201.6v38.42h32.57v29.57H201.6v38.41h53.29v29.57h-62.18c-11.16.29-20.44-8.53-20.72-19.69V193.7c-.27-11.15 8.56-20.41 19.71-20.69h63.19l-.01 29.52zm103.64 115.29c-13.2 30.75-36.85 24.63-47.44 0l-38.53-144.8h32.57l29.71 113.72 29.57-113.72h32.58l-38.46 144.8z"/></svg>

  </span>

</a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://github.com/fteem"
          target="_blank"
          aria-label="Github"
          rel="me noopener noreferrer"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>

  </span>

</a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://t.me/ieftimovcom"
          target="_blank"
          aria-label="Telegram"
          rel="me noopener noreferrer"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M248,8C111.033,8,0,119.033,0,256S111.033,504,248,504,496,392.967,496,256,384.967,8,248,8ZM362.952,176.66c-3.732,39.215-19.881,134.378-28.1,178.3-3.476,18.584-10.322,24.816-16.948,25.425-14.4,1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25,5.342-39.5,3.652-3.793,67.107-61.51,68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608,69.142-14.845,10.194-26.894,9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7,18.45-13.7,108.446-47.248,144.628-62.3c68.872-28.647,83.183-33.623,92.511-33.789,2.052-.034,6.639.474,9.61,2.885a10.452,10.452,0,0,1,3.53,6.716A43.765,43.765,0,0,1,362.952,176.66Z"/></svg>

  </span>

</a
        >
      
    
  </div>

</div>
    </div>
  </div>


      
  
  <section class="flex flex-row flex-wrap justify-center pt-4 text-xl">
    
      
        <a
          class="bg-neutral-300 text-neutral-700 dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800 m-1 hover:bg-primary-500 hover:text-neutral rounded min-w-[2.4rem] inline-block text-center p-1"
          href="https://www.facebook.com/sharer/sharer.php?u=https://ieftimov.com/posts/deep-dive-cors-history-how-it-works-best-practices/&amp;quote=Deep%20dive%20in%20CORS:%20History,%20how%20it%20works,%20and%20best%20practices"
          title="Share on Facebook"
          aria-label="Share on Facebook"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg>

  </span>

</a
        >
      
    
      
        <a
          class="bg-neutral-300 text-neutral-700 dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800 m-1 hover:bg-primary-500 hover:text-neutral rounded min-w-[2.4rem] inline-block text-center p-1"
          href="https://twitter.com/intent/tweet/?url=https://ieftimov.com/posts/deep-dive-cors-history-how-it-works-best-practices/&amp;text=Deep%20dive%20in%20CORS:%20History,%20how%20it%20works,%20and%20best%20practices"
          title="Tweet on Twitter"
          aria-label="Tweet on Twitter"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>

  </span>

</a
        >
      
    
      
        <a
          class="bg-neutral-300 text-neutral-700 dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800 m-1 hover:bg-primary-500 hover:text-neutral rounded min-w-[2.4rem] inline-block text-center p-1"
          href="https://reddit.com/submit/?url=https://ieftimov.com/posts/deep-dive-cors-history-how-it-works-best-practices/&amp;resubmit=true&amp;title=Deep%20dive%20in%20CORS:%20History,%20how%20it%20works,%20and%20best%20practices"
          title="Submit to Reddit"
          aria-label="Submit to Reddit"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M201.5 305.5c-13.8 0-24.9-11.1-24.9-24.6 0-13.8 11.1-24.9 24.9-24.9 13.6 0 24.6 11.1 24.6 24.9 0 13.6-11.1 24.6-24.6 24.6zM504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-132.3-41.2c-9.4 0-17.7 3.9-23.8 10-22.4-15.5-52.6-25.5-86.1-26.6l17.4-78.3 55.4 12.5c0 13.6 11.1 24.6 24.6 24.6 13.8 0 24.9-11.3 24.9-24.9s-11.1-24.9-24.9-24.9c-9.7 0-18 5.8-22.1 13.8l-61.2-13.6c-3-.8-6.1 1.4-6.9 4.4l-19.1 86.4c-33.2 1.4-63.1 11.3-85.5 26.8-6.1-6.4-14.7-10.2-24.1-10.2-34.9 0-46.3 46.9-14.4 62.8-1.1 5-1.7 10.2-1.7 15.5 0 52.6 59.2 95.2 132 95.2 73.1 0 132.3-42.6 132.3-95.2 0-5.3-.6-10.8-1.9-15.8 31.3-16 19.8-62.5-14.9-62.5zM302.8 331c-18.2 18.2-76.1 17.9-93.6 0-2.2-2.2-6.1-2.2-8.3 0-2.5 2.5-2.5 6.4 0 8.6 22.8 22.8 87.3 22.8 110.2 0 2.5-2.2 2.5-6.1 0-8.6-2.2-2.2-6.1-2.2-8.3 0zm7.7-75c-13.6 0-24.6 11.1-24.6 24.9 0 13.6 11.1 24.6 24.6 24.6 13.8 0 24.9-11.1 24.9-24.6 0-13.8-11-24.9-24.9-24.9z"/></svg>

  </span>

</a
        >
      
    
      
        <a
          class="bg-neutral-300 text-neutral-700 dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800 m-1 hover:bg-primary-500 hover:text-neutral rounded min-w-[2.4rem] inline-block text-center p-1"
          href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://ieftimov.com/posts/deep-dive-cors-history-how-it-works-best-practices/&amp;title=Deep%20dive%20in%20CORS:%20History,%20how%20it%20works,%20and%20best%20practices"
          title="Share on LinkedIn"
          aria-label="Share on LinkedIn"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>

  </span>

</a
        >
      
    
      
        <a
          class="bg-neutral-300 text-neutral-700 dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800 m-1 hover:bg-primary-500 hover:text-neutral rounded min-w-[2.4rem] inline-block text-center p-1"
          href="mailto:?body=https://ieftimov.com/posts/deep-dive-cors-history-how-it-works-best-practices/&amp;subject=Deep%20dive%20in%20CORS:%20History,%20how%20it%20works,%20and%20best%20practices"
          title="Send via email"
          aria-label="Send via email"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1c-27.64 140.9 68.65 266.2 199.1 285.1c19.01 2.888 36.17-12.26 36.17-31.49l.0001-.6631c0-15.74-11.44-28.88-26.84-31.24c-84.35-12.98-149.2-86.13-149.2-174.2c0-102.9 88.61-185.5 193.4-175.4c91.54 8.869 158.6 91.25 158.6 183.2l0 16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98 .0036c-7.299 0-13.2 4.992-15.12 11.68c-24.85-12.15-54.24-16.38-86.06-5.106c-38.75 13.73-68.12 48.91-73.72 89.64c-9.483 69.01 43.81 128 110.9 128c26.44 0 50.43-9.544 69.59-24.88c24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3C495.1 107.1 361.2-9.332 207.8 20.73zM239.1 304.3c-26.47 0-48-21.56-48-48.05s21.53-48.05 48-48.05s48 21.56 48 48.05S266.5 304.3 239.1 304.3z"/></svg>

  </span>

</a
        >
      
    
  </section>


      
  
    
    
    
    <div class="pt-8">
      <hr class="border-dotted border-neutral-300 dark:border-neutral-600" />
      <div class="flex justify-between pt-3">
        <span>
          
            <a class="flex group" href="/posts/testing-in-go-stop-leaking-files/">
              <span
                class="mr-3 ltr:inline rtl:hidden text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400"
                >&larr;</span
              >
              <span
                class="ml-3 ltr:hidden rtl:inline text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >Testing in Go: Stop Leaking Files</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2020-05-22 00:00:00 &#43;0000 UTC">22 May 2020</time>
                  
                </span>
              </span>
            </a>
          
        </span>
        <span>
          
            <a class="flex text-right group" href="/posts/conditional-http-get-fastest-requests-need-no-response-body/">
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >Conditional HTTP GET: The fastest requests need no response body</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2021-06-01 00:00:00 &#43;0000 UTC">1 June 2021</time>
                  
                </span>
              </span>
              <span
                class="ml-3 ltr:inline rtl:hidden text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span
                class="mr-3 ltr:hidden rtl:inline text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400"
                >&larr;</span
              >
            </a>
          
        </span>
      </div>
    </div>
  


      
    </footer>
  </article>

        
          <div
            class="absolute top-[100vh] ltr:right-0 rtl:left-0 w-12 pointer-events-none bottom-0"
          >
            <a
              href="#the-top"
              class="w-12 h-12 sticky pointer-events-auto top-[calc(100vh-5.5rem)] bg-neutral/50 dark:bg-neutral-800/50 backdrop-blur rounded-full text-xl flex items-center justify-center text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400"
              aria-label="Scroll to top"
              title="Scroll to top"
            >
              &uarr;
            </a>
          </div>
        
      </main><footer class="py-10 print:hidden">
  
  
    <nav class="pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400">
      <ul class="flex flex-col list-none sm:flex-row">
        
          <li
            class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"
          >
            <a
              class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
              href="/analytics"
              title=""
              >Analytics</a
            >
          </li>
        
          <li
            class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"
          >
            <a
              class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
              href="/index.xml"
              title=""
              >RSS</a
            >
          </li>
        
          <li
            class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"
          >
            <a
              class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
              href="https://forms.gle/orfXK5jh1LRaiFzo8"
              title=""
              >Suggest a topic</a
            >
          </li>
        
      </ul>
    </nav>
  
  <div class="flex items-center justify-between">
    <div>
      
      
        <p class="text-sm text-neutral-500 dark:text-neutral-400">
            &copy;
            2022
            Ilija Eftimov
        </p>
      
      
      
        <p class="text-xs text-neutral-500 dark:text-neutral-400">
          
          
          Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
            href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a> &amp; <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href="https://git.io/hugo-congo" target="_blank" rel="noopener noreferrer">Congo</a>
        </p>
      
    </div>
    
    
      <div
        class="text-sm cursor-pointer text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400 ltr:mr-14 rtl:ml-14"
      >
        <button
          id="appearance-switcher"
          class="w-12 h-12 "
          type="button"
          title="Switch to dark appearance"
        >
          <span class="inline dark:hidden">

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>

</span>
          <span class="hidden dark:inline">

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>

</span>
        </button>
      </div>
    
  </div>
  
  
</footer>
<div
  id="search-wrapper"
  class="fixed inset-0 z-50 flex flex-col p-4 sm:p-6 md:p-[10vh] lg:p-[12vh] w-screen h-screen cursor-default bg-neutral-500/50 backdrop-blur-sm dark:bg-neutral-900/50 invisible"
  data-url="https://ieftimov.com/"
>
  <div
    id="search-modal"
    class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg border-neutral-200 top-20 bg-neutral dark:bg-neutral-800 dark:border-neutral-700"
  >
    <header class="relative z-10 flex items-center justify-between flex-none px-2">
      <form class="flex items-center flex-auto min-w-0">
        <div class="flex items-center justify-center w-8 h-8 text-neutral-400">
          

  <span class="relative inline-block align-text-bottom icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


        </div>
        <input
          type="search"
          id="search-query"
          class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-transparent focus:outline-2"
          placeholder="Search"
          tabindex="0"
        />
      </form>
      <button
        id="close-search-button"
        class="flex items-center justify-center w-8 h-8 text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400"
        title="Close (Esc)"
      >
        

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>

  </span>


      </button>
    </header>
    <section class="flex-auto px-2 overflow-auto">
      <ul id="search-results">
        
      </ul>
    </section>
  </div>
</div>

    </div>
  </body>
</html>
