

<!DOCTYPE html>
<html
  lang="en"
  dir="ltr"
  class="scroll-smooth"
  data-default-appearance="light"
  data-auto-appearance="true"
><head>
  <meta charset="utf-8" />
  
    <meta http-equiv="content-language" content="en" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  
  <title>Barebones model of Spotify&#39;s &#39;Recently Played&#39; screen using a Least Recently Used (LRU) cache in Golang &middot; Ilija Eftimov üë®‚ÄçüöÄ</title>
    <meta name="title" content="Barebones model of Spotify&#39;s &#39;Recently Played&#39; screen using a Least Recently Used (LRU) cache in Golang &middot; Ilija Eftimov üë®‚ÄçüöÄ" />
  
  <meta name="description" content="Documenting my experiences and learnings, with the goal of helping other software engineers on their journey" />
  
  
  
  <link rel="canonical" href="https://ieftimov.com/posts/spotify-recently-played-least-recently-used-cache-golang/" />
  
  
  
  
  
  
  
  
  
    
  
  
  <link
    type="text/css"
    rel="stylesheet"
    href="/css/main.bundle.min.4801cb831d6359e43865e37733fc89df21983ad1c08157d4e17c36e09cb2501cdbd2e1dcde1db016cfa1554f175134d948555ab487816811cb9e93b19673ce89.css"
    integrity="sha512-SAHLgx1jWeQ4ZeN3M/yJ3yGYOtHAgVfU4Xw24JyyUBzb0uHc3h2wFs&#43;hVU8XUTTZSFVatIeBaBHLnpOxlnPOiQ=="
  />
  
  
  <script type="text/javascript" src="/js/appearance.min.badab316c9287a5a42a843e4eb45da65bb3d194a5a0f5fa4a3e516160e67df0b8c65f4f19a8e146436e29d583699e6cb41d6bbe99e05e1dbaa877763bad9f8e2.js" integrity="sha512-utqzFskoelpCqEPk60XaZbs9GUpaD1&#43;ko&#43;UWFg5n3wuMZfTxmo4UZDbinVg2mebLQda76Z4F4duqh3djutn44g=="></script>
  
    
    
    
  
  
    
    
  
  
  
    
    <script defer type="text/javascript" id="script-bundle" src="/js/main.bundle.min.15ae6e2c9b1ac24a9ccf40003fa689efb1a18db1ee9b73d780b01a6c31b150441415862513e93184f68fe385759e4698b8763cba6a0f79493c1fed99ad5868d4.js" integrity="sha512-Fa5uLJsawkqcz0AAP6aJ77GhjbHum3PXgLAabDGxUEQUFYYlE&#43;kxhPaP44V1nkaYuHY8umoPeUk8H&#43;2ZrVho1A==" data-copy="Copy" data-copied="Copied"></script>
  
  
  
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />
  
  
  
  
  
  
  
  <meta property="og:title" content="Barebones model of Spotify&#39;s &#39;Recently Played&#39; screen using a Least Recently Used (LRU) cache in Golang" />
<meta property="og:description" content="One of the most used caching schemes is Least Recently Used (LRU)." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ieftimov.com/posts/spotify-recently-played-least-recently-used-cache-golang/" /><meta property="og:image" content="https://ieftimov.com/cards/spotify-recently-played-least-recently-used-cache-golang.png" /><meta property="article:section" content="posts" />

<meta property="og:site_name" content="Ilija Eftimov üë®‚ÄçüöÄ" />

  <meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://ieftimov.com/cards/spotify-recently-played-least-recently-used-cache-golang.png"/>

<meta name="twitter:title" content="Barebones model of Spotify&#39;s &#39;Recently Played&#39; screen using a Least Recently Used (LRU) cache in Golang"/>
<meta name="twitter:description" content="One of the most used caching schemes is Least Recently Used (LRU)."/>

  
  <script type="application/ld+json">
  [{
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "Posts",
    "name": "Barebones model of Spotify\u0027s \u0027Recently Played\u0027 screen using a Least Recently Used (LRU) cache in Golang",
    "headline": "Barebones model of Spotify\u0027s \u0027Recently Played\u0027 screen using a Least Recently Used (LRU) cache in Golang",
    
    "abstract": "One of the most used caching schemes is Least Recently Used (LRU).",
    "inLanguage": "en",
    "url" : "https:\/\/ieftimov.com\/posts\/spotify-recently-played-least-recently-used-cache-golang\/",
    "author" : {
      "@type": "Person",
      "name": "Ilija Eftimov"
    },
    
    "dateCreated": "2019-03-11T00:00:00\u002b00:00",
    
    
    
    
    "keywords": ["caching","lru","last recently used","golang"],
    
    "mainEntityOfPage": "true",
    "wordCount": "2433"
  }]
  </script>


  
  <meta name="author" content="Ilija Eftimov" />
  
    
      <link href="https://twitter.com/ilijaio" rel="me" />
    
      <link href="https://www.linkedin.com/in/ieftimov/" rel="me" />
    
      <link href="mailto:blog@ieftimov.com" rel="me" />
    
      <link href="https://captainscodebook.com" rel="me" />
    
      <link href="https://dev.to/fteem" rel="me" />
    
      <link href="https://github.com/fteem" rel="me" />
    
      <link href="https://t.me/ieftimovcom" rel="me" />
    
  
  
  






  
  <script async defer data-domain="ieftimov.com" src="https://plausible.io/js/plausible.js"></script>

  
  
</head>
<body
    class="flex flex-col h-screen px-6 m-auto text-lg leading-7 bg-neutral text-neutral-900 sm:px-14 md:px-24 lg:px-32 dark:bg-neutral-800 dark:text-neutral max-w-7xl"
  >
    <div id="the-top" class="absolute flex self-center">
      <a
        class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 dark:bg-neutral-600 focus:translate-y-0"
        href="#main-content"
        ><span class="font-bold ltr:pr-2 rtl:pl-2 text-primary-600 dark:text-primary-400"
          >&darr;</span
        >Skip to main content</a
      >
    </div>
    
    
      <header class="py-6 font-semibold sm:py-10 text-neutral-900 dark:text-neutral print:hidden">
  <nav class="flex justify-between">
    
    <div>
      
        <a
          class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
          rel="me"
          href="/"
          >Ilija Eftimov üë®‚ÄçüöÄ</a
        >
      

    </div>
    
    
      <ul class="flex flex-col list-none ltr:text-right rtl:text-left sm:flex-row">
        
          
            <li class="mb-1 sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
              <a
                class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
                href="/"
                title=""
                >Home</a
              >
            </li>
          
            <li class="mb-1 sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
              <a
                class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
                href="/posts/"
                title="Posts"
                >Essays</a
              >
            </li>
          
            <li class="mb-1 sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
              <a
                class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
                href="/work"
                title=""
                >Work</a
              >
            </li>
          
            <li class="mb-1 sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
              <a
                class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
                href="https://captainscodebook.com"
                title=""
                >Subscribe</a
              >
            </li>
          
        
        
          <li class="ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
            <button
              id="search-button"
              class="text-base hover:text-primary-600 dark:hover:text-primary-400"
              title="Search (/)"
            >
              

  <span class="relative inline-block align-text-bottom icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


            </button>
          </li>
        
      </ul>
    
  </nav>
</header>

    
    <div class="relative flex flex-col grow">
      <main id="main-content" class="grow">
        
  <article>
    <header class="max-w-prose">
      
      <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
        Barebones model of Spotify's 'Recently Played' screen using a Least Recently Used (LRU) cache in Golang
      </h1>
      <div class="mt-8 mb-12 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
        





  
  



  

  
  
    
  

  

  

  
    
  

  


  <div class="flex flex-row flex-wrap items-center">
    
    
      <time datetime="2019-03-11 00:00:00 &#43;0000 UTC">11 March 2019</time><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">12 mins</span>
    

    
    
  </div>

  
  


      </div>
    </header>
    <section class="flex flex-col max-w-full mt-0 prose lg:flex-row dark:prose-invert">
      
        <div class="order-first px-0 lg:max-w-xs ltr:lg:pl-8 rtl:lg:pr-8 lg:order-last">
          <div class="ltr:pl-5 rtl:pr-5 toc lg:sticky lg:top-10 print:hidden">
            <details open class="mt-0 overflow-hidden rounded-lg rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5">
  <summary
    class="block py-1 text-lg font-semibold cursor-pointer rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 text-neutral-800 dark:text-neutral-100 lg:hidden bg-neutral-100 dark:bg-neutral-700"
  >
    Table of Contents
  </summary>
  <div
    class="py-2 border-dotted ltr:border-l rtl:border-r rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 border-neutral-300 dark:border-neutral-600"
  >
    <nav id="TableOfContents">
  <ul>
    <li><a href="#applications">Applications</a></li>
    <li><a href="#establishing-basic-types">Establishing basic types</a></li>
    <li><a href="#recently-played">Recently played</a></li>
    <li><a href="#introducing-the-player">Introducing the player</a></li>
    <li><a href="#playing-a-playlist">Playing a <code>Playlist</code></a></li>
    <li><a href="#getting-a-playlist-from-cache"><code>Get</code>ting a <code>Playlist</code> from cache</a></li>
    <li><a href="#hash-table-key-for-a-playlist">Hash table key for a <code>Playlist</code></a></li>
    <li><a href="#setting-a-playlist-to-cache"><code>Set</code>ting a <code>Playlist</code> to cache</a></li>
    <li><a href="#eviction">Eviction</a></li>
    <li><a href="#in-closing">In closing</a></li>
  </ul>
</nav>
  </div>
</details>

          </div>
        </div>
      
      <div class="min-w-0 min-h-0 max-w-prose">
        <p>One of the most used caching schemes is Least Recently Used (LRU). Caches that
use this eviction strategy will remove the least recently used item when their
size reaches their capacity. That means that such caches have to keep a track
of the order of access of the cached items, so it would evict the correct
items.</p>












<figure class="imagecaption">
  <img class="caption" src="/spotify-recently-played-least-recently-used-cache-golang/music.png" caption="" alt="Person looking at a report page">
  <span class="caption-text" style="font-size: 0.75em;display: table;margin: 0 auto 1.5em;"></span>
</figure>

<p>Before we go too much into details about the implementation of an LRU cache,
let&rsquo;s first see what are the possible applications of this caching scheme.</p>
<h2 id="applications" class="relative group">Applications <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#applications" aria-label="Anchor">#</a></span></h2>
<p>LRU cache applications are diverse. The LRU cache eviction scheme is one of the
most widespread and used scheme. Due to its nature, it often does the trick for
conventional problems in commercial programming. For example, if one has a
fixed amount of memory, the most natural way to cache is to keep recently
accessed items.</p>
<p>So, what would be one potential application of a LRU cache? Let&rsquo;s see an
example.</p>
<p>Open your Spotify application (if you have one). Don&rsquo;t have one? Here&rsquo;s a
screenshot of mine:</p>












<figure class="imagecaption">
  <img class="caption" src="/golang-lru-cache/spotify.png" caption="" alt="Spotify desktop application screenshot">
  <span class="caption-text" style="font-size: 0.75em;display: table;margin: 0 auto 1.5em;"></span>
</figure>

<p>You can see in the screenshot above that I have chosen the &ldquo;Recently played&rdquo;
view. To no one&rsquo;s surprise, it shows all my recently played media. If you‚Äôve
never thought about the implementation of such a screen, let me break the magic
down for you. This view is a GUI that lives on top of some sort of an LRU
cache.</p>
<p>Curious how we would model such a &ldquo;Recently played&rdquo; view? Let&rsquo;s take a deeper
look.</p>
<h2 id="establishing-basic-types" class="relative group">Establishing basic types <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#establishing-basic-types" aria-label="Anchor">#</a></span></h2>
<p>Let&rsquo;s define couple of types that would represent the <code>Playlist</code>s and <code>Song</code>s
found on Spotify:</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">type</span> Song <span style="color:#81a1c1;font-weight:bold">struct</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>	duration  <span style="color:#81a1c1">int64</span> <span style="color:#616e87;font-style:italic">// seconds
</span></span></span><span style="display:flex;"><span><span style="color:#616e87;font-style:italic"></span>	title     <span style="color:#81a1c1">string</span>
</span></span><span style="display:flex;"><span>	artist    <span style="color:#81a1c1">*</span>Artist
</span></span><span style="display:flex;"><span><span style="color:#eceff4">}</span></span></span></code></pre></div>
<p>No surprises here - a <code>Song</code> has a <code>duration</code>, a <code>title</code> and an <code>artist</code>. Let&rsquo;s
look at a <code>Playlist</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">type</span> Playlist <span style="color:#81a1c1;font-weight:bold">struct</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>	title       <span style="color:#81a1c1">string</span>
</span></span><span style="display:flex;"><span>	descrption  <span style="color:#81a1c1">string</span>
</span></span><span style="display:flex;"><span>	duration    <span style="color:#81a1c1">int64</span> <span style="color:#616e87;font-style:italic">// seconds
</span></span></span><span style="display:flex;"><span><span style="color:#616e87;font-style:italic"></span>	publishedAt <span style="color:#81a1c1">int32</span> <span style="color:#616e87;font-style:italic">// Unix timestamp
</span></span></span><span style="display:flex;"><span><span style="color:#616e87;font-style:italic"></span>	songs       <span style="color:#eceff4">[]</span><span style="color:#81a1c1">*</span>Song
</span></span><span style="display:flex;"><span><span style="color:#eceff4">}</span></span></span></code></pre></div>
<p>A <code>Playlist</code> has a <code>title</code>, <code>description</code>, <code>duration</code> (which is the sum of the
durations of all songs in it). Also, a <code>publishedAt</code> which is the date of the
publishing of the playlist. Finally it has <code>songs</code> - a slice of <code>Song</code> pointers
representing the songs in the playlist.</p>
<p>Such structure of the <code>Playlist</code> <code>struct</code> will allow users to find a playlist
and &ldquo;just play it&rdquo;.</p>
<h2 id="recently-played" class="relative group">Recently played <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#recently-played" aria-label="Anchor">#</a></span></h2>
<p>The &ldquo;Recently played&rdquo; screen in Spotify has 30 items only, where each of the
items can be a playlist, an artist or an album. For simplicity of our example
here, we will agree that we will only keep track of the recently played
playlists. This means that we&rsquo;ll ignore the artists or albums in our version of
the &ldquo;Recently Played&rdquo; screen.</p>
<p>A typical implementation of a LRU cache uses a combination of two simple data
structures: a hash table and a linked list. Why? Well, as I mentioned in
<a href="https://ieftimov.com/when-why-least-frequently-used-cache-implementation-golang">another article on
caching</a>,
caches have to be fast along two dimensions:</p>
<ol>
<li>Ensuring that as many of the requests for files go to it (cache hit), not
over the network or to main memory (cache miss);</li>
<li>The overhead of using it should be small: testing membership and deciding
when to replace a <code>Playlist</code> should be as fast as possible.</li>
</ol>
<p>On the first point, we have agreed that LRU will do the job because of the
nature of the &ldquo;Recently played&rdquo; screen. This means that we have to keep track
of what <code>Playlist</code>s are recently played. A data structure that allows us to do
this is a linked list. Since Go already provides us a doubly-linked list
implementation, there is no need to reinvent the wheel. We will use the
<code>container/list</code> package <sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>.</p>
<p>On the second point, the data structure that comes to mind for a scalable
membership tests is a hash table. <sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup> As you might know, hash tables have
unique keys for every value. If our program can create a unique key for a
<code>Playlist</code>, it will be easy for us to check if the <code>Playlist</code> is in the cache
or not.</p>
<p>Knowing this, let&rsquo;s define the <code>RecentlyPlayed</code> struct and its constructor
function:</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">type</span> RecentlyPlayed <span style="color:#81a1c1;font-weight:bold">struct</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>	capacity <span style="color:#81a1c1">int</span>
</span></span><span style="display:flex;"><span>	size     <span style="color:#81a1c1">int</span>
</span></span><span style="display:flex;"><span>	cache    <span style="color:#81a1c1;font-weight:bold">map</span><span style="color:#eceff4">[</span><span style="color:#81a1c1">int</span><span style="color:#eceff4">]</span><span style="color:#81a1c1">*</span>list<span style="color:#eceff4">.</span>Element
</span></span><span style="display:flex;"><span>	lru      <span style="color:#81a1c1">*</span>list<span style="color:#eceff4">.</span>List
</span></span><span style="display:flex;"><span><span style="color:#eceff4">}</span></span></span></code></pre></div>
<p>Things are pretty self explanatory here. <code>capacity</code> will hold the maximum
capacity of the cache and <code>size</code> will be the current size of the recently
played screen. We will use the <code>cache</code> hash table to retrieve the elements from
cache.  The <code>lru</code> is a linked list (from the <code>container/list</code> package) that we
will use to keep track of the recently played playlists.</p>
<p>Let&rsquo;s first create a small function that will spawn up a new <code>RecentlyPlayed</code>
struct with some sane defaults:</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">func</span> <span style="color:#88c0d0">NewRecentlyPlayed</span><span style="color:#eceff4">(</span>capacity <span style="color:#81a1c1">int</span><span style="color:#eceff4">)</span> <span style="color:#81a1c1">*</span>RecentlyPlayed <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>	rp <span style="color:#81a1c1">:=</span> RecentlyPlayed<span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>		capacity<span style="color:#eceff4">:</span> capacity<span style="color:#eceff4">,</span>
</span></span><span style="display:flex;"><span>                size<span style="color:#eceff4">:</span>     <span style="color:#b48ead">0</span><span style="color:#eceff4">,</span>
</span></span><span style="display:flex;"><span>		lru<span style="color:#eceff4">:</span>      list<span style="color:#eceff4">.</span><span style="color:#88c0d0">New</span><span style="color:#eceff4">(),</span>
</span></span><span style="display:flex;"><span>		cache<span style="color:#eceff4">:</span>    <span style="color:#81a1c1">make</span><span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">map</span><span style="color:#eceff4">[</span><span style="color:#81a1c1">string</span><span style="color:#eceff4">]</span><span style="color:#81a1c1">*</span>list<span style="color:#eceff4">.</span>Element<span style="color:#eceff4">),</span>
</span></span><span style="display:flex;"><span>	<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">return</span> <span style="color:#81a1c1">&amp;</span>rp
</span></span><span style="display:flex;"><span><span style="color:#eceff4">}</span></span></span></code></pre></div>
<p>This function sets the defaults to the struct and returns a pointer to it.
Before we continue, let&rsquo;s make a quick stop. Let&rsquo;s take a moment to understand
how each of these two data structures will work together.</p>
<p>First, <code>cache</code> is going to be a <code>map</code> that will have a key of type <code>string</code> and
a value of type <code>*list.Element</code>. The <code>string</code> will be a hash of the <code>Playlist</code>
that will be stored there, while the <code>*list.Element</code> will be a pointer to the
element in the doubly-linked list. By having this pointer, we can get the
<code>Playlist</code> stored inside it (it&rsquo;s <code>Value</code>). Also, it will be easy to reposition
it in the <code>lru</code> list when we play the Playlist.</p>












<figure class="imagecaption">
  <img class="caption" src="/spotify-recently-played-least-recently-used-cache-golang/media_player.png" caption="" alt="Music player">
  <span class="caption-text" style="font-size: 0.75em;display: table;margin: 0 auto 1.5em;"></span>
</figure>

<h2 id="introducing-the-player" class="relative group">Introducing the player <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#introducing-the-player" aria-label="Anchor">#</a></span></h2>
<p>To have a &ldquo;Recently played&rdquo; list of playlists, we obviously need to put it in
some sort of a player, that will have a <code>Play</code> function.</p>
<p>Here&rsquo;s a quick sketch of it, so we can move to the meat of our implementation:</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">type</span> Player <span style="color:#81a1c1;font-weight:bold">struct</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>	playProgress       <span style="color:#81a1c1">int</span>
</span></span><span style="display:flex;"><span>	RecentlyPlayedList <span style="color:#81a1c1">*</span>RecentlyPlayed
</span></span><span style="display:flex;"><span><span style="color:#eceff4">}</span></span></span></code></pre></div>
<p>For the purpose of this example, we can keep the <code>Player</code> quite simple - only
the progress of the song currently playing (<code>playProgress</code>) and the recently
played list of playlists (<code>RecentlyPlayedList</code>).</p>
<p>We will also add a small constructor function for the <code>Player</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">func</span> <span style="color:#88c0d0">NewPlayer</span><span style="color:#eceff4">()</span> <span style="color:#81a1c1">*</span>Player <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>	p <span style="color:#81a1c1">:=</span> Player<span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>		RecentlyPlayedList<span style="color:#eceff4">:</span> <span style="color:#88c0d0">NewRecentlyPlayed</span><span style="color:#eceff4">(</span><span style="color:#b48ead">30</span><span style="color:#eceff4">),</span>
</span></span><span style="display:flex;"><span>	<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">return</span> <span style="color:#81a1c1">&amp;</span>p
</span></span><span style="display:flex;"><span><span style="color:#eceff4">}</span></span></span></code></pre></div>
<p>Now we need to add the <code>Play</code> function and understand what are the functions
related to <code>RecentlyPlayed</code> that <code>Play</code> will have to invoke.</p>
<h2 id="playing-a-playlist" class="relative group">Playing a <code>Playlist</code> <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#playing-a-playlist" aria-label="Anchor">#</a></span></h2>
<p>Obviously, there&rsquo;a already an entity that will have to play the <code>Playlist</code> - the
<code>Player</code>. Let&rsquo;s add a function <code>Play</code> to our <code>Player</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">func</span> <span style="color:#eceff4">(</span>player <span style="color:#81a1c1">*</span>Player<span style="color:#eceff4">)</span> <span style="color:#88c0d0">Play</span><span style="color:#eceff4">(</span>playlist <span style="color:#81a1c1">*</span>Playlist<span style="color:#eceff4">)</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">if</span> cached<span style="color:#eceff4">,</span> playlist <span style="color:#81a1c1">:=</span> player<span style="color:#eceff4">.</span>RecentlyPlayedList<span style="color:#eceff4">.</span><span style="color:#88c0d0">Get</span><span style="color:#eceff4">(</span>playlist<span style="color:#eceff4">.</span><span style="color:#88c0d0">hash</span><span style="color:#eceff4">());</span> cached <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#616e87;font-style:italic">// Play from cache...
</span></span></span><span style="display:flex;"><span><span style="color:#616e87;font-style:italic"></span>	<span style="color:#eceff4">}</span> <span style="color:#81a1c1;font-weight:bold">else</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#616e87;font-style:italic">// Fetch over the network and start playing...
</span></span></span><span style="display:flex;"><span><span style="color:#616e87;font-style:italic"></span>		player<span style="color:#eceff4">.</span>RecentlyPlayedList<span style="color:#eceff4">.</span><span style="color:#88c0d0">Set</span><span style="color:#eceff4">(</span>playlist<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">}</span></span></span></code></pre></div>
<div class="flex px-4 py-3 rounded-md bg-primary-100 dark:bg-primary-900">
  <span class="ltr:pr-3 rtl:pl-3 text-primary-400">
    

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M506.3 417l-213.3-364c-16.33-28-57.54-28-73.98 0l-213.2 364C-10.59 444.9 9.849 480 42.74 480h426.6C502.1 480 522.6 445 506.3 417zM232 168c0-13.25 10.75-24 24-24S280 154.8 280 168v128c0 13.25-10.75 24-23.1 24S232 309.3 232 296V168zM256 416c-17.36 0-31.44-14.08-31.44-31.44c0-17.36 14.07-31.44 31.44-31.44s31.44 14.08 31.44 31.44C287.4 401.9 273.4 416 256 416z"/></svg>

  </span>


  </span>
  <span class="dark:text-neutral-300"><strong>Note:</strong> If you thought that I&rsquo;d show you how we&rsquo;ll actually play a media file
or stream it over the network I am sorry to disappoint. That&rsquo;s a tad out of the
scope of this article. That being said, I am always looking for topic ideas to
write on, although I have a huge list already, so if that&rsquo;s something you&rsquo;d
like to read on drop a comment below.</span>
</div>

<p>Let&rsquo;s dissect the <code>Play</code> function:</p>
<ol>
<li>
<p>The <code>player.RecentlyPlayedList</code> struct is of type <code>*RecentlyPlayed</code>. It has
a function <code>Get</code> which will return a <code>bool</code> and a playlist which our player
can then play.</p>
</li>
<li>
<p>If it doesn‚Äôt find a cached playlist it will fetch/start streaming the
playlist over the network. Then, it will cache it using the <code>Set</code> function
of the <code>RecentlyPlayedLists</code> struct.</p>
</li>
</ol>
<p>So, what is the behaviour and the internals of these two new methods, <code>Get</code> and
<code>Set</code>?</p>
<h2 id="getting-a-playlist-from-cache" class="relative group"><code>Get</code>ting a <code>Playlist</code> from cache <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#getting-a-playlist-from-cache" aria-label="Anchor">#</a></span></h2>
<p>To retrieve a <code>Playlist</code> from cache is actually a cheap task, from time
perspective. Our cache is hash table-backed which has a <code>O(1)</code> time complexity
for the access operation. The trick is once we access an item in <code>cache</code> we
also have to move it to the beginning of the <code>lru</code> list.</p>
<p>In other words, we need to promote it as the most recently used item in the
<code>RecentlyPlayedList</code>. Given that we use a linked list-backed cache, we have
to take our item from the list and move it to the front.</p>
<p>Let&rsquo;s see how that would work in our context:</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">func</span> <span style="color:#eceff4">(</span>rp <span style="color:#81a1c1">*</span>RecentlyPlayed<span style="color:#eceff4">)</span> <span style="color:#88c0d0">Get</span><span style="color:#eceff4">(</span>key <span style="color:#81a1c1">string</span><span style="color:#eceff4">)</span> <span style="color:#eceff4">(</span><span style="color:#81a1c1">*</span>Playlist<span style="color:#eceff4">,</span> <span style="color:#81a1c1">bool</span><span style="color:#eceff4">)</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">if</span> elem<span style="color:#eceff4">,</span> present <span style="color:#81a1c1">:=</span> rp<span style="color:#eceff4">.</span>cache<span style="color:#eceff4">[</span>key<span style="color:#eceff4">];</span> present <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>                rp<span style="color:#eceff4">.</span>lru<span style="color:#eceff4">.</span><span style="color:#88c0d0">MoveToFront</span><span style="color:#eceff4">(</span>elem<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>		<span style="color:#81a1c1;font-weight:bold">return</span> elem<span style="color:#eceff4">.</span>Value<span style="color:#eceff4">.(</span><span style="color:#81a1c1">*</span>Playlist<span style="color:#eceff4">),</span> <span style="color:#81a1c1;font-weight:bold">true</span>
</span></span><span style="display:flex;"><span>	<span style="color:#eceff4">}</span> <span style="color:#81a1c1;font-weight:bold">else</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#81a1c1;font-weight:bold">return</span> <span style="color:#81a1c1;font-weight:bold">nil</span><span style="color:#eceff4">,</span> <span style="color:#81a1c1;font-weight:bold">false</span>
</span></span><span style="display:flex;"><span>	<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">}</span></span></span></code></pre></div>
<p>In case you were expecting some magic here ‚Äì sorry to disappoint, but this is
pretty simple. Its a three step function:</p>
<ol>
<li>Checks if it finds the item in the cache. If not it returns a <code>nil</code>.</li>
<li>Otherwise, it moves the element to the beginning of the LRU list, and</li>
<li>It returns the value of the <code>*list.Element</code>, which is the pointer
to the <code>Playlist</code> that our player will play</li>
</ol>
<p>That&rsquo;s it, pretty simple.</p>
<h2 id="hash-table-key-for-a-playlist" class="relative group">Hash table key for a <code>Playlist</code> <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#hash-table-key-for-a-playlist" aria-label="Anchor">#</a></span></h2>
<p>Before we move on to <code>Set</code>, let&rsquo;s quickly discuss the implementation of the
<code>hash</code> function.</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">func</span> <span style="color:#eceff4">(</span>playlist <span style="color:#81a1c1">*</span>Playlist<span style="color:#eceff4">)</span> <span style="color:#88c0d0">hash</span><span style="color:#eceff4">()</span> <span style="color:#81a1c1">string</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>	hash <span style="color:#81a1c1">:=</span> sha1<span style="color:#eceff4">.</span><span style="color:#88c0d0">New</span><span style="color:#eceff4">()</span>
</span></span><span style="display:flex;"><span>	s <span style="color:#81a1c1">:=</span> fmt<span style="color:#eceff4">.</span><span style="color:#88c0d0">Sprintf</span><span style="color:#eceff4">(</span>
</span></span><span style="display:flex;"><span>		<span style="color:#a3be8c">&#34;%d-%s-%s-%d&#34;</span><span style="color:#eceff4">,</span>
</span></span><span style="display:flex;"><span>		playlist<span style="color:#eceff4">.</span>duration<span style="color:#eceff4">,</span>
</span></span><span style="display:flex;"><span>		playlist<span style="color:#eceff4">.</span>title<span style="color:#eceff4">,</span>
</span></span><span style="display:flex;"><span>		playlist<span style="color:#eceff4">.</span>description<span style="color:#eceff4">,</span>
</span></span><span style="display:flex;"><span>		playlist<span style="color:#eceff4">.</span>publishedAt<span style="color:#eceff4">,</span>
</span></span><span style="display:flex;"><span>	<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	hash<span style="color:#eceff4">.</span><span style="color:#88c0d0">Write</span><span style="color:#eceff4">([]</span><span style="color:#81a1c1">byte</span><span style="color:#eceff4">(</span>s<span style="color:#eceff4">))</span>
</span></span><span style="display:flex;"><span>	sum <span style="color:#81a1c1">:=</span> hash<span style="color:#eceff4">.</span><span style="color:#88c0d0">Sum</span><span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">nil</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">return</span> fmt<span style="color:#eceff4">.</span><span style="color:#88c0d0">Sprintf</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;%x&#34;</span><span style="color:#eceff4">,</span> sum<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">}</span></span></span></code></pre></div>
<p>As you can see, it&rsquo;s a simple one - it&rsquo;s goal is just to generate a
reproducible hash for a <code>Playlist</code>. It basically concatenates the attributes of
the <code>Playlist</code> struct and then applies a <code>SHA1</code> hashing sum on it. As the last
step, it returns the hash in a hexidecimal format.</p>
<h2 id="setting-a-playlist-to-cache" class="relative group"><code>Set</code>ting a <code>Playlist</code> to cache <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#setting-a-playlist-to-cache" aria-label="Anchor">#</a></span></h2>
<p>Now that we have the <code>hash</code> function out of the way, let&rsquo;s look at the code of
the <code>Set</code> function. After, we can discuss the steps this function takes to add
a <code>Playlist</code> to the cache:</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">func</span> <span style="color:#eceff4">(</span>rp <span style="color:#81a1c1">*</span>RecentlyPlayed<span style="color:#eceff4">)</span> <span style="color:#88c0d0">Set</span><span style="color:#eceff4">(</span>playlist <span style="color:#81a1c1">*</span>Playlist<span style="color:#eceff4">)</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>	key <span style="color:#81a1c1">:=</span> playlist<span style="color:#eceff4">.</span><span style="color:#88c0d0">hash</span><span style="color:#eceff4">()</span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">if</span> elem<span style="color:#eceff4">,</span> present <span style="color:#81a1c1">:=</span> rp<span style="color:#eceff4">.</span>cache<span style="color:#eceff4">[</span>key<span style="color:#eceff4">];</span> present <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>		rp<span style="color:#eceff4">.</span>lru<span style="color:#eceff4">.</span><span style="color:#88c0d0">MoveToFront</span><span style="color:#eceff4">(</span>elem<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#eceff4">}</span> <span style="color:#81a1c1;font-weight:bold">else</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>		elem <span style="color:#81a1c1">:=</span> rp<span style="color:#eceff4">.</span>lru<span style="color:#eceff4">.</span><span style="color:#88c0d0">PushFront</span><span style="color:#eceff4">(</span>playlist<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>		rp<span style="color:#eceff4">.</span>size<span style="color:#81a1c1">++</span>
</span></span><span style="display:flex;"><span>	<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>	rp<span style="color:#eceff4">.</span>cache<span style="color:#eceff4">[</span>key<span style="color:#eceff4">]</span> <span style="color:#eceff4">=</span> elem
</span></span><span style="display:flex;"><span><span style="color:#eceff4">}</span></span></span></code></pre></div>
<p>The Set function takes a <code>*Playlist</code> as an argument. It is then hashed using
the <code>hash</code> method that implemented by <code>RecentlyPlayed</code>. It returns a unique key
based on some attributes of the <code>Playlist</code>. The key is then used when the
<code>Playlist</code> is added in the hash table <code>caches</code>.</p>
<p>But before we add it to the hash table <code>cache</code>, we will check if there&rsquo;s
already a value in the <code>cache</code> hash table with the same <code>key</code>. If so, we will
only move the <code>*Playlist</code> to the front of the <code>lru</code> linked list.</p>
<p>If not, we push the <code>*Playlist</code> to the front of the <code>lru</code> linked list, as the
most recently used item. This returns a <code>*list.Element</code>, which for its <code>Value</code>
expects an <code>interface{}</code> (which is the Go way to say &ldquo;any type&rdquo;). The
<code>*list.Element</code> will wrap the <code>*Playlist</code> as its <code>Value</code>.</p>
<p>This means that any time we access the <code>elem.Value</code> we will have to cast it to
its proper type, since <code>*list.Element</code> does not know the type of its <code>Value</code>
(remember, it accepts any type).</p>
<p>After the playlist is added to the front of the <code>lru</code> list, the <code>Set</code> function
will increment the <code>RecentlyPlayed</code>&rsquo;s <code>size</code> due to the new item added to the
list.</p>
<p>Finally, the function will cache the <code>*list.Element</code> in the <code>cache</code> hash table</p>
<ul>
<li>which we will use to retrieve the playlist with a <code>O(1)</code> time complexity.</li>
</ul>












<figure class="imagecaption">
  <img class="caption" src="/spotify-recently-played-least-recently-used-cache-golang/empty_cart.png" caption="" alt="Person with empty shopping cart">
  <span class="caption-text" style="font-size: 0.75em;display: table;margin: 0 auto 1.5em;"></span>
</figure>

<h2 id="eviction" class="relative group">Eviction <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#eviction" aria-label="Anchor">#</a></span></h2>
<p>Now that we know how the <code>Get</code> and <code>Set</code> functions work, we need to take one
more thing into consideration. That is Spotify‚Äôs limitation of the size of the
recently played screen. It means that once the number of playlists reaches a
threshold, it removes the least recently played playlist. This will make the
room to add a new one to the list.</p>
<p>This is the eviction algorithm that we have to write for our LRU cache, which
powers the recently played screen. In our implementation we&rsquo;ll call the
function <code>increment</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">func</span> <span style="color:#eceff4">(</span>rp <span style="color:#81a1c1">*</span>RecentlyPlayed<span style="color:#eceff4">)</span> <span style="color:#88c0d0">increment</span><span style="color:#eceff4">(</span>element <span style="color:#81a1c1">*</span>list<span style="color:#eceff4">.</span>Element<span style="color:#eceff4">)</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>	rp<span style="color:#eceff4">.</span>lru<span style="color:#eceff4">.</span><span style="color:#88c0d0">MoveToFront</span><span style="color:#eceff4">(</span>element<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">if</span> rp<span style="color:#eceff4">.</span>size <span style="color:#81a1c1">==</span> rp<span style="color:#eceff4">.</span>capacity <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>		lruItem <span style="color:#81a1c1">:=</span> rp<span style="color:#eceff4">.</span>lru<span style="color:#eceff4">.</span><span style="color:#88c0d0">Back</span><span style="color:#eceff4">()</span>
</span></span><span style="display:flex;"><span>		rp<span style="color:#eceff4">.</span>lru<span style="color:#eceff4">.</span><span style="color:#88c0d0">Remove</span><span style="color:#eceff4">(</span>lruItem<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>		rp<span style="color:#eceff4">.</span>size<span style="color:#81a1c1">--</span>
</span></span><span style="display:flex;"><span>	<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">}</span></span></span></code></pre></div>
<p>Every time we want to increment the usage of a certain <code>*list.Element</code>, the
function will take these two steps:</p>
<ol>
<li>Move the accessed element to be beginning of the <code>lru</code> linked list, and</li>
<li>When the <code>size</code> of the <code>RecentlyPlayed</code> struct has reached its <code>capacity</code>,
remove the last item in the <code>lru</code> linked list</li>
</ol>
<p>This function will allow us to handle the eviction of the least recently used
item in the list of playlists. Now, we can revisit our <code>Set</code> and <code>Get</code>
functions and drop this function in:</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-go" data-lang="go"><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">func</span> <span style="color:#eceff4">(</span>rp <span style="color:#81a1c1">*</span>RecentlyPlayed<span style="color:#eceff4">)</span> <span style="color:#88c0d0">Set</span><span style="color:#eceff4">(</span>playlist <span style="color:#81a1c1">*</span>Playlist<span style="color:#eceff4">)</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>	key <span style="color:#81a1c1">:=</span> playlist<span style="color:#eceff4">.</span><span style="color:#88c0d0">hash</span><span style="color:#eceff4">()</span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">if</span> elem<span style="color:#eceff4">,</span> present <span style="color:#81a1c1">:=</span> rp<span style="color:#eceff4">.</span>cache<span style="color:#eceff4">[</span>key<span style="color:#eceff4">];</span> present <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>		rp<span style="color:#eceff4">.</span><span style="color:#88c0d0">increment</span><span style="color:#eceff4">(</span>elem<span style="color:#eceff4">)</span> <span style="color:#616e87;font-style:italic">// &lt;- the change
</span></span></span><span style="display:flex;"><span><span style="color:#616e87;font-style:italic"></span>	<span style="color:#eceff4">}</span> <span style="color:#81a1c1;font-weight:bold">else</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>		elem <span style="color:#81a1c1">:=</span> rp<span style="color:#eceff4">.</span>lru<span style="color:#eceff4">.</span><span style="color:#88c0d0">PushFront</span><span style="color:#eceff4">(</span>playlist<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>		rp<span style="color:#eceff4">.</span>size<span style="color:#81a1c1">++</span>
</span></span><span style="display:flex;"><span>	<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>	rp<span style="color:#eceff4">.</span>cache<span style="color:#eceff4">[</span>key<span style="color:#eceff4">]</span> <span style="color:#eceff4">=</span> elem
</span></span><span style="display:flex;"><span><span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">func</span> <span style="color:#eceff4">(</span>rp <span style="color:#81a1c1">*</span>RecentlyPlayed<span style="color:#eceff4">)</span> <span style="color:#88c0d0">Get</span><span style="color:#eceff4">(</span>key <span style="color:#81a1c1">string</span><span style="color:#eceff4">)</span> <span style="color:#eceff4">(</span><span style="color:#81a1c1">*</span>Playlist<span style="color:#eceff4">,</span> <span style="color:#81a1c1">bool</span><span style="color:#eceff4">)</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>	<span style="color:#81a1c1;font-weight:bold">if</span> elem<span style="color:#eceff4">,</span> present <span style="color:#81a1c1">:=</span> rp<span style="color:#eceff4">.</span>cache<span style="color:#eceff4">[</span>key<span style="color:#eceff4">];</span> present <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>		rp<span style="color:#eceff4">.</span><span style="color:#88c0d0">increment</span><span style="color:#eceff4">(</span>elem<span style="color:#eceff4">)</span> <span style="color:#616e87;font-style:italic">// &lt;- the change
</span></span></span><span style="display:flex;"><span><span style="color:#616e87;font-style:italic"></span>		<span style="color:#81a1c1;font-weight:bold">return</span> elem<span style="color:#eceff4">.</span>Value<span style="color:#eceff4">.(</span><span style="color:#81a1c1">*</span>Playlist<span style="color:#eceff4">),</span> <span style="color:#81a1c1;font-weight:bold">true</span>
</span></span><span style="display:flex;"><span>	<span style="color:#eceff4">}</span> <span style="color:#81a1c1;font-weight:bold">else</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>		<span style="color:#81a1c1;font-weight:bold">return</span> <span style="color:#81a1c1;font-weight:bold">nil</span><span style="color:#eceff4">,</span> <span style="color:#81a1c1;font-weight:bold">false</span>
</span></span><span style="display:flex;"><span>	<span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">}</span></span></span></code></pre></div>
<p>Now that we have the <code>increment</code> function, we will use it in the <code>Set</code> and
<code>Get</code> functions. By doing this, we will update the list of recently used items
every time we play a <code>Playlist</code>.</p>
<p>This change will unlock two things for our recently played screen:</p>
<ol>
<li>It will change the order of the cached playlists, based on the how recently
the playlists are played</li>
<li>It will remove any playlists once <code>size</code> exceeds <code>capacity</code></li>
</ol>
<h2 id="in-closing" class="relative group">In closing <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#in-closing" aria-label="Anchor">#</a></span></h2>
<p>Now that we have a Go-powered sketch of Spotify&rsquo;s recently played screen, let&rsquo;s
do a quick recap.</p>
<p>To shine some light on the shortcomings:</p>
<ol>
<li>This is a barebones model - it lacks any mechanisms to stream/download the
playlists via the internet. We agreed that although interesting, this would
be hard to cover in this article.</li>
<li>The model does not take into account any restarting of the application. This
means if we stop and start the program the cached playlists will be gone.
This is because our implementation does not store the data on disk (only in
memory).</li>
<li>We do not have any graphical user interface to interact with the application
- only a couple of functions that we can invoke.</li>
</ol>
<p>While all the above is a shortcoming of our implementation, it still paints the
picture of how we could write such a program using Go. The combination of a
linked list &amp; a hash table works nice for solving the problem at hand. From
time complexity perspective, it scales well. And, for our tiny scenario, the
hit-to-miss ratio should is optimal.</p>
<p>If you would like to read more of my rambling about caching algorithms, you can
also read &ldquo;When and Why to use a Least Frequently Used (LFU) cache with an
implementation in Golang&rdquo; <sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup>.</p>
<iframe src="https://captainscodebook.com/embed" width="100%" height="400" style="margin-top:2em" frameborder="0" scrolling="no"></iframe>

<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>Package that implements a doubly linked list:
<a href="https://golang.org/pkg/container/list/">https://golang.org/pkg/container/list/</a>&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2">
<p>Or a bloom filter - good article on the topic:
<a href="https://bart.degoe.de/bloom-filters-bit-arrays-recommendations-caches-bitcoin/">https://bart.degoe.de/bloom-filters-bit-arrays-recommendations-caches-bitcoin/</a>&#160;<a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3">
<p>Article I published on this very blog:
<a href="https://ieftimov.com/when-why-least-frequently-used-cache-implementation-golang">https://ieftimov.com/when-why-least-frequently-used-cache-implementation-golang</a>&#160;<a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>

      </div>
    </section>
    <footer class="pt-8 max-w-prose print:hidden">
      
  <div class="flex">
    
      
      
        
        <img
          class="w-24 h-24 !mt-0 !mb-0 ltr:mr-4 rtl:ml-4 rounded-full"
          width="96"
          height="96"
          alt="Ilija Eftimov"
          src="/img/avatar_huae39953c6189b6aa60e47103b358d088_112612_192x192_fill_q75_box_smart1.jpg"
        />
      
    
    <div class="place-self-center">
      
        <div class="text-[0.6rem] leading-3 text-neutral-500 dark:text-neutral-400 uppercase">
          Author
        </div>
        <div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">
          Ilija Eftimov
        </div>
      
      
      <div class="text-2xl sm:text-lg">
  <div class="flex flex-wrap text-neutral-400 dark:text-neutral-500">
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://twitter.com/ilijaio"
          target="_blank"
          aria-label="Twitter"
          rel="me noopener noreferrer"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>

  </span>

</a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://www.linkedin.com/in/ieftimov/"
          target="_blank"
          aria-label="Linkedin"
          rel="me noopener noreferrer"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>

  </span>

</a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="mailto:blog@ieftimov.com"
          target="_blank"
          aria-label="Email"
          rel="me noopener noreferrer"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1c-27.64 140.9 68.65 266.2 199.1 285.1c19.01 2.888 36.17-12.26 36.17-31.49l.0001-.6631c0-15.74-11.44-28.88-26.84-31.24c-84.35-12.98-149.2-86.13-149.2-174.2c0-102.9 88.61-185.5 193.4-175.4c91.54 8.869 158.6 91.25 158.6 183.2l0 16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98 .0036c-7.299 0-13.2 4.992-15.12 11.68c-24.85-12.15-54.24-16.38-86.06-5.106c-38.75 13.73-68.12 48.91-73.72 89.64c-9.483 69.01 43.81 128 110.9 128c26.44 0 50.43-9.544 69.59-24.88c24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3C495.1 107.1 361.2-9.332 207.8 20.73zM239.1 304.3c-26.47 0-48-21.56-48-48.05s21.53-48.05 48-48.05s48 21.56 48 48.05S266.5 304.3 239.1 304.3z"/></svg>

  </span>

</a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://captainscodebook.com"
          target="_blank"
          aria-label="Substack"
          rel="me noopener noreferrer"
          >

</a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://dev.to/fteem"
          target="_blank"
          aria-label="Dev"
          rel="me noopener noreferrer"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M120.12 208.29c-3.88-2.9-7.77-4.35-11.65-4.35H91.03v104.47h17.45c3.88 0 7.77-1.45 11.65-4.35 3.88-2.9 5.82-7.25 5.82-13.06v-69.65c-.01-5.8-1.96-10.16-5.83-13.06zM404.1 32H43.9C19.7 32 .06 51.59 0 75.8v360.4C.06 460.41 19.7 480 43.9 480h360.2c24.21 0 43.84-19.59 43.9-43.8V75.8c-.06-24.21-19.7-43.8-43.9-43.8zM154.2 291.19c0 18.81-11.61 47.31-48.36 47.25h-46.4V172.98h47.38c35.44 0 47.36 28.46 47.37 47.28l.01 70.93zm100.68-88.66H201.6v38.42h32.57v29.57H201.6v38.41h53.29v29.57h-62.18c-11.16.29-20.44-8.53-20.72-19.69V193.7c-.27-11.15 8.56-20.41 19.71-20.69h63.19l-.01 29.52zm103.64 115.29c-13.2 30.75-36.85 24.63-47.44 0l-38.53-144.8h32.57l29.71 113.72 29.57-113.72h32.58l-38.46 144.8z"/></svg>

  </span>

</a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://github.com/fteem"
          target="_blank"
          aria-label="Github"
          rel="me noopener noreferrer"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>

  </span>

</a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://t.me/ieftimovcom"
          target="_blank"
          aria-label="Telegram"
          rel="me noopener noreferrer"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M248,8C111.033,8,0,119.033,0,256S111.033,504,248,504,496,392.967,496,256,384.967,8,248,8ZM362.952,176.66c-3.732,39.215-19.881,134.378-28.1,178.3-3.476,18.584-10.322,24.816-16.948,25.425-14.4,1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25,5.342-39.5,3.652-3.793,67.107-61.51,68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608,69.142-14.845,10.194-26.894,9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7,18.45-13.7,108.446-47.248,144.628-62.3c68.872-28.647,83.183-33.623,92.511-33.789,2.052-.034,6.639.474,9.61,2.885a10.452,10.452,0,0,1,3.53,6.716A43.765,43.765,0,0,1,362.952,176.66Z"/></svg>

  </span>

</a
        >
      
    
  </div>

</div>
    </div>
  </div>


      
  
  <section class="flex flex-row flex-wrap justify-center pt-4 text-xl">
    
      
        <a
          class="bg-neutral-300 text-neutral-700 dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800 m-1 hover:bg-primary-500 hover:text-neutral rounded min-w-[2.4rem] inline-block text-center p-1"
          href="https://www.facebook.com/sharer/sharer.php?u=https://ieftimov.com/posts/spotify-recently-played-least-recently-used-cache-golang/&amp;quote=Barebones%20model%20of%20Spotify%27s%20%27Recently%20Played%27%20screen%20using%20a%20Least%20Recently%20Used%20%28LRU%29%20cache%20in%20Golang"
          title="Share on Facebook"
          aria-label="Share on Facebook"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg>

  </span>

</a
        >
      
    
      
        <a
          class="bg-neutral-300 text-neutral-700 dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800 m-1 hover:bg-primary-500 hover:text-neutral rounded min-w-[2.4rem] inline-block text-center p-1"
          href="https://twitter.com/intent/tweet/?url=https://ieftimov.com/posts/spotify-recently-played-least-recently-used-cache-golang/&amp;text=Barebones%20model%20of%20Spotify%27s%20%27Recently%20Played%27%20screen%20using%20a%20Least%20Recently%20Used%20%28LRU%29%20cache%20in%20Golang"
          title="Tweet on Twitter"
          aria-label="Tweet on Twitter"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>

  </span>

</a
        >
      
    
      
        <a
          class="bg-neutral-300 text-neutral-700 dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800 m-1 hover:bg-primary-500 hover:text-neutral rounded min-w-[2.4rem] inline-block text-center p-1"
          href="https://reddit.com/submit/?url=https://ieftimov.com/posts/spotify-recently-played-least-recently-used-cache-golang/&amp;resubmit=true&amp;title=Barebones%20model%20of%20Spotify%27s%20%27Recently%20Played%27%20screen%20using%20a%20Least%20Recently%20Used%20%28LRU%29%20cache%20in%20Golang"
          title="Submit to Reddit"
          aria-label="Submit to Reddit"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M201.5 305.5c-13.8 0-24.9-11.1-24.9-24.6 0-13.8 11.1-24.9 24.9-24.9 13.6 0 24.6 11.1 24.6 24.9 0 13.6-11.1 24.6-24.6 24.6zM504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-132.3-41.2c-9.4 0-17.7 3.9-23.8 10-22.4-15.5-52.6-25.5-86.1-26.6l17.4-78.3 55.4 12.5c0 13.6 11.1 24.6 24.6 24.6 13.8 0 24.9-11.3 24.9-24.9s-11.1-24.9-24.9-24.9c-9.7 0-18 5.8-22.1 13.8l-61.2-13.6c-3-.8-6.1 1.4-6.9 4.4l-19.1 86.4c-33.2 1.4-63.1 11.3-85.5 26.8-6.1-6.4-14.7-10.2-24.1-10.2-34.9 0-46.3 46.9-14.4 62.8-1.1 5-1.7 10.2-1.7 15.5 0 52.6 59.2 95.2 132 95.2 73.1 0 132.3-42.6 132.3-95.2 0-5.3-.6-10.8-1.9-15.8 31.3-16 19.8-62.5-14.9-62.5zM302.8 331c-18.2 18.2-76.1 17.9-93.6 0-2.2-2.2-6.1-2.2-8.3 0-2.5 2.5-2.5 6.4 0 8.6 22.8 22.8 87.3 22.8 110.2 0 2.5-2.2 2.5-6.1 0-8.6-2.2-2.2-6.1-2.2-8.3 0zm7.7-75c-13.6 0-24.6 11.1-24.6 24.9 0 13.6 11.1 24.6 24.6 24.6 13.8 0 24.9-11.1 24.9-24.6 0-13.8-11-24.9-24.9-24.9z"/></svg>

  </span>

</a
        >
      
    
      
        <a
          class="bg-neutral-300 text-neutral-700 dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800 m-1 hover:bg-primary-500 hover:text-neutral rounded min-w-[2.4rem] inline-block text-center p-1"
          href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://ieftimov.com/posts/spotify-recently-played-least-recently-used-cache-golang/&amp;title=Barebones%20model%20of%20Spotify%27s%20%27Recently%20Played%27%20screen%20using%20a%20Least%20Recently%20Used%20%28LRU%29%20cache%20in%20Golang"
          title="Share on LinkedIn"
          aria-label="Share on LinkedIn"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>

  </span>

</a
        >
      
    
      
        <a
          class="bg-neutral-300 text-neutral-700 dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800 m-1 hover:bg-primary-500 hover:text-neutral rounded min-w-[2.4rem] inline-block text-center p-1"
          href="mailto:?body=https://ieftimov.com/posts/spotify-recently-played-least-recently-used-cache-golang/&amp;subject=Barebones%20model%20of%20Spotify%27s%20%27Recently%20Played%27%20screen%20using%20a%20Least%20Recently%20Used%20%28LRU%29%20cache%20in%20Golang"
          title="Send via email"
          aria-label="Send via email"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1c-27.64 140.9 68.65 266.2 199.1 285.1c19.01 2.888 36.17-12.26 36.17-31.49l.0001-.6631c0-15.74-11.44-28.88-26.84-31.24c-84.35-12.98-149.2-86.13-149.2-174.2c0-102.9 88.61-185.5 193.4-175.4c91.54 8.869 158.6 91.25 158.6 183.2l0 16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98 .0036c-7.299 0-13.2 4.992-15.12 11.68c-24.85-12.15-54.24-16.38-86.06-5.106c-38.75 13.73-68.12 48.91-73.72 89.64c-9.483 69.01 43.81 128 110.9 128c26.44 0 50.43-9.544 69.59-24.88c24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3C495.1 107.1 361.2-9.332 207.8 20.73zM239.1 304.3c-26.47 0-48-21.56-48-48.05s21.53-48.05 48-48.05s48 21.56 48 48.05S266.5 304.3 239.1 304.3z"/></svg>

  </span>

</a
        >
      
    
  </section>


      
  
    
    
    
    <div class="pt-8">
      <hr class="border-dotted border-neutral-300 dark:border-neutral-600" />
      <div class="flex justify-between pt-3">
        <span>
          
            <a class="flex group" href="/posts/when-why-least-frequently-used-cache-implementation-golang/">
              <span
                class="mr-3 ltr:inline rtl:hidden text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400"
                >&larr;</span
              >
              <span
                class="ml-3 ltr:hidden rtl:inline text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >When and Why to use a Least Frequently Used (LFU) cache with an implementation in Golang</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2019-02-27 00:00:00 &#43;0000 UTC">27 February 2019</time>
                  
                </span>
              </span>
            </a>
          
        </span>
        <span>
          
            <a class="flex text-right group" href="/posts/tell-team-running-late-google-home-google-functions-golang-twilio/">
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >Tell your team you are running late using Google Home, Google Cloud Functions, Golang and Twilio</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2019-03-26 00:00:00 &#43;0000 UTC">26 March 2019</time>
                  
                </span>
              </span>
              <span
                class="ml-3 ltr:inline rtl:hidden text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span
                class="mr-3 ltr:hidden rtl:inline text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400"
                >&larr;</span
              >
            </a>
          
        </span>
      </div>
    </div>
  


      
    </footer>
  </article>

        
          <div
            class="absolute top-[100vh] ltr:right-0 rtl:left-0 w-12 pointer-events-none bottom-0"
          >
            <a
              href="#the-top"
              class="w-12 h-12 sticky pointer-events-auto top-[calc(100vh-5.5rem)] bg-neutral/50 dark:bg-neutral-800/50 backdrop-blur rounded-full text-xl flex items-center justify-center text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400"
              aria-label="Scroll to top"
              title="Scroll to top"
            >
              &uarr;
            </a>
          </div>
        
      </main><footer class="py-10 print:hidden">
  
  
    <nav class="pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400">
      <ul class="flex flex-col list-none sm:flex-row">
        
          <li
            class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"
          >
            <a
              class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
              href="/analytics"
              title=""
              >Analytics</a
            >
          </li>
        
          <li
            class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"
          >
            <a
              class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
              href="/index.xml"
              title=""
              >RSS</a
            >
          </li>
        
          <li
            class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"
          >
            <a
              class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
              href="https://forms.gle/orfXK5jh1LRaiFzo8"
              title=""
              >Suggest a topic</a
            >
          </li>
        
      </ul>
    </nav>
  
  <div class="flex items-center justify-between">
    <div>
      
      
        <p class="text-sm text-neutral-500 dark:text-neutral-400">
            &copy;
            2023
            Ilija Eftimov
        </p>
      
      
      
        <p class="text-xs text-neutral-500 dark:text-neutral-400">
          
          
          Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
            href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a> &amp; <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href="https://git.io/hugo-congo" target="_blank" rel="noopener noreferrer">Congo</a>
        </p>
      
    </div>
    
    
      <div
        class="text-sm cursor-pointer text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400 ltr:mr-14 rtl:ml-14"
      >
        <button
          id="appearance-switcher"
          class="w-12 h-12 "
          type="button"
          title="Switch to dark appearance"
        >
          <span class="inline dark:hidden">

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>

</span>
          <span class="hidden dark:inline">

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>

</span>
        </button>
      </div>
    
  </div>
  
  
</footer>
<div
  id="search-wrapper"
  class="fixed inset-0 z-50 flex flex-col p-4 sm:p-6 md:p-[10vh] lg:p-[12vh] w-screen h-screen cursor-default bg-neutral-500/50 backdrop-blur-sm dark:bg-neutral-900/50 invisible"
  data-url="https://ieftimov.com/"
>
  <div
    id="search-modal"
    class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg border-neutral-200 top-20 bg-neutral dark:bg-neutral-800 dark:border-neutral-700"
  >
    <header class="relative z-10 flex items-center justify-between flex-none px-2">
      <form class="flex items-center flex-auto min-w-0">
        <div class="flex items-center justify-center w-8 h-8 text-neutral-400">
          

  <span class="relative inline-block align-text-bottom icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


        </div>
        <input
          type="search"
          id="search-query"
          class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-transparent focus:outline-2"
          placeholder="Search"
          tabindex="0"
        />
      </form>
      <button
        id="close-search-button"
        class="flex items-center justify-center w-8 h-8 text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400"
        title="Close (Esc)"
      >
        

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>

  </span>


      </button>
    </header>
    <section class="flex-auto px-2 overflow-auto">
      <ul id="search-results">
        
      </ul>
    </section>
  </div>
</div>

    </div>
  </body>
</html>
