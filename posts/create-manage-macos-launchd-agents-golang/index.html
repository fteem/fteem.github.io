

<!DOCTYPE html>
<html
  lang="en"
  dir="ltr"
  class="scroll-smooth"
  data-default-appearance="light"
  data-auto-appearance="true"
><head>
  <meta charset="utf-8" />
  
    <meta http-equiv="content-language" content="en" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  
  <title>Create and manage MacOS LaunchAgents using Go &middot; Ilija Eftimov üë®‚ÄçüöÄ</title>
    <meta name="title" content="Create and manage MacOS LaunchAgents using Go &middot; Ilija Eftimov üë®‚ÄçüöÄ" />
  
  <meta name="description" content="Documenting my experiences and learnings, with the goal of helping other software engineers on their journey" />
  
  
  
  <link rel="canonical" href="https://ieftimov.com/posts/create-manage-macos-launchd-agents-golang/" />
  
  
  
  
  
  
  
  
  
    
  
  
  <link
    type="text/css"
    rel="stylesheet"
    href="/css/main.bundle.min.4801cb831d6359e43865e37733fc89df21983ad1c08157d4e17c36e09cb2501cdbd2e1dcde1db016cfa1554f175134d948555ab487816811cb9e93b19673ce89.css"
    integrity="sha512-SAHLgx1jWeQ4ZeN3M/yJ3yGYOtHAgVfU4Xw24JyyUBzb0uHc3h2wFs&#43;hVU8XUTTZSFVatIeBaBHLnpOxlnPOiQ=="
  />
  
  
  <script type="text/javascript" src="/js/appearance.min.4df8309499991be53c71b2b39ba0f5d5e77ea7d411d0710ce48c24218e7cc24ded28f19e85838fdc56db2306195cb001f049f577be0cf0ffb2dd6e2037ede1b9.js" integrity="sha512-TfgwlJmZG&#43;U8cbKzm6D11ed&#43;p9QR0HEM5IwkIY58wk3tKPGehYOP3FbbIwYZXLAB8En1d74M8P&#43;y3W4gN&#43;3huQ=="></script>
  
    
    
    
  
  
    
    
  
  
  
    
    <script defer type="text/javascript" id="script-bundle" src="/js/main.bundle.min.bbbc21fe00162ca986299c3aa2587e88662408cef57709874b7c316048a5ff80b7e342fc03812cff1393cb2be2ce65593299494d88df71ec6eb48ee261fc0fd6.js" integrity="sha512-u7wh/gAWLKmGKZw6olh&#43;iGYkCM71dwmHS3wxYEil/4C340L8A4Es/xOTyyvizmVZMplJTYjfcexutI7iYfwP1g==" data-copy="Copy" data-copied="Copied"></script>
  
  
  
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />
  
  
  
  
  
  
  
  <meta property="og:title" content="Create and manage MacOS LaunchAgents using Go" />
<meta property="og:description" content="If you have ever tried writing a daemon for MacOS you have met with launchd." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ieftimov.com/posts/create-manage-macos-launchd-agents-golang/" /><meta property="og:image" content="https://ieftimov.com/cards/create-manage-macos-launchd-agents-golang.png" /><meta property="article:section" content="posts" />

<meta property="og:site_name" content="Ilija Eftimov üë®‚ÄçüöÄ" />


  <meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://ieftimov.com/cards/create-manage-macos-launchd-agents-golang.png"/>

<meta name="twitter:title" content="Create and manage MacOS LaunchAgents using Go"/>
<meta name="twitter:description" content="If you have ever tried writing a daemon for MacOS you have met with launchd."/>

  
  <script type="application/ld+json">
  [{
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "Posts",
    "name": "Create and manage MacOS LaunchAgents using Go",
    "headline": "Create and manage MacOS LaunchAgents using Go",
    
    "abstract": "If you have ever tried writing a daemon for MacOS you have met with launchd.",
    "inLanguage": "en",
    "url" : "https:\/\/ieftimov.com\/posts\/create-manage-macos-launchd-agents-golang\/",
    "author" : {
      "@type": "Person",
      "name": "Ilija Eftimov"
    },
    
    "dateCreated": "2018-01-30T00:00:00\u002b00:00",
    
    
    
    
    "keywords": ["launchagent","launchd","launchctl","lpc","signals"],
    
    "mainEntityOfPage": "true",
    "wordCount": "3368"
  }]
  </script>


  
  <meta name="author" content="Ilija Eftimov" />
  
    
      <link href="https://twitter.com/ilijaio" rel="me" />
    
      <link href="https://www.linkedin.com/in/ieftimov/" rel="me" />
    
      <link href="mailto:blog@ieftimov.com" rel="me" />
    
      <link href="https://quadratic.fm" rel="me" />
    
      <link href="https://dev.to/fteem" rel="me" />
    
      <link href="https://github.com/fteem" rel="me" />
    
      <link href="https://t.me/ieftimovcom" rel="me" />
    
  
  
  






  
  <script async defer data-domain="ieftimov.com" src="https://plausible.io/js/plausible.js"></script>

  
  
</head>
<body
    class="flex flex-col h-screen px-6 m-auto text-lg leading-7 bg-neutral text-neutral-900 sm:px-14 md:px-24 lg:px-32 dark:bg-neutral-800 dark:text-neutral max-w-7xl"
  >
    <div id="the-top" class="absolute flex self-center">
      <a
        class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 dark:bg-neutral-600 focus:translate-y-0"
        href="#main-content"
        ><span class="font-bold ltr:pr-2 rtl:pl-2 text-primary-600 dark:text-primary-400"
          >&darr;</span
        >Skip to main content</a
      >
    </div>
    
    
      <header class="py-6 font-semibold sm:py-10 text-neutral-900 dark:text-neutral print:hidden">
  <nav class="flex justify-between">
    
    <div>
      
        <a
          class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
          rel="me"
          href="/"
          >Ilija Eftimov üë®‚ÄçüöÄ</a
        >
      

    </div>
    
    
      <ul class="flex flex-col list-none ltr:text-right rtl:text-left sm:flex-row">
        
          
            <li class="mb-1 sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
              <a
                class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
                href="/"
                title=""
                >Home</a
              >
            </li>
          
            <li class="mb-1 sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
              <a
                class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
                href="/posts/"
                title="Posts"
                >Essays</a
              >
            </li>
          
            <li class="mb-1 sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
              <a
                class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
                href="/work"
                title=""
                >Work</a
              >
            </li>
          
            <li class="mb-1 sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
              <a
                class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
                href="https://quadratic.fm"
                title=""
                >Subscribe</a
              >
            </li>
          
        
        
          <li class="ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
            <button
              id="search-button"
              class="text-base hover:text-primary-600 dark:hover:text-primary-400"
              title="Search (/)"
            >
              

  <span class="relative inline-block align-text-bottom icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


            </button>
          </li>
        
      </ul>
    
  </nav>
</header>

    
    <div class="relative flex flex-col grow">
      <main id="main-content" class="grow">
        
  <article>
    <header class="max-w-prose">
      
      <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
        Create and manage MacOS LaunchAgents using Go
      </h1>
      <div class="mt-8 mb-12 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
        





  
  



  

  
  
    
  

  

  

  
    
  

  


  <div class="flex flex-row flex-wrap items-center">
    
    
      <time datetime="2018-01-30 00:00:00 &#43;0000 UTC">30 January 2018</time><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">16 mins</span>
    

    
    
  </div>

  
  


      </div>
    </header>
    <section class="flex flex-col max-w-full mt-0 prose lg:flex-row dark:prose-invert">
      
        <div class="order-first px-0 lg:max-w-xs ltr:lg:pl-8 rtl:lg:pr-8 lg:order-last">
          <div class="ltr:pl-5 rtl:pr-5 toc lg:sticky lg:top-10 print:hidden">
            <details open class="mt-0 overflow-hidden rounded-lg rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5">
  <summary
    class="block py-1 text-lg font-semibold cursor-pointer rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 text-neutral-800 dark:text-neutral-100 lg:hidden bg-neutral-100 dark:bg-neutral-700"
  >
    Table of Contents
  </summary>
  <div
    class="py-2 border-dotted ltr:border-l rtl:border-r rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 border-neutral-300 dark:border-neutral-600"
  >
    <nav id="TableOfContents">
  <ul>
    <li><a href="#what-is-launchd-and-how-it-works">What is <code>launchd</code> and how it works?</a>
      <ul>
        <li><a href="#defining-agents-and-daemons">Defining agents and daemons</a></li>
      </ul>
    </li>
    <li><a href="#launchd-vs-launchctl"><code>launchd</code> v.s. <code>launchctl</code></a></li>
    <li><a href="#automating-with-go">Automating with Go</a>
      <ul>
        <li><a href="#templates-in-go">Templates in Go</a></li>
        <li><a href="#injecting-your-data">Injecting your data</a></li>
        <li><a href="#make-and-load-my-plist">Make and load my <code>.plist</code></a></li>
      </ul>
    </li>
    <li><a href="#what-about-the-launch-agent">What about the Launch Agent?</a>
      <ul>
        <li><a href="#understanding-and-handling-os-signals">Understanding and handling OS signals</a></li>
      </ul>
    </li>
    <li><a href="#putting-it-all-together">Putting it all together</a></li>
    <li><a href="#in-closing">In closing</a></li>
  </ul>
</nav>
  </div>
</details>

          </div>
        </div>
      
      <div class="min-w-0 min-h-0 max-w-prose">
        <p>If you have ever tried writing a daemon for MacOS you have met with <code>launchd</code>.
For those that don&rsquo;t have the experience, think of it as a framework for
starting, stopping and managing daemons, applications, processes, and scripts.
If you have any *nix experience the word daemon should not be too alien to
you.</p>
<p>For those unfamiliar, a daemon is a program running in the background without
requiring user input. A typical daemon might, for instance, perform daily
maintenance tasks or scan a device for malware when connected.</p>
<p>This post is aimed at folks that know a little bit about what daemons are, what
is the common way of using them and know a bit about Go. Also, if you have ever
written a daemon for any other *nix system, you will have a good idea of what
we are going to talk here. If you are an absolute beginner in Go or systems
this might prove to be an overwhelming article. Still, feel free to give it a
shot and let me know how it goes.</p>
<p>If you ever find yourself wanting to write a MacOS daemon with Go you would
like to know most of the stuff we are going to talk about in this article.
Without further ado, let&rsquo;s dive in.</p>
<h2 id="what-is-launchd-and-how-it-works" class="relative group">What is <code>launchd</code> and how it works? <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#what-is-launchd-and-how-it-works" aria-label="Anchor">#</a></span></h2>
<p><code>launchd</code> is a unified service-management framework, that starts, stops and
manages daemons, applications, processes, and scripts in MacOS.</p>
<p>One of its key features is that it differentiates between agents and daemons.
In <code>launchd</code> land, an agent runs on behalf of the logged in user while a daemon
runs on behalf of the root user or any specified user.</p>
<h3 id="defining-agents-and-daemons" class="relative group">Defining agents and daemons <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#defining-agents-and-daemons" aria-label="Anchor">#</a></span></h3>
<p>An agent/daemon is defined in an XML file, which states the properties of the
program that will execute, among a list of other properties. Another aspect to
keep in mind is that <code>launchd</code> decides if a program will be treated as a daemon
or an agent by where the program XML is located.</p>
<p>Over at <a href="https://launchd.info">launchd.info</a>, there&rsquo;s a simple table that shows
where you would (or not) place your program&rsquo;s XML:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">+----------------+-------------------------------+----------------------------------------------------+
| Type           | Location                      | Run on behalf of                                   |
+----------------+-------------------------------+----------------------------------------------------+
| User Agents    | ~/Library/LaunchAgents        | Currently logged in user                           |
| Global Agents  | /Library/LaunchAgents         | Currently logged in user                           |
| Global Daemons | /Library/LaunchDaemons        | root or the user specified with the key &#39;UserName&#39; |
| System Agents  | /System/Library/LaunchAgents  | Currently logged in user                           |
| System Daemons | /System/Library/LaunchDaemons | root or the user specified with the key &#39;UserName&#39; |
+----------------+-------------------------------+----------------------------------------------------+</code></pre></div>
<p>This means that when we set our XML file in, for example, the
<code>/Library/LaunchAgents</code> path our process will be treated as a global agent. The
main difference between the daemons and agents is that LaunchDaemons will run
as root, and are generally background processes. On the other hand,
LaunchAgents are jobs that will run as a user or in the context of userland.
These may be scripts or other foreground items and they also have access to the
MacOS UI (e.g. you can send notifications, control the windows, etc.)</p>
<p>So, how do we define an agent? Let&rsquo;s take a look at a simple XML file that
<code>launchd</code> understands:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="c">&lt;!--- Example blatantly ripped off from http://www.launchd.info/ --&gt;</span>
<span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span class="cp">&lt;!DOCTYPE plist PUBLIC &#34;-//Apple//DTD PLIST 1.0//EN&#34; &#34;http://www.apple.com/DTDs/PropertyList-1.0.dtd&#34;&gt;</span>
<span class="nt">&lt;plist</span> <span class="na">version=</span><span class="s">&#34;1.0&#34;</span><span class="nt">&gt;</span>
	<span class="nt">&lt;dict&gt;</span>
		<span class="nt">&lt;key&gt;</span>Label<span class="nt">&lt;/key&gt;</span>
		<span class="nt">&lt;string&gt;</span>com.example.app<span class="nt">&lt;/string&gt;</span>
		<span class="nt">&lt;key&gt;</span>Program<span class="nt">&lt;/key&gt;</span>
		<span class="nt">&lt;string&gt;</span>/Users/Me/Scripts/cleanup.sh<span class="nt">&lt;/string&gt;</span>
		<span class="nt">&lt;key&gt;</span>RunAtLoad<span class="nt">&lt;/key&gt;</span>
		<span class="nt">&lt;true/&gt;</span>
	<span class="nt">&lt;/dict&gt;</span>
<span class="nt">&lt;/plist&gt;</span></code></pre></div>
<p>The XML is quite self-explanatory, unless it&rsquo;s the first time you are seeing an
XML file. The file has three main properties, with values. In fact, if you take
a better look you will see the <code>dict</code> keyword which means <code>dictionary</code>. This
actually means that the XML represents a key-value structure, so in Go it would
look like:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="kt">string</span><span class="p">{</span>
        <span class="s">&#34;Label&#34;</span><span class="p">:</span>     <span class="s">&#34;com.example.app&#34;</span><span class="p">,</span>
        <span class="s">&#34;Program&#34;</span><span class="p">:</span>   <span class="s">&#34;/Users/Me/Scripts/cleanup.sh&#34;</span><span class="p">,</span>
        <span class="s">&#34;RunAtLoad&#34;</span><span class="p">:</span> <span class="s">&#34;true&#34;</span><span class="p">,</span>
<span class="p">}</span></code></pre></div>
<p>Let‚Äôs look at each of the keys:</p>
<ol>
<li><code>Label</code> - The job definition or the name of the job. This is the unique
identifier for the job within the <code>launchd</code> instance. Usually, the label
(and hence the name) is written in <a href="en.wikipedia.org/wiki/Reverse_domain_name_notation">Reverse domain name
notation</a>.</li>
<li><code>Program</code> - This key defines what the job should start, in our case a script
with the path <code>/Users/Me/Scripts/cleanup.sh</code>.</li>
<li><code>RunAtLoad</code> - This key specifies when the job should be run, in this case
right after it&rsquo;s loaded.</li>
</ol>
<p>As you can see, the keys used in this XML file are quite self-explanatory. This
is the case for the remaining 30-40 keys that <code>launchd</code> supports. Last but not
least these files although have an XML syntax, in fact, they have a <code>.plist</code>
extension (which means <code>Property List</code>). Makes a lot of sense, right?</p>
<h2 id="launchd-vs-launchctl" class="relative group"><code>launchd</code> v.s. <code>launchctl</code> <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#launchd-vs-launchctl" aria-label="Anchor">#</a></span></h2>
<p>Before we continue with our little exercise of creating daemons/agents with Go,
let&rsquo;s first see how <code>launchd</code> allows us to control these jobs. While
<code>launchd</code>&rsquo;s job is to boot the system and to load and maintain services, there
is a different command used for jobs management - <code>launchctl</code>. With <code>launchd</code>
facilitating jobs, the control of services is centralized in the <code>launchctl</code>
command.</p>
<p><code>launchctl</code> has a long list of subcommands that we can use. For example,
loading or unloading a job is done via:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">launchctl unload/load ~/Library/LaunchAgents/com.example.app.plist</code></pre></div>
<p>Or, starting/stopping a job is done via:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">launchctl start/stop ~/Library/LaunchAgents/com.example.app.plist</code></pre></div>
<p>To get any confusion out of the way, <code>load</code> and <code>start</code> are different. While
<code>start</code> only starts the agent/daemon, <code>load</code> loads the job and it might also
start it if the job is configured to run on load. This is achieved by setting
the <code>RunAtLoad</code> property in the property list XML of the job:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="c">&lt;!--- Example blatantly ripped off from http://www.launchd.info/ --&gt;</span>
<span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span class="cp">&lt;!DOCTYPE plist PUBLIC &#34;-//Apple//DTD PLIST 1.0//EN&#34; &#34;http://www.apple.com/DTDs/PropertyList-1.0.dtd&#34;&gt;</span>
<span class="nt">&lt;plist</span> <span class="na">version=</span><span class="s">&#34;1.0&#34;</span><span class="nt">&gt;</span>
	<span class="nt">&lt;dict&gt;</span>
		<span class="nt">&lt;key&gt;</span>Label<span class="nt">&lt;/key&gt;</span>
		<span class="nt">&lt;string&gt;</span>com.example.app<span class="nt">&lt;/string&gt;</span>
		<span class="nt">&lt;key&gt;</span>Program<span class="nt">&lt;/key&gt;</span>
		<span class="nt">&lt;string&gt;</span>/Users/Me/Scripts/cleanup.sh<span class="nt">&lt;/string&gt;</span>

		<span class="nt">&lt;key&gt;</span>RunAtLoad<span class="nt">&lt;/key&gt;&lt;true/&gt;</span>

	<span class="nt">&lt;/dict&gt;</span>
<span class="nt">&lt;/plist&gt;</span></code></pre></div>
<p>If you would like to see what other commands <code>launchctl</code> supports, you can run
<code>man launchctl</code> in your terminal and see the options in detail.</p>
<h2 id="automating-with-go" class="relative group">Automating with Go <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#automating-with-go" aria-label="Anchor">#</a></span></h2>
<p>After getting the basics of <code>launchd</code> and <code>launctl</code> out of the way, why don&rsquo;t
we see how we can add an agent to any Go package? For our example, we are going
to write a simple way of plugging in a <code>launchd</code> agent for any of your Go
packages.</p>
<p>As we already established before, <code>launchd</code> speaks in XML. Or, rather, it
understands XML files, called <em>property lists</em> (or <code>.plist</code>). This means, for
our Go package to have an agent running on MacOS, it will need to tell
<code>launchd</code> &ldquo;hey, <code>launchd</code>, run this thing!&rdquo;. And since <code>launch</code> speaks only in
<code>.plist</code>, that means our package needs to be capable of generating XML files.</p>
<h3 id="templates-in-go" class="relative group">Templates in Go <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#templates-in-go" aria-label="Anchor">#</a></span></h3>
<p>While one could have a hardcoded <code>.plist</code> file in their project and copy it
across to the <code>~/Library/LaunchAgents</code> path, a more programmatical way to do
this would be to use a template to generate these XML files. The good thing is
Go&rsquo;s standard library has us covered - the <code>text/template</code> package
(<a href="https://godoc.org/text/template">docs</a>) does exactly what we need.</p>
<p>In a nutshell, <code>text/template</code> implements data-driven templates for generating
textual output. Or in other words, you give it a template and a data structure,
it will mash them up together and produce a nice and clean text file. Perfect.</p>
<p>Let&rsquo;s say the <code>.plist</code> we need to generate in our case is the following:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#39;1.0&#39; encoding=&#39;UTF-8&#39;?&gt;</span>
<span class="cp">&lt;!DOCTYPE plist PUBLIC \&#34;-//Apple Computer//DTD PLIST 1.0//EN\&#34; \&#34;http://www.apple.com/DTDs/PropertyList-1.0.dtd\&#34; &gt;</span>
<span class="nt">&lt;plist</span> <span class="na">version=</span><span class="s">&#39;1.0&#39;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;dict&gt;</span>
    <span class="nt">&lt;key&gt;</span>Label<span class="nt">&lt;/key&gt;&lt;string&gt;</span>Ticker<span class="nt">&lt;/string&gt;</span>
    <span class="nt">&lt;key&gt;</span>Program<span class="nt">&lt;/key&gt;&lt;string&gt;</span>/usr/local/bin/ticker<span class="nt">&lt;/string&gt;</span>
    <span class="nt">&lt;key&gt;</span>StandardOutPath<span class="nt">&lt;/key&gt;&lt;string&gt;</span>/tmp/ticker.out.log<span class="nt">&lt;/string&gt;</span>
    <span class="nt">&lt;key&gt;</span>StandardErrorPath<span class="nt">&lt;/key&gt;&lt;string&gt;</span>/tmp/ticker.err.log<span class="nt">&lt;/string&gt;</span>
    <span class="nt">&lt;key&gt;</span>KeepAlive<span class="nt">&lt;/key&gt;&lt;true/&gt;</span>
    <span class="nt">&lt;key&gt;</span>RunAtLoad<span class="nt">&lt;/key&gt;&lt;true/&gt;</span>
  <span class="nt">&lt;/dict&gt;</span>
<span class="nt">&lt;/plist&gt;</span></code></pre></div>
<p>We want to keep it quite simple in our little exercise. It will contain only
six properties: <code>Label</code>, <code>Program</code>, <code>StandardOutPath</code>, <code>StandardErrorPath</code>,
<code>KeepAlive</code> and <code>RunAtLoad</code>. To generate such a XML, its template would look
something like this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version=&#39;1.0&#39; encoding=&#39;UTF-8&#39;?&gt;</span>
<span class="cp">&lt;!DOCTYPE plist PUBLIC \&#34;-//Apple Computer//DTD PLIST 1.0//EN\&#34; \&#34;http://www.apple.com/DTDs/PropertyList-1.0.dtd\&#34; &gt;</span>
<span class="nt">&lt;plist</span> <span class="na">version=</span><span class="s">&#39;1.0&#39;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;dict&gt;</span>
    <span class="nt">&lt;key&gt;</span>Label<span class="nt">&lt;/key&gt;&lt;string&gt;</span>{{.Label}}<span class="nt">&lt;/string&gt;</span>
    <span class="nt">&lt;key&gt;</span>Program<span class="nt">&lt;/key&gt;&lt;string&gt;</span>{{.Program}}<span class="nt">&lt;/string&gt;</span>
    <span class="nt">&lt;key&gt;</span>StandardOutPath<span class="nt">&lt;/key&gt;&lt;string&gt;</span>/tmp/{{.Label}}.out.log<span class="nt">&lt;/string&gt;</span>
    <span class="nt">&lt;key&gt;</span>StandardErrorPath<span class="nt">&lt;/key&gt;&lt;string&gt;</span>/tmp/{{.Label}}.err.log<span class="nt">&lt;/string&gt;</span>
    <span class="nt">&lt;key&gt;</span>KeepAlive<span class="nt">&lt;/key&gt;</span><span class="err">&lt;</span>{{.KeepAlive}}/&gt;
    <span class="nt">&lt;key&gt;</span>RunAtLoad<span class="nt">&lt;/key&gt;</span><span class="err">&lt;</span>{{.RunAtLoad}}/&gt;
  <span class="nt">&lt;/dict&gt;</span>
<span class="nt">&lt;/plist&gt;</span></code></pre></div>
<p>As you can see, the difference between the two XMLs is that the second one has
the double curly braces with expressions in them in places where the first XML
has some sort of a value. These are called &ldquo;actions&rdquo;, which can be data
evaluations or control structures and are delimited by &ldquo;{{&rdquo; and &ldquo;}}&rdquo;. Any of the
text outside actions is copied to the output untouched.</p>
<h3 id="injecting-your-data" class="relative group">Injecting your data <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#injecting-your-data" aria-label="Anchor">#</a></span></h3>
<p>Now that we have our template with its glorious XML and curly braces
(or actions), let&rsquo;s see how we can inject our data into it. Since things are
generally simple in Go, especially when it comes to its standard library, you
should not worry - this will be easy!</p>
<p>To keep thing simple, we will store the whole XML template in a plain old string.
Yes, weird, I know. The best way would be to store it in a file and
read it from there, or embed it in the binary itself, but in our little example
let&rsquo;s keep it simple:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml">// template.go
package main

func Template() string {
	return `
<span class="cp">&lt;?xml version=&#39;1.0&#39; encoding=&#39;UTF-8&#39;?&gt;</span>
 <span class="cp">&lt;!DOCTYPE plist PUBLIC \&#34;-//Apple Computer//DTD PLIST 1.0//EN\&#34; \&#34;http://www.apple.com/DTDs/PropertyList-1.0.dtd\&#34; &gt;</span>
 <span class="nt">&lt;plist</span> <span class="na">version=</span><span class="s">&#39;1.0&#39;</span><span class="nt">&gt;</span>
   <span class="nt">&lt;dict&gt;</span>
     <span class="nt">&lt;key&gt;</span>Label<span class="nt">&lt;/key&gt;&lt;string&gt;</span>{{.Label}}<span class="nt">&lt;/string&gt;</span>
     <span class="nt">&lt;key&gt;</span>Program<span class="nt">&lt;/key&gt;&lt;string&gt;</span>{{.Program}}<span class="nt">&lt;/string&gt;</span>
     <span class="nt">&lt;key&gt;</span>StandardOutPath<span class="nt">&lt;/key&gt;&lt;string&gt;</span>/tmp/{{.Label}}.out.log<span class="nt">&lt;/string&gt;</span>
     <span class="nt">&lt;key&gt;</span>StandardErrorPath<span class="nt">&lt;/key&gt;&lt;string&gt;</span>/tmp/{{.Label}}.err.log<span class="nt">&lt;/string&gt;</span>
     <span class="nt">&lt;key&gt;</span>KeepAlive<span class="nt">&lt;/key&gt;</span><span class="err">&lt;</span>{{.KeepAlive}}/&gt;
     <span class="nt">&lt;key&gt;</span>RunAtLoad<span class="nt">&lt;/key&gt;</span><span class="err">&lt;</span>{{.RunAtLoad}}/&gt;
   <span class="nt">&lt;/dict&gt;</span>
<span class="nt">&lt;/plist&gt;</span>
`
}</code></pre></div>
<p>And the program that will use our little template function:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// main.go
</span><span class="c1"></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;log&#34;</span>
	<span class="s">&#34;os&#34;</span>
	<span class="s">&#34;text/template&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">data</span> <span class="o">:=</span> <span class="kd">struct</span> <span class="p">{</span>
		<span class="nx">Label</span>     <span class="kt">string</span>
		<span class="nx">Program</span>   <span class="kt">string</span>
		<span class="nx">KeepAlive</span> <span class="kt">bool</span>
		<span class="nx">RunAtLoad</span> <span class="kt">bool</span>
	<span class="p">}{</span>
		<span class="nx">Label</span><span class="p">:</span>     <span class="s">&#34;ticker&#34;</span><span class="p">,</span>
		<span class="nx">Program</span><span class="p">:</span>   <span class="s">&#34;/usr/local/bin/ticker&#34;</span><span class="p">,</span>
		<span class="nx">KeepAlive</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
		<span class="nx">RunAtLoad</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
	<span class="p">}</span>
	<span class="nx">t</span> <span class="o">:=</span> <span class="nx">template</span><span class="p">.</span><span class="nf">Must</span><span class="p">(</span><span class="nx">template</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="s">&#34;launchdConfig&#34;</span><span class="p">).</span><span class="nf">Parse</span><span class="p">(</span><span class="nf">Template</span><span class="p">()))</span>
	<span class="nx">err</span> <span class="o">:=</span> <span class="nx">t</span><span class="p">.</span><span class="nf">Execute</span><span class="p">(</span><span class="nx">os</span><span class="p">.</span><span class="nx">Stdout</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">log</span><span class="p">.</span><span class="nf">Fatalf</span><span class="p">(</span><span class="s">&#34;Template generation failed: %s&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span></code></pre></div>
<p>So, what happens there, in the <code>main</code> function? It&rsquo;s actually quite simple:</p>
<ol>
<li>We declare a small <code>struct</code>, which has only the properties that will be needed
in the template, and we immediately initialize it with the values for our program.</li>
<li>We build a new template, using the <code>template.New</code> function, with the name
<code>launchdConfig</code>. Then, we invoke the <code>Parse</code> function on it, which takes the
XML template as an argument.</li>
<li>We invoke the <code>template.Must</code> function, which takes our built template as
argument. From the documentation, <code>template.Must</code> is a helper that wraps a call
to a function returning <code>(*Template, error)</code> and panics if the error is non-<code>nil</code>.
Actually, <code>template.Must</code> is built to, in a way, validate if the template can be
understood by the <code>text/template</code> package.</li>
<li>Finally, we invoke <code>Execute</code> on our built template, which takes a data structure
and applies its attributes to the actions in the template. Then it sends the
output to <code>os.Stdout</code>, which does the trick for our example. Of course, the
output can be sent to any struct that implements the <code>io.Writer</code> interface, like
a file (<code>os.File</code>).</li>
</ol>
<h3 id="make-and-load-my-plist" class="relative group">Make and load my <code>.plist</code> <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#make-and-load-my-plist" aria-label="Anchor">#</a></span></h3>
<p>Instead of sending all this nice XML to standard out, let&rsquo;s throw in an open
file descriptor to the <code>Execute</code> function and finally save our <code>.plist</code> file in
<code>~/Library/LaunchAgents</code>. There are a couple of main points we need to change.</p>
<p>First, getting the location of the binary. Since it&rsquo;s a Go binary, and we will
install it via <code>go install</code>, we can assume that the path will be at <code>$GOPATH/bin</code>.
Second, since we don&rsquo;t know the actual <code>$HOME</code> of the current user, we will have
to get it through the environment. Both of these can be done via <code>os.Getenv</code>
(<a href="https://godoc.org/os#Getenv">docs</a>) which takes a variable name and returns
its value.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// main.go
</span><span class="c1"></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;log&#34;</span>
	<span class="s">&#34;os&#34;</span>
	<span class="s">&#34;text/template&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">data</span> <span class="o">:=</span> <span class="kd">struct</span> <span class="p">{</span>
		<span class="nx">Label</span>     <span class="kt">string</span>
		<span class="nx">Program</span>   <span class="kt">string</span>
		<span class="nx">KeepAlive</span> <span class="kt">bool</span>
		<span class="nx">RunAtLoad</span> <span class="kt">bool</span>
	<span class="p">}{</span>
		<span class="nx">Label</span><span class="p">:</span>     <span class="s">&#34;com.ieftimov.ticker&#34;</span><span class="p">,</span> <span class="c1">// Reverse-DNS naming convention
</span><span class="c1"></span>		<span class="nx">Program</span><span class="p">:</span>   <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;%s/bin/ticker&#34;</span><span class="p">,</span> <span class="nx">os</span><span class="p">.</span><span class="nf">Getenv</span><span class="p">(</span><span class="s">&#34;GOPATH&#34;</span><span class="p">)),</span>
		<span class="nx">KeepAlive</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
		<span class="nx">RunAtLoad</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
	<span class="p">}</span>

        <span class="nx">plistPath</span> <span class="o">:=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;%s/Library/LaunchAgents/%s.plist&#34;</span><span class="p">,</span> <span class="nx">os</span><span class="p">.</span><span class="nf">Getenv</span><span class="p">(</span><span class="s">&#34;HOME&#34;</span><span class="p">),</span> <span class="nx">data</span><span class="p">.</span><span class="nx">Label</span><span class="p">)</span>
        <span class="nx">f</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nf">Open</span><span class="p">(</span><span class="nx">plistPath</span><span class="p">)</span>
        <span class="nx">t</span> <span class="o">:=</span> <span class="nx">template</span><span class="p">.</span><span class="nf">Must</span><span class="p">(</span><span class="nx">template</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="s">&#34;launchdConfig&#34;</span><span class="p">).</span><span class="nf">Parse</span><span class="p">(</span><span class="nf">Template</span><span class="p">()))</span>
        <span class="nx">err</span> <span class="o">:=</span> <span class="nx">t</span><span class="p">.</span><span class="nf">Execute</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
                <span class="nx">log</span><span class="p">.</span><span class="nf">Fatalf</span><span class="p">(</span><span class="s">&#34;Template generation failed: %s&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
        <span class="p">}</span>
<span class="p">}</span></code></pre></div>
<p>That&rsquo;s about it. The first part, about setting the correct <code>Program</code> property,
is done by concatenating the name of the program and <code>$GOPATH</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;%s/bin/ticker&#34;</span><span class="p">,</span> <span class="nx">os</span><span class="p">.</span><span class="nf">Getenv</span><span class="p">(</span><span class="s">&#34;GOPATH&#34;</span><span class="p">))</span>
<span class="c1">// Output: /Users/&lt;username&gt;/go/bin/ticker
</span></code></pre></div>
<p>The second part is slightly more complex, and it&rsquo;s done by concatenating three
strings, the <code>$HOME</code> environment variable, the <code>Label</code> property of the program
and the <code>/Library/LaunchAgents</code> string:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;%s/Library/LaunchAgents/%s.plist&#34;</span><span class="p">,</span> <span class="nx">os</span><span class="p">.</span><span class="nf">Getenv</span><span class="p">(</span><span class="s">&#34;HOME&#34;</span><span class="p">),</span> <span class="nx">data</span><span class="p">.</span><span class="nx">Label</span><span class="p">)</span>
<span class="c1">// Output: /Users/&lt;username&gt;/Library/LaunchAgents/com.ieftimov.ticker.plist
</span></code></pre></div>
<p>By having these two paths, opening the file and writing to it is very trivial -
we open the file via <code>os.Open</code> and we pass in the <code>os.File</code> structure to
<code>t.Execute</code> which writes to the file descriptor.</p>
<h2 id="what-about-the-launch-agent" class="relative group">What about the Launch Agent? <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#what-about-the-launch-agent" aria-label="Anchor">#</a></span></h2>
<p>We will keep this one simple as well. Let&rsquo;s throw in a command to our package,
make it installable via <code>go install</code> (not that there&rsquo;s much to it) and make it
runnable by our <code>.plist</code> file:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// cmd/ticker/main.go
</span><span class="c1"></span><span class="kn">package</span> <span class="nx">ticker</span>

<span class="kn">import</span> <span class="p">(</span>
  <span class="s">&#34;time&#34;</span>
  <span class="s">&#34;fmt&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">for</span> <span class="k">range</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Tick</span><span class="p">(</span><span class="mi">30</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;tick!&#34;</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></div>
<p>This the <code>ticker</code> program will use <code>time.Tick</code>, to execute an action every 30
seconds. Since this will be an infinite loop, <code>launchd</code> will kick off the program
on boot (because <code>RunAtLoad</code> is set to <code>true</code> in the <code>.plist</code> file) and will
keep it running. But, to make the program controllable from the operating system,
we need to make the program react to some OS signals, like <code>SIGINT</code> or <code>SIGTERM</code>.</p>
<h3 id="understanding-and-handling-os-signals" class="relative group">Understanding and handling OS signals <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#understanding-and-handling-os-signals" aria-label="Anchor">#</a></span></h3>
<p>While there&rsquo;s quite a bit to be learned about OS signals, in our
example we will scratch a bit off the surface. (If you know a lot about
inter-process communication this might be too much of an oversimplification to
you - and I apologize up front. Feel free to drop some links on the topic in the
comments so others can learn more!)</p>
<p>The best way to think about a signal is that it&rsquo;s a message from the operating
system or another process, to a process. It is an asynchronous notification sent
to a process or to a specific thread within the same process to notify it of an
event that occurred.</p>
<p>There are quite a bit of various signals that can be sent to a process
(or a thread), like <code>SIGKILL</code> (which kills a process), <code>SIGSTOP</code> (stop), <code>SIGTERM</code>
(termination), <code>SIGILL</code> and so on and so forth. There&rsquo;s an exhaustive list of
signal types on <a href="https://en.wikipedia.org/wiki/Signal_(IPC)">Wikipedia&rsquo;s page</a>
on signals.</p>
<p>To get back to <code>launchd</code>, if we look at its documentation about stopping a job
we will notice the following:</p>
<blockquote>
<p>Stopping a job will send the signal <code>SIGTERM</code> to the process. Should this not
stop the process launchd will wait <code>ExitTimeOut</code> seconds (20 seconds by default)
before sending <code>SIGKILL</code>.</p>
</blockquote>
<p>Pretty self-explanatory, right? We need to handle one signal - <code>SIGTERM</code>.
Why not <code>SIGKILL</code>? Because <code>SIGKILL</code> is a special signal that cannot be caught -
it kills the process without any chance for a graceful shutdown, no questions
asked. That&rsquo;s why there&rsquo;s a termination signal and a &ldquo;kill&rdquo; signal.</p>
<p>Let&rsquo;s throw in a bit of signal handling in our code, so our program knows that
it needs to exit when it gets told to do so:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;fmt&#34;</span>
	<span class="s">&#34;os&#34;</span>
	<span class="s">&#34;os/signal&#34;</span>
	<span class="s">&#34;syscall&#34;</span>
	<span class="s">&#34;time&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">sigs</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Signal</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
	<span class="nx">signal</span><span class="p">.</span><span class="nf">Notify</span><span class="p">(</span><span class="nx">sigs</span><span class="p">,</span> <span class="nx">syscall</span><span class="p">.</span><span class="nx">SIGINT</span><span class="p">,</span> <span class="nx">syscall</span><span class="p">.</span><span class="nx">SIGTERM</span><span class="p">)</span>

	<span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
		<span class="o">&lt;-</span><span class="nx">sigs</span>
		<span class="nx">os</span><span class="p">.</span><span class="nf">Exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
	<span class="p">}()</span>

	<span class="k">for</span> <span class="k">range</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Tick</span><span class="p">(</span><span class="mi">30</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;tick!&#34;</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span></code></pre></div>
<p>In the new version, the agent program has two new packages imported: <code>os/signal</code>
and <code>syscall</code>. <code>os/signal</code> implements access to incoming signals, that are
primarily used on Unix-like systems. Since in this article we are specifically
interested in MacOS, this is exactly what we need.</p>
<p>Package <code>syscall</code> contains an interface to the low-level operating system
primitives. An important note about <code>syscall</code> is that it is locked down since
Go v1.4. This means that any code outside of the standard library that uses
the <code>syscall</code> package should be migrated to use the new <code>golang.org/x/sys</code>
<a href="https://golang.org/x/sys">package</a>. Since we are using <strong>only</strong> the signals constants of
<code>syscall</code> we can get away with this.</p>
<p>(If you want to read more about the package lockdown, you can see
<a href="https://docs.google.com/document/d/1QXzI9I1pOfZPujQzxhyRy6EeHYTQitKKjHfpq0zpxZs/edit">the rationale on locking it down</a>
by the Go team and the new <a href="https://golang.org/x/sys">golang.org/s/sys</a> package.)</p>
<p>Having the basics of the packages out of the way, let&rsquo;s go step by step through
the new lines of code added:</p>
<ol>
<li>We make a buffered channel of type <code>os.Signal</code>, with a size of <code>1</code>. <code>os.Signal</code>
is a type that represents an operating system signal.</li>
<li>We call <code>signal.Notify</code> with the new channel as an argument, plus
<code>syscall.SIGINT</code> and <code>syscall.SIGTERM</code>. This function states &ldquo;when the OS sends
a <code>SIGINT</code> or a <code>SIGTERM</code> signal to this program, send the signal to the
channel&rdquo;. This allows us to somehow handle the sent OS signal.</li>
<li>The new goroutine that we spawn waits for any of the signals to arrive through
the channel. Since we know that any of the signals that will arrive are about
shutting down the program, after receiving any signal we use <code>os.Exit(0)</code>
(<a href="https://godoc.org/os#Exit">docs</a>) to gracefully stop the program. One caveat
here is that if we had any <code>defer</code>red calls they would not be run.</li>
</ol>
<p>Now <code>launchd</code> can run the agent program and we can <code>load</code> and <code>unload</code>,
<code>start</code> and <code>stop</code> it using <code>launchctl</code>.</p>
<h2 id="putting-it-all-together" class="relative group">Putting it all together <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#putting-it-all-together" aria-label="Anchor">#</a></span></h2>
<p>Now that we have all the pieces ready, we need to put them together to a
good use. Our application will consist of two binaries - a CLI tool and an
agent (daemon). Both of the programs will be stored in separate subdirectories
of the <code>cmd</code> directory.</p>
<p>The CLI tool:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// cmd/cli/main.go
</span><span class="c1"></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;log&#34;</span>
	<span class="s">&#34;os&#34;</span>
	<span class="s">&#34;text/template&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">data</span> <span class="o">:=</span> <span class="kd">struct</span> <span class="p">{</span>
		<span class="nx">Label</span>     <span class="kt">string</span>
		<span class="nx">Program</span>   <span class="kt">string</span>
		<span class="nx">KeepAlive</span> <span class="kt">bool</span>
		<span class="nx">RunAtLoad</span> <span class="kt">bool</span>
	<span class="p">}{</span>
		<span class="nx">Label</span><span class="p">:</span>     <span class="s">&#34;com.ieftimov.ticker&#34;</span><span class="p">,</span> <span class="c1">// Reverse-DNS naming convention
</span><span class="c1"></span>		<span class="nx">Program</span><span class="p">:</span>   <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;%s/bin/ticker&#34;</span><span class="p">,</span> <span class="nx">os</span><span class="p">.</span><span class="nf">Getenv</span><span class="p">(</span><span class="s">&#34;GOPATH&#34;</span><span class="p">)),</span>
		<span class="nx">KeepAlive</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
		<span class="nx">RunAtLoad</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
	<span class="p">}</span>

        <span class="nx">plistPath</span> <span class="o">:=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;%s/Library/LaunchAgents/%s.plist&#34;</span><span class="p">,</span> <span class="nx">os</span><span class="p">.</span><span class="nf">Getenv</span><span class="p">(</span><span class="s">&#34;HOME&#34;</span><span class="p">),</span> <span class="nx">data</span><span class="p">.</span><span class="nx">Label</span><span class="p">)</span>
        <span class="nx">f</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nf">Open</span><span class="p">(</span><span class="nx">plistPath</span><span class="p">)</span>
        <span class="nx">t</span> <span class="o">:=</span> <span class="nx">template</span><span class="p">.</span><span class="nf">Must</span><span class="p">(</span><span class="nx">template</span><span class="p">.</span><span class="nf">New</span><span class="p">(</span><span class="s">&#34;launchdConfig&#34;</span><span class="p">).</span><span class="nf">Parse</span><span class="p">(</span><span class="nf">Template</span><span class="p">()))</span>
        <span class="nx">err</span> <span class="o">:=</span> <span class="nx">t</span><span class="p">.</span><span class="nf">Execute</span><span class="p">(</span><span class="nx">f</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
                <span class="nx">log</span><span class="p">.</span><span class="nf">Fatalf</span><span class="p">(</span><span class="s">&#34;Template generation failed: %s&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
        <span class="p">}</span>
<span class="p">}</span></code></pre></div>
<p>And the ticker program:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="c1">// cmd/ticker/main.go
</span><span class="c1"></span><span class="kn">package</span> <span class="nx">main</span>

<span class="kn">import</span> <span class="p">(</span>
	<span class="s">&#34;fmt&#34;</span>
	<span class="s">&#34;os&#34;</span>
	<span class="s">&#34;os/signal&#34;</span>
	<span class="s">&#34;syscall&#34;</span>
	<span class="s">&#34;time&#34;</span>
<span class="p">)</span>

<span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">sigs</span> <span class="o">:=</span> <span class="nb">make</span><span class="p">(</span><span class="kd">chan</span> <span class="nx">os</span><span class="p">.</span><span class="nx">Signal</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
	<span class="nx">signal</span><span class="p">.</span><span class="nf">Notify</span><span class="p">(</span><span class="nx">sigs</span><span class="p">,</span> <span class="nx">syscall</span><span class="p">.</span><span class="nx">SIGINT</span><span class="p">,</span> <span class="nx">syscall</span><span class="p">.</span><span class="nx">SIGTERM</span><span class="p">)</span>

	<span class="k">go</span> <span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
		<span class="o">&lt;-</span><span class="nx">sigs</span>
		<span class="nx">os</span><span class="p">.</span><span class="nf">Exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
	<span class="p">}()</span>

	<span class="k">for</span> <span class="k">range</span> <span class="nx">time</span><span class="p">.</span><span class="nf">Tick</span><span class="p">(</span><span class="mi">30</span> <span class="o">*</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Second</span><span class="p">)</span> <span class="p">{</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;tick!&#34;</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span></code></pre></div>
<p>To install them both, we need to run <code>go install ./...</code> in the project root.
The command will install all the sub-packages that are located within the
project.  This will leave us with two available binaries, installed in the
<code>$GOPATH/bin</code> path.</p>
<p>To install our launch agent, we need to run only the CLI tool, via the <code>cli</code>
command. This will generate the <code>.plist</code> file and place it in the
<code>~/Library/LaunchAgents</code> path. We don&rsquo;t need to touch the <code>ticker</code> binary -
that one will be managed by <code>launchd</code>.</p>
<p>To load the newly created <code>.plist</code> file, we need to run:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">launchctl load ~/Library/LaunchAgents/com.ieftimov.ticker.plist</code></pre></div>
<p>When we run it, we will not see anything immediately, but after 30 seconds
the ticker will add a <code>tick!</code> line in <code>/tmp/ticker.out.log</code>. We can <code>tail</code>
the file to see the new lines being added. If we want to unload the agent, we
can use:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">launchctl unload ~/Library/LaunchAgents/com.ieftimov.ticker.plist</code></pre></div>
<p>This will unload the launch agent and will stop the ticker from running.
Remember the signal handling we added? This is the case where it&rsquo;s being used!
Also, we could have automated the (un)loading of the file via the CLI tool but
for simplicity, we left it out. You can try to improve the CLI tool by making
it a bit smarter with subcommands and flags, as a follow-up exercise from this
tutorial.</p>
<p>Finally, if you decide to completely delete the launch agent, you can remove
the <code>.plist</code> file:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">rm ~/Library/LaunchAgents/com.ieftimov.ticker.plist</code></pre></div>
<h2 id="in-closing" class="relative group">In closing <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#in-closing" aria-label="Anchor">#</a></span></h2>
<p>As part of this (quite long!) article, we saw how we can work with <code>launchd</code>
and Golang. We took a detour, like learning about <code>launchd</code> and <code>launchctl</code>,
generating XML files using the <code>text/template</code> package, we took a look at OS
signals and how we can gracefully shutdown a Go program by handling the
<code>SIGINT</code> and <code>SIGTERM</code> signals. There was quite a bit to learn and see, but we
got to the end.</p>
<p>Of course, we only scratched the surface with this article. For example,
<code>launchd</code> is quite an interesting tool. You can use it also like <code>crontab</code>
because it allows running programs at explicit time/date combinations or on
specific days. Or, for example, the XML template can be embedded in the program
binary using tools like <a href="https://github.com/jteeuwen/go-bindata"><code>go-bindata</code></a>,
instead of hardcoding it in a function. Also, you explore more about signals,
how they work and how Go implements these low-level primitives so you can use
them with ease in your programs. The options are plenty, feel free to explore!</p>
<iframe src="https://quadratic.fm/embed" width="100%" height="320" style="margin-top:2em" frameborder="0" scrolling="no"></iframe>


      </div>
    </section>
    <footer class="pt-8 max-w-prose print:hidden">
      
  <div class="flex">
    
      
      
        
        <img
          class="w-24 h-24 !mt-0 !mb-0 ltr:mr-4 rtl:ml-4 rounded-full"
          width="96"
          height="96"
          alt="Ilija Eftimov"
          src="/img/avatar_huae39953c6189b6aa60e47103b358d088_112612_192x192_fill_q75_box_smart1.jpg"
        />
      
    
    <div class="place-self-center">
      
        <div class="text-[0.6rem] leading-3 text-neutral-500 dark:text-neutral-400 uppercase">
          Author
        </div>
        <div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">
          Ilija Eftimov
        </div>
      
      
      <div class="text-2xl sm:text-lg">
  <div class="flex flex-wrap text-neutral-400 dark:text-neutral-500">
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://twitter.com/ilijaio"
          target="_blank"
          aria-label="Twitter"
          rel="me noopener noreferrer"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>

  </span>

</a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://www.linkedin.com/in/ieftimov/"
          target="_blank"
          aria-label="Linkedin"
          rel="me noopener noreferrer"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>

  </span>

</a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="mailto:blog@ieftimov.com"
          target="_blank"
          aria-label="Email"
          rel="me noopener noreferrer"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1c-27.64 140.9 68.65 266.2 199.1 285.1c19.01 2.888 36.17-12.26 36.17-31.49l.0001-.6631c0-15.74-11.44-28.88-26.84-31.24c-84.35-12.98-149.2-86.13-149.2-174.2c0-102.9 88.61-185.5 193.4-175.4c91.54 8.869 158.6 91.25 158.6 183.2l0 16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98 .0036c-7.299 0-13.2 4.992-15.12 11.68c-24.85-12.15-54.24-16.38-86.06-5.106c-38.75 13.73-68.12 48.91-73.72 89.64c-9.483 69.01 43.81 128 110.9 128c26.44 0 50.43-9.544 69.59-24.88c24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3C495.1 107.1 361.2-9.332 207.8 20.73zM239.1 304.3c-26.47 0-48-21.56-48-48.05s21.53-48.05 48-48.05s48 21.56 48 48.05S266.5 304.3 239.1 304.3z"/></svg>

  </span>

</a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://quadratic.fm"
          target="_blank"
          aria-label="Substack"
          rel="me noopener noreferrer"
          >

</a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://dev.to/fteem"
          target="_blank"
          aria-label="Dev"
          rel="me noopener noreferrer"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M120.12 208.29c-3.88-2.9-7.77-4.35-11.65-4.35H91.03v104.47h17.45c3.88 0 7.77-1.45 11.65-4.35 3.88-2.9 5.82-7.25 5.82-13.06v-69.65c-.01-5.8-1.96-10.16-5.83-13.06zM404.1 32H43.9C19.7 32 .06 51.59 0 75.8v360.4C.06 460.41 19.7 480 43.9 480h360.2c24.21 0 43.84-19.59 43.9-43.8V75.8c-.06-24.21-19.7-43.8-43.9-43.8zM154.2 291.19c0 18.81-11.61 47.31-48.36 47.25h-46.4V172.98h47.38c35.44 0 47.36 28.46 47.37 47.28l.01 70.93zm100.68-88.66H201.6v38.42h32.57v29.57H201.6v38.41h53.29v29.57h-62.18c-11.16.29-20.44-8.53-20.72-19.69V193.7c-.27-11.15 8.56-20.41 19.71-20.69h63.19l-.01 29.52zm103.64 115.29c-13.2 30.75-36.85 24.63-47.44 0l-38.53-144.8h32.57l29.71 113.72 29.57-113.72h32.58l-38.46 144.8z"/></svg>

  </span>

</a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://github.com/fteem"
          target="_blank"
          aria-label="Github"
          rel="me noopener noreferrer"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>

  </span>

</a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://t.me/ieftimovcom"
          target="_blank"
          aria-label="Telegram"
          rel="me noopener noreferrer"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M248,8C111.033,8,0,119.033,0,256S111.033,504,248,504,496,392.967,496,256,384.967,8,248,8ZM362.952,176.66c-3.732,39.215-19.881,134.378-28.1,178.3-3.476,18.584-10.322,24.816-16.948,25.425-14.4,1.326-25.338-9.517-39.287-18.661-21.827-14.308-34.158-23.215-55.346-37.177-24.485-16.135-8.612-25,5.342-39.5,3.652-3.793,67.107-61.51,68.335-66.746.153-.655.3-3.1-1.154-4.384s-3.59-.849-5.135-.5q-3.283.746-104.608,69.142-14.845,10.194-26.894,9.934c-8.855-.191-25.888-5.006-38.551-9.123-15.531-5.048-27.875-7.717-26.8-16.291q.84-6.7,18.45-13.7,108.446-47.248,144.628-62.3c68.872-28.647,83.183-33.623,92.511-33.789,2.052-.034,6.639.474,9.61,2.885a10.452,10.452,0,0,1,3.53,6.716A43.765,43.765,0,0,1,362.952,176.66Z"/></svg>

  </span>

</a
        >
      
    
  </div>

</div>
    </div>
  </div>


      
  
  <section class="flex flex-row flex-wrap justify-center pt-4 text-xl">
    
      
        <a
          class="bg-neutral-300 text-neutral-700 dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800 m-1 hover:bg-primary-500 hover:text-neutral rounded min-w-[2.4rem] inline-block text-center p-1"
          href="https://www.facebook.com/sharer/sharer.php?u=https://ieftimov.com/posts/create-manage-macos-launchd-agents-golang/&amp;quote=Create%20and%20manage%20MacOS%20LaunchAgents%20using%20Go"
          title="Share on Facebook"
          aria-label="Share on Facebook"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg>

  </span>

</a
        >
      
    
      
        <a
          class="bg-neutral-300 text-neutral-700 dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800 m-1 hover:bg-primary-500 hover:text-neutral rounded min-w-[2.4rem] inline-block text-center p-1"
          href="https://twitter.com/intent/tweet/?url=https://ieftimov.com/posts/create-manage-macos-launchd-agents-golang/&amp;text=Create%20and%20manage%20MacOS%20LaunchAgents%20using%20Go"
          title="Tweet on Twitter"
          aria-label="Tweet on Twitter"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>

  </span>

</a
        >
      
    
      
        <a
          class="bg-neutral-300 text-neutral-700 dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800 m-1 hover:bg-primary-500 hover:text-neutral rounded min-w-[2.4rem] inline-block text-center p-1"
          href="https://reddit.com/submit/?url=https://ieftimov.com/posts/create-manage-macos-launchd-agents-golang/&amp;resubmit=true&amp;title=Create%20and%20manage%20MacOS%20LaunchAgents%20using%20Go"
          title="Submit to Reddit"
          aria-label="Submit to Reddit"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M201.5 305.5c-13.8 0-24.9-11.1-24.9-24.6 0-13.8 11.1-24.9 24.9-24.9 13.6 0 24.6 11.1 24.6 24.9 0 13.6-11.1 24.6-24.6 24.6zM504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-132.3-41.2c-9.4 0-17.7 3.9-23.8 10-22.4-15.5-52.6-25.5-86.1-26.6l17.4-78.3 55.4 12.5c0 13.6 11.1 24.6 24.6 24.6 13.8 0 24.9-11.3 24.9-24.9s-11.1-24.9-24.9-24.9c-9.7 0-18 5.8-22.1 13.8l-61.2-13.6c-3-.8-6.1 1.4-6.9 4.4l-19.1 86.4c-33.2 1.4-63.1 11.3-85.5 26.8-6.1-6.4-14.7-10.2-24.1-10.2-34.9 0-46.3 46.9-14.4 62.8-1.1 5-1.7 10.2-1.7 15.5 0 52.6 59.2 95.2 132 95.2 73.1 0 132.3-42.6 132.3-95.2 0-5.3-.6-10.8-1.9-15.8 31.3-16 19.8-62.5-14.9-62.5zM302.8 331c-18.2 18.2-76.1 17.9-93.6 0-2.2-2.2-6.1-2.2-8.3 0-2.5 2.5-2.5 6.4 0 8.6 22.8 22.8 87.3 22.8 110.2 0 2.5-2.2 2.5-6.1 0-8.6-2.2-2.2-6.1-2.2-8.3 0zm7.7-75c-13.6 0-24.6 11.1-24.6 24.9 0 13.6 11.1 24.6 24.6 24.6 13.8 0 24.9-11.1 24.9-24.6 0-13.8-11-24.9-24.9-24.9z"/></svg>

  </span>

</a
        >
      
    
      
        <a
          class="bg-neutral-300 text-neutral-700 dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800 m-1 hover:bg-primary-500 hover:text-neutral rounded min-w-[2.4rem] inline-block text-center p-1"
          href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://ieftimov.com/posts/create-manage-macos-launchd-agents-golang/&amp;title=Create%20and%20manage%20MacOS%20LaunchAgents%20using%20Go"
          title="Share on LinkedIn"
          aria-label="Share on LinkedIn"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>

  </span>

</a
        >
      
    
      
        <a
          class="bg-neutral-300 text-neutral-700 dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800 m-1 hover:bg-primary-500 hover:text-neutral rounded min-w-[2.4rem] inline-block text-center p-1"
          href="mailto:?body=https://ieftimov.com/posts/create-manage-macos-launchd-agents-golang/&amp;subject=Create%20and%20manage%20MacOS%20LaunchAgents%20using%20Go"
          title="Send via email"
          aria-label="Send via email"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1c-27.64 140.9 68.65 266.2 199.1 285.1c19.01 2.888 36.17-12.26 36.17-31.49l.0001-.6631c0-15.74-11.44-28.88-26.84-31.24c-84.35-12.98-149.2-86.13-149.2-174.2c0-102.9 88.61-185.5 193.4-175.4c91.54 8.869 158.6 91.25 158.6 183.2l0 16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98 .0036c-7.299 0-13.2 4.992-15.12 11.68c-24.85-12.15-54.24-16.38-86.06-5.106c-38.75 13.73-68.12 48.91-73.72 89.64c-9.483 69.01 43.81 128 110.9 128c26.44 0 50.43-9.544 69.59-24.88c24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3C495.1 107.1 361.2-9.332 207.8 20.73zM239.1 304.3c-26.47 0-48-21.56-48-48.05s21.53-48.05 48-48.05s48 21.56 48 48.05S266.5 304.3 239.1 304.3z"/></svg>

  </span>

</a
        >
      
    
  </section>


      
  
    
    
    
    <div class="pt-8">
      <hr class="border-dotted border-neutral-300 dark:border-neutral-600" />
      <div class="flex justify-between pt-3">
        <span>
          
            <a class="flex group" href="/posts/golang-package-multiple-binaries/">
              <span
                class="mr-3 ltr:inline rtl:hidden text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400"
                >&larr;</span
              >
              <span
                class="ml-3 ltr:hidden rtl:inline text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >Packing multiple binaries in a Golang package</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2018-01-23 00:00:00 &#43;0000 UTC">23 January 2018</time>
                  
                </span>
              </span>
            </a>
          
        </span>
        <span>
          
            <a class="flex text-right group" href="/posts/golang-datastructures-linked-lists/">
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >Data structures in Go: Linked lists</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2018-02-18 00:00:00 &#43;0000 UTC">18 February 2018</time>
                  
                </span>
              </span>
              <span
                class="ml-3 ltr:inline rtl:hidden text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span
                class="mr-3 ltr:hidden rtl:inline text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400"
                >&larr;</span
              >
            </a>
          
        </span>
      </div>
    </div>
  


      
    </footer>
  </article>

        
          <div
            class="absolute top-[100vh] ltr:right-0 rtl:left-0 w-12 pointer-events-none bottom-0"
          >
            <a
              href="#the-top"
              class="w-12 h-12 sticky pointer-events-auto top-[calc(100vh-5.5rem)] bg-neutral/50 dark:bg-neutral-800/50 backdrop-blur rounded-full text-xl flex items-center justify-center text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400"
              aria-label="Scroll to top"
              title="Scroll to top"
            >
              &uarr;
            </a>
          </div>
        
      </main><footer class="py-10 print:hidden">
  
  
    <nav class="pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400">
      <ul class="flex flex-col list-none sm:flex-row">
        
          <li
            class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"
          >
            <a
              class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
              href="/analytics"
              title=""
              >Analytics</a
            >
          </li>
        
          <li
            class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"
          >
            <a
              class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
              href="/index.xml"
              title=""
              >RSS</a
            >
          </li>
        
          <li
            class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"
          >
            <a
              class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
              href="https://forms.gle/orfXK5jh1LRaiFzo8"
              title=""
              >Suggest a topic</a
            >
          </li>
        
      </ul>
    </nav>
  
  <div class="flex items-center justify-between">
    <div>
      
      
        <p class="text-sm text-neutral-500 dark:text-neutral-400">
            &copy;
            2022
            Ilija Eftimov
        </p>
      
      
      
        <p class="text-xs text-neutral-500 dark:text-neutral-400">
          
          
          Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
            href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a> &amp; <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href="https://git.io/hugo-congo" target="_blank" rel="noopener noreferrer">Congo</a>
        </p>
      
    </div>
    
    
      <div
        class="text-sm cursor-pointer text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400 ltr:mr-14 rtl:ml-14"
      >
        <button
          id="appearance-switcher"
          class="w-12 h-12 "
          type="button"
          title="Switch to dark appearance"
        >
          <span class="inline dark:hidden">

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>

</span>
          <span class="hidden dark:inline">

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>

</span>
        </button>
      </div>
    
  </div>
  
  
</footer>
<div
  id="search-wrapper"
  class="fixed inset-0 z-50 flex flex-col p-4 sm:p-6 md:p-[10vh] lg:p-[12vh] w-screen h-screen cursor-default bg-neutral-500/50 backdrop-blur-sm dark:bg-neutral-900/50 invisible"
  data-url="https://ieftimov.com/"
>
  <div
    id="search-modal"
    class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg border-neutral-200 top-20 bg-neutral dark:bg-neutral-800 dark:border-neutral-700"
  >
    <header class="relative z-10 flex items-center justify-between flex-none px-2">
      <form class="flex items-center flex-auto min-w-0">
        <div class="flex items-center justify-center w-8 h-8 text-neutral-400">
          

  <span class="relative inline-block align-text-bottom icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


        </div>
        <input
          type="search"
          id="search-query"
          class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-transparent focus:outline-2"
          placeholder="Search"
          tabindex="0"
        />
      </form>
      <button
        id="close-search-button"
        class="flex items-center justify-center w-8 h-8 text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400"
        title="Close (Esc)"
      >
        

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>

  </span>


      </button>
    </header>
    <section class="flex-auto px-2 overflow-auto">
      <ul id="search-results">
        
      </ul>
    </section>
  </div>
</div>

    </div>
  </body>
</html>
