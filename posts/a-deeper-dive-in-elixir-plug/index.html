<!DOCTYPE html>
<html
  lang="en"
  dir="ltr"
  class="scroll-smooth"
  data-default-appearance="light"
  data-auto-appearance="true"
><head>
  <meta charset="utf-8" />
  
    <meta http-equiv="content-language" content="en" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  
  <title>A deeper dive in Elixir&#39;s Plug &middot; Ilija Eftimov üë®‚ÄçüöÄ</title>
    <meta name="title" content="A deeper dive in Elixir&#39;s Plug &middot; Ilija Eftimov üë®‚ÄçüöÄ" />
  
  <meta name="description" content="Documenting my experiences and learnings, with the goal of helping other software engineers on their journey" />
  
  
  
  <link rel="canonical" href="https://ieftimov.com/posts/a-deeper-dive-in-elixir-plug/" />
  
  
  
  
  
  
  
  
  
    
  
  
  <link
    type="text/css"
    rel="stylesheet"
    href="/css/main.bundle.min.b4e16dd9839a706aac3e482fb2ead8a30c01f199844299a37ddc79029b6a3bae7c65ff23668804cf9b10c85a4931caa1dca1efa0395de6dc9fe0784468f41457.css"
    integrity="sha512-tOFt2YOacGqsPkgvsurYowwB8ZmEQpmjfdx5AptqO658Zf8jZogEz5sQyFpJMcqh3KHvoDld5tyf4HhEaPQUVw=="
  />
  
  
  <script type="text/javascript" src="/js/appearance.min.dbca9e2200cf929a23b55442f2ff09361b8d5290147ff1407f89ed3839f0fea13db4e94f5ae6bf2f3de10d322b4bede74b578455e9cc7d5565314d914602c974.js" integrity="sha512-28qeIgDPkpojtVRC8v8JNhuNUpAUf/FAf4ntODnw/qE9tOlPWua/Lz3hDTIrS&#43;3nS1eEVenMfVVlMU2RRgLJdA=="></script>
  
    
    
    
  
  
    
    
  
  
    
    <script defer type="text/javascript" id="script-bundle" src="/js/main.bundle.min.238e7ce9c541b4e7abb5781ad8e736e849e74890fcb8a26e73ea1845f573b3a0cf91418b20ac4401bdbb57d9c6c009d8f6ec50dad6d44b48f3936aea0f95c391.js" integrity="sha512-I4586cVBtOertXga2Oc26EnnSJD8uKJuc&#43;oYRfVzs6DPkUGLIKxEAb27V9nGwAnY9uxQ2tbUS0jzk2rqD5XDkQ==" data-copy="Copy" data-copied="Copied"></script>
  
  
  
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />
  
  
  
  
  
  
  
  <meta property="og:title" content="A deeper dive in Elixir&#39;s Plug" />
<meta property="og:description" content="Being new to Elixir and Phoenix, I spend quite some time in the projects&#39; documentation." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ieftimov.com/posts/a-deeper-dive-in-elixir-plug/" /><meta property="og:image" content="https://ieftimov.com/cards/a-deeper-dive-in-elixir-plug.png" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-12-31T00:00:00+00:00" />
<meta property="article:modified_time" content="2018-12-31T00:00:00+00:00" /><meta property="og:site_name" content="Ilija Eftimov üë®‚ÄçüöÄ" />


  <meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://ieftimov.com/cards/a-deeper-dive-in-elixir-plug.png"/>

<meta name="twitter:title" content="A deeper dive in Elixir&#39;s Plug"/>
<meta name="twitter:description" content="Being new to Elixir and Phoenix, I spend quite some time in the projects&#39; documentation."/>

  
  <script type="application/ld+json">
  [{
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "Posts",
    "name": "A deeper dive in Elixir\u0027s Plug",
    "headline": "A deeper dive in Elixir\u0027s Plug",
    
    "abstract": "Being new to Elixir and Phoenix, I spend quite some time in the projects\u0027 documentation.",
    "inLanguage": "en",
    "url" : "https:\/\/ieftimov.com\/posts\/a-deeper-dive-in-elixir-plug\/",
    "author" : {
      "@type": "Person",
      "name": "Ilija Eftimov"
    },
    "copyrightYear": "2018",
    "dateCreated": "2018-12-31T00:00:00\u002b00:00",
    "datePublished": "2018-12-31T00:00:00\u002b00:00",
    
    "dateModified": "2018-12-31T00:00:00\u002b00:00",
    
    "keywords": ["cowboy","router","endpoint"],
    
    "mainEntityOfPage": "true",
    "wordCount": "3265"
  }]
  </script>


  
  
    <meta name="generator" content="Hugo 0.92.2" />
  
  
  <meta name="author" content="Ilija Eftimov" />
  
    
      <link href="https://twitter.com/itsilija" rel="me" />
    
      <link href="https://www.linkedin.com/in/ieftimov/" rel="me" />
    
      <link href="mailto:blog@ieftimov.com" rel="me" />
    
      <link href="https://dev.to/fteem" rel="me" />
    
      <link href="https://github.com/fteem" rel="me" />
    
      <link href="https://t.me/ieftimovcom" rel="me" />
    
  
  
  






  
  <script async defer data-domain="ieftimov.com" src="https://plausible.io/js/plausible.js"></script>

  
  
</head>
<body
    class="flex flex-col h-screen px-6 m-auto text-lg leading-7 bg-neutral text-neutral-900 sm:px-14 md:px-24 lg:px-32 dark:bg-neutral-800 dark:text-neutral max-w-7xl"
  >
    <div id="the-top" class="absolute flex self-center">
      <a
        class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 dark:bg-neutral-600 focus:translate-y-0"
        href="#main-content"
        ><span class="font-bold ltr:pr-2 rtl:pl-2 text-primary-600 dark:text-primary-400"
          >&darr;</span
        >Skip to main content</a
      >
    </div><header
  class="flex justify-between py-6 font-semibold sm:items-center sm:py-10 text-neutral-900 dark:text-neutral"
>
  
  <div>
    
      <a
        class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
        rel="me"
        href="/"
        >Ilija Eftimov üë®‚ÄçüöÄ</a
      >
    

  </div>
  
  
    <nav>
      <ul class="flex flex-col list-none sm:flex-row">
        
          <li
            class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"
          >
            <a
              class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
              href="/"
              title=""
              >Home</a
            >
          </li>
        
          <li
            class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"
          >
            <a
              class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
              href="/posts/"
              title="Posts"
              >Writing</a
            >
          </li>
        
          <li
            class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"
          >
            <a
              class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
              href="/work"
              title=""
              >Work</a
            >
          </li>
        
          <li
            class="mb-1 ltr:text-right rtl:text-left sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"
          >
            <a
              class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
              href="https://www.getrevue.co/profile/itsilija"
              title=""
              >Subscribe</a
            >
          </li>
        
        
          <li
            class="ltr:text-right rtl:text-left ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0"
          >
            <button
              id="search-button"
              class="text-base hover:text-primary-600 dark:hover:text-primary-400"
              title="Search (/)"
            >
              

  <span class="relative inline-block align-text-bottom icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
  </span>


            </button>
          </li>
        
      </ul>
    </nav>
  
</header>
<main id="main-content" class="relative grow">
  <article>
    <header class="max-w-prose">
      
      <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
        A deeper dive in Elixir's Plug
      </h1>
      <div class="mt-8 mb-12 text-base text-neutral-500 dark:text-neutral-400">
        





  
  



  

  
  
    
  

  

  

  
    
  

  


  <div class="flex flex-row flex-wrap items-center">
    
    
      <time datetime="2018-12-31 00:00:00 &#43;0000 UTC">31 December 2018</time><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">16 mins</span>
    

    
    
  </div>

  
  


      </div>
    </header>
    <section class="flex flex-col max-w-full mt-0 prose lg:flex-row dark:prose-invert">
      
        <div class="order-first px-0 lg:max-w-xs ltr:lg:pl-8 rtl:lg:pr-8 lg:order-last">
          <div class="ltr:pl-5 rtl:pr-5 toc lg:sticky lg:top-10">
            <details open class="mt-0 overflow-hidden rounded-lg rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 lg:mt-3">
  <summary
    class="block py-1 text-lg font-semibold cursor-pointer rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 text-neutral-800 dark:text-neutral-100 lg:hidden bg-neutral-100 dark:bg-neutral-700"
  >
    Table of Contents
  </summary>
  <div
    class="py-2 border-dotted ltr:border-l rtl:border-r rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 border-neutral-300 dark:border-neutral-600"
  >
    <nav id="TableOfContents">
  <ul>
    <li><a href="#whats-plug">What&rsquo;s Plug?</a></li>
    <li><a href="#web-servers-yeehaw">Web servers, yeehaw!</a></li>
    <li><a href="#enter-plug">Enter Plug</a></li>
    <li><a href="#plugging-a-plug-as-an-endpoint">Plugging a plug as an endpoint</a></li>
    <li><a href="#diving-into-the-plugconn">Diving into the <code>Plug.Conn</code></a>
      <ul>
        <li><a href="#connection-lifecycle">Connection lifecycle</a></li>
      </ul>
    </li>
    <li><a href="#next-level-plugging-using-plugrouter">Next-level <code>Plug</code>ging using <code>Plug.Router</code></a></li>
    <li><a href="#built-in-plugs">Built-in Plugs</a>
      <ul>
        <li><a href="#plughead"><code>Plug.Head</code></a></li>
        <li><a href="#pluglogger"><code>Plug.Logger</code></a></li>
      </ul>
    </li>
    <li><a href="#wrapping-up-with-plug">Wrapping up with Plug</a></li>
  </ul>
</nav>
  </div>
</details>

          </div>
        </div>
      
      <div class="min-w-0 min-h-0 max-w-prose">
        <p>Being new to Elixir and Phoenix, I spend quite some time in the projects'
documentation. One thing that stood out for me recently is the first sentence
of <a href="https://hexdocs.pm/phoenix/plug.html#content">Phoenix&rsquo;s Plug
documentation</a>:</p>
<blockquote>
<p>Plug lives at the heart of Phoenix‚Äôs HTTP layer and Phoenix puts Plug front and center.</p>
</blockquote>
<p>So naturally, I felt compelled to take a deeper dive into Plug and understand
it better. I hope the following article will help you out in understanding
Plug.</p>
<h2 id="whats-plug" class="relative group">What&rsquo;s Plug? <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#whats-plug" aria-label="Anchor">#</a></span></h2>
<p>As <a href="https://github.com/elixir-plug/plug#plug">the readme</a> puts it, Plug is:</p>
<ol>
<li>A specification for composable modules between web applications</li>
<li>Connection adapters for different web servers in the Erlang VM</li>
</ol>
<p>But, what does this mean? Well, it basically states that Plug 1) <em>defines the
way</em> you build web apps in Elixir and 2) it provides you with tools to write
apps that are understood by web servers.</p>
<p>Let&rsquo;s take a dive and see what that means.</p>
<h2 id="web-servers-yeehaw" class="relative group">Web servers, yeehaw! <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#web-servers-yeehaw" aria-label="Anchor">#</a></span></h2>
<p>One of the most popular HTTP servers for Erlang is
<a href="https://github.com/ninenines/cowboy">Cowboy</a>. It is a small, fast and modern
HTTP server for Erlang/OTP. If you were to write any web application in Elixir
it will run on Cowboy, because the Elixir core team has built a Plug adapter
for Cowboy, conveniently named
<a href="https://github.com/elixir-plug/plug_cowboy">plug_cowboy</a>.</p>
<p>This means that if you include this package in your package, you will get the
Elixir interface to talk to the Cowboy web server (and vice-versa). It means
that you can send and receive requests and other stuff that web servers can do.</p>
<p>So why is this important?</p>
<p>Well, to understand Plug we need to understand how it works. Basically, using
the adapter (<code>plug_cowboy</code>), Plug can accept the connection request that comes
in Cowboy and turn it into a meaningful struct, also known as <code>Plug.Conn</code>.</p>
<p>This means that Plug uses <code>plug_cowboy</code> to understand Cowboy&rsquo;s nitty-gritty
details. By doing this Plug allows us to easily build handler functions and
modules that can receive, handle and respond to requests.</p>
<p>Of course, the idea behind Plug is not to work only with Cowboy. If you look at
<a href="https://stackoverflow.com/a/26323883/6015550">this SO answer</a> from Jos√© Valim
(Elixir&rsquo;s BDFL) he clearly states &ldquo;Plug is meant to be a generic adapter for
different web servers. Currently we support just Cowboy but there is work to
support others.&rdquo;</p>
<h2 id="enter-plug" class="relative group">Enter Plug <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#enter-plug" aria-label="Anchor">#</a></span></h2>
<p>Okay, now that we&rsquo;ve scratched the surface of Cowboy and it&rsquo;s Plug adapter,
let&rsquo;s look at Plug itself.</p>
<p>If you look at <a href="https://github.com/elixir-plug/plug/blob/master/README.md">Plug&rsquo;s
README</a>, you will
notice that there are two flavours of plugs, a function or a module.</p>
<p>The most minimal plug can be a function, it just takes a <code>Plug.Conn</code> struct
(that we will explore more later) and some options. The function will
manipulate the struct and return it at the end. Here&rsquo;s the example from the
<code>README</code>:</p>
<p><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elixir" data-lang="elixir"><span class="kd">def</span> <span class="n">hello_world_plug</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">_opts</span><span class="p">)</span> <span class="k">do</span>
  <span class="n">conn</span>
  <span class="o">|&gt;</span> <span class="n">put_resp_content_type</span><span class="p">(</span><span class="s2">&#34;text/plain&#34;</span><span class="p">)</span>
  <span class="o">|&gt;</span> <span class="n">send_resp</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="s2">&#34;Hello world&#34;</span><span class="p">)</span>
<span class="k">end</span></code></pre></div>
<small>Code blatantly copied from
<a href="https://github.com/elixir-plug/plug/blob/master/README.md">Plug&rsquo;s docs</a>.
</small></p>
<p>If you look at the function, it&rsquo;s quite simple. It receives the connection
struct, puts its content type to <code>text/plain</code> and returns a response with an
HTTP 200 status and <code>&quot;Hello world&quot;</code> as the body.</p>
<p>The second flavour is the module Plug. This means that instead of just having a
function that will be invoked as part of the request lifecycle, you can define
a module that takes a connection and initialized options and returns the
connection:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elixir" data-lang="elixir"><span class="kd">defmodule</span> <span class="nc">MyPlug</span> <span class="k">do</span>
  <span class="kd">def</span> <span class="n">init</span><span class="p">([]),</span> <span class="ss">do</span><span class="p">:</span> <span class="no">false</span>
  <span class="kd">def</span> <span class="n">call</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">_opts</span><span class="p">),</span> <span class="ss">do</span><span class="p">:</span> <span class="n">conn</span>
<span class="k">end</span></code></pre></div>
<p><small>Code blatantly copied from
<a href="https://github.com/elixir-plug/plug/blob/master/README.md">Plug&rsquo;s docs</a>.
</small></p>
<p>Having this in mind, let&rsquo;s take a step further and see how we can use Plug in a
tiny application.</p>
<h2 id="plugging-a-plug-as-an-endpoint" class="relative group">Plugging a plug as an endpoint <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#plugging-a-plug-as-an-endpoint" aria-label="Anchor">#</a></span></h2>
<p>So far, the most important things we covered was what&rsquo;s Plug and what is it
used for on a high level. We also took a look at two different types of plugs.</p>
<p>Now, let&rsquo;s see how we can mount a Plug on a Cowboy server and essentially use
it as an endpoint:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elixir" data-lang="elixir"><span class="kd">defmodule</span> <span class="nc">PlugTest</span> <span class="k">do</span>
  <span class="kn">import</span> <span class="nc">Plug.Conn</span>

  <span class="kd">def</span> <span class="n">init</span><span class="p">(</span><span class="n">options</span><span class="p">)</span> <span class="k">do</span>
    <span class="c1"># initialize options</span>

    <span class="n">options</span>
  <span class="k">end</span>

  <span class="kd">def</span> <span class="n">call</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">_opts</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">conn</span>
    <span class="o">|&gt;</span> <span class="n">put_resp_content_type</span><span class="p">(</span><span class="s2">&#34;text/plain&#34;</span><span class="p">)</span>
    <span class="o">|&gt;</span> <span class="n">send_resp</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="s2">&#34;Hello world&#34;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>
<p>What this module will do is, when mounted on a Cowboy server, will set the
<code>Content-Type</code> header to <code>text/plain</code> and will return an HTTP 200 with a body of
<code>Hello world</code>.</p>
<p>Let&rsquo;s fire up IEx and test this ourselves:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">‚Ä∫ iex -S mix
Erlang/OTP 21 [erts-10.2] [source] [64-bit] [smp:4:4] [ds:4:4:10] [async-threads:1] [hipe] [dtrace]

Interactive Elixir (1.7.4) - press Ctrl+C to exit (type h() ENTER for help)
iex(1)&gt; {:ok, _ } = Plug.Cowboy.http PlugTest, [], port: 3000
{:ok, #PID&lt;0.202.0&gt;}</code></pre></div>
<p>This starts the Cowboy server as a BEAM process, listening on port 3000. If we
<code>cURL</code> it we&rsquo;ll see the response body and it&rsquo;s headers:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">‚Ä∫ curl -v 127.0.0.1:3000
&gt; GET / HTTP/1.1
&gt; Host: 127.0.0.1:3000
&gt; User-Agent: curl/7.54.0
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 200 OK
&lt; cache-control: max-age=0, private, must-revalidate
&lt; content-length: 11
&lt; content-type: text/plain; charset=utf-8
&lt; date: Tue, 25 Dec 2018 22:54:54 GMT
&lt; server: Cowboy
&lt;
* Connection #0 to host 127.0.0.1 left intact
Hello world</code></pre></div>
<p>You see, the <code>Content-Type</code> of the response is set to <code>text/plain</code> and the body
is <code>Hello world</code>. In this example, the plug is essentially an endpoint by
itself, serving plain text to our <code>cURL</code> command (or to a browser). As you
might be able to imagine at this point, you can plug in much more elaborate
Plugs to a Cowboy server and it will serve them just fine.</p>
<p>To shut down the endpoint all you need to do is:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">iex(2)&gt; Plug.Cowboy.shutdown PlugTest.HTTP
:ok</code></pre></div>
<p>What we are witnessing here is probably the tiniest web application one can
write in Elixir. It&rsquo;s an app that takes a request and returns a valid response
over HTTP with a status and a body.</p>
<p>So, how does this actually work? How do we accept the request and build a
response here?</p>
<h2 id="diving-into-the-plugconn" class="relative group">Diving into the <code>Plug.Conn</code> <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#diving-into-the-plugconn" aria-label="Anchor">#</a></span></h2>
<p>To understand this, we need to zoom in the <code>call/2</code> function of our module
<code>PlugTest</code>. I will also throw in an <code>IO.inspect</code> right at the end of the
function so we can inspect what this struct is:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elixir" data-lang="elixir"><span class="kd">def</span> <span class="n">call</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">_opts</span><span class="p">)</span> <span class="k">do</span>
  <span class="n">conn</span>
  <span class="o">|&gt;</span> <span class="n">put_resp_content_type</span><span class="p">(</span><span class="s2">&#34;text/plain&#34;</span><span class="p">)</span>
  <span class="o">|&gt;</span> <span class="n">send_resp</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="s2">&#34;Hello world&#34;</span><span class="p">)</span>
  <span class="o">|&gt;</span> <span class="nc">IO</span><span class="o">.</span><span class="n">inspect</span>
<span class="k">end</span></code></pre></div>
<p>If you start the Cowboy instance again via your IEx session and you hit
<code>127.0.0.1:3000</code> via <code>cURL</code> (or a browser), you should see something like this
in your IEx session:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">%Plug.Conn{
  adapter: {Plug.Cowboy.Conn, :...},
  assigns: %{},
  before_send: [],
  body_params: %Plug.Conn.Unfetched{aspect: :body_params},
  cookies: %Plug.Conn.Unfetched{aspect: :cookies},
  halted: false,
  host: &#34;127.0.0.1&#34;,
  method: &#34;GET&#34;,
  owner: #PID&lt;0.316.0&gt;,
  params: %Plug.Conn.Unfetched{aspect: :params},
  path_info: [],
  path_params: %{},
  port: 3000,
  private: %{},
  query_params: %Plug.Conn.Unfetched{aspect: :query_params},
  query_string: &#34;&#34;,
  remote_ip: {127, 0, 0, 1},
  req_cookies: %Plug.Conn.Unfetched{aspect: :cookies},
  req_headers: [
    {&#34;accept&#34;,
     &#34;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8&#34;},
    {&#34;accept-encoding&#34;, &#34;gzip, deflate, br&#34;},
    {&#34;accept-language&#34;, &#34;en-US,en;q=0.9&#34;},
    {&#34;connection&#34;, &#34;keep-alive&#34;},
    {&#34;host&#34;, &#34;127.0.0.1:3000&#34;},
    {&#34;upgrade-insecure-requests&#34;, &#34;1&#34;},
    {&#34;user-agent&#34;,
     &#34;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/71.0.3578.98 Safari/537.36&#34;}
  ],
  request_path: &#34;/&#34;,
  resp_body: nil,
  resp_cookies: %{},
  resp_headers: [
    {&#34;cache-control&#34;, &#34;max-age=0, private, must-revalidate&#34;},
    {&#34;content-type&#34;, &#34;text/plain; charset=utf-8&#34;}
  ],
  scheme: :http,
  script_name: [],
  secret_key_base: nil,
  state: :sent,
  status: 200
}</code></pre></div>
<p>What are we actually looking at? Well, it&rsquo;s actually the Plug representation
of a connection. This is a direct interface to the underlying web server and
the request that the Cowboy server has received.</p>
<p>Some of the attributes of the struct are pretty self-explanatory, like <code>scheme</code>,
<code>method</code>, <code>host</code>, <code>request_path</code>, etc. If you would like to go into detail what
each of these fields is, I suggest taking a look at <code>Plug.Conn</code>&rsquo;s
<a href="https://hexdocs.pm/plug/Plug.Conn.html#module-request-fields">documentation</a>.</p>
<p>But, to understand better the <code>Plug.Conn</code> struct, we need to understand the
connection lifecycle of each connection struct.</p>
<h3 id="connection-lifecycle" class="relative group">Connection lifecycle <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#connection-lifecycle" aria-label="Anchor">#</a></span></h3>
<p>Just like any map in Elixir <code>Plug.Conn</code> allows us to pattern match on it. Let&rsquo;s
modify the little endpoint we created before and try to add some extra
<code>IO.inspect</code> function calls:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elixir" data-lang="elixir"><span class="kd">defmodule</span> <span class="nc">PlugTest</span> <span class="k">do</span>
  <span class="kn">import</span> <span class="nc">Plug.Conn</span>

  <span class="kd">def</span> <span class="n">init</span><span class="p">(</span><span class="n">options</span><span class="p">)</span> <span class="k">do</span>
    <span class="c1"># initialize options</span>

    <span class="n">options</span>
  <span class="k">end</span>

  <span class="kd">def</span> <span class="n">call</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">_opts</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">conn</span>
    <span class="o">|&gt;</span> <span class="n">inspect_state</span>
    <span class="o">|&gt;</span> <span class="n">put_resp_content_type</span><span class="p">(</span><span class="s2">&#34;text/plain&#34;</span><span class="p">)</span>
    <span class="o">|&gt;</span> <span class="n">inspect_state</span>
    <span class="o">|&gt;</span> <span class="n">put_private</span><span class="p">(</span><span class="ss">:foo</span><span class="p">,</span> <span class="ss">:bar</span><span class="p">)</span>
    <span class="o">|&gt;</span> <span class="n">inspect_state</span>
    <span class="o">|&gt;</span> <span class="n">resp</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="s2">&#34;Hello world&#34;</span><span class="p">)</span>
    <span class="o">|&gt;</span> <span class="n">inspect_state</span>
    <span class="o">|&gt;</span> <span class="n">send_resp</span><span class="p">()</span>
    <span class="o">|&gt;</span> <span class="n">inspect_state</span>
  <span class="k">end</span>

  <span class="kd">defp</span> <span class="n">inspect_state</span><span class="p">(</span><span class="n">conn</span> <span class="o">=</span> <span class="p">%{</span><span class="ss">state</span><span class="p">:</span> <span class="n">state</span><span class="p">})</span> <span class="k">do</span>
    <span class="nc">IO</span><span class="o">.</span><span class="n">inspect</span> <span class="n">state</span>
    <span class="n">conn</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>
<p>Because <code>Plug.Conn</code> allows pattern matching, we can get the <code>state</code> of the
connection, print it out and return the connection itself so the pipeline in
the <code>call/2</code> function would continue working as expected.</p>
<p>Let&rsquo;s mount this plug on a Cowboy instance and hit it with a simple <code>cURL</code>
request:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">iex<span class="o">(</span>6<span class="o">)</span>&gt; Plug.Cowboy.http PlugTest, <span class="o">[]</span>, port: <span class="m">3000</span>
<span class="o">{</span>:ok, <span class="c1">#PID&lt;0.453.0&gt;}</span>

<span class="c1"># curl 127.0.0.1:3000</span>

iex<span class="o">(</span>21<span class="o">)</span>&gt; :unset
:unset
:unset
:set
:sent</code></pre></div>
<p>You see, when the connection enters the plug it&rsquo;s state changes from <code>:unset</code> to
<code>:set</code> to finally <code>:sent</code>. This means that once the plug is invoked the state of
the connection is <code>:unset</code>. Then we do multiple actions, or in other words, we
invoke multiple functions on the <code>Plug.Conn</code> which add more information to the
connection. Obviously, since all variables in Elixir are immutable, each of
these function returns a new <code>Plug.Conn</code> instance, instead of mutating the
existing one.</p>
<p>Once the body and the status of the connection are set, then the state changes
to <code>:set</code>. Up until that moment, the state is fixed as <code>:unset</code>. Once we send
the response back to the client the state is changed to <code>:sent</code>.</p>
<p>What we need to understand here is that whether we have one or more plugs in a
pipeline, they will all receive a <code>Plug.Conn</code>, call functions on it, whether
to extract or add data to it and then the connection will be passed on to the
next plug. Eventually, in the pipeline, there will be a plug (in the form of an
endpoint or a Phoenix controller) that will set the body and the response status
and send the response back to the client.</p>
<p>There are a bit more details to this, but this is just enough to wrap our minds
around <code>Plug</code> and <code>Plug.Conn</code> in general.</p>
<h2 id="next-level-plugging-using-plugrouter" class="relative group">Next-level <code>Plug</code>ging using <code>Plug.Router</code> <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#next-level-plugging-using-plugrouter" aria-label="Anchor">#</a></span></h2>
<p>Now that we understand how <code>Plug.Conn</code> works and how plugs can change the
connection by invoking functions defined in the <code>Plug.Conn</code> module, let&rsquo;s look
at a more advanced feature of plugs - turning a plug into a router.</p>
<p>In our first example, we saw the simplest of the Elixir web apps - a simple
plug that takes the request and returns a simple response with a text body and
an HTTP 200. But, what if we want to handle different routes or HTTP methods?
What if we want to gracefully handle any request to an unknown route with an
HTTP 404?</p>
<p>One nicety that <code>Plug</code> comes with is a module called <code>Plug.Router</code>, you can see
its documentation <a href="https://hexdocs.pm/plug/Plug.Router.html#content">here</a>.
The router module contains a DSL that allows us to define a routing algorithm
for incoming requests and writing handlers (powered by Plug) for the routes.
If you are coming from Ruby land, while <code>Plug</code> is basically Rack, this DSL is
Sinatra.rb.</p>
<p>Let&rsquo;s create a tiny router using <code>Plug.Router</code>, add some plugs to its pipeline
and some endpoints.</p>
<p><strong>Quick aside: What is a pipeline?</strong></p>
<p>Although it has the same name as the pipeline operator (<code>|&gt;</code>), a pipeline in
Plug&rsquo;s context is a list of plugs executed one after another. That&rsquo;s really it.
The last plug in that pipeline is usually an endpoint that will set the body and
the status of the response and return the response to the client.</p>
<p>Now, back to our router:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elixir" data-lang="elixir"><span class="kd">defmodule</span> <span class="nc">MyRouter</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="nc">Plug.Router</span>

  <span class="n">plug</span> <span class="ss">:match</span>
  <span class="n">plug</span> <span class="ss">:dispatch</span>

  <span class="n">get</span> <span class="s2">&#34;/hello&#34;</span> <span class="k">do</span>
    <span class="n">send_resp</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="s2">&#34;world&#34;</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">match</span> <span class="n">_</span> <span class="k">do</span>
    <span class="n">send_resp</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="mi">404</span><span class="p">,</span> <span class="s2">&#34;oops&#34;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>
<p><small>Code blatantly copied from
<a href="https://hexdocs.pm/plug/Plug.Router.html"><code>Plug.Router</code>&rsquo;s docs</a>.
</small></p>
<p>The first thing that you will notice here is that all routers are modules as
well. By <code>use</code>ing the <code>Plug.Router</code> module, we include some functions that make
our lives easier, like <code>get</code> or <code>match</code>.</p>
<p>If you notice at the top of the module we have two lines:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elixir" data-lang="elixir"><span class="n">plug</span> <span class="ss">:match</span>
<span class="n">plug</span> <span class="ss">:dispatch</span></code></pre></div>
<p>This is the router&rsquo;s <em>pipeline</em>. All of the requests coming to the router will
pass through these two plugs: <code>match</code> and <code>dispatch</code>. The first one does the
matching of the route that we define (e.g. <code>/hello</code>), while the other one will
invoke the function defined for a particular route. This means that if we would
like to add other plugs, most of the time they will be invoked between the two
mandatory ones (<code>match</code> and <code>dispatch</code>).</p>
<p>Let&rsquo;s mount our router on a Cowboy server and see it&rsquo;s behaviour:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">iex<span class="o">(</span>29<span class="o">)</span>&gt; Plug.Cowboy.http MyRouter, <span class="o">[]</span>, port: <span class="m">3000</span>
<span class="o">{</span>:ok, <span class="c1">#PID&lt;0.1500.0&gt;}</span></code></pre></div>
<p>When we hit <code>127.0.0.1:3000/hello</code>, we will get the following:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">‚Ä∫ curl -v 127.0.0.1:3000/hello
*   Trying 127.0.0.1...
* TCP_NODELAY <span class="nb">set</span>
* Connected to 127.0.0.1 <span class="o">(</span>127.0.0.1<span class="o">)</span> port <span class="m">3000</span> <span class="o">(</span><span class="c1">#0)</span>
&gt; GET /hello HTTP/1.1
&gt; Host: 127.0.0.1:3000
&gt; User-Agent: curl/7.54.0
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 <span class="m">200</span> OK
&lt; cache-control: max-age<span class="o">=</span>0, private, must-revalidate
&lt; content-length: <span class="m">5</span>
&lt; date: Thu, <span class="m">27</span> Dec <span class="m">2018</span> 22:50:47 GMT
&lt; server: Cowboy
&lt;
* Connection <span class="c1">#0 to host 127.0.0.1 left intact</span>
world</code></pre></div>
<p>As you can see, we received <code>world</code> as the response body and an HTTP 200. But if
we hit any other URL, the router will match the other route:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">‚Ä∫ curl -v 127.0.0.1:3000/foo
*   Trying 127.0.0.1...
* TCP_NODELAY <span class="nb">set</span>
* Connected to 127.0.0.1 <span class="o">(</span>127.0.0.1<span class="o">)</span> port <span class="m">3000</span> <span class="o">(</span><span class="c1">#0)</span>
&gt; GET /foo HTTP/1.1
&gt; Host: 127.0.0.1:3000
&gt; User-Agent: curl/7.54.0
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 <span class="m">404</span> Not Found
&lt; cache-control: max-age<span class="o">=</span>0, private, must-revalidate
&lt; content-length: <span class="m">4</span>
&lt; date: Thu, <span class="m">27</span> Dec <span class="m">2018</span> 22:51:56 GMT
&lt; server: Cowboy
&lt;
* Connection <span class="c1">#0 to host 127.0.0.1 left intact</span>
oops</code></pre></div>
<p>As you can see, because the <code>/hello</code> route didn&rsquo;t match we defaulted to the
other route, also known as &ldquo;catch all&rdquo; route, which returned <code>oops</code> as the
response body and an HTTP 404 status.</p>
<p>If you would like to learn more about <code>Plug.Router</code> and its route matching
macros you can read more in
<a href="https://hexdocs.pm/plug/Plug.Router.html#module-routes">its documentation</a>. We
still need to cover some more distance with Plug.</p>
<h2 id="built-in-plugs" class="relative group">Built-in Plugs <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#built-in-plugs" aria-label="Anchor">#</a></span></h2>
<p>In the previous section, we mentioned the plugs <code>match</code> and <code>dispatch</code>, and plug
pipelines. We also mentioned that we can plug in other plugs in the pipeline
so we can inspect or change the <code>Plug.Conn</code> of each request.</p>
<p>What is very exciting here is that <code>Plug</code> also comes with already built-in plugs.
That means that there&rsquo;s a list of plugs that you can plug-in in any Plug-based
application:</p>
<ul>
<li><code>Plug.CSRFProtection</code></li>
<li><code>Plug.Head</code></li>
<li><code>Plug.Logger</code></li>
<li><code>Plug.MethodOverride</code></li>
<li><code>Plug.Parsers</code></li>
<li><code>Plug.RequestId</code></li>
<li><code>Plug.SSL</code></li>
<li><code>Plug.Session</code></li>
<li><code>Plug.Static</code></li>
</ul>
<p>Let&rsquo;s try to understand how a couple of them work and how we can plug them in
our <code>MyRouter</code> router module.</p>
<h3 id="plughead" class="relative group"><code>Plug.Head</code> <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#plughead" aria-label="Anchor">#</a></span></h3>
<p>This is a rather simple plug. It&rsquo;s so simple, I will add
<a href="https://github.com/elixir-plug/plug/blob/v1.7.1/lib/plug/head.ex#L1">all of its code</a>
here:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elixir" data-lang="elixir"><span class="kd">defmodule</span> <span class="nc">Plug.Head</span> <span class="k">do</span>
  <span class="na">@behaviour</span> <span class="nc">Plug</span>

  <span class="kn">alias</span> <span class="nc">Plug.Conn</span>

  <span class="kd">def</span> <span class="n">init</span><span class="p">([]),</span> <span class="ss">do</span><span class="p">:</span> <span class="p">[]</span>

  <span class="kd">def</span> <span class="n">call</span><span class="p">(%</span><span class="nc">Conn</span><span class="p">{</span><span class="ss">method</span><span class="p">:</span> <span class="s2">&#34;HEAD&#34;</span><span class="p">}</span> <span class="o">=</span> <span class="n">conn</span><span class="p">,</span> <span class="p">[]),</span> <span class="ss">do</span><span class="p">:</span> <span class="p">%{</span><span class="n">conn</span> <span class="o">|</span> <span class="ss">method</span><span class="p">:</span> <span class="s2">&#34;GET&#34;</span><span class="p">}</span>
  <span class="kd">def</span> <span class="n">call</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="p">[]),</span> <span class="ss">do</span><span class="p">:</span> <span class="n">conn</span>
<span class="k">end</span></code></pre></div>
<p>What this plug does is it turns any HTTP <code>HEAD</code> request into a <code>GET</code> request.
That&rsquo;s all. Its <code>call</code> function receives a <code>Plug.Conn</code>, matches only the ones
that have a <code>method: &quot;HEAD&quot;</code> and returns a new <code>Plug.Conn</code> with the <code>method</code>
changed to <code>&quot;GET&quot;</code>.</p>
<p>If you&rsquo;ve been wondering what the <code>HEAD</code> method is for, this is from
<a href="https://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html">RFC 2616</a>:</p>
<blockquote>
<p>The HEAD method is identical to GET except that the server MUST NOT return a
message-body in the response. The metainformation contained in the HTTP headers
in response to a HEAD request SHOULD be identical to the information sent in
response to a GET request. This method can be used for obtaining
metainformation about the entity implied by the request without transferring
the entity-body itself. This method is often used for testing hypertext links
for validity, accessibility, and recent modification.</p>
</blockquote>
<p>Let&rsquo;s plug this plug in our <code>Plug.Router</code> (pun totally intended):</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elixir" data-lang="elixir"><span class="kd">defmodule</span> <span class="nc">MyRouter</span> <span class="k">do</span>
  <span class="kn">use</span> <span class="nc">Plug.Router</span>

  <span class="n">plug</span> <span class="nc">Plug.Head</span>
  <span class="n">plug</span> <span class="ss">:match</span>
  <span class="n">plug</span> <span class="ss">:dispatch</span>

  <span class="n">get</span> <span class="s2">&#34;/hello&#34;</span> <span class="k">do</span>
    <span class="n">send_resp</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="s2">&#34;world&#34;</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="n">match</span> <span class="n">_</span> <span class="k">do</span>
    <span class="n">send_resp</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="mi">404</span><span class="p">,</span> <span class="s2">&#34;oops&#34;</span><span class="p">)</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></div>
<p>Once we <code>cURL</code> the routes we would get the following behaviour:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash">‚Ä∫ curl -I 127.0.0.1:3000/hello
HTTP/1.1 <span class="m">200</span> OK
cache-control: max-age<span class="o">=</span>0, private, must-revalidate
content-length: <span class="m">5</span>
date: Thu, <span class="m">27</span> Dec <span class="m">2018</span> 23:25:13 GMT
server: Cowboy

‚Ä∫ curl -I 127.0.0.1:3000/foo
HTTP/1.1 <span class="m">404</span> Not Found
cache-control: max-age<span class="o">=</span>0, private, must-revalidate
content-length: <span class="m">4</span>
date: Thu, <span class="m">27</span> Dec <span class="m">2018</span> 23:25:17 GMT
server: Cowboy</code></pre></div>
<p>As you can see, although we didn&rsquo;t explicitly match the <code>HEAD</code> routes using the
<code>head</code> macro, the <code>Plug.Head</code> plug remapped the <code>HEAD</code> requests to <code>GET</code> and
our handlers still kept on working as expected (the first one returned an HTTP
200, and the second one an HTTP 404).</p>
<h3 id="pluglogger" class="relative group"><code>Plug.Logger</code> <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#pluglogger" aria-label="Anchor">#</a></span></h3>
<p>This one is a bit more complicated so we cannot inline
<a href="https://github.com/elixir-plug/plug/blob/v1.7.1/lib/plug/logger.ex#L1">all of its code</a>
in this article. Basically, if we would plug this plug in our router, it will
log all of the incoming requests and response statuses, like so:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">  GET /index.html
  Sent 200 in 572ms</code></pre></div>
<p>This plug uses Elixir&rsquo;s <code>Logger</code> (<a href="https://hexdocs.pm/logger/Logger.html">docs</a>)
under the hood, which supports four different logging levels:</p>
<ul>
<li><code>:debug</code> - for debug-related messages</li>
<li><code>:info</code> - for information of any kind (default level)</li>
<li><code>:warn</code> - for warnings</li>
<li><code>:error</code> - for errors</li>
</ul>
<p>If we would look at the source of its <code>call/2</code> function, we would notice two
logical units. The first one is:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elixir" data-lang="elixir"><span class="kd">def</span> <span class="n">call</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span> <span class="k">do</span>
  <span class="nc">Logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="k">fn</span> <span class="o">-&gt;</span>
    <span class="p">[</span><span class="n">conn</span><span class="o">.</span><span class="n">method</span><span class="p">,</span> <span class="sc">?</span><span class="se">\s</span><span class="p">,</span> <span class="n">conn</span><span class="o">.</span><span class="n">request_path</span><span class="p">]</span>
  <span class="k">end</span><span class="p">)</span>

  <span class="c1"># Snipped...</span>
<span class="k">end</span></code></pre></div>
<p>This one will take Elixir&rsquo;s <code>Logger</code> and using the logging <code>level</code> will log the
information to the backend (by default it&rsquo;s <code>console</code>). The information that is
logged is the method of the request (e.g. <code>GET</code>, <code>POST</code>, etc) and the request
path (e.g. <code>/foo/bar</code>). This results in the first line of the log:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text">GET /index.html</code></pre></div>
<p>The second logical unit is a bit more elaborate:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-elixir" data-lang="elixir"><span class="kd">def</span> <span class="n">call</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">level</span><span class="p">)</span> <span class="k">do</span>
  <span class="c1"># Snipped...</span>

  <span class="n">start</span> <span class="o">=</span> <span class="nc">System</span><span class="o">.</span><span class="n">monotonic_time</span><span class="p">()</span>

  <span class="nc">Conn</span><span class="o">.</span><span class="n">register_before_send</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="k">fn</span> <span class="n">conn</span> <span class="o">-&gt;</span>
    <span class="nc">Logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">level</span><span class="p">,</span> <span class="k">fn</span> <span class="o">-&gt;</span>
      <span class="n">stop</span> <span class="o">=</span> <span class="nc">System</span><span class="o">.</span><span class="n">monotonic_time</span><span class="p">()</span>
      <span class="n">diff</span> <span class="o">=</span> <span class="nc">System</span><span class="o">.</span><span class="n">convert_time_unit</span><span class="p">(</span><span class="n">stop</span> <span class="o">-</span> <span class="n">start</span><span class="p">,</span> <span class="ss">:native</span><span class="p">,</span> <span class="ss">:microsecond</span><span class="p">)</span>
      <span class="n">status</span> <span class="o">=</span> <span class="nc">Integer</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">conn</span><span class="o">.</span><span class="n">status</span><span class="p">)</span>

      <span class="p">[</span><span class="n">connection_type</span><span class="p">(</span><span class="n">conn</span><span class="p">),</span> <span class="sc">?</span><span class="se">\s</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="s2">&#34; in &#34;</span><span class="p">,</span> <span class="n">formatted_diff</span><span class="p">(</span><span class="n">diff</span><span class="p">)]</span>
    <span class="k">end</span><span class="p">)</span>

    <span class="n">conn</span>
  <span class="k">end</span><span class="p">)</span>
<span class="k">end</span></code></pre></div>
<p>In short: this section records the time between the <code>start</code> and the <code>stop</code>
(end) of the request and prints out the <code>diff</code>erence between the two (or in
other words - the amount of time the response took). Also, it prints out the
HTTP status of the response.</p>
<p>To do this it uses <code>Plug.Conn.register_before_send/2</code>
(<a href="https://hexdocs.pm/plug/Plug.Conn.html#register_before_send/2">docs</a>) which
is a utility function that registers callbacks to be invoked before the
response is sent. This means that the function which will calculate the <code>diff</code>
and log it to the <code>Logger</code> with the response status will be invoked by
<code>Plug.Conn</code> right before the response is sent to the client.</p>
<h2 id="wrapping-up-with-plug" class="relative group">Wrapping up with Plug <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#wrapping-up-with-plug" aria-label="Anchor">#</a></span></h2>
<p>You actually made it this far - I applaud you. I hope that this was a nice
journey for you in Plug and it&rsquo;s related modules/functions and that you learned
something new.</p>
<p>We looked at quite a bit of details in and around <code>Plug</code>. For some of the
modules that we spoke about we barely scratched the surface. For example,
<code>Plug.Conn</code> has quite a bit of more useful functions. Or <code>Plug.Router</code> has more
functions in its DSL where you can write more elaborate and thoughtful APIs or
web apps. In line with this, <code>Plug</code> also offers more built-in plugs. It even
has a plug which can serve static files with ease, and plugging it in your
Plug-based apps is a breeze.</p>
<p>But, aside from all the things that we skipped in this article, I hope that you
understood how powerful the Plug model is and how much power it provides us
with such simplicity and unobtrusiveness.</p>
<p>In future posts, we will look at even more details about other plugs in <code>Plug</code>,
but until then please shoot me a comment or a message if you&rsquo;ve found this
article helpful (or not).</p>
<div id="revue-embed">
  <form action="https://www.getrevue.co/profile/itsilija/add_subscriber" method="post" id="revue-form" name="revue-form"  target="_blank">
    <p><b>Liked this article?</b>
Subscribe to my newsletter and get future articles in your inbox. It's a
short and sweet read, going out to hundreds of other engineers.</p>
    <div class="revue-form-group">
      <input class="revue-form-field" placeholder="Your email address..." type="email" name="member[email]" id="member_email">
    </div>
    <div class="revue-form-actions">
      <input type="submit" value="Subscribe" name="member[subscribe]" id="member_submit">
    </div>
  </form>
</div>


      </div>
    </section>
    <footer class="pt-8 max-w-prose">
      
  <div class="flex">
    
      
      
        
        <img
          class="w-24 h-24 !mt-0 !mb-0 ltr:mr-4 rtl:ml-4 rounded-full"
          width="96"
          height="96"
          alt="Author"
          src="/img/avatar_huae39953c6189b6aa60e47103b358d088_112612_192x192_fill_q75_box_smart1.jpg"
        />
      
    
    <div class="place-self-center">
      
        <div class="text-[0.6rem] leading-3 text-neutral-500 dark:text-neutral-400 uppercase">
          Author
        </div>
        <div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">
          Ilija Eftimov
        </div>
      
      
      <div class="text-2xl sm:text-lg">
  <div class="flex flex-wrap text-neutral-400 dark:text-neutral-500">
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://twitter.com/itsilija"
          target="_blank"
          aria-label="Twitter"
          rel="me noopener noreferrer"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="twitter" class="svg-inline--fa fa-twitter fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg>
  </span>

</a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://www.linkedin.com/in/ieftimov/"
          target="_blank"
          aria-label="Linkedin"
          rel="me noopener noreferrer"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="linkedin" class="svg-inline--fa fa-linkedin fa-w-14" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg>
  </span>

</a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="mailto:blog@ieftimov.com"
          target="_blank"
          aria-label="Email"
          rel="me noopener noreferrer"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="at" class="svg-inline--fa fa-at fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 8C118.941 8 8 118.919 8 256c0 137.059 110.919 248 248 248 48.154 0 95.342-14.14 135.408-40.223 12.005-7.815 14.625-24.288 5.552-35.372l-10.177-12.433c-7.671-9.371-21.179-11.667-31.373-5.129C325.92 429.757 291.314 440 256 440c-101.458 0-184-82.542-184-184S154.542 72 256 72c100.139 0 184 57.619 184 160 0 38.786-21.093 79.742-58.17 83.693-17.349-.454-16.91-12.857-13.476-30.024l23.433-121.11C394.653 149.75 383.308 136 368.225 136h-44.981a13.518 13.518 0 0 0-13.432 11.993l-.01.092c-14.697-17.901-40.448-21.775-59.971-21.775-74.58 0-137.831 62.234-137.831 151.46 0 65.303 36.785 105.87 96 105.87 26.984 0 57.369-15.637 74.991-38.333 9.522 34.104 40.613 34.103 70.71 34.103C462.609 379.41 504 307.798 504 232 504 95.653 394.023 8 256 8zm-21.68 304.43c-22.249 0-36.07-15.623-36.07-40.771 0-44.993 30.779-72.729 58.63-72.729 22.292 0 35.601 15.241 35.601 40.77 0 45.061-33.875 72.73-58.161 72.73z"></path></svg>
  </span>

</a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://dev.to/fteem"
          target="_blank"
          aria-label="Dev"
          rel="me noopener noreferrer"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="dev" class="svg-inline--fa fa-dev fa-w-14" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M120.12 208.29c-3.88-2.9-7.77-4.35-11.65-4.35H91.03v104.47h17.45c3.88 0 7.77-1.45 11.65-4.35 3.88-2.9 5.82-7.25 5.82-13.06v-69.65c-.01-5.8-1.96-10.16-5.83-13.06zM404.1 32H43.9C19.7 32 .06 51.59 0 75.8v360.4C.06 460.41 19.7 480 43.9 480h360.2c24.21 0 43.84-19.59 43.9-43.8V75.8c-.06-24.21-19.7-43.8-43.9-43.8zM154.2 291.19c0 18.81-11.61 47.31-48.36 47.25h-46.4V172.98h47.38c35.44 0 47.36 28.46 47.37 47.28l.01 70.93zm100.68-88.66H201.6v38.42h32.57v29.57H201.6v38.41h53.29v29.57h-62.18c-11.16.29-20.44-8.53-20.72-19.69V193.7c-.27-11.15 8.56-20.41 19.71-20.69h63.19l-.01 29.52zm103.64 115.29c-13.2 30.75-36.85 24.63-47.44 0l-38.53-144.8h32.57l29.71 113.72 29.57-113.72h32.58l-38.46 144.8z"></path></svg>
  </span>

</a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://github.com/fteem"
          target="_blank"
          aria-label="Github"
          rel="me noopener noreferrer"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github" class="svg-inline--fa fa-github fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg>
  </span>

</a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://t.me/ieftimovcom"
          target="_blank"
          aria-label="Telegram"
          rel="me noopener noreferrer"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="telegram-plane" class="svg-inline--fa fa-telegram-plane fa-w-14" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M446.7 98.6l-67.6 318.8c-5.1 22.5-18.4 28.1-37.3 17.5l-103-75.9-49.7 47.8c-5.5 5.5-10.1 10.1-20.7 10.1l7.4-104.9 190.9-172.5c8.3-7.4-1.8-11.5-12.9-4.1L117.8 284 16.2 252.2c-22.1-6.9-22.5-22.1 4.6-32.7L418.2 66.4c18.4-6.9 34.5 4.1 28.5 32.2z"></path></svg>
  </span>

</a
        >
      
    
  </div>

</div>
    </div>
  </div>


      
  
  <section class="flex flex-row flex-wrap justify-center pt-4 text-xl">
    
      
        <a
          class="bg-neutral-300 text-neutral-700 dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800 m-1 hover:bg-primary-500 hover:text-neutral rounded min-w-[2.4rem] inline-block text-center p-1"
          href="https://www.facebook.com/sharer/sharer.php?u=https://ieftimov.com/posts/a-deeper-dive-in-elixir-plug/&amp;quote=A%20deeper%20dive%20in%20Elixir%27s%20Plug"
          title="Share on Facebook"
          aria-label="Share on Facebook"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="facebook" class="svg-inline--fa fa-facebook fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"></path></svg>
  </span>

</a
        >
      
    
      
        <a
          class="bg-neutral-300 text-neutral-700 dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800 m-1 hover:bg-primary-500 hover:text-neutral rounded min-w-[2.4rem] inline-block text-center p-1"
          href="https://twitter.com/intent/tweet/?url=https://ieftimov.com/posts/a-deeper-dive-in-elixir-plug/&amp;text=A%20deeper%20dive%20in%20Elixir%27s%20Plug"
          title="Tweet on Twitter"
          aria-label="Tweet on Twitter"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="twitter" class="svg-inline--fa fa-twitter fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg>
  </span>

</a
        >
      
    
      
        <a
          class="bg-neutral-300 text-neutral-700 dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800 m-1 hover:bg-primary-500 hover:text-neutral rounded min-w-[2.4rem] inline-block text-center p-1"
          href="https://reddit.com/submit/?url=https://ieftimov.com/posts/a-deeper-dive-in-elixir-plug/&amp;resubmit=true&amp;title=A%20deeper%20dive%20in%20Elixir%27s%20Plug"
          title="Submit to Reddit"
          aria-label="Submit to Reddit"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="reddit" class="svg-inline--fa fa-reddit fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M201.5 305.5c-13.8 0-24.9-11.1-24.9-24.6 0-13.8 11.1-24.9 24.9-24.9 13.6 0 24.6 11.1 24.6 24.9 0 13.6-11.1 24.6-24.6 24.6zM504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-132.3-41.2c-9.4 0-17.7 3.9-23.8 10-22.4-15.5-52.6-25.5-86.1-26.6l17.4-78.3 55.4 12.5c0 13.6 11.1 24.6 24.6 24.6 13.8 0 24.9-11.3 24.9-24.9s-11.1-24.9-24.9-24.9c-9.7 0-18 5.8-22.1 13.8l-61.2-13.6c-3-.8-6.1 1.4-6.9 4.4l-19.1 86.4c-33.2 1.4-63.1 11.3-85.5 26.8-6.1-6.4-14.7-10.2-24.1-10.2-34.9 0-46.3 46.9-14.4 62.8-1.1 5-1.7 10.2-1.7 15.5 0 52.6 59.2 95.2 132 95.2 73.1 0 132.3-42.6 132.3-95.2 0-5.3-.6-10.8-1.9-15.8 31.3-16 19.8-62.5-14.9-62.5zM302.8 331c-18.2 18.2-76.1 17.9-93.6 0-2.2-2.2-6.1-2.2-8.3 0-2.5 2.5-2.5 6.4 0 8.6 22.8 22.8 87.3 22.8 110.2 0 2.5-2.2 2.5-6.1 0-8.6-2.2-2.2-6.1-2.2-8.3 0zm7.7-75c-13.6 0-24.6 11.1-24.6 24.9 0 13.6 11.1 24.6 24.6 24.6 13.8 0 24.9-11.1 24.9-24.6 0-13.8-11-24.9-24.9-24.9z"></path></svg>
  </span>

</a
        >
      
    
      
        <a
          class="bg-neutral-300 text-neutral-700 dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800 m-1 hover:bg-primary-500 hover:text-neutral rounded min-w-[2.4rem] inline-block text-center p-1"
          href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://ieftimov.com/posts/a-deeper-dive-in-elixir-plug/&amp;title=A%20deeper%20dive%20in%20Elixir%27s%20Plug"
          title="Share on LinkedIn"
          aria-label="Share on LinkedIn"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="linkedin" class="svg-inline--fa fa-linkedin fa-w-14" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg>
  </span>

</a
        >
      
    
      
        <a
          class="bg-neutral-300 text-neutral-700 dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800 m-1 hover:bg-primary-500 hover:text-neutral rounded min-w-[2.4rem] inline-block text-center p-1"
          href="mailto:?body=https://ieftimov.com/posts/a-deeper-dive-in-elixir-plug/&amp;subject=A%20deeper%20dive%20in%20Elixir%27s%20Plug"
          title="Send via email"
          aria-label="Send via email"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="at" class="svg-inline--fa fa-at fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 8C118.941 8 8 118.919 8 256c0 137.059 110.919 248 248 248 48.154 0 95.342-14.14 135.408-40.223 12.005-7.815 14.625-24.288 5.552-35.372l-10.177-12.433c-7.671-9.371-21.179-11.667-31.373-5.129C325.92 429.757 291.314 440 256 440c-101.458 0-184-82.542-184-184S154.542 72 256 72c100.139 0 184 57.619 184 160 0 38.786-21.093 79.742-58.17 83.693-17.349-.454-16.91-12.857-13.476-30.024l23.433-121.11C394.653 149.75 383.308 136 368.225 136h-44.981a13.518 13.518 0 0 0-13.432 11.993l-.01.092c-14.697-17.901-40.448-21.775-59.971-21.775-74.58 0-137.831 62.234-137.831 151.46 0 65.303 36.785 105.87 96 105.87 26.984 0 57.369-15.637 74.991-38.333 9.522 34.104 40.613 34.103 70.71 34.103C462.609 379.41 504 307.798 504 232 504 95.653 394.023 8 256 8zm-21.68 304.43c-22.249 0-36.07-15.623-36.07-40.771 0-44.993 30.779-72.729 58.63-72.729 22.292 0 35.601 15.241 35.601 40.77 0 45.061-33.875 72.73-58.161 72.73z"></path></svg>
  </span>

</a
        >
      
    
  </section>


      
  
    
    
    
    <div class="pt-8">
      <hr class="border-dotted border-neutral-300 dark:border-neutral-600" />
      <div class="flex justify-between pt-3">
        <span>
          
            <a class="flex group" href="/posts/haveibeenpwned-password-lookup-elixir/">
              <span
                class="mr-3 ltr:inline rtl:hidden text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400"
                >&larr;</span
              >
              <span
                class="ml-3 ltr:hidden rtl:inline text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >Validate your passwords using Elixir and haveibeenpwned.com's API</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2018-12-23 00:00:00 &#43;0000 UTC">23 December 2018</time>
                  
                </span>
              </span>
            </a>
          
        </span>
        <span>
          
            <a class="flex text-right group" href="/posts/understanding-basics-elixir-concurrency-model/">
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >Understanding the basics of Elixir's concurrency model</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2019-01-15 00:00:00 &#43;0000 UTC">15 January 2019</time>
                  
                </span>
              </span>
              <span
                class="ml-3 ltr:inline rtl:hidden text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span
                class="mr-3 ltr:hidden rtl:inline text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400"
                >&larr;</span
              >
            </a>
          
        </span>
      </div>
    </div>
  


    </footer>
    
  </article>

      
        <div
          class="absolute top-[110vh] ltr:right-0 rtl:left-0 w-12 pointer-events-none bottom-[-5.5rem]"
        >
          <a
            href="#the-top"
            class="w-12 h-12 sticky pointer-events-auto top-[calc(100vh-5rem)] bg-neutral/50 dark:bg-neutral-800/50 backdrop-blur rounded-full text-xl flex items-center justify-center text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400"
            aria-label="Scroll to top"
            title="Scroll to top"
          >
            &uarr;
          </a>
        </div>
      
    </main>
    <div
  id="search-wrapper"
  class="fixed inset-0 z-50 flex flex-col p-4 sm:p-6 md:p-[10vh] lg:p-[12vh] w-screen h-screen cursor-default bg-neutral-500/50 backdrop-blur-sm dark:bg-neutral-900/50 invisible"
  data-url="https://ieftimov.com/"
>
  <div
    id="search-modal"
    class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg border-neutral-200 top-20 bg-neutral dark:bg-neutral-800 dark:border-neutral-700"
  >
    <header class="relative z-10 flex items-center justify-between flex-none px-2">
      <form class="flex items-center flex-auto min-w-0">
        <div class="flex items-center justify-center w-8 h-8 text-neutral-400">
          

  <span class="relative inline-block align-text-bottom icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"></path></svg>
  </span>


        </div>
        <input
          type="search"
          id="search-query"
          class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-transparent focus:outline-2"
          placeholder="Search"
          tabindex="0"
        />
      </form>
      <button
        id="close-search-button"
        class="flex items-center justify-center w-8 h-8 text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400"
        title="Close (Esc)"
      >
        

  <span class="relative inline-block align-text-bottom icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="times" class="svg-inline--fa fa-times fa-w-11" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 352 512"><path fill="currentColor" d="M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"></path></svg>
  </span>


      </button>
    </header>
    <section class="flex-auto px-2 overflow-auto">
      <ul id="search-results">
        
      </ul>
    </section>
  </div>
</div>
<footer class="py-10">
  
  
    <nav class="pb-4 text-base font-medium text-neutral-500 dark:text-neutral-400">
      <ul class="flex flex-col list-none sm:flex-row">
        
          <li class="mb-1 sm:mb-0 sm:mr-7 sm:last:mr-0">
            <a
              class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
              href="/analytics"
              title=""
              >Analytics</a
            >
          </li>
        
          <li class="mb-1 sm:mb-0 sm:mr-7 sm:last:mr-0">
            <a
              class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
              href="/index.xml"
              title=""
              >RSS</a
            >
          </li>
        
          <li class="mb-1 sm:mb-0 sm:mr-7 sm:last:mr-0">
            <a
              class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
              href="https://forms.gle/orfXK5jh1LRaiFzo8"
              title=""
              >Suggest a topic</a
            >
          </li>
        
      </ul>
    </nav>
  
  <div class="flex justify-between">
    <div>
      
      <p class="text-sm text-neutral-500 dark:text-neutral-400">
          &copy;
          2022
          Ilija Eftimov
      </p>
      
      
        <p class="text-xs text-neutral-500 dark:text-neutral-400">
          
          
          Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
            href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a> &amp; <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href="https://git.io/hugo-congo" target="_blank" rel="noopener noreferrer">Congo</a>
        </p>
      
    </div>
    
    
      <div
        class="text-sm cursor-pointer text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400 ltr:mr-14 rtl:ml-14"
      >
        <button
          id="appearance-switcher"
          class="w-12 h-12 "
          type="button"
          title="Switch to dark appearance"
        >
          <span class="inline dark:hidden">

  <span class="relative inline-block align-text-bottom icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="moon" class="svg-inline--fa fa-moon fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M283.211 512c78.962 0 151.079-35.925 198.857-94.792 7.068-8.708-.639-21.43-11.562-19.35-124.203 23.654-238.262-71.576-238.262-196.954 0-72.222 38.662-138.635 101.498-174.394 9.686-5.512 7.25-20.197-3.756-22.23A258.156 258.156 0 0 0 283.211 0c-141.309 0-256 114.511-256 256 0 141.309 114.511 256 256 256z"></path></svg>
  </span>

</span>
          <span class="hidden dark:inline">

  <span class="relative inline-block align-text-bottom icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="sun" class="svg-inline--fa fa-sun fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 160c-52.9 0-96 43.1-96 96s43.1 96 96 96 96-43.1 96-96-43.1-96-96-96zm246.4 80.5l-94.7-47.3 33.5-100.4c4.5-13.6-8.4-26.5-21.9-21.9l-100.4 33.5-47.4-94.8c-6.4-12.8-24.6-12.8-31 0l-47.3 94.7L92.7 70.8c-13.6-4.5-26.5 8.4-21.9 21.9l33.5 100.4-94.7 47.4c-12.8 6.4-12.8 24.6 0 31l94.7 47.3-33.5 100.5c-4.5 13.6 8.4 26.5 21.9 21.9l100.4-33.5 47.3 94.7c6.4 12.8 24.6 12.8 31 0l47.3-94.7 100.4 33.5c13.6 4.5 26.5-8.4 21.9-21.9l-33.5-100.4 94.7-47.3c13-6.5 13-24.7.2-31.1zm-155.9 106c-49.9 49.9-131.1 49.9-181 0-49.9-49.9-49.9-131.1 0-181 49.9-49.9 131.1-49.9 181 0 49.9 49.9 49.9 131.1 0 181z"></path></svg>
  </span>

</span>
        </button>
      </div>
    
  </div>
  
  
</footer>
</body>
</html>
