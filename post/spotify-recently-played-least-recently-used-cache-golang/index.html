<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Barebones model of Spotify&#39;s &#39;Recently Played&#39; screen using a Least Recently Used (LRU) cache in Golang - Ilija Eftimov</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="Ilija Eftimov" />
  <meta name="description" content="One of the most widely used caching schemes is Least Recently Used (LRU). Caches that use this eviction strategy will remove the least recently used item when their maximum capacity is reached. That means that such caches have to keep a track of the order of access of the cached items, so it would know what items should be evicted.
Before we go too much into details about the implementation of an LRU cache, let&amp;rsquo;s first see what are the possible applications of this caching scheme." />

  <meta name="keywords" content="Software, Programming, Computer Science, Products" />






<meta name="generator" content="Hugo 0.54.0" />


<link rel="canonical" href="https://ieftimov.com/post/spotify-recently-played-least-recently-used-cache-golang/" />



<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.ec807d8b802a40889537c26e014f733206312ea440d42e1f0dabed80918de1ac.css" integrity="sha256-7IB9i4AqQIiVN8JuAU9zMgYxLqRA1C4fDavtgJGN4aw=" media="screen" crossorigin="anonymous">




<link rel="stylesheet" href="/css/overrides.css">

<link rel="stylesheet" href="/css/subscribe.css">


<meta property="og:title" content="Barebones model of Spotify&#39;s &#39;Recently Played&#39; screen using a Least Recently Used (LRU) cache in Golang" />
<meta property="og:description" content="One of the most widely used caching schemes is Least Recently Used (LRU). Caches that use this eviction strategy will remove the least recently used item when their maximum capacity is reached. That means that such caches have to keep a track of the order of access of the cached items, so it would know what items should be evicted.
Before we go too much into details about the implementation of an LRU cache, let&rsquo;s first see what are the possible applications of this caching scheme." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ieftimov.com/post/spotify-recently-played-least-recently-used-cache-golang/" />

<meta property="og:image" content="https://ieftimov.com/cards/spotify-recently-played-least-recently-used-cache-golang.png" />
<meta property="article:published_time" content="2019-03-11T00:00:00&#43;00:00"/>


<meta itemprop="name" content="Barebones model of Spotify&#39;s &#39;Recently Played&#39; screen using a Least Recently Used (LRU) cache in Golang">
<meta itemprop="description" content="One of the most widely used caching schemes is Least Recently Used (LRU). Caches that use this eviction strategy will remove the least recently used item when their maximum capacity is reached. That means that such caches have to keep a track of the order of access of the cached items, so it would know what items should be evicted.
Before we go too much into details about the implementation of an LRU cache, let&rsquo;s first see what are the possible applications of this caching scheme.">



<meta itemprop="wordCount" content="2595">

  <meta itemprop="image" content="https://ieftimov.com/cards/spotify-recently-played-least-recently-used-cache-golang.png">



<meta itemprop="keywords" content="caching,lru,last recently used,golang," />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://ieftimov.com/cards/spotify-recently-played-least-recently-used-cache-golang.png"/>

<meta name="twitter:title" content="Barebones model of Spotify&#39;s &#39;Recently Played&#39; screen using a Least Recently Used (LRU) cache in Golang"/>
<meta name="twitter:description" content="One of the most widely used caching schemes is Least Recently Used (LRU). Caches that use this eviction strategy will remove the least recently used item when their maximum capacity is reached. That means that such caches have to keep a track of the order of access of the cached items, so it would know what items should be evicted.
Before we go too much into details about the implementation of an LRU cache, let&rsquo;s first see what are the possible applications of this caching scheme."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-11264459-2', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>



</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Ilija Eftimov</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://ieftimov.com/">Home</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://ieftimov.com/post/">Archives</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://ieftimov.com/about/">About</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://ieftimov.com/subscribe/">Subscribe</a>
          
        
      </li>
    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      Ilija Eftimov
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://ieftimov.com/">Home</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://ieftimov.com/post/">Archives</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://ieftimov.com/about/">About</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://ieftimov.com/subscribe/">Subscribe</a>
          

        

      </li>
    
    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">Barebones model of Spotify&#39;s &#39;Recently Played&#39; screen using a Least Recently Used (LRU) cache in Golang</h1>
      
      <div class="post-meta">
        <time datetime="2019-03-11" class="post-time">
          11-03-2019
        </time>
        <div class="post-category">
            <a href="https://ieftimov.com/categories/caching/"> caching </a>
            <a href="https://ieftimov.com/categories/golang/"> golang </a>
            
          </div>
        

        
        

        
        
      </div>
    </header>

    
    

    
    <div class="post-content">
      

<p>One of the most widely used caching schemes is Least Recently Used (LRU).
Caches that use this eviction strategy will remove the least recently used item
when their maximum capacity is reached. That means that such caches have to
keep a track of the order of access of the cached items, so it would know what
items should be evicted.</p>

<p>Before we go too much into details about the implementation of an LRU cache,
let&rsquo;s first see what are the possible applications of this caching scheme.</p>

<h2 id="applications">Applications</h2>

<p>LRU cache applications are really diverse. The LRU cache eviction scheme is, in
my opinion, the most widespread and used scheme. I believe that this is due to
its nature - it clicks with people really quick because it often does the trick
for conventional problems in commercial programming. For example, if one has a
fixed amount of memory, the most natural way to approach caching is to keep
in cache whatever is accessed recently.</p>

<p>So, what would be one potential application of a LRU cache? Let&rsquo;s see an
example.</p>

<p>Open your Spotify application (if you have one). Don&rsquo;t have one? Here&rsquo;s a
screenshot of mine:</p>











<span class="caption-wrapper">
  <img class="caption" src="/golang-lru-cache/spotify.png" title="" alt="">
  <p class="caption-text">Let&#39;s keep my music taste out of the discussion, please.</p>
</span>


<p>You can see in the screenshot above that I have chosen the &ldquo;Recently played&rdquo;
view, which shows all of my recently played media. If you&rsquo;ve never thought
about how such screen would look like, let me break the magic down for you -
this view is just a GUI that lives on top of some sort of an LRU cache.</p>

<p>Curious how we would model such a &ldquo;Recently played&rdquo; view? Let&rsquo;s take a deeper
look.</p>

<h2 id="establishing-basic-types">Establishing basic types</h2>

<p>Let&rsquo;s define couple of types that would represent the <code>Playlist</code>s and <code>Song</code>s
that can be found on Spotify:</p>

<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">Song</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">duration</span>  <span class="kt">int64</span> <span class="c1">// seconds
</span><span class="c1"></span>	<span class="nx">title</span>     <span class="kt">string</span>
	<span class="nx">artist</span>    <span class="o">*</span><span class="nx">Artist</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>

<p>No surprises here - a <code>Song</code> has a <code>duration</code>, a <code>title</code> and an <code>artist</code>. Let&rsquo;s
look at a <code>Playlist</code>:</p>

<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">Playlist</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">title</span>       <span class="kt">string</span>
	<span class="nx">descrption</span>  <span class="kt">string</span>
	<span class="nx">duration</span>    <span class="kt">int64</span> <span class="c1">// seconds
</span><span class="c1"></span>	<span class="nx">publishedAt</span> <span class="kt">int32</span> <span class="c1">// Unix timestamp
</span><span class="c1"></span>	<span class="nx">songs</span>       <span class="p">[]</span><span class="o">*</span><span class="nx">Song</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>

<p>A <code>Playlist</code> has a <code>title</code>, <code>description</code>, <code>duration</code> (which is the sum of the
durations of all songs in it), <code>publishedAt</code> which is the date of the
publishing of the playlist and <code>songs</code> - a slice of <code>Song</code> pointers
representing the songs in the playlist.</p>

<p>Such structure of the <code>Playlist</code> <code>struct</code> will allow users to find a playlist
and &ldquo;just play it&rdquo;.</p>

<h2 id="recently-played">Recently played</h2>

<p>The &ldquo;Recently played&rdquo; screen in Spotify has 30 items only, where each of the
items can be a playlist, an artist or an album. For simplicity of our example
here, we will agree that we will only keep track of the recently played
playlists, ignoring the artists or albums.</p>

<p>Now, a typical implementation of a LRU cache uses a combination of two simple
data structures - a hash table and a linked list. Why? Well, as mentioned in
<a href="https://ieftimov.com/when-why-least-frequently-used-cache-implementation-golang">another article on caching</a>,
caches have to be fast along two dimensions:</p>

<ol>
<li>Ensuring that as many of the requests for files go to it (cache hit), not
over the network or to main memory (cache miss);</li>
<li>The overhead of using it should be small: testing membership and deciding
when to replace a <code>Playlist</code> should be as fast as possible.</li>
</ol>

<p>On the first point, we have agreed that LRU will do the job because of the
nature of the &ldquo;Recently played&rdquo; screen. This means that we have to keep track
of what <code>Playlist</code>s have been played recently. A data structure that allows us
to do this is a linked list. Since Go already provides us a doubly-linked list
implementation, there is no need to implement it ourselves - we will just use
the <code>container/list</code> package <sup class="footnote-ref" id="fnref:1"><a href="#fn:1">1</a></sup>.</p>

<p>On the second point, the data structure that comes to mind for a scalable
membership tests is a hash table (or, a bloom filter <sup class="footnote-ref" id="fnref:3"><a href="#fn:3">2</a></sup>). In hash tables,
every value has a unique key, so if our program can accurately recreate that
key every time it needs it, it will be super easy for us to check if the
<code>Playlist</code> is in the cache or not.</p>

<p>Knowing this, let&rsquo;s define the <code>RecentlyPlayed</code> struct and its constructor
function:</p>

<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">RecentlyPlayed</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">capacity</span> <span class="kt">int</span>
	<span class="nx">size</span>     <span class="kt">int</span>
	<span class="nx">cache</span>    <span class="kd">map</span><span class="p">[</span><span class="kt">int</span><span class="p">]</span><span class="o">*</span><span class="nx">list</span><span class="p">.</span><span class="nx">Element</span>
	<span class="nx">lru</span>      <span class="o">*</span><span class="nx">list</span><span class="p">.</span><span class="nx">List</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>

<p>Things are pretty self explanatory here: <code>capacity</code> will hold the maximum
capacity of the cache, <code>size</code> will be the current size of the recently played
screen, <code>cache</code> is the hashmap that wil be used to retrieve the elements from
cache and <code>lru</code> is a linked list (from the <code>container/list</code> package <sup class="footnote-ref" id="fnref:1"><a href="#fn:1">1</a></sup>) that
we will use to keep track of the recently played playlists.</p>

<p>Let&rsquo;s first create a small function that will spawn up a new <code>RecentlyPlayed</code>
struct with some sane defaults:</p>

<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">NewRecentlyPlayed</span><span class="p">(</span><span class="nx">capacity</span> <span class="kt">int</span><span class="p">)</span> <span class="o">*</span><span class="nx">RecentlyPlayed</span> <span class="p">{</span>
	<span class="nx">rp</span> <span class="o">:=</span> <span class="nx">RecentlyPlayed</span><span class="p">{</span>
		<span class="nx">capacity</span><span class="p">:</span> <span class="nx">capacity</span><span class="p">,</span>
                <span class="nx">size</span><span class="p">:</span>     <span class="mi">0</span><span class="p">,</span>
		<span class="nx">lru</span><span class="p">:</span>      <span class="nx">list</span><span class="p">.</span><span class="nf">New</span><span class="p">(),</span>
		<span class="nx">cache</span><span class="p">:</span>    <span class="nb">make</span><span class="p">(</span><span class="kd">map</span><span class="p">[</span><span class="kt">string</span><span class="p">]</span><span class="o">*</span><span class="nx">list</span><span class="p">.</span><span class="nx">Element</span><span class="p">),</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="o">&amp;</span><span class="nx">rp</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>

<p>This function sets the defaults to the struct and returns a pointer to it. Now,
before we go any further with the implementation, let&rsquo;s quickly understand
how each of these two datastructures will work and also look at some diagrams.</p>

<p>First, <code>cache</code> is going to be a <code>map</code> that will have a key of type <code>string</code> and
a value of type <code>*list.Element</code>. The <code>string</code> will be a hash of the <code>Playlist</code>
that will be stored there, while the <code>*list.Element</code> will be a pointer to the
element in the doubly-linked list. By having this pointer, we can easily get
the <code>Playlist</code> that is stored inside it (so we can play it), but also it will
be easy to reposition it in the <code>lru</code> list when we play the <code>Playlist</code>.</p>

<h2 id="introducing-the-player">Introducing the player</h2>

<p>To have a &ldquo;Recently played&rdquo; list of playlists, we obviously need to put it in
some sort of a player, that will have a <code>Play</code> function.</p>

<p>Here&rsquo;s a quick sketch of it, so we can move to the meat of our implementation:</p>

<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">Player</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">playProgress</span>       <span class="kt">int</span>
	<span class="nx">RecentlyPlayedList</span> <span class="o">*</span><span class="nx">RecentlyPlayed</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>

<p>For the purpose of this example, we can keep the <code>Player</code> quite simple - only
the progress of the song currently playing (<code>playProgress</code>) and the recently
played list of playlists (<code>RecentlyPlayedList</code>).</p>

<p>We will also add a small constructor function for the <code>Player</code>:</p>

<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">NewPlayer</span><span class="p">()</span> <span class="o">*</span><span class="nx">Player</span> <span class="p">{</span>
	<span class="nx">p</span> <span class="o">:=</span> <span class="nx">Player</span><span class="p">{</span>
		<span class="nx">RecentlyPlayedList</span><span class="p">:</span> <span class="nf">NewRecentlyPlayed</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="o">&amp;</span><span class="nx">p</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>

<p>Now we need to add the <code>Play</code> function and understand what are the functions
related to <code>RecentlyPlayed</code> that <code>Play</code> will have to invoke.</p>

<h2 id="playing-a-playlist">Playing a <code>Playlist</code></h2>

<p>Obviously, there&rsquo;a already an entity that will have to play the <code>Playlist</code> - the
<code>Player</code>. Let&rsquo;s add a function <code>Play</code> to our <code>Player</code>:</p>

<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">player</span> <span class="o">*</span><span class="nx">Player</span><span class="p">)</span> <span class="nf">Play</span><span class="p">(</span><span class="nx">playlist</span> <span class="o">*</span><span class="nx">Playlist</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="nx">cached</span><span class="p">,</span> <span class="nx">playlist</span> <span class="o">:=</span> <span class="nx">player</span><span class="p">.</span><span class="nx">RecentlyPlayedList</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="nx">playlist</span><span class="p">.</span><span class="nf">hash</span><span class="p">());</span> <span class="nx">cached</span> <span class="p">{</span>
		<span class="c1">// Play from cache...
</span><span class="c1"></span>	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="c1">// Fetch over the network and start playing...
</span><span class="c1"></span>		<span class="nx">player</span><span class="p">.</span><span class="nx">RecentlyPlayedList</span><span class="p">.</span><span class="nf">Set</span><span class="p">(</span><span class="nx">playlist</span><span class="p">)</span>
	<span class="p">}</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>

<div class="shortcode-notice info">
  <div class="shortcode-notice-title info">
    
      Before we continue...
    
  </div>
  <p>If you thought that I&rsquo;d show you how we&rsquo;ll actually play a media file or stream
it over the network I am sorry to disappoint. That&rsquo;s a tad out of the scope of
this article.</p>

<p>That being said, I am always looking for topic ideas to write on, although I
have a huge list already, so if that&rsquo;s something you&rsquo;d like to read on drop a
comment below.</p>

</div>


<p>Let&rsquo;s dissect the <code>Play</code> function:</p>

<ol>
<li>The <code>player.RecentlyPlayedList</code> struct (which is of type <code>*RecentlyPlayed</code>)
will have a function <code>Get</code> which will return a <code>bool</code> and a <code>playlist</code> which
our player can then play.</li>
<li>If it doesn&rsquo;t find a <code>cached</code> playlist, in that case it will fetch/start
streaming the playlist and it will cache it using the <code>Set</code> function of the
<code>RecentlyPlayedList</code> struct.</li>
</ol>

<p>So, what is the behaviour and the internals of these two new methods, <code>Get</code> and
<code>Set</code>?</p>

<h2 id="get-ting-a-playlist-from-cache"><code>Get</code>ting a <code>Playlist</code> from cache</h2>

<p>To retrieve a <code>Playlist</code> from cache is actually a cheap and easy task - our
cache is backed by a hash map which has a O(1) time complexity for the access
operation. The trick lies it the fact that once we access an item in the cache
we also have to make it the most recently used item in the
<code>RecentlyPlayedList</code>.  Given that the list is powered by a linked list, we have
to take our item from the list and move it to the front of the list.</p>

<p>Let&rsquo;s see how that would work in our context:</p>

<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">rp</span> <span class="o">*</span><span class="nx">RecentlyPlayed</span><span class="p">)</span> <span class="nf">Get</span><span class="p">(</span><span class="nx">key</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="nx">Playlist</span><span class="p">,</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="nx">elem</span><span class="p">,</span> <span class="nx">present</span> <span class="o">:=</span> <span class="nx">rp</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span> <span class="nx">present</span> <span class="p">{</span>
                <span class="nx">rp</span><span class="p">.</span><span class="nx">lru</span><span class="p">.</span><span class="nf">MoveToFront</span><span class="p">(</span><span class="nx">elem</span><span class="p">)</span>
		<span class="k">return</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">Value</span><span class="p">.(</span><span class="o">*</span><span class="nx">Playlist</span><span class="p">),</span> <span class="kc">true</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="kc">false</span>
	<span class="p">}</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>

<p>In case you were expecting some magic here – sorry to disappoint, but this is
pretty simple. Its a three step function:</p>

<ol>
<li>Checks if the item can be found in the cache. If not it returns a <code>nil</code>.</li>
<li>Otherwise, it moves the element to the beginning of the LRU list, and</li>
<li>It returns the value of the <code>*list.Element</code>, which is basically the pointer
to the <code>Playlist</code> that our player is supposed to play</li>
</ol>

<p>That&rsquo;s it, pretty simple.</p>

<h2 id="hash-table-key-for-a-playlist">Hash table key for a <code>Playlist</code></h2>

<p>Before we move on to <code>Set</code>, let&rsquo;s quickly discuss the implementation of the
<code>hash</code> function.</p>

<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">playlist</span> <span class="o">*</span><span class="nx">Playlist</span><span class="p">)</span> <span class="nf">hash</span><span class="p">()</span> <span class="kt">string</span> <span class="p">{</span>
	<span class="nx">hash</span> <span class="o">:=</span> <span class="nx">sha1</span><span class="p">.</span><span class="nf">New</span><span class="p">()</span>
	<span class="nx">s</span> <span class="o">:=</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span>
		<span class="s">&#34;%d-%s-%s-%d&#34;</span><span class="p">,</span>
		<span class="nx">playlist</span><span class="p">.</span><span class="nx">duration</span><span class="p">,</span>
		<span class="nx">playlist</span><span class="p">.</span><span class="nx">title</span><span class="p">,</span>
		<span class="nx">playlist</span><span class="p">.</span><span class="nx">description</span><span class="p">,</span>
		<span class="nx">playlist</span><span class="p">.</span><span class="nx">publishedAt</span><span class="p">,</span>
	<span class="p">)</span>
	<span class="nx">hash</span><span class="p">.</span><span class="nf">Write</span><span class="p">([]</span><span class="nb">byte</span><span class="p">(</span><span class="nx">s</span><span class="p">))</span>
	<span class="nx">sum</span> <span class="o">:=</span> <span class="nx">hash</span><span class="p">.</span><span class="nf">Sum</span><span class="p">(</span><span class="kc">nil</span><span class="p">)</span>
	<span class="k">return</span> <span class="nx">fmt</span><span class="p">.</span><span class="nf">Sprintf</span><span class="p">(</span><span class="s">&#34;%x&#34;</span><span class="p">,</span> <span class="nx">sum</span><span class="p">)</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>

<p>As you can see, it&rsquo;s a simple one - it&rsquo;s goal is just to generate a
reproducible hash for a <code>Playlist</code>. It basically concatenates the attributes of
the <code>Playlist</code> struct and then applies a <code>SHA1</code> hashing sum on it. As the last
step, it returns the hash in a hexidecimal format.</p>

<h2 id="set-ting-a-playlist-to-cache"><code>Set</code>ting a <code>Playlist</code> to cache</h2>

<p>Now that we have the <code>hash</code> function out of the way, let&rsquo;s look at the code of
the <code>Set</code> function and then we can discuss the steps this function takes to add
a <code>Playlist</code> to the cache:</p>

<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">rp</span> <span class="o">*</span><span class="nx">RecentlyPlayed</span><span class="p">)</span> <span class="nf">Set</span><span class="p">(</span><span class="nx">playlist</span> <span class="o">*</span><span class="nx">Playlist</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">key</span> <span class="o">:=</span> <span class="nx">playlist</span><span class="p">.</span><span class="nf">hash</span><span class="p">()</span>
	<span class="k">if</span> <span class="nx">elem</span><span class="p">,</span> <span class="nx">present</span> <span class="o">:=</span> <span class="nx">rp</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span> <span class="nx">present</span> <span class="p">{</span>
		<span class="nx">rp</span><span class="p">.</span><span class="nx">lru</span><span class="p">.</span><span class="nf">MoveToFront</span><span class="p">(</span><span class="nx">elem</span><span class="p">)</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="nx">elem</span> <span class="o">:=</span> <span class="nx">rp</span><span class="p">.</span><span class="nx">lru</span><span class="p">.</span><span class="nf">PushFront</span><span class="p">(</span><span class="nx">playlist</span><span class="p">)</span>
		<span class="nx">rp</span><span class="p">.</span><span class="nx">size</span><span class="o">++</span>
	<span class="p">}</span>
	<span class="nx">rp</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="p">=</span> <span class="nx">elem</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>

<p>The <code>Set</code> function takes a <code>*Playlist</code> as an argument, which is then hashed
using a <code>hash</code> method that is implemented by <code>RecentlyPlayed</code> - this returns a
unique key based on some attributes of the <code>Playlist</code>. Then <code>key</code> is used when
the <code>Playlist</code> is added in the hash table <code>cache</code>.</p>

<p>But before we add it to the hash table <code>cache</code>, we will check if there&rsquo;s
already a value in the <code>cache</code> hash table with the same <code>key</code>. If so, we will
only move the <code>*Playlist</code> to the front of the <code>lru</code> linked list.</p>

<p>If not, the <code>*Playlist</code> will be pushed to the front of the <code>lru</code> linked list
(as the most recently used item), which will return a <code>*list.Element</code>. This
element, which for its <code>Value</code> expects an <code>interface{}</code> (which is the Go way
to say &ldquo;any type&rdquo;), will wrap the <code>*Playlist</code> as its <code>Value</code>. This means that
any time we access the <code>elem.Value</code> we will have to cast it to the proper type,
since <code>*list.Element</code> does not know the type of its <code>Value</code> (remember, it
accepts any type).</p>

<p>After the playlist is added to the front of the <code>lru</code> list, the <code>Set</code> function
will increment the <code>RecentlyPlayed</code>&rsquo;s <code>size</code> due to the new item added to the
list.</p>

<p>Finally, the function will cache the <code>*list.Element</code> in the <code>cache</code> hash table
- which we will use to retrieve the playlist with a <code>O(1)</code> time complexity.</p>

<h2 id="eviction">Eviction</h2>

<p>Now that we know how the <code>Get</code> and <code>Set</code> functions work, we need to take one
more thing into consideration: Spotify&rsquo;s recently played screen has a limited
amount of items. This means that once the number of playlists reach a
threshold, the least recently played playlist will have to be removed so a new
one can be added to the list.</p>

<p>In essence, this is the eviction algoritm that we have to write for our LRU
cache that powers the recently played screen. For the purpose of our
implementation we will write an <code>increment</code> function:</p>

<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">rp</span> <span class="o">*</span><span class="nx">RecentlyPlayed</span><span class="p">)</span> <span class="nf">increment</span><span class="p">(</span><span class="nx">element</span> <span class="o">*</span><span class="nx">list</span><span class="p">.</span><span class="nx">Element</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">rp</span><span class="p">.</span><span class="nx">lru</span><span class="p">.</span><span class="nf">MoveToFront</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">rp</span><span class="p">.</span><span class="nx">size</span> <span class="o">==</span> <span class="nx">rp</span><span class="p">.</span><span class="nx">capacity</span> <span class="p">{</span>
		<span class="nx">lruItem</span> <span class="o">:=</span> <span class="nx">rp</span><span class="p">.</span><span class="nx">lru</span><span class="p">.</span><span class="nf">Back</span><span class="p">()</span>
		<span class="nx">rp</span><span class="p">.</span><span class="nx">lru</span><span class="p">.</span><span class="nf">Remove</span><span class="p">(</span><span class="nx">lruItem</span><span class="p">)</span>
		<span class="nx">rp</span><span class="p">.</span><span class="nx">size</span><span class="o">--</span>
	<span class="p">}</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>

<p>Every time we want to increment the usage of a certain <code>*list.Element</code>, the
function will take these two steps:</p>

<ol>
<li>Move the accessed element to be beginning of the <code>lru</code> linked list, and</li>
<li>Take the last item in the <code>lru</code> linked list and remove it from the list,
only when the <code>size</code> of the <code>RecentlyPlayed</code> struct has reached its
capacity</li>
</ol>

<p>This function will allow us to handle the eviction of the least recently used
item in the list of playlists. Now, we can revisit our <code>Set</code> and <code>Get</code>
functions and drop this function in:</p>

<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">rp</span> <span class="o">*</span><span class="nx">RecentlyPlayed</span><span class="p">)</span> <span class="nf">Set</span><span class="p">(</span><span class="nx">playlist</span> <span class="o">*</span><span class="nx">Playlist</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">key</span> <span class="o">:=</span> <span class="nx">playlist</span><span class="p">.</span><span class="nf">hash</span><span class="p">()</span>
	<span class="k">if</span> <span class="nx">elem</span><span class="p">,</span> <span class="nx">present</span> <span class="o">:=</span> <span class="nx">rp</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span> <span class="nx">present</span> <span class="p">{</span>
		<span class="nx">rp</span><span class="p">.</span><span class="nf">increment</span><span class="p">(</span><span class="nx">elem</span><span class="p">)</span> <span class="c1">// &lt;- the change
</span><span class="c1"></span>	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="nx">elem</span> <span class="o">:=</span> <span class="nx">rp</span><span class="p">.</span><span class="nx">lru</span><span class="p">.</span><span class="nf">PushFront</span><span class="p">(</span><span class="nx">playlist</span><span class="p">)</span>
		<span class="nx">rp</span><span class="p">.</span><span class="nx">size</span><span class="o">++</span>
	<span class="p">}</span>
	<span class="nx">rp</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="p">=</span> <span class="nx">elem</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">rp</span> <span class="o">*</span><span class="nx">RecentlyPlayed</span><span class="p">)</span> <span class="nf">Get</span><span class="p">(</span><span class="nx">key</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="nx">Playlist</span><span class="p">,</span> <span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
	<span class="k">if</span> <span class="nx">elem</span><span class="p">,</span> <span class="nx">present</span> <span class="o">:=</span> <span class="nx">rp</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">key</span><span class="p">];</span> <span class="nx">present</span> <span class="p">{</span>
		<span class="nx">rp</span><span class="p">.</span><span class="nf">increment</span><span class="p">(</span><span class="nx">elem</span><span class="p">)</span> <span class="c1">// &lt;- the change
</span><span class="c1"></span>		<span class="k">return</span> <span class="nx">elem</span><span class="p">.</span><span class="nx">Value</span><span class="p">.(</span><span class="o">*</span><span class="nx">Playlist</span><span class="p">),</span> <span class="kc">true</span>
	<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="kc">false</span>
	<span class="p">}</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>

<p>By dropping the <code>increment</code> function in <code>Set</code> and <code>Get</code>, every time we touch
any of the playlists in our recently played screen we will make sure the list
of recently used items is updated. This will allow our recently played screen
to change the order (based on the how recently the playlists are played) or
remove any playlists when the capacity is exceeded.</p>

<h2 id="in-closing">In closing</h2>

<p>Now that we have a Go-powered sketch of Spotify&rsquo;s recently played screen, let&rsquo;s
quickly recap what we did and what are the missing pieces.</p>

<p>Obviously, this was a very limited implementation - it lacks any mechanisms to
stream/download the playlists via the internet, which would be pretty hard to
cover in this article. Also, the implementation does not take into account any
restarting of the application - if we stop and start the program all of the
cached playlists will be gone. This is because our implementation does not
store the data on disk (just in memory). Of course, we also do not have any
graphical user interface to interact with the application - just a couple of
mere functions that we can invoke.</p>

<p>While all of the above is a downside of our implementation (or a shortcoming),
it still effectively painted the picture of how we could write such a program
using Go. The combination of the two data structures (linked list + hash table)
worked nicely for solving the problem at hand - it scales well from time
complexity and (for our scenario) the hit-to-miss ratio should is optimal. I
hope that our barebones implementation of LRU cache paints that picture well.</p>

<p>If you would like to read more of my rambling about caching algorithms, you can
also read &ldquo;When and Why to use a Least Frequently Used (LFU) cache with an
implementation in Golang&rdquo; <sup class="footnote-ref" id="fnref:2"><a href="#fn:2">3</a></sup>.</p>
<div class="footnotes">

<hr />

<ol>
<li id="fn:1">Package that implements a doubly linked list: <a href="https://golang.org/pkg/container/list/">https://golang.org/pkg/container/list/</a>
 <a class="footnote-return" href="#fnref:1"><sup>[return]</sup></a></li>
<li id="fn:3">Good article on the topic: <a href="https://bart.degoe.de/bloom-filters-bit-arrays-recommendations-caches-bitcoin/">https://bart.degoe.de/bloom-filters-bit-arrays-recommendations-caches-bitcoin/</a>
 <a class="footnote-return" href="#fnref:3"><sup>[return]</sup></a></li>
<li id="fn:2">Article I published on this very blog: <a href="https://ieftimov.com/when-why-least-frequently-used-cache-implementation-golang">https://ieftimov.com/when-why-least-frequently-used-cache-implementation-golang</a>
 <a class="footnote-return" href="#fnref:2"><sup>[return]</sup></a></li>
</ol>
</div>

    </div>

    
    


    
    

    <footer class="post-footer">
      <div class="post-tags">
          <a href="https://ieftimov.com/tags/caching/">caching</a>
          <a href="https://ieftimov.com/tags/lru/">lru</a>
          <a href="https://ieftimov.com/tags/last-recently-used/">last recently used</a>
          <a href="https://ieftimov.com/tags/golang/">golang</a>
          
        </div>

      
      <nav class="post-nav">
        
        
          <a class="next" href="/post/when-why-least-frequently-used-cache-implementation-golang/">
            <span class="next-text nav-default">When and Why to use a Least Frequently Used (LFU) cache with an implementation in Golang</span>
            <span class="prev-text nav-mobile">Next</span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  

  
  

  
  

  

  

  <div class="disqus-comment">
  <div class="disqus-button" id="load_disqus" onclick="load_disqus()">
    Show Disqus Comments
  </div>
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_config = function () {
      this.page.url = "https://ieftimov.com/post/spotify-recently-played-least-recently-used-cache-golang/";
    };
    function load_disqus() {
      
      
      if (window.location.hostname === 'localhost') return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'eftimov';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);

      $('#load_disqus').remove();
    };
  </script>
  <noscript>Please enable JavaScript to view the
    <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
  </noscript>
  
  </div>
  
    



        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="icon-links">
  
  
    <a href="mailto:hi@ilija.io" rel="me noopener" class="iconfont"
      title="email" >
      <svg class="icon" viewBox="0 0 1451 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M664.781909 681.472759 0 97.881301C0 3.997201 71.046997 0 71.046997 0L474.477909 0 961.649408 0 1361.641813 0C1361.641813 0 1432.688811 3.997201 1432.688811 97.881301L771.345323 681.472759C771.345323 681.472759 764.482731 685.154773 753.594283 688.65053L753.594283 688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858L682.561621 688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759L664.781909 681.472759ZM718.063616 811.603883C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633 0 212.052267 0 212.052267L0 942.809523C0 942.809523 0 1024 83.726336 1024L682.532949 1024 753.579947 1024 1348.948139 1024C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523L1432.688811 212.052267C1432.688811 212.052267 893.138176 701.759633 817.019477 767.734955 777.248 802.205449 742.347691 811.03081 718.063616 811.603883L718.063616 811.603883Z"></path>
</svg>

    </a>
  
    <a href="https://stackoverflow.com/users/601555/ilija-eftimov" rel="me noopener" class="iconfont"
      title="stack-overflow"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M809.714286 932.571429l-638.857143 0 0-274.285714-91.428571 0 0 365.714286 821.714286 0 0-365.714286-91.428571 0 0 274.285714zm-538.285714-299.428571l18.857143-89.714286 447.428571 94.285714-18.857143 89.142857zm58.857143-213.714286l38.285714-83.428571 414.285714 193.714286-38.285714 82.857143zm114.857143-203.428571l58.285714-70.285714 350.857143 293.142857-58.285714 70.285714zm226.857143-216l272.571429 366.285714-73.142857 54.857143-272.571429-366.285714zm-410.285714 840.571429l0-90.857143 457.142857 0 0 90.857143-457.142857 0z"></path>
</svg>

    </a>
  
    <a href="https://twitter.com/fteem" rel="me noopener" class="iconfont"
      title="twitter"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1264 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M1229.8616 18.043658c0 0-117.852626 63.135335-164.151872 67.344358-105.225559-164.151872-505.082682-92.598492-437.738325 223.078185C278.622548 312.675223 89.216542 47.506814 89.216542 47.506814s-117.852626 189.406006 75.762402 345.139833C127.097743 396.85567 55.544363 371.601535 55.544363 371.601535S26.081207 535.753407 253.368414 615.724832c-21.045112 29.463156-113.643603 8.418045-113.643603 8.418045s25.254134 143.10676 231.496229 180.987961c-143.10676 130.479693-387.230056 92.598492-370.393967 105.225559 206.242095 189.406006 1119.599946 231.496229 1128.01799-643.98042C1179.353331 249.539887 1263.533778 123.269217 1263.533778 123.269217s-130.479693 37.881201-138.897738 33.672179C1225.652577 98.015083 1229.8616 18.043658 1229.8616 18.043658"></path>
</svg>

    </a>
  
    <a href="https://www.linkedin.com/in/ieftimov/" rel="me noopener" class="iconfont"
      title="linkedin"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="33" height="33">
  <path d="M872.405333 872.618667h-151.637333v-237.610667c0-56.661333-1.152-129.578667-79.018667-129.578667-79.061333 0-91.136 61.653333-91.136 125.397334v241.792H398.976V384h145.664v66.602667h1.962667c20.352-38.4 69.845333-78.933333 143.786666-78.933334 153.642667 0 182.058667 101.12 182.058667 232.746667v268.202667zM227.712 317.141333a87.978667 87.978667 0 0 1-88.021333-88.106666 88.064 88.064 0 1 1 88.021333 88.106666z m76.032 555.477334H151.68V384h152.064v488.618667zM948.266667 0H75.562667C33.792 0 0 33.024 0 73.770667v876.458666C0 991.018667 33.792 1024 75.562667 1024h872.576C989.866667 1024 1024 991.018667 1024 950.229333V73.770667C1024 33.024 989.866667 0 948.138667 0h0.128z"></path>
</svg>

    </a>
  
    <a href="https://github.com/fteem" rel="me noopener" class="iconfont"
      title="github"  target="_blank"
      >
      <svg class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M512 12.672c-282.88 0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667 0-12.16-0.426667-44.373333-0.64-87.04-142.421333 30.890667-172.458667-68.693333-172.458667-68.693333C188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333 0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333 0 0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52 0.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667 0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72 0 68.522667-0.64 123.562667-0.64 140.202666 0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"></path>
</svg>

    </a>


<a href="https://ieftimov.com/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
   
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
      2014 -
    2019
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        Ilija Eftimov
        
      </span></span>

  
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js" integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin="anonymous"></script>






  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  













</body>
</html>
