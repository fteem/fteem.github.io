<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Testing in Go: Fixtures - Ilija Eftimov ⚡️</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="Ilija Eftimov" />
  <meta name="description" content="When I was researching the topic of test fixtures, I couldn&amp;rsquo;t find much about their beginnings. My first search was about the name of the person who coined &amp;ldquo;test fixtures&amp;rdquo;. Unfortunately, that was not a fruitful edeavour. The next logical step was to look for etymology of the phrase &amp;ldquo;test fixtures&amp;rdquo;, but the only search result that made sense was a Wikipedia page on the topic.
Judging by the Wiki page, it&amp;rsquo;s clear that test fixutures as a concept has been heavily popularized by Ruby on Rails." />

  <meta name="keywords" content="Software, Programming, Computer Science, Products" />






<meta name="generator" content="Hugo 0.55.6" />


<link rel="canonical" href="https://ieftimov.com/post/testing-in-go-fixtures/" />



<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.ec807d8b802a40889537c26e014f733206312ea440d42e1f0dabed80918de1ac.css" integrity="sha256-7IB9i4AqQIiVN8JuAU9zMgYxLqRA1C4fDavtgJGN4aw=" media="screen" crossorigin="anonymous">




<link rel="stylesheet" href="/css/overrides.css">

<link rel="stylesheet" href="/css/subscribe.css">


<meta property="og:title" content="Testing in Go: Fixtures" />
<meta property="og:description" content="When I was researching the topic of test fixtures, I couldn&rsquo;t find much about their beginnings. My first search was about the name of the person who coined &ldquo;test fixtures&rdquo;. Unfortunately, that was not a fruitful edeavour. The next logical step was to look for etymology of the phrase &ldquo;test fixtures&rdquo;, but the only search result that made sense was a Wikipedia page on the topic.
Judging by the Wiki page, it&rsquo;s clear that test fixutures as a concept has been heavily popularized by Ruby on Rails." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ieftimov.com/post/testing-in-go-fixtures/" />

<meta property="og:image" content="https://ieftimov.com/cards/testing-in-go-fixtures.png" />
<meta property="article:published_time" content="2019-09-15T00:00:00&#43;00:00"/>
<meta property="article:modified_time" content="2019-09-15T00:00:00&#43;00:00"/>

<meta itemprop="name" content="Testing in Go: Fixtures">
<meta itemprop="description" content="When I was researching the topic of test fixtures, I couldn&rsquo;t find much about their beginnings. My first search was about the name of the person who coined &ldquo;test fixtures&rdquo;. Unfortunately, that was not a fruitful edeavour. The next logical step was to look for etymology of the phrase &ldquo;test fixtures&rdquo;, but the only search result that made sense was a Wikipedia page on the topic.
Judging by the Wiki page, it&rsquo;s clear that test fixutures as a concept has been heavily popularized by Ruby on Rails.">


<meta itemprop="datePublished" content="2019-09-15T00:00:00&#43;00:00" />
<meta itemprop="dateModified" content="2019-09-15T00:00:00&#43;00:00" />
<meta itemprop="wordCount" content="2752">

  <meta itemprop="image" content="https://ieftimov.com/cards/testing-in-go-fixtures.png">



<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://ieftimov.com/cards/testing-in-go-fixtures.png"/>

<meta name="twitter:title" content="Testing in Go: Fixtures"/>
<meta name="twitter:description" content="When I was researching the topic of test fixtures, I couldn&rsquo;t find much about their beginnings. My first search was about the name of the person who coined &ldquo;test fixtures&rdquo;. Unfortunately, that was not a fruitful edeavour. The next logical step was to look for etymology of the phrase &ldquo;test fixtures&rdquo;, but the only search result that made sense was a Wikipedia page on the topic.
Judging by the Wiki page, it&rsquo;s clear that test fixutures as a concept has been heavily popularized by Ruby on Rails."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-11264459-2', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>



</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Ilija Eftimov ⚡️</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://ieftimov.com/">Home</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://ieftimov.com/testing-in-go/">Testing in Go</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://ieftimov.com/post/">Archives</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://ieftimov.com/about/">About</a>
          
        
      </li>
    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      Ilija Eftimov ⚡️
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://ieftimov.com/">Home</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://ieftimov.com/testing-in-go/">Testing in Go</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://ieftimov.com/post/">Archives</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://ieftimov.com/about/">About</a>
          

        

      </li>
    
    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">Testing in Go: Fixtures</h1>
      
      <div class="post-meta">
        <time datetime="2019-09-16" class="post-time">
          16-09-2019
        </time>
        <div class="post-category">
            <a href="https://ieftimov.com/categories/go/"> go </a>
            <a href="https://ieftimov.com/categories/testing-in-go/"> testing-in-go </a>
            
          </div>
        

        
        

        
        
      </div>
    </header>

    
    

    
    <div class="post-content">
      

<p><img src="/testing-in-go-fixtures/sculpting.png" alt="" /></p>

<p>When I was researching the topic of test fixtures, I couldn&rsquo;t find much about
their beginnings. My first search was about the name of the person who coined
&ldquo;test fixtures&rdquo;. Unfortunately, that was not a fruitful edeavour. The next
logical step was to look for etymology of the phrase &ldquo;test fixtures&rdquo;, but the
only search result that made sense was a <a href="https://en.wikipedia.org/wiki/Test_fixture">Wikipedia
page</a> on the topic.</p>

<p>Judging by the Wiki page, it&rsquo;s clear that test fixutures as a concept has been
heavily popularized by Ruby on Rails. Likely though, folks that have been in
the industry for a longer time will say that the idea of test fixutres is older
than Rails itself. What I feel is more important in this discussion is putting
the historical facts aside and who/what is to blame to the popularization of
the concept. Instead, we should focus on understanding the motivation behind it
and how we can improve its implementations.</p>

<p>Test fixtures contribute to setting up the system for the testing process by
providing it with all the necessary data for initialization. This is done to
satisfy any preconditions there may be for the code under test. For example,
code that we want to test might require some configuration before it can be
executed or tested. This means that every time we have to test such code, we
would have to recreate these preconditions to run the code.</p>

<p>More annoyingly, if the configuration of the tested code would change, we would
have to update the structure of the configuration everywhere where we test that
particular code.</p>

<p>To avoid such scenarios, we use fixtures. Fixtures allow us to <em>reliably</em> and
<em>repeatably</em> create the state that our code relies on, without worrying about
the details. If the required state for the code under test would change, we
need only to tweak a fixture, instead of scouring all of our tests for the code
that needs to be changed.</p>

<p>I know, I know. My introduction made you dizzy from all the praise of fixtures.
Let&rsquo;s stop the sales pitch here and move on to see how simple fixtures can be
and how you can master them as another tool in your testing toolbelt.</p>

<p><img src="/testing-in-go-fixtures/progress_tracking.png" alt="" /></p>

<h2 id="making-a-simple-gradebook">Making a simple gradebook</h2>

<p>As always, talking about code without having code to talk about is not great.
Let&rsquo;s introduce an example representing a gradebook that will be populated from
a CSV file, using a builder function. After, we will create a lookup method per
column and add some tests for both functions.</p>

<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">Record</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">student</span> <span class="kt">string</span>
	<span class="nx">subject</span> <span class="kt">string</span>
	<span class="nx">grade</span>   <span class="kt">string</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">Gradebook</span> <span class="p">[]</span><span class="nx">Record</span></code></pre></td></tr></table>
</div>
</div>

<p>The <code>Record</code> type will have three attributes: <code>student</code>, <code>subject</code> and <code>grade</code>,
all three of type <code>string</code>. The <code>Gradebook</code> type is just a slice of <code>Record</code>s,
nothing more.</p>

<p>Next, let&rsquo;s create a builder function for a <code>Gradebook</code>. We want the function
to be simple - receive a path to a CSV file as argument and return a
<code>Gradebook</code> with all of the records parsed from the CSV.</p>

<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">NewGradebook</span><span class="p">(</span><span class="nx">csvPath</span> <span class="kt">string</span><span class="p">)</span> <span class="p">(</span><span class="nx">Gradebook</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">gradebook</span> <span class="nx">Gradebook</span>
	<span class="nx">csvFile</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">os</span><span class="p">.</span><span class="nf">Open</span><span class="p">(</span><span class="nx">csvPath</span><span class="p">)</span>
	<span class="nx">reader</span> <span class="o">:=</span> <span class="nx">csv</span><span class="p">.</span><span class="nf">NewReader</span><span class="p">(</span><span class="nx">bufio</span><span class="p">.</span><span class="nf">NewReader</span><span class="p">(</span><span class="nx">csvFile</span><span class="p">))</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="k">return</span> <span class="nx">gradebook</span><span class="p">,</span> <span class="nx">err</span>
	<span class="p">}</span>

	<span class="k">for</span> <span class="p">{</span>
		<span class="nx">line</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">reader</span><span class="p">.</span><span class="nf">Read</span><span class="p">()</span>

		<span class="k">if</span> <span class="nx">err</span> <span class="o">==</span> <span class="nx">io</span><span class="p">.</span><span class="nx">EOF</span> <span class="p">{</span>
			<span class="k">break</span>
		<span class="p">}</span>

		<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
			<span class="k">return</span> <span class="nx">gradebook</span><span class="p">,</span> <span class="nx">err</span>
		<span class="p">}</span>

		<span class="nx">gradebook</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">gradebook</span><span class="p">,</span> <span class="nx">Record</span><span class="p">{</span>
			<span class="nx">student</span><span class="p">:</span> <span class="nx">line</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
			<span class="nx">subject</span><span class="p">:</span> <span class="nx">line</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
			<span class="nx">grade</span><span class="p">:</span>   <span class="nx">line</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
		<span class="p">})</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="nx">gradebook</span><span class="p">,</span> <span class="kc">nil</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>

<p>Although a bit bloated, the function actually doesn&rsquo;t do much. It opens a file
descriptor at the path, wraps it in a reader and reads it line by line. For
each line it reads, it will create a new <code>Record</code> struct and <code>append</code> it to the
collection of <code>Record</code>s, <code>gradebook</code>. After parsing the whole file it will exit
the loop and return the gradebook.</p>

<p>Of course, in true Go fashion, in every step of the reading and parsing the
file we gracefully handle the errors. If in any scenario there&rsquo;s an error, the
function will return the error along with the empty <code>gradebook</code>.</p>

<p>The last piece of the puzzle is the function which will find all records in the
gradebook for a particular student:</p>

<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="p">(</span><span class="nx">gb</span> <span class="o">*</span><span class="nx">Gradebook</span><span class="p">)</span> <span class="nf">FindByStudent</span><span class="p">(</span><span class="nx">student</span> <span class="kt">string</span><span class="p">)</span> <span class="p">[]</span><span class="nx">Record</span> <span class="p">{</span>
	<span class="kd">var</span> <span class="nx">records</span> <span class="p">[]</span><span class="nx">Record</span>
	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">record</span> <span class="o">:=</span> <span class="k">range</span> <span class="o">*</span><span class="nx">gb</span> <span class="p">{</span>
		<span class="k">if</span> <span class="nx">student</span> <span class="o">==</span> <span class="nx">record</span><span class="p">.</span><span class="nx">student</span> <span class="p">{</span>
			<span class="nx">records</span> <span class="p">=</span> <span class="nb">append</span><span class="p">(</span><span class="nx">records</span><span class="p">,</span> <span class="nx">record</span><span class="p">)</span>
		<span class="p">}</span>
	<span class="p">}</span>
	<span class="k">return</span> <span class="nx">records</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>

<p>The <code>FindByStudent</code> function takes the <code>student</code> name as argument. Then, it
will loop through all the records of the <code>Gradebook</code> and will collect all of
the records where the name of the student matches. Lastly, it will return the
records found for the particular <code>student</code> name.</p>

<p>To manually test the code, let&rsquo;s create a small CSV file, called <code>grades.csv</code>:</p>

<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-csv" data-lang="csv"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-csv" data-lang="csv">Jane,Chemistry,A
John,Biology,A
Jane,Algebra,B
Jane,Biology,A
John,Algebra,B
John,Chemistry,C</code></pre></td></tr></table>
</div>
</div>

<p>In the <code>main</code> function of the file we will parse it and then get all of Jane&rsquo;s
grades:</p>

<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">grades</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nf">NewGradebook</span><span class="p">(</span><span class="s">&#34;grades.csv&#34;</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">fmt</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;Error opening file: %v \n&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>
	<span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;%+v\n&#34;</span><span class="p">,</span> <span class="nx">grades</span><span class="p">.</span><span class="nf">FindByStudent</span><span class="p">(</span><span class="s">&#34;Jane&#34;</span><span class="p">))</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>

<p>The output of the function will be:</p>

<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ go run grades.go
<span class="o">[{</span>student:Jane subject:Chemistry grade:A<span class="o">}</span> <span class="o">{</span>student:Jane subject:Algebra grade:B<span class="o">}</span> <span class="o">{</span>student:Jane subject:Biology grade:A<span class="o">}]</span></code></pre></div>

<p>From the output it is clear what are Jane&rsquo;s grades in the gradebook we have
created. Having these two types and two functions is good enough to explain how
we can use fixtures in the testing we&rsquo;re about to do.</p>

<h2 id="testing-the-builder-function">Testing the builder function</h2>

<p>Whenever we need to test a piece of code, we have to identify what are its key
components. In other words, we have to understand what are the important steps
that that code takes to accomplish its mission. For example, to test the
<code>NewGradebook</code> function an overly simplified breakdown of its doings would look
like:</p>

<ol>
<li>Open a CSV file for reading</li>
<li>Read through each of the lines</li>
<li>When reading through each line, create a new struct from the data</li>
<li>Put the new struct in the collection of structs</li>
<li>Return the collection of structs</li>
</ol>

<p>Now, there&rsquo;s no need to test if opening a file and parsing it works - we trust
Go to take care of that. There are two things we are interested at: will our
function handle invalid CSV files gracefully, and will it create a <code>Gradebook</code>
that what we expect from a valid file?</p>

<p>To test the error handling, we will introduce a test function:</p>

<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">TestNewGradebook_ErrorHandling</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">cases</span> <span class="o">:=</span> <span class="p">[]</span><span class="kd">struct</span> <span class="p">{</span>
		<span class="nx">fixture</span>   <span class="kt">string</span>
		<span class="nx">returnErr</span> <span class="kt">bool</span>
		<span class="nx">name</span>      <span class="kt">string</span>
	<span class="p">}{</span>
		<span class="p">{</span>
			<span class="nx">fixture</span><span class="p">:</span>   <span class="s">&#34;testdata/grades/empty.csv&#34;</span><span class="p">,</span>
			<span class="nx">returnErr</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
			<span class="nx">name</span><span class="p">:</span>      <span class="s">&#34;EmptyFile&#34;</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">{</span>
			<span class="nx">fixture</span><span class="p">:</span>   <span class="s">&#34;testdata/grades/invalid.csv&#34;</span><span class="p">,</span>
			<span class="nx">returnErr</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
			<span class="nx">name</span><span class="p">:</span>      <span class="s">&#34;InvalidFile&#34;</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">{</span>
			<span class="nx">fixture</span><span class="p">:</span>   <span class="s">&#34;testdata/grades/nonexisting.csv&#34;</span><span class="p">,</span>
			<span class="nx">returnErr</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
			<span class="nx">name</span><span class="p">:</span>      <span class="s">&#34;NonexistingFile&#34;</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">{</span>
			<span class="nx">fixture</span><span class="p">:</span>   <span class="s">&#34;testdata/grades/valid.csv&#34;</span><span class="p">,</span>
			<span class="nx">returnErr</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
			<span class="nx">name</span><span class="p">:</span>      <span class="s">&#34;ValidFile&#34;</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">}</span>

	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">tc</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">cases</span> <span class="p">{</span>
		<span class="nx">t</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="nx">tc</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">_</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nf">NewGradebook</span><span class="p">(</span><span class="nx">tc</span><span class="p">.</span><span class="nx">fixture</span><span class="p">)</span>
			<span class="nx">returnedErr</span> <span class="o">:=</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span>

			<span class="k">if</span> <span class="nx">returnedErr</span> <span class="o">!=</span> <span class="nx">tc</span><span class="p">.</span><span class="nx">returnErr</span> <span class="p">{</span>
				<span class="nx">t</span><span class="p">.</span><span class="nf">Fatalf</span><span class="p">(</span><span class="s">&#34;Expected returnErr: %v, got: %v&#34;</span><span class="p">,</span> <span class="nx">tc</span><span class="p">.</span><span class="nx">returnErr</span><span class="p">,</span> <span class="nx">returnedErr</span><span class="p">)</span>
			<span class="p">}</span>
		<span class="p">})</span>
	<span class="p">}</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>

<p>To run these test cases, we will need three accompanying CSV files, in the root
of our project: <code>empty.csv</code>, <code>invalid.csv</code> and <code>valid.csv</code>. An empty CSV, an
invalid CSV and a valid CSV file, respectively.</p>

<p>Each of these files are actually fixtures - files that go together with the
test suite of this project, enabling us to assume the state of the system that
we run our tests on. Now, the content of these files should be obvious from the
file names. The <code>invalid.csv</code> will contain just text, not in a CSV format
though. The <code>empty.csv</code> will be just an empty file, while the <code>valid.csv</code> file
will be a real CSV that our function can parse and use. Lastly, the
<code>nonexisting.csv</code> actually will not be a file – we want our tests to fail when
this path is passed to the <code>NewGradebook</code> function. And this is the first thing
we need to remember about fixtures: we can (and should) create as many fixture
files as it makes sense, but not more than that.</p>

<p>Fixtures should always be placed in a directory (in our example <code>testdata</code>) in
the root of our project. In fact, we should always place our fixtures in the
<code>testdata</code> directory at the root of our project because <code>go test</code> will ignore
that path when building our packages. Quoting the ouput of <code>go help test</code>:</p>

<blockquote>
<p>The go tool will ignore a directory named &ldquo;testdata&rdquo;, making it available
to hold ancillary data needed by the tests.</p>
</blockquote>

<p>Placing it in the root of the directory works great because when we run <code>go
test</code>, for each package in the directory tree, the test binary will be executed
with its working directory set to the source directory of the package under
test. (Read more about it in <a href="https://dave.cheney.net/2016/05/10/test-fixtures-in-go">Dave Cheney&rsquo;s
article</a> on the topic.)</p>

<p>In the example above, we used two nested directories: <code>testdata</code> and <code>grades</code>.
This is because we want to logically group our fixtures and leave the room for
other kind of fixtures within the same project, if need be. Software is built
to grow, so why not set some sane defaults from the start.</p>

<p><img src="/testing-in-go-fixtures/exams.png" alt="" /></p>

<h2 id="testing-the-findbystudent-function">Testing the <code>FindByStudent</code> function</h2>

<p>The functionality of the <code>FindByStudent</code> function is a linear search though a
<code>Gradebook</code> type (which is a slice of <code>Record</code>s). It compares the student name
from the argument and the name of each of the records in the <code>Gradebook</code>. When
a match is found, the matching record is added to the collection <code>records</code>.</p>

<p>Testing this function is can be based on couple of state assumptions. The first
one is that to test <code>FindByStudent</code> we have to have a <code>Gradebook</code> available.
The <code>Gradebook</code> can be in three states: empty, without a matching <code>Record</code> and
with a <code>Record</code> that matches the student name from the argument. If we would
flip this on its head, it would mean that to test the function we will need
three different <code>Gradebooks</code>: one empty, one without a matching <code>Record</code>, and
one with a matching <code>Record</code>.</p>

<p>To be able to create such <code>Gradebook</code>s we can take two different approaches:
define the <code>Gradebook</code>s directly in the test, or use a fixture file. Using the
first approach might be more preferred by some, but for the purpose of seeing
how we can use fixtures we will use the second approach. While we already have
the fixture files from the previous test, we can use them in the test of the
<code>FindByStudent</code> function:</p>

<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">TestFindByStudent</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">cases</span> <span class="o">:=</span> <span class="p">[]</span><span class="kd">struct</span> <span class="p">{</span>
		<span class="nx">fixture</span> <span class="kt">string</span>
		<span class="nx">student</span> <span class="kt">string</span>
		<span class="nx">want</span>    <span class="nx">Gradebook</span>
		<span class="nx">name</span>    <span class="kt">string</span>
	<span class="p">}{</span>
		<span class="p">{</span>
			<span class="nx">fixture</span><span class="p">:</span> <span class="s">&#34;fixtures/grades/empty.csv&#34;</span><span class="p">,</span>
			<span class="nx">student</span><span class="p">:</span> <span class="s">&#34;Jane&#34;</span><span class="p">,</span>
			<span class="nx">want</span><span class="p">:</span>    <span class="nx">Gradebook</span><span class="p">{},</span>
			<span class="nx">name</span><span class="p">:</span>    <span class="s">&#34;EmptyFixture&#34;</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">{</span>
			<span class="nx">fixture</span><span class="p">:</span> <span class="s">&#34;fixtures/grades/valid.csv&#34;</span><span class="p">,</span>
			<span class="nx">student</span><span class="p">:</span> <span class="s">&#34;Jane&#34;</span><span class="p">,</span>
			<span class="nx">want</span><span class="p">:</span> <span class="nx">Gradebook</span><span class="p">{</span>
				<span class="nx">Record</span><span class="p">{</span>
					<span class="nx">student</span><span class="p">:</span> <span class="s">&#34;Jane&#34;</span><span class="p">,</span>
					<span class="nx">subject</span><span class="p">:</span> <span class="s">&#34;Chemistry&#34;</span><span class="p">,</span>
					<span class="nx">grade</span><span class="p">:</span>   <span class="s">&#34;A&#34;</span><span class="p">,</span>
				<span class="p">},</span>
				<span class="nx">Record</span><span class="p">{</span>
					<span class="nx">student</span><span class="p">:</span> <span class="s">&#34;Jane&#34;</span><span class="p">,</span>
					<span class="nx">subject</span><span class="p">:</span> <span class="s">&#34;Algebra&#34;</span><span class="p">,</span>
					<span class="nx">grade</span><span class="p">:</span>   <span class="s">&#34;A&#34;</span><span class="p">,</span>
				<span class="p">},</span>
			<span class="p">},</span>
                        <span class="nx">name</span><span class="p">:</span> <span class="s">&#34;ValidFixtures&#34;</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">}</span>

	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">tc</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">cases</span> <span class="p">{</span>
		<span class="nx">t</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="nx">tc</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">gradebook</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nf">NewGradebook</span><span class="p">(</span><span class="nx">tc</span><span class="p">.</span><span class="nx">fixture</span><span class="p">)</span>
			<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
				<span class="nx">t</span><span class="p">.</span><span class="nf">Fatalf</span><span class="p">(</span><span class="s">&#34;Cannot create gradebook: %v&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
			<span class="p">}</span>

			<span class="nx">got</span> <span class="o">:=</span> <span class="nx">gradebook</span><span class="p">.</span><span class="nf">FindByStudent</span><span class="p">(</span><span class="nx">tc</span><span class="p">.</span><span class="nx">student</span><span class="p">)</span>
			<span class="k">for</span> <span class="nx">idx</span><span class="p">,</span> <span class="nx">gotGrade</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">got</span> <span class="p">{</span>
				<span class="nx">wantedGrade</span> <span class="o">:=</span> <span class="nx">tc</span><span class="p">.</span><span class="nx">want</span><span class="p">[</span><span class="nx">idx</span><span class="p">]</span>
				<span class="k">if</span> <span class="nx">gotGrade</span> <span class="o">!=</span> <span class="nx">wantedGrade</span> <span class="p">{</span>
					<span class="nx">t</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;Expected: %v, got: %v&#34;</span><span class="p">,</span> <span class="nx">wantedGrade</span><span class="p">,</span> <span class="nx">gotGrade</span><span class="p">)</span>
				<span class="p">}</span>
			<span class="p">}</span>

		<span class="p">})</span>
	<span class="p">}</span>

<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>

<p>In this test function we have defined two test cases: the first one uses the
<code>empty.csv</code> fixture, while the other uses <code>valid.csv</code> fixture. By looking at
the test cases it is clear what we expect to get from each one. When working
with the empty CSV we expect to get an empty gradebook - no grades, no gradebook.
But, when working with the <code>valid.csv</code> we expect to get a <code>Gradebook</code> that will
have all of the grades for the student specified in that particular test case,
in this case <code>Jane</code>.</p>

<p>The test function does not have any magic. It merely builds a <code>Gradebook</code> using
the <code>NewGradebook</code> function and the fixture file. Then, we invoke the
<code>FindByStudent</code> function on the <code>Gradebook</code> and we make srue that all of the
grades that we got are the ones we expected.</p>

<p>If we run the test, we&rsquo;ll get an output looking like this:</p>

<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ go <span class="nb">test</span> -v -run<span class="o">=</span><span class="nv">TestFindByStudent</span>
<span class="o">===</span> RUN   <span class="nv">TestFindByStudent</span>
<span class="o">===</span> RUN   TestFindByStudent/EmptyFixture
<span class="o">===</span> RUN   TestFindByStudent/ValidFixture
--- PASS: TestFindByStudent <span class="o">(</span><span class="m">0</span>.00s<span class="o">)</span>
    --- PASS: TestFindByStudent/EmptyFixture <span class="o">(</span><span class="m">0</span>.00s<span class="o">)</span>
    --- PASS: TestFindByStudent/ValidFixture <span class="o">(</span><span class="m">0</span>.00s<span class="o">)</span>
PASS
ok  	_/Users/Ilija/Documents/fixtures	<span class="m">0</span>.004s</code></pre></div>

<p>The tests pass - building the <code>Gradebook</code>s with the fixtures worked well, so we
could <code>range</code> over the test cases and test our expectations.</p>

<p><img src="/testing-in-go-fixtures/clean_up.png" alt="" /></p>

<h2 id="tidying-up-our-tests">Tidying up our tests</h2>

<p>Looking at both test functions that we wrote, at the beginning of the <code>t.Run</code>
blocks we can notice that we have to create a new <code>Gradebook</code> by using the
<code>NewGradebook</code> builder function. In essence, this is the test setup in these
two test functions - we have to have an instance of the <code>Gradebook</code> type to run
our tests.</p>

<p>When we use fixtures the failure to use a fixture can mean that the tests
cannot be run - they depend on the fixture files being available and usable. In
case where the fixture renders to be unusable, we have to stop the execution of
the tests futher and bail out with an error.</p>

<p>For such reasons it is a quick win to extract a test helper that can be used in
the test setup. By doing that, we all of the error handling for loading the
fixture and test setup can be extracted outside of the tests functions. Let&rsquo;s
create a small function that will do just that:</p>

<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">buildGradebook</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">,</span> <span class="nx">path</span> <span class="kt">string</span><span class="p">)</span> <span class="o">*</span><span class="nx">Gradebook</span> <span class="p">{</span>
	<span class="nx">gradebook</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nf">NewGradebook</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span>
	<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
		<span class="nx">t</span><span class="p">.</span><span class="nf">Fatalf</span><span class="p">(</span><span class="s">&#34;Cannot create Gradebook: %v&#34;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
	<span class="p">}</span>

	<span class="k">return</span> <span class="o">&amp;</span><span class="nx">gradebook</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>

<p>The <code>buildGradebook</code> is simply a wrapper around the call to <code>NewGradebook</code>,
with one key difference: if a <code>Gradebook</code> cannot be produced using
<code>NewGradebook</code> it will actually mark the as failed. This is done using
<code>t.Fatalf</code>, where instead of returning an empty <code>Gradebook</code> we immediately make
the test fail. In other words: being unable to create a <code>Gradebook</code> is an
unrecoverable error. A nice sideffect of this is that the caller function of
<code>buildGradebook</code> does not need to handle the error that might be returned from
<code>NewGradebook</code> - that will all be handled by <code>buildGradebook</code>.</p>

<p>If we revisit our <code>TestFindByStudent</code> function now, it will not have changed
much. Still, it will contain the improvements coming from the <code>buildGradebook</code>
function:</p>

<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-go" data-lang="go"><span class="kd">func</span> <span class="nf">TestFindByStudent</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">cases</span> <span class="o">:=</span> <span class="p">[]</span><span class="kd">struct</span> <span class="p">{</span>
		<span class="nx">fixture</span> <span class="kt">string</span>
		<span class="nx">student</span> <span class="kt">string</span>
		<span class="nx">want</span>    <span class="nx">Gradebook</span>
		<span class="nx">name</span>    <span class="kt">string</span>
	<span class="p">}{</span>
		<span class="p">{</span>
			<span class="nx">fixture</span><span class="p">:</span> <span class="s">&#34;fixtures/grades/empty.csv&#34;</span><span class="p">,</span>
			<span class="nx">student</span><span class="p">:</span> <span class="s">&#34;Jane&#34;</span><span class="p">,</span>
			<span class="nx">want</span><span class="p">:</span>    <span class="nx">Gradebook</span><span class="p">{},</span>
			<span class="nx">name</span><span class="p">:</span>    <span class="s">&#34;EmptyFixture&#34;</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="p">{</span> <span class="nx">fixture</span><span class="p">:</span> <span class="s">&#34;fixtures/grades/valid.csv&#34;</span><span class="p">,</span>
			<span class="nx">student</span><span class="p">:</span> <span class="s">&#34;Jane&#34;</span><span class="p">,</span>
			<span class="nx">want</span><span class="p">:</span> <span class="nx">Gradebook</span><span class="p">{</span>
				<span class="nx">Record</span><span class="p">{</span>
					<span class="nx">student</span><span class="p">:</span> <span class="s">&#34;Jane&#34;</span><span class="p">,</span>
					<span class="nx">subject</span><span class="p">:</span> <span class="s">&#34;Chemistry&#34;</span><span class="p">,</span>
					<span class="nx">grade</span><span class="p">:</span>   <span class="s">&#34;A&#34;</span><span class="p">,</span>
				<span class="p">},</span>
				<span class="nx">Record</span><span class="p">{</span>
					<span class="nx">student</span><span class="p">:</span> <span class="s">&#34;Jane&#34;</span><span class="p">,</span>
					<span class="nx">subject</span><span class="p">:</span> <span class="s">&#34;Algebra&#34;</span><span class="p">,</span>
					<span class="nx">grade</span><span class="p">:</span>   <span class="s">&#34;A&#34;</span><span class="p">,</span>
				<span class="p">},</span>
			<span class="p">},</span>
			<span class="nx">name</span><span class="p">:</span> <span class="s">&#34;ValidFixture&#34;</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">}</span>

	<span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">tc</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">cases</span> <span class="p">{</span>
		<span class="nx">t</span><span class="p">.</span><span class="nf">Run</span><span class="p">(</span><span class="nx">tc</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="kd">func</span><span class="p">(</span><span class="nx">t</span> <span class="o">*</span><span class="nx">testing</span><span class="p">.</span><span class="nx">T</span><span class="p">)</span> <span class="p">{</span>
			<span class="nx">gradebook</span> <span class="o">:=</span> <span class="nf">buildGradebook</span><span class="p">(</span><span class="nx">t</span><span class="p">,</span> <span class="nx">tc</span><span class="p">.</span><span class="nx">fixture</span><span class="p">)</span>

			<span class="nx">got</span> <span class="o">:=</span> <span class="nx">gradebook</span><span class="p">.</span><span class="nf">FindByStudent</span><span class="p">(</span><span class="nx">tc</span><span class="p">.</span><span class="nx">student</span><span class="p">)</span>
			<span class="k">for</span> <span class="nx">idx</span><span class="p">,</span> <span class="nx">gotGrade</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">got</span> <span class="p">{</span>
				<span class="nx">wantedGrade</span> <span class="o">:=</span> <span class="nx">tc</span><span class="p">.</span><span class="nx">want</span><span class="p">[</span><span class="nx">idx</span><span class="p">]</span>
				<span class="k">if</span> <span class="nx">gotGrade</span> <span class="o">!=</span> <span class="nx">wantedGrade</span> <span class="p">{</span>
					<span class="nx">t</span><span class="p">.</span><span class="nf">Errorf</span><span class="p">(</span><span class="s">&#34;Expected: %v, got: %v&#34;</span><span class="p">,</span> <span class="nx">wantedGrade</span><span class="p">,</span> <span class="nx">gotGrade</span><span class="p">)</span>
				<span class="p">}</span>
			<span class="p">}</span>

		<span class="p">})</span>
	<span class="p">}</span>
<span class="p">}</span></code></pre></td></tr></table>
</div>
</div>

<p>If we would remove any of the fixture files, we will see how the test will be
marked as failed due to the <code>t.Fatal</code> invocation:</p>

<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">$ rm testdata/grades/valid.csv <span class="c1"># We remove the fixture</span>

$ go <span class="nb">test</span> ./... -count<span class="o">=</span><span class="m">1</span> -v -run<span class="o">=</span><span class="nv">TestFindByStudent</span>
<span class="o">===</span> RUN   <span class="nv">TestFindByStudent</span>
<span class="o">===</span> RUN   TestFindByStudent/ValidFixture
<span class="o">===</span> RUN   TestFindByStudent/EmptyFixture
--- FAIL: TestFindByStudent <span class="o">(</span><span class="m">0</span>.00s<span class="o">)</span>
    --- FAIL: TestFindByStudent/ValidFixture <span class="o">(</span><span class="m">0</span>.00s<span class="o">)</span>
        grades_test.go Cannot create Gradebook: open testdata/grades/valid.csv: no such file or directory
    --- PASS: TestFindByStudent/EmptyFixture <span class="o">(</span><span class="m">0</span>.00s<span class="o">)</span>
FAIL
FAIL	_/Users/Ilija/Documents/fixtures	<span class="m">0</span>.004s</code></pre></div>

<p>By having another function that takes care of building the <code>Gradebook</code> we&rsquo;re
able to offload the complexity of the missing fixtures outside of the tests
themselves. While these concepts are simple, they&rsquo;re powerful as they lead to
cleaner tests and functions that are local to the test and easy to maintain.</p>

    </div>

    
    


    
    

    <footer class="post-footer">
      

      
      <nav class="post-nav">
        
        
          <a class="next" href="/post/testing-in-go-subtests/">
            <span class="next-text nav-default">Testing in Go: Subtests</span>
            <span class="prev-text nav-mobile">Next</span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  

  
  

  

  
  

  

  

  <div class="disqus-comment">
  <div class="disqus-button" id="load_disqus" onclick="load_disqus()">
    Show Disqus Comments
  </div>
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_config = function () {
      this.page.url = "https://ieftimov.com/post/testing-in-go-fixtures/";
    };
    function load_disqus() {
      
      
      if (window.location.hostname === 'localhost') return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'eftimov';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);

      $('#load_disqus').remove();
    };
  </script>
  <noscript>Please enable JavaScript to view the
    <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
  </noscript>
  
  </div>

    

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="icon-links">
  
  
    <a href="https://stackoverflow.com/users/601555/ilija-eftimov" rel="me noopener" class="iconfont"
      title="stack-overflow"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M809.714286 932.571429l-638.857143 0 0-274.285714-91.428571 0 0 365.714286 821.714286 0 0-365.714286-91.428571 0 0 274.285714zm-538.285714-299.428571l18.857143-89.714286 447.428571 94.285714-18.857143 89.142857zm58.857143-213.714286l38.285714-83.428571 414.285714 193.714286-38.285714 82.857143zm114.857143-203.428571l58.285714-70.285714 350.857143 293.142857-58.285714 70.285714zm226.857143-216l272.571429 366.285714-73.142857 54.857143-272.571429-366.285714zm-410.285714 840.571429l0-90.857143 457.142857 0 0 90.857143-457.142857 0z"></path>
</svg>

    </a>
  
    <a href="https://twitter.com/fteem" rel="me noopener" class="iconfont"
      title="twitter"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1264 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M1229.8616 18.043658c0 0-117.852626 63.135335-164.151872 67.344358-105.225559-164.151872-505.082682-92.598492-437.738325 223.078185C278.622548 312.675223 89.216542 47.506814 89.216542 47.506814s-117.852626 189.406006 75.762402 345.139833C127.097743 396.85567 55.544363 371.601535 55.544363 371.601535S26.081207 535.753407 253.368414 615.724832c-21.045112 29.463156-113.643603 8.418045-113.643603 8.418045s25.254134 143.10676 231.496229 180.987961c-143.10676 130.479693-387.230056 92.598492-370.393967 105.225559 206.242095 189.406006 1119.599946 231.496229 1128.01799-643.98042C1179.353331 249.539887 1263.533778 123.269217 1263.533778 123.269217s-130.479693 37.881201-138.897738 33.672179C1225.652577 98.015083 1229.8616 18.043658 1229.8616 18.043658"></path>
</svg>

    </a>
  
    <a href="https://www.linkedin.com/in/ieftimov/" rel="me noopener" class="iconfont"
      title="linkedin"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="33" height="33">
  <path d="M872.405333 872.618667h-151.637333v-237.610667c0-56.661333-1.152-129.578667-79.018667-129.578667-79.061333 0-91.136 61.653333-91.136 125.397334v241.792H398.976V384h145.664v66.602667h1.962667c20.352-38.4 69.845333-78.933333 143.786666-78.933334 153.642667 0 182.058667 101.12 182.058667 232.746667v268.202667zM227.712 317.141333a87.978667 87.978667 0 0 1-88.021333-88.106666 88.064 88.064 0 1 1 88.021333 88.106666z m76.032 555.477334H151.68V384h152.064v488.618667zM948.266667 0H75.562667C33.792 0 0 33.024 0 73.770667v876.458666C0 991.018667 33.792 1024 75.562667 1024h872.576C989.866667 1024 1024 991.018667 1024 950.229333V73.770667C1024 33.024 989.866667 0 948.138667 0h0.128z"></path>
</svg>

    </a>
  
    <a href="https://github.com/fteem" rel="me noopener" class="iconfont"
      title="github"  target="_blank"
      >
      <svg class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M512 12.672c-282.88 0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667 0-12.16-0.426667-44.373333-0.64-87.04-142.421333 30.890667-172.458667-68.693333-172.458667-68.693333C188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333 0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333 0 0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52 0.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667 0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72 0 68.522667-0.64 123.562667-0.64 140.202666 0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"></path>
</svg>

    </a>
  
    <a href="ieftimovcom@gmail.com" rel="me noopener" class="iconfont"
      title="email"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1451 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M664.781909 681.472759 0 97.881301C0 3.997201 71.046997 0 71.046997 0L474.477909 0 961.649408 0 1361.641813 0C1361.641813 0 1432.688811 3.997201 1432.688811 97.881301L771.345323 681.472759C771.345323 681.472759 764.482731 685.154773 753.594283 688.65053L753.594283 688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858L682.561621 688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759L664.781909 681.472759ZM718.063616 811.603883C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633 0 212.052267 0 212.052267L0 942.809523C0 942.809523 0 1024 83.726336 1024L682.532949 1024 753.579947 1024 1348.948139 1024C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523L1432.688811 212.052267C1432.688811 212.052267 893.138176 701.759633 817.019477 767.734955 777.248 802.205449 742.347691 811.03081 718.063616 811.603883L718.063616 811.603883Z"></path>
</svg>

    </a>


<a href="https://ieftimov.com/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
   
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
      2014 -
    2019
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        Ilija Eftimov
        
      </span></span>

  
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js" integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin="anonymous"></script>






  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  













</body>
</html>
