<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Testing in Go: Golden Files | Ilija Eftimov ⚡️</title><meta name=keywords content><meta name=description content="Hardcoding the expected values in an assertion is a straightforward approach in testing. Most of the time, we know the expected output of the unit under test, so simply adding the raw value to the assertion works well.
Things can get tricky when we are testing a unit whose output is cumbersome to hardcode. The straightforward remedy is to extract this cumbersome value to a file that we can then read and compare the output of the unit under test to the output of the file."><meta name=author content="Ilija"><link rel=canonical href=https://ieftimov.com/post/testing-in-go-golden-files/><link href=/assets/css/stylesheet.min.css rel="preload stylesheet" as=style><link rel=icon href=https://ieftimov.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://ieftimov.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://ieftimov.com/favicon-32x32.png><link rel=apple-touch-icon href=https://ieftimov.com/apple-touch-icon.png><link rel=mask-icon href=https://ieftimov.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.83.1"><script async defer data-domain=ieftimov.com src=https://plausible.io/js/plausible.js></script><link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel=stylesheet><meta property="og:title" content="Testing in Go: Golden Files"><meta property="og:description" content="Hardcoding the expected values in an assertion is a straightforward approach in testing. Most of the time, we know the expected output of the unit under test, so simply adding the raw value to the assertion works well.
Things can get tricky when we are testing a unit whose output is cumbersome to hardcode. The straightforward remedy is to extract this cumbersome value to a file that we can then read and compare the output of the unit under test to the output of the file."><meta property="og:type" content="article"><meta property="og:url" content="https://ieftimov.com/post/testing-in-go-golden-files/"><meta property="og:image" content="https://ieftimov.com/cards/testing-in-go-golden-files.png"><meta property="article:published_time" content="2020-02-02T00:00:00+00:00"><meta property="article:modified_time" content="2020-02-02T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://ieftimov.com/cards/testing-in-go-golden-files.png"><meta name=twitter:title content="Testing in Go: Golden Files"><meta name=twitter:description content="Hardcoding the expected values in an assertion is a straightforward approach in testing. Most of the time, we know the expected output of the unit under test, so simply adding the raw value to the assertion works well.
Things can get tricky when we are testing a unit whose output is cumbersome to hardcode. The straightforward remedy is to extract this cumbersome value to a file that we can then read and compare the output of the unit under test to the output of the file."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://ieftimov.com/posts/"},{"@type":"ListItem","position":2,"name":"Testing in Go: Golden Files","item":"https://ieftimov.com/post/testing-in-go-golden-files/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Testing in Go: Golden Files","name":"Testing in Go: Golden Files","description":"Hardcoding the expected values in an assertion is a straightforward approach in testing. Most of the time, we know the expected output of the unit under test, so simply adding the …","keywords":[],"articleBody":"Hardcoding the expected values in an assertion is a straightforward approach in testing. Most of the time, we know the expected output of the unit under test, so simply adding the raw value to the assertion works well.\nThings can get tricky when we are testing a unit whose output is cumbersome to hardcode. The straightforward remedy is to extract this cumbersome value to a file that we can then read and compare the output of the unit under test to the output of the file.\nIn Go, we call such files golden files. Golden files contain the expected output of a test. When tests run, they read the contents of the golden file and compare it to the output of the unit under test.\nAs always, let’s make our lives easier and discuss golden files using an example.\nBook reports Imagine you own a small library or a book store. Your inventory software exposes an API where you can get the list of books in said inventory. You want a program that will take all that data and format it in a Markdown table. Maybe you want to print this table or send it to your accountant. The possibilities are endless!\nLet’s see a simulation of such a program:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34  // report/report.go  package report import ( \"bytes\" \"log\" \"text/template\" \"github.com/fteem/go-playground/golden-files/books\" ) const ( header string = ` | Title | Author | Publisher | Pages | ISBN | Price | | ------------- | ------------- | --------- | ------- | ------ | ------- | ` rowTemplate string = \"| {{ .Title }} | {{ .Author }} | {{ .Publisher }} | {{ .Pages }} | {{ .ISBN }} | {{ .Price }} |\\n\" ) func Generate(books []books.Book) string { buf := bytes.NewBufferString(header) t := template.Must(template.New(\"table\").Parse(rowTemplate)) for _, book := range books { err := t.Execute(buf, book) if err != nil { log.Println(\"Error executing template:\", err) } } return buf.String() }   In the report package, we have a single function Generate which generates the report Markdown table. It gets all the books from the books.Books package, iterates over them and uses the rowTemplate to generate each of the rows of the table. In the end, it returns the whole Markdown table as in a single string.\nLet’s take a quick peek at the books package:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47  // books/books.go  package books type Book struct { ISBN string Title string Author string Pages int Publisher string Price int } var Books []Book = []Book{ Book{ ISBN: \"978-1591847786\", Title: \"Hooked\", Author: \"Nir Eyal\", Pages: 256, Publisher: \"Portfolio\", Price: 19, }, Book{ ISBN: \"978-1434442017\", Title: \"The Great Gatsby\", Author: \"F. Scott Fitzgerald\", Pages: 140, Publisher: \"Wildside Press\", Price: 12, }, Book{ ISBN: \"978-1784756260\", Title: \"Then She Was Gone: A Novel\", Author: \"Lisa Jewell\", Pages: 448, Publisher: \"Arrow\", Price: 29, }, Book{ ISBN: \"978-1094400648\", Title: \"Think Like a Billionaire\", Author: \"James Altucher\", Pages: 852, Publisher: \"Scribd, Inc.\", Price: 9, }, }   The books package contains just the list of the books in our fake inventory.\nIf we ran the code we would get the following output:\n1 2 3 4 5 6 7 8  $ go run main.go | Title | Author | Publisher | Pages | ISBN | Price | | ------------- | ------------- | --------- | ------- | ------ | ------- | | Hooked | Nir Eyal | Portfolio | 256 | 978-1591847786 | 19 | | The Great Gatsby | F. Scott Fitzgerald | Wildside Press | 140 | 978-1434442017 | 12 | | Then She Was Gone: A Novel | Lisa Jewell | Arrow | 448 | 978-1784756260 | 29 | | Think Like a Billionaire | James Altucher | Scribd, Inc. | 852 | 978-1094400648 | 9 |   Given that this blog is generated using Markdown, here’s the table rendered:\n   Title Author Publisher Pages ISBN Price     Hooked Nir Eyal Portfolio 256 978-1591847786 19   The Great Gatsby F. Scott Fitzgerald Wildside Press 140 978-1434442017 12   Then She Was Gone: A Novel Lisa Jewell Arrow 448 978-1784756260 29   Think Like a Billionaire James Altucher Scribd, Inc. 852 978-1094400648 9    Not the prettiest table in the world, still a good overview of the inventory. Now that we have the report in place let’s see how we can test it.\nTesting our reports Testing the Generate function is straightforward, using the table-driven approach:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57  package report import ( \"strings\" \"testing\" \"github.com/fteem/go-playground/golden-files/books\" ) func TestGenerate(t *testing.T) { testcases := []struct { name string books []books.Book want string }{ { name: \"WithInventory\", books: []books.Book{ books.Book{ Title: \"The Da Vinci Code\", Author: \"Dan Brown\", Pages: 592, ISBN: \"978-0552161275\", Price: 7, }, books.Book{ Title: \"American on Purpose\", Author: \"Craig Ferguson\", Pages: 288, ISBN: \"978-0061959158\", Price: 19, }, }, want: ` | Title | Author | Pages | ISBN | Price | | ------------- | ------------- | ------ | ----- | ------ | | The Da Vinci Code | Dan Brown | 592 | 978-0552161275 | 7 | | American on Purpose | Craig Ferguson | 288 | 978-0061959158 | 19 | `, }, { name: \"EmptyInventory\", books: []books.Book{}, want: ` | Title | Author | Pages | ISBN | Price | | ------------- | ------------- | ------ | ----- | ------ | `, }, } for _, testcase := range testcases { got := Generate(testcase.books) if got != testcase.want { t.Errorf(\"Want:\\n%s\\nGot:%s\", testcase.want, got) } } }   The formatting of the expected output is rather hard to scan. That’s because our test cases test the actual output of the table, which is a string with a particular format.\nEven worse, in cases when these inconvenient strings are hardcoded, a failing test can be hard to debug if there’s a mismatch in leading or trailing whitespace. Consider this case, for example:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18  $ go test -v === RUN TestGenerate --- FAIL: TestGenerate (0.00s) report_test.go:54: Want: | Title | Author | Pages | ISBN | Price | | ------------- | ------------- | ------ | ----- | ------ | | The Da Vinci Code | Dan Brown | 592 | 978-0552161275 | 7 | | American on Purpose | Craig Ferguson | 288 | 978-0061959158 | 19 | Got: | Title | Author | Pages | ISBN | Price | | ------------- | ------------- | ------ | ----- | ------ | | The Da Vinci Code | Dan Brown | 592 | 978-0552161275 | 7 | | American on Purpose | Craig Ferguson | 288 | 978-0061959158 | 19 | FAIL exit status 1 FAIL\tgithub.com/fteem/go-playground/golden-files/report-verbose\t0.005s   While the wanted and the gotten values look identical, the test is failing because one of the values has trailing whitespace. To avoid hardcoding such outputs in our tests, we resort to using golden files.\nConverting to golden files To use the golden files, we need to extract the tables to a separate file in the testdata directory. If the testdata directory is foreign to you: it is a directory that the go build tool will ignore when building the binaries of your programs. You can read more about it in my post on fixtures in Go.\nUsing this approach, we want to move the two table outputs to two different files:\n testdata/empty_inventory.golden, and testdata/with_inventory.golden  Both of them will have the corresponding output of the test cases:\n1 2 3 4 5 6 7 8 9  $ cat report/testdata/empty_inventory.golden | Title | Author | Publisher | Pages | ISBN | Price | | ------------- | ------------- | --------- | ------- | ------ | ------- | $ cat report/testdata/with_inventory.golden | Title | Author | Publisher | Pages | ISBN | Price | | ------------- | ------------- | --------- | ------- | ------ | ------- | | The Da Vinci Code | Dan Brown | Corgi | 592 | 978-0552161275 | 7 | | American on Purpose | Craig Ferguson | Harper Collins | 288 | 978-0061959158 | 19 |   Now, let’s change up our test cases to use the golden files to compare the outputs:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57  package report import ( \"io/ioutil\" \"testing\" \"github.com/fteem/go-playground/golden-files/books\" ) func TestGenerate(t *testing.T) { testcases := []struct { name string books []books.Book golden string \t}{ { name: \"WithInventory\", books: []books.Book{ books.Book{ Title: \"The Da Vinci Code\", Author: \"Dan Brown\", Publisher: \"Corgi\", Pages: 592, ISBN: \"978-0552161275\", Price: 7, }, books.Book{ Title: \"American on Purpose\", Author: \"Craig Ferguson\", Publisher: \"Harper Collins\", Pages: 288, ISBN: \"978-0061959158\", Price: 19, }, }, golden: \"with_inventory\", \t}, { name: \"EmptyInventory\", books: []books.Book{}, golden: \"empty_inventory\", \t}, } for _, testcase := range testcases { got := Generate(testcase.books) content, err := ioutil.ReadFile(\"testdata/\" + testcase.golden + \".golden\") if err != nil { t.Fatalf(\"Error loading golden file: %s\", err) } want := string(content)  if got != want { t.Errorf(\"Want:\\n%s\\nGot:\\n%s\", want, got) } } }   The notable changes are on the highlighted lines above:\n we add a golden attribute to each test case, representing the name of its golden file for each of the test cases, we open the respective golden file and read all of its contents we use the contents to compare the expected (want) and the actual (got) values  This approach removes hardcoded strings from our tests, and it comes with two important features:\nFirst, golden files are coupled to the test cases (a.k.a. the inputs). That means that if the inputs change, the output will change, so you will have to update the contents of the golden file. Also, if you add another test case, you will probably have to create a golden file for it. If you forget to create it, your tests will fail - which is a good thing!\nSecond, golden files contain the expected outcome of a test case. So, if the implementation of the code under test changes, your test will fail - which is also a good thing! But that also means our golden files will be out of date, and we have to update them.\nKeeping our golden files up to date is a caveat that we always have to keep in mind. As our applications evolve and their functionalities change, the golden files will have to follow suit. If we’re working on a project with many golden files, keeping them up to date can be a frustrating exercise. Therefore it’s often a good idea to automate this, so it becomes an effortless task.\nHere’s a straightforward way to automate the golden file updating.\nKeeping our golden files up to date The whole idea here is, after any change of the implementation or the test inputs, to update the golden files saving ourselves time from copy-pasting outputs to files.\nThe usual approach in the wild is to provide a command-line flag, usually -update, which you can use with the go test tool:\n1 2 3 4 5 6 7 8 9  // report/report_test.go var ( update = flag.Bool(\"update\", false, \"update the golden files of this test\") ) func TestMain(m *testing.M) { flag.Parse() os.Exit(m.Run()) }   The update flag will be a bool that we will use in our function that will read and write to the golden files.\nBefore Go v1.13, the test’s init function invoked flag.Parse(). Since Go v1.13, the TestMain function should invoke the flag.Parse() function. This change of behavior is due to changes introduced in Go 1.13, where the testing package internally parses the flags before it runs the tests. Consequently, if we would skip the TestMain function, go test would not recognize the -update flag.\n(You can read more about the change in this Github issue.)\nIf you are unsure about the meaning of the TestMain function, you can read more about it in my article on the topic here.\nLet’s see the rest of the test file and the notable changes:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67  func TestGenerate(t *testing.T) { testcases := []struct { name string books []books.Book golden string }{ { name: \"WithInventory\", books: []books.Book{ books.Book{ Title: \"The Da Vinci Code\", Author: \"Dan Brown\", Publisher: \"Corgi\", Pages: 592, ISBN: \"978-0552161275\", Price: 7, }, books.Book{ Title: \"American on Purpose\", Author: \"Craig Ferguson\", Publisher: \"Harper Collins\", Pages: 288, ISBN: \"978-0061959158\", Price: 19, }, }, golden: \"with_inventory\", }, { name: \"EmptyInventory\", books: []books.Book{}, golden: \"empty_inventory\", }, } for _, testcase := range testcases { got := Generate(testcase.books) want := goldenValue(t, testcase.golden, got, *update)  if got != want { t.Errorf(\"Want:\\n%s\\nGot:\\n%s\", want, got) } } } func goldenValue(t *testing.T, goldenFile string, actual string, update bool) string { t.Helper() goldenPath := \"testdata/\" + goldenFile + \".golden\" f, err := os.OpenFile(goldenPath, os.O_RDWR, 0644) defer f.Close() if update { _, err := f.WriteString(actual) if err != nil { t.Fatalf(\"Error writing to file %s: %s\", goldenPath, err) } return actual } content, err := ioutil.ReadAll(f) if err != nil { t.Fatalf(\"Error opening file %s: %s\", goldenPath, err) } return string(content) }   The significant changes are in the highlighted lines above.\nThe goldenValue function takes the goldenFile name as an argument, with the actual value of the test returned by the function under test and with the update bool passed from the flag.\nThen it takes three steps:\n It opens the golden file in an R/W mode. If the update flag is true, it will update the golden file with the contents saved in the actual argument and return it. If the update flag is not set, it will continue to read the contents of the golden file and return them as a string.  If any of the reading or writing steps fail, it will crash the test and stop further test execution.\nLet’s test this in action. First, the usual, flag-less run of go test:\n1 2 3 4 5  $ go test -v ./report/... === RUN TestGenerate --- PASS: TestGenerate (0.00s) PASS ok github.com/fteem/go-playground/golden-files/report0.005s }}   Now, let’s change our implementation. We will remove the publisher column from the report that will make our tests fail because the golden file expects the Publisher column to be present:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28  $ go test -v ./report/... === RUN TestGenerate --- FAIL: TestGenerate (0.00s) report_test.go:61: Want: | Title | Author | Publisher | Pages | ISBN | Price | | ------------- | ------------- | --------- | ------- | ------ | ------- | | The Da Vinci Code | Dan Brown | Corgi | 592 | 978-0552161275 | 7 | | American on Purpose | Craig Ferguson | Harper Collins | 288 | 978-0061959158 | 19 | Got: | Title | Author | Pages | ISBN | Price | | ------------- | ------------- | ------- | ------ | ------- | | The Da Vinci Code | Dan Brown | 592 | 978-0552161275 | 7 | | American on Purpose | Craig Ferguson | 288 | 978-0061959158 | 19 | report_test.go:61: Want: | Title | Author | Publisher | Pages | ISBN | Price | | ------------- | ------------- | --------- | ------- | ------ | ------- | Got: | Title | Author | Pages | ISBN | Price | | ------------- | ------------- | ------- | ------ | ------- | FAIL FAIL\tgithub.com/fteem/go-playground/golden-files/report\t0.006s FAIL   The difference in the two failing tests is noticeable – we’re missing the column. Since we know that this is the new behavior of the report going forward, we only want to update the golden files. Let’s add the -update flag:\n1 2 3 4 5  $ go test -v ./report/... -update === RUN TestGenerate --- PASS: TestGenerate (0.00s) PASS ok github.com/fteem/go-playground/golden-files/report\t0.006s   Nothing special, only passing tests? Let’s inspect the contents of the golden files:\n1 2 3 4 5 6 7 8 9 10 11 12  $ cat report/testdata/with_inventory.golden report/testdata/empty_inventory.golden report/testdata/with_inventory.golden | Title | Author | Pages | ISBN | Price | | ------------- | ------------- | ------- | ------ | ------- | | The Da Vinci Code | Dan Brown | 592 | 978-0552161275 | 7 | | American on Purpose | Craig Ferguson | 288 | 978-0061959158 | 19 | report/testdata/empty_inventory.golden | Title | Author | Pages | ISBN | Price | | ------------- | ------------- | ------- | ------ | ------- |   Voilà! The using the -update flag, we removed the “Publisher” from our golden files, and the tests pass.\nFew words of caution While the golden files are a simple technique that improves our tests' legibility, they come with a few caveats.\nIt’s important to remember that you have to version these files. They are part of the project, and if you do not check them in your version control, your test suite will fail the moment it’s run in continuous integration.\nAlso, like fixtures, you should keep them in your testdata directory. The go build tool ignores any files in a testdata directory, and it excludes these files when building the binary. While we are comparing golden files and fixtures, there is another similarity between the two - the test files are not self-sufficient. This means that you will have to know the contents of another file to understand what is the expected outcome of your tests.\nFurthermore, parsing the golden files can be funny (or frustrating), depending on their content. Be careful when you’re storing content like the one I showed in the example above. If the golden file has lots of whitespaces, new lines or indentation, parsing, and comparing it to other strings can be annoying to debug.\nLastly, the -update flag has an important caveat: it must be available in all packages of your project to function. If you would like to be able to run go test ./... -update to update all golden files in your project, all packages in the project must know of -update.\nEven if there’s one package that is not aware of -update, running the tests will error out:\n1 2 3  ❯ go test ./... -v -update ? github.com/fteem/go-playground/golden-files\t[no test files] flag provided but not defined: -update   Such a behavior is because my Go module has more than one package in it, while only one of them (report) knows of -update’s existence.\nIn general, the benefits you get with golden files are great, but I suggest treading carefully, given the caveats mentioned above.\nLiked this article? You can buy me a coffee. Or simply subscribe to my newsletter and get my fresh posts in your inbox. It's short and sweet, going out monthly to over 1,000 subscribers.  ","wordCount":"3313","inLanguage":"en","datePublished":"2020-02-02T00:00:00Z","dateModified":"2020-02-02T00:00:00Z","author":{"@type":"Person","name":"Ilija"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://ieftimov.com/post/testing-in-go-golden-files/"},"publisher":{"@type":"Organization","name":"Ilija Eftimov ⚡️","logo":{"@type":"ImageObject","url":"https://ieftimov.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://ieftimov.com/ accesskey=h title="Ilija Eftimov ⚡️ (Alt + H)">Ilija Eftimov ⚡️</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu onscroll=menu_on_scroll()><li><a href=https://ieftimov.com/posts title=Archive><span>Archive</span></a></li><li><a href=https://ieftimov.com/about title=About><span>About</span></a></li><li><a href=https://ieftimov.com/newsletter title=Newsletter><span>Newsletter</span></a></li><li><a href=https://forms.gle/orfXK5jh1LRaiFzo8 title="Suggest a topic"><span>Suggest a topic</span></a></li><li><a href=https://www.buymeacoffee.com/ieftimov title="Buy me a ☕"><span>Buy me a ☕</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Testing in Go: Golden Files</h1><div class=post-meta>February 2, 2020&nbsp;·&nbsp;16 min&nbsp;·&nbsp;Ilija</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><div class=details>Table of Contents</div></summary><div class=inner><ul><li><a href=#book-reports aria-label="Book reports">Book reports</a></li><li><a href=#testing-our-reports aria-label="Testing our reports">Testing our reports</a></li><li><a href=#converting-to-golden-files aria-label="Converting to golden files">Converting to golden files</a></li><li><a href=#keeping-our-golden-files-up-to-date aria-label="Keeping our golden files up to date">Keeping our golden files up to date</a></li><li><a href=#few-words-of-caution aria-label="Few words of caution">Few words of caution</a></li></ul></div></details></div><div class=post-content><p>Hardcoding the expected values in an assertion is a straightforward approach
in testing. Most of the time, we know the expected output of the unit under
test, so simply adding the raw value to the assertion works well.</p><p>Things can get tricky when we are testing a unit whose output is cumbersome to
hardcode. The straightforward remedy is to extract this cumbersome value to a
file that we can then read and compare the output of the unit under test to the
output of the file.</p><p>In Go, we call such files <em>golden files</em>. Golden files contain the expected
output of a test. When tests run, they read the contents of the golden file and
compare it to the output of the unit under test.</p><p>As always, let&rsquo;s make our lives easier and discuss golden files using an
example.</p><h2 id=book-reports>Book reports<a hidden class=anchor aria-hidden=true href=#book-reports>#</a></h2><p>Imagine you own a small library or a book store. Your inventory software
exposes an API where you can get the list of books in said inventory. You want
a program that will take all that data and format it in a Markdown table. Maybe
you want to print this table or send it to your accountant. The possibilities
are endless!</p><p>Let&rsquo;s see a simulation of such a program:</p><div class=highlight><div style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">32
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">33
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">34
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#4e4e4e>// report/report.go
</span><span style=color:#4e4e4e></span>
<span style=color:#d75f00>package</span> report

<span style=color:#d75f00>import</span> (
	<span style=color:#00afaf>&#34;bytes&#34;</span>
	<span style=color:#00afaf>&#34;log&#34;</span>
	<span style=color:#00afaf>&#34;text/template&#34;</span>

	<span style=color:#00afaf>&#34;github.com/fteem/go-playground/golden-files/books&#34;</span>
)

<span style=color:#0087ff>const</span> (
	header <span style=color:#af0000>string</span> = <span style=color:#00afaf>`
</span><span style=color:#00afaf>| Title         | Author        | Publisher |  Pages  |  ISBN  |  Price  |
</span><span style=color:#00afaf>| ------------- | ------------- | --------- | ------- | ------ | ------- |
</span><span style=color:#00afaf>`</span>
	rowTemplate <span style=color:#af0000>string</span> = <span style=color:#00afaf>&#34;|  {{ .Title }}  |  {{ .Author }}  |  {{ .Publisher }}  |  {{ .Pages }}  |  {{ .ISBN }}  |  {{ .Price }}  |\n&#34;</span>
)

<span style=color:#0087ff>func</span> <span style=color:#0087ff>Generate</span>(books []books.Book) <span style=color:#af0000>string</span> {
	buf := bytes.<span style=color:#0087ff>NewBufferString</span>(header)

	t := template.<span style=color:#0087ff>Must</span>(template.<span style=color:#0087ff>New</span>(<span style=color:#00afaf>&#34;table&#34;</span>).<span style=color:#0087ff>Parse</span>(rowTemplate))

	<span style=color:#5f8700>for</span> _, book := <span style=color:#5f8700>range</span> books {
		err := t.<span style=color:#0087ff>Execute</span>(buf, book)
		<span style=color:#5f8700>if</span> err != <span style=color:#d75f00>nil</span> {
			log.<span style=color:#0087ff>Println</span>(<span style=color:#00afaf>&#34;Error executing template:&#34;</span>, err)
		}
	}

	<span style=color:#5f8700>return</span> buf.<span style=color:#0087ff>String</span>()
}</code></pre></td></tr></table></div></div><p>In the <code>report</code> package, we have a single function <code>Generate</code> which generates
the report Markdown table. It gets all the books from the <code>books.Books</code>
package, iterates over them and uses the <code>rowTemplate</code> to generate each of the
rows of the table. In the end, it returns the whole Markdown table as in a
single string.</p><p>Let&rsquo;s take a quick peek at the <code>books</code> package:</p><div class=highlight><div style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">32
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">33
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">34
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">35
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">36
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">37
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">38
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">39
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">40
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">41
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">42
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">43
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">44
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">45
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">46
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">47
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#4e4e4e>// books/books.go
</span><span style=color:#4e4e4e></span>
<span style=color:#d75f00>package</span> books

<span style=color:#0087ff>type</span> Book <span style=color:#0087ff>struct</span> {
	ISBN      <span style=color:#af0000>string</span>
	Title     <span style=color:#af0000>string</span>
	Author    <span style=color:#af0000>string</span>
	Pages     <span style=color:#af0000>int</span>
	Publisher <span style=color:#af0000>string</span>
	Price     <span style=color:#af0000>int</span>
}

<span style=color:#0087ff>var</span> Books []Book = []Book{
	Book{
		ISBN:      <span style=color:#00afaf>&#34;978-1591847786&#34;</span>,
		Title:     <span style=color:#00afaf>&#34;Hooked&#34;</span>,
		Author:    <span style=color:#00afaf>&#34;Nir Eyal&#34;</span>,
		Pages:     <span style=color:#00afaf>256</span>,
		Publisher: <span style=color:#00afaf>&#34;Portfolio&#34;</span>,
		Price:     <span style=color:#00afaf>19</span>,
	},
	Book{
		ISBN:      <span style=color:#00afaf>&#34;978-1434442017&#34;</span>,
		Title:     <span style=color:#00afaf>&#34;The Great Gatsby&#34;</span>,
		Author:    <span style=color:#00afaf>&#34;F. Scott Fitzgerald&#34;</span>,
		Pages:     <span style=color:#00afaf>140</span>,
		Publisher: <span style=color:#00afaf>&#34;Wildside Press&#34;</span>,
		Price:     <span style=color:#00afaf>12</span>,
	},
	Book{
		ISBN:      <span style=color:#00afaf>&#34;978-1784756260&#34;</span>,
		Title:     <span style=color:#00afaf>&#34;Then She Was Gone: A Novel&#34;</span>,
		Author:    <span style=color:#00afaf>&#34;Lisa Jewell&#34;</span>,
		Pages:     <span style=color:#00afaf>448</span>,
		Publisher: <span style=color:#00afaf>&#34;Arrow&#34;</span>,
		Price:     <span style=color:#00afaf>29</span>,
	},
	Book{
		ISBN:      <span style=color:#00afaf>&#34;978-1094400648&#34;</span>,
		Title:     <span style=color:#00afaf>&#34;Think Like a Billionaire&#34;</span>,
		Author:    <span style=color:#00afaf>&#34;James Altucher&#34;</span>,
		Pages:     <span style=color:#00afaf>852</span>,
		Publisher: <span style=color:#00afaf>&#34;Scribd, Inc.&#34;</span>,
		Price:     <span style=color:#00afaf>9</span>,
	},
}</code></pre></td></tr></table></div></div><p>The <code>books</code> package contains just the list of the books in our fake inventory.</p><p>If we ran the code we would get the following output:</p><div class=highlight><div style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#454545">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">7
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">8
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ go run main.go

| Title         | Author        | Publisher |  Pages  |  ISBN  |  Price  |
| ------------- | ------------- | --------- | ------- | ------ | ------- |
|  Hooked  |  Nir Eyal  |  Portfolio  |  <span style=color:#00afaf>256</span>  |  978-1591847786  |  <span style=color:#00afaf>19</span>  |
|  The Great Gatsby  |  F. Scott Fitzgerald  |  Wildside Press  |  <span style=color:#00afaf>140</span>  |  978-1434442017  |  <span style=color:#00afaf>12</span>  |
|  Then She Was Gone: A Novel  |  Lisa Jewell  |  Arrow  |  <span style=color:#00afaf>448</span>  |  978-1784756260  |  <span style=color:#00afaf>29</span>  |
|  Think Like a Billionaire  |  James Altucher  |  Scribd, Inc.  |  <span style=color:#00afaf>852</span>  |  978-1094400648  |  <span style=color:#00afaf>9</span>  |</code></pre></td></tr></table></div></div><p>Given that this blog is generated using Markdown, here&rsquo;s the table rendered:</p><table><thead><tr><th style=text-align:left>Title</th><th style=text-align:left>Author</th><th style=text-align:left>Publisher</th><th style=text-align:left>Pages</th><th style=text-align:left>ISBN</th><th style=text-align:left>Price</th></tr></thead><tbody><tr><td style=text-align:left>Hooked</td><td style=text-align:left>Nir Eyal</td><td style=text-align:left>Portfolio</td><td style=text-align:left>256</td><td style=text-align:left>978-1591847786</td><td style=text-align:left>19</td></tr><tr><td style=text-align:left>The Great Gatsby</td><td style=text-align:left>F. Scott Fitzgerald</td><td style=text-align:left>Wildside Press</td><td style=text-align:left>140</td><td style=text-align:left>978-1434442017</td><td style=text-align:left>12</td></tr><tr><td style=text-align:left>Then She Was Gone: A Novel</td><td style=text-align:left>Lisa Jewell</td><td style=text-align:left>Arrow</td><td style=text-align:left>448</td><td style=text-align:left>978-1784756260</td><td style=text-align:left>29</td></tr><tr><td style=text-align:left>Think Like a Billionaire</td><td style=text-align:left>James Altucher</td><td style=text-align:left>Scribd, Inc.</td><td style=text-align:left>852</td><td style=text-align:left>978-1094400648</td><td style=text-align:left>9</td></tr></tbody></table><p>Not the prettiest table in the world, still a good overview of the inventory.
Now that we have the report in place let&rsquo;s see how we can test it.</p><h2 id=testing-our-reports>Testing our reports<a hidden class=anchor aria-hidden=true href=#testing-our-reports>#</a></h2><p>Testing the <code>Generate</code> function is straightforward, using the <a href=/post/testing-in-go-table-driven-tests/>table-driven
approach</a>:</p><div class=highlight><div style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">32
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">33
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">34
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">35
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">36
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">37
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">38
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">39
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">40
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">41
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">42
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">43
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">44
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">45
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">46
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">47
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">48
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">49
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">50
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">51
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">52
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">53
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">54
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">55
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">56
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">57
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#d75f00>package</span> report

<span style=color:#d75f00>import</span> (
	<span style=color:#00afaf>&#34;strings&#34;</span>
	<span style=color:#00afaf>&#34;testing&#34;</span>

	<span style=color:#00afaf>&#34;github.com/fteem/go-playground/golden-files/books&#34;</span>
)

<span style=color:#0087ff>func</span> <span style=color:#0087ff>TestGenerate</span>(t *testing.T) {
	testcases := []<span style=color:#0087ff>struct</span> {
		name  <span style=color:#af0000>string</span>
		books []books.Book
		want  <span style=color:#af0000>string</span>
	}{
		{
			name: <span style=color:#00afaf>&#34;WithInventory&#34;</span>,
			books: []books.Book{
				books.Book{
					Title:  <span style=color:#00afaf>&#34;The Da Vinci Code&#34;</span>,
					Author: <span style=color:#00afaf>&#34;Dan Brown&#34;</span>,
					Pages:  <span style=color:#00afaf>592</span>,
					ISBN:   <span style=color:#00afaf>&#34;978-0552161275&#34;</span>,
					Price:  <span style=color:#00afaf>7</span>,
				},
				books.Book{
					Title:  <span style=color:#00afaf>&#34;American on Purpose&#34;</span>,
					Author: <span style=color:#00afaf>&#34;Craig Ferguson&#34;</span>,
					Pages:  <span style=color:#00afaf>288</span>,
					ISBN:   <span style=color:#00afaf>&#34;978-0061959158&#34;</span>,
					Price:  <span style=color:#00afaf>19</span>,
				},
			},
			want: <span style=color:#00afaf>`
</span><span style=color:#00afaf>| Title         | Author        | Pages  | ISBN  | Price  |
</span><span style=color:#00afaf>| ------------- | ------------- | ------ | ----- | ------ |
</span><span style=color:#00afaf>| The Da Vinci Code | Dan Brown | 592 | 978-0552161275 | 7 |
</span><span style=color:#00afaf>| American on Purpose | Craig Ferguson | 288 | 978-0061959158 | 19 |
</span><span style=color:#00afaf>`</span>,
		},
		{
			name:  <span style=color:#00afaf>&#34;EmptyInventory&#34;</span>,
			books: []books.Book{},
			want: <span style=color:#00afaf>`
</span><span style=color:#00afaf>| Title         | Author        | Pages  | ISBN  | Price  |
</span><span style=color:#00afaf>| ------------- | ------------- | ------ | ----- | ------ |
</span><span style=color:#00afaf>`</span>,
		},
	}

	<span style=color:#5f8700>for</span> _, testcase := <span style=color:#5f8700>range</span> testcases {
		got := <span style=color:#0087ff>Generate</span>(testcase.books)
		<span style=color:#5f8700>if</span> got != testcase.want {
			t.<span style=color:#0087ff>Errorf</span>(<span style=color:#00afaf>&#34;Want:\n%s\nGot:%s&#34;</span>, testcase.want, got)
		}
	}
}</code></pre></td></tr></table></div></div><p>The formatting of the expected output is rather hard to scan. That&rsquo;s because
our test cases test the actual output of the table, which is a string with a
particular format.</p><p>Even worse, in cases when these inconvenient strings are hardcoded, a failing
test can be hard to debug if there&rsquo;s a mismatch in leading or trailing
whitespace. Consider this case, for example:</p><div class=highlight><div style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">18
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ go <span style=color:#0087ff>test</span> -v
=== RUN   TestGenerate
--- FAIL: TestGenerate (0.00s)
    report_test.go:54: Want:

        | Title         | Author        | Pages  | ISBN  | Price  |
        | ------------- | ------------- | ------ | ----- | ------ |
        | The Da Vinci Code | Dan Brown | <span style=color:#00afaf>592</span> | 978-0552161275 | <span style=color:#00afaf>7</span> |
        | American on Purpose | Craig Ferguson | <span style=color:#00afaf>288</span> | 978-0061959158 | <span style=color:#00afaf>19</span> |

        Got:
        | Title         | Author        | Pages  | ISBN  | Price  |
        | ------------- | ------------- | ------ | ----- | ------ |
        | The Da Vinci Code | Dan Brown | <span style=color:#00afaf>592</span> | 978-0552161275 | <span style=color:#00afaf>7</span> |
        | American on Purpose | Craig Ferguson | <span style=color:#00afaf>288</span> | 978-0061959158 | <span style=color:#00afaf>19</span> |
FAIL
<span style=color:#0087ff>exit</span> status <span style=color:#00afaf>1</span>
FAIL	github.com/fteem/go-playground/golden-files/report-verbose	0.005s</code></pre></td></tr></table></div></div><p>While the <code>want</code>ed and the <code>got</code>ten values look identical, the test is failing
because one of the values has trailing whitespace. To avoid hardcoding such
outputs in our tests, we resort to using golden files.</p><h2 id=converting-to-golden-files>Converting to golden files<a hidden class=anchor aria-hidden=true href=#converting-to-golden-files>#</a></h2><p>To use the golden files, we need to extract the tables to a separate file in
the <code>testdata</code> directory. If the <code>testdata</code> directory is foreign to you: it is
a directory that the <code>go build</code> tool will ignore when building the binaries of
your programs. You can read more about it in <a href=/post/testing-in-go-fixtures>my post on fixtures in
Go</a>.</p><p>Using this approach, we want to move the two table outputs to two different
files:</p><ol><li><code>testdata/empty_inventory.golden</code>, and</li><li><code>testdata/with_inventory.golden</code></li></ol><p>Both of them will have the corresponding output of the test cases:</p><div class=highlight><div style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#454545">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">7
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">8
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ cat report/testdata/empty_inventory.golden
| Title         | Author        | Publisher |  Pages  |  ISBN  |  Price  |
| ------------- | ------------- | --------- | ------- | ------ | ------- |

$ cat report/testdata/with_inventory.golden
| Title         | Author        | Publisher |  Pages  |  ISBN  |  Price  |
| ------------- | ------------- | --------- | ------- | ------ | ------- |
| The Da Vinci Code | Dan Brown | Corgi | <span style=color:#00afaf>592</span> | 978-0552161275 | <span style=color:#00afaf>7</span> |
| American on Purpose | Craig Ferguson | Harper Collins | <span style=color:#00afaf>288</span> | 978-0061959158 | <span style=color:#00afaf>19</span> |</code></pre></td></tr></table></div></div><p>Now, let&rsquo;s change up our test cases to use the golden files to compare the
outputs:</p><div class=highlight><div style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">13
</span><span style=display:block;width:100%;background-color:#323232><span style="margin-right:.4em;padding:0 .4em;color:#454545">14
</span></span><span style="margin-right:.4em;padding:0 .4em;color:#454545">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">32
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">33
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">34
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">35
</span><span style=display:block;width:100%;background-color:#323232><span style="margin-right:.4em;padding:0 .4em;color:#454545">36
</span></span><span style="margin-right:.4em;padding:0 .4em;color:#454545">37
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">38
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">39
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">40
</span><span style=display:block;width:100%;background-color:#323232><span style="margin-right:.4em;padding:0 .4em;color:#454545">41
</span></span><span style="margin-right:.4em;padding:0 .4em;color:#454545">42
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">43
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">44
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">45
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">46
</span><span style=display:block;width:100%;background-color:#323232><span style="margin-right:.4em;padding:0 .4em;color:#454545">47
</span></span><span style=display:block;width:100%;background-color:#323232><span style="margin-right:.4em;padding:0 .4em;color:#454545">48
</span></span><span style=display:block;width:100%;background-color:#323232><span style="margin-right:.4em;padding:0 .4em;color:#454545">49
</span></span><span style=display:block;width:100%;background-color:#323232><span style="margin-right:.4em;padding:0 .4em;color:#454545">50
</span></span><span style=display:block;width:100%;background-color:#323232><span style="margin-right:.4em;padding:0 .4em;color:#454545">51
</span></span><span style="margin-right:.4em;padding:0 .4em;color:#454545">52
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">53
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">54
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">55
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">56
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">57
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#d75f00>package</span> report

<span style=color:#d75f00>import</span> (
	<span style=color:#00afaf>&#34;io/ioutil&#34;</span>
	<span style=color:#00afaf>&#34;testing&#34;</span>

	<span style=color:#00afaf>&#34;github.com/fteem/go-playground/golden-files/books&#34;</span>
)

<span style=color:#0087ff>func</span> <span style=color:#0087ff>TestGenerate</span>(t *testing.T) {
	testcases := []<span style=color:#0087ff>struct</span> {
		name   <span style=color:#af0000>string</span>
		books  []books.Book
<span style=display:block;width:100%;background-color:#323232>		golden <span style=color:#af0000>string</span>
</span>	}{
		{
			name: <span style=color:#00afaf>&#34;WithInventory&#34;</span>,
			books: []books.Book{
				books.Book{
					Title:     <span style=color:#00afaf>&#34;The Da Vinci Code&#34;</span>,
					Author:    <span style=color:#00afaf>&#34;Dan Brown&#34;</span>,
					Publisher: <span style=color:#00afaf>&#34;Corgi&#34;</span>,
					Pages:     <span style=color:#00afaf>592</span>,
					ISBN:      <span style=color:#00afaf>&#34;978-0552161275&#34;</span>,
					Price:     <span style=color:#00afaf>7</span>,
				},
				books.Book{
					Title:     <span style=color:#00afaf>&#34;American on Purpose&#34;</span>,
					Author:    <span style=color:#00afaf>&#34;Craig Ferguson&#34;</span>,
					Publisher: <span style=color:#00afaf>&#34;Harper Collins&#34;</span>,
					Pages:     <span style=color:#00afaf>288</span>,
					ISBN:      <span style=color:#00afaf>&#34;978-0061959158&#34;</span>,
					Price:     <span style=color:#00afaf>19</span>,
				},
			},
<span style=display:block;width:100%;background-color:#323232>			golden: <span style=color:#00afaf>&#34;with_inventory&#34;</span>,
</span>		},
		{
			name:   <span style=color:#00afaf>&#34;EmptyInventory&#34;</span>,
			books:  []books.Book{},
<span style=display:block;width:100%;background-color:#323232>			golden: <span style=color:#00afaf>&#34;empty_inventory&#34;</span>,
</span>		},
	}

	<span style=color:#5f8700>for</span> _, testcase := <span style=color:#5f8700>range</span> testcases {
		got := <span style=color:#0087ff>Generate</span>(testcase.books)
<span style=display:block;width:100%;background-color:#323232>		content, err := ioutil.<span style=color:#0087ff>ReadFile</span>(<span style=color:#00afaf>&#34;testdata/&#34;</span> + testcase.golden + <span style=color:#00afaf>&#34;.golden&#34;</span>)
</span><span style=display:block;width:100%;background-color:#323232>		<span style=color:#5f8700>if</span> err != <span style=color:#d75f00>nil</span> {
</span><span style=display:block;width:100%;background-color:#323232>			t.<span style=color:#0087ff>Fatalf</span>(<span style=color:#00afaf>&#34;Error loading golden file: %s&#34;</span>, err)
</span><span style=display:block;width:100%;background-color:#323232>		}
</span><span style=display:block;width:100%;background-color:#323232>		want := <span style=color:#0087ff>string</span>(content)
</span>
		<span style=color:#5f8700>if</span> got != want {
			t.<span style=color:#0087ff>Errorf</span>(<span style=color:#00afaf>&#34;Want:\n%s\nGot:\n%s&#34;</span>, want, got)
		}
	}
}</code></pre></td></tr></table></div></div><p>The notable changes are on the highlighted lines above:</p><ul><li>we add a <code>golden</code> attribute to each test case, representing the name of its
golden file</li><li>for each of the test cases, we open the respective golden file and read all
of its contents</li><li>we use the contents to compare the expected (<code>want</code>) and the actual (<code>got</code>)
values</li></ul><p>This approach removes hardcoded strings from our tests, and it comes with two
important features:</p><p>First, golden files are coupled to the test cases (a.k.a. the inputs). That
means that if the inputs change, the output will change, so you will have to
update the contents of the golden file. Also, if you add another test case, you
will probably have to create a golden file for it. If you forget to create it,
your tests will fail - which is a good thing!</p><p>Second, golden files contain the <em>expected outcome</em> of a test case. So, if the
implementation of the code under test changes, your test will fail - which is
also a good thing! But that also means our golden files will be out of date,
and we have to update them.</p><p>Keeping our golden files up to date is a caveat that we always have to keep in
mind. As our applications evolve and their functionalities change, the golden
files will have to follow suit. If we&rsquo;re working on a project with many golden
files, keeping them up to date can be a frustrating exercise. Therefore it&rsquo;s
often a good idea to automate this, so it becomes an effortless task.</p><p>Here&rsquo;s a straightforward way to automate the golden file updating.</p><h2 id=keeping-our-golden-files-up-to-date>Keeping our golden files up to date<a hidden class=anchor aria-hidden=true href=#keeping-our-golden-files-up-to-date>#</a></h2><p>The whole idea here is, after any change of the implementation or the test
inputs, to update the golden files saving ourselves time from copy-pasting
outputs to files.</p><p>The usual approach in the wild is to provide a command-line flag, usually
<code>-update</code>, which you can use with the <code>go test</code> tool:</p><div class=highlight><div style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#454545">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">7
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">8
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#4e4e4e>// report/report_test.go
</span><span style=color:#4e4e4e></span><span style=color:#0087ff>var</span> (
	update = flag.<span style=color:#0087ff>Bool</span>(<span style=color:#00afaf>&#34;update&#34;</span>, <span style=color:#d75f00>false</span>, <span style=color:#00afaf>&#34;update the golden files of this test&#34;</span>)
)

<span style=color:#0087ff>func</span> <span style=color:#0087ff>TestMain</span>(m *testing.M) {
	flag.<span style=color:#0087ff>Parse</span>()
	os.<span style=color:#0087ff>Exit</span>(m.<span style=color:#0087ff>Run</span>())
}</code></pre></td></tr></table></div></div><p>The <code>update</code> flag will be a <code>bool</code> that we will use in our function that will
read and write to the golden files.</p><p>Before Go v1.13, the test&rsquo;s <code>init</code> function invoked <code>flag.Parse()</code>. Since Go
v1.13, the <code>TestMain</code> function should invoke the <code>flag.Parse()</code> function. This
change of behavior is due to <a href=https://golang.org/doc/go1.13#testing>changes introduced in Go
1.13</a>, where the <code>testing</code> package
internally parses the flags before it runs the tests. Consequently, if we would
skip the <code>TestMain</code> function, <code>go test</code> would not recognize the <code>-update</code> flag.</p><p>(You can read more about the change in <a href=https://github.com/golang/go/issues/31859>this Github
issue</a>.)</p><p>If you are unsure about the meaning of the <code>TestMain</code> function, you can read
more about it in my article on the topic
<a href=/post/testing-in-go-subtests/#testmain>here</a>.</p><p>Let&rsquo;s see the rest of the test file and the notable changes:</p><div class=highlight><div style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">32
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">33
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">34
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">35
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">36
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">37
</span><span style=display:block;width:100%;background-color:#323232><span style="margin-right:.4em;padding:0 .4em;color:#454545">38
</span></span><span style="margin-right:.4em;padding:0 .4em;color:#454545">39
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">40
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">41
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">42
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">43
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">44
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">45
</span><span style=display:block;width:100%;background-color:#323232><span style="margin-right:.4em;padding:0 .4em;color:#454545">46
</span></span><span style=display:block;width:100%;background-color:#323232><span style="margin-right:.4em;padding:0 .4em;color:#454545">47
</span></span><span style=display:block;width:100%;background-color:#323232><span style="margin-right:.4em;padding:0 .4em;color:#454545">48
</span></span><span style=display:block;width:100%;background-color:#323232><span style="margin-right:.4em;padding:0 .4em;color:#454545">49
</span></span><span style=display:block;width:100%;background-color:#323232><span style="margin-right:.4em;padding:0 .4em;color:#454545">50
</span></span><span style=display:block;width:100%;background-color:#323232><span style="margin-right:.4em;padding:0 .4em;color:#454545">51
</span></span><span style=display:block;width:100%;background-color:#323232><span style="margin-right:.4em;padding:0 .4em;color:#454545">52
</span></span><span style=display:block;width:100%;background-color:#323232><span style="margin-right:.4em;padding:0 .4em;color:#454545">53
</span></span><span style=display:block;width:100%;background-color:#323232><span style="margin-right:.4em;padding:0 .4em;color:#454545">54
</span></span><span style=display:block;width:100%;background-color:#323232><span style="margin-right:.4em;padding:0 .4em;color:#454545">55
</span></span><span style=display:block;width:100%;background-color:#323232><span style="margin-right:.4em;padding:0 .4em;color:#454545">56
</span></span><span style=display:block;width:100%;background-color:#323232><span style="margin-right:.4em;padding:0 .4em;color:#454545">57
</span></span><span style=display:block;width:100%;background-color:#323232><span style="margin-right:.4em;padding:0 .4em;color:#454545">58
</span></span><span style=display:block;width:100%;background-color:#323232><span style="margin-right:.4em;padding:0 .4em;color:#454545">59
</span></span><span style=display:block;width:100%;background-color:#323232><span style="margin-right:.4em;padding:0 .4em;color:#454545">60
</span></span><span style=display:block;width:100%;background-color:#323232><span style="margin-right:.4em;padding:0 .4em;color:#454545">61
</span></span><span style=display:block;width:100%;background-color:#323232><span style="margin-right:.4em;padding:0 .4em;color:#454545">62
</span></span><span style=display:block;width:100%;background-color:#323232><span style="margin-right:.4em;padding:0 .4em;color:#454545">63
</span></span><span style=display:block;width:100%;background-color:#323232><span style="margin-right:.4em;padding:0 .4em;color:#454545">64
</span></span><span style=display:block;width:100%;background-color:#323232><span style="margin-right:.4em;padding:0 .4em;color:#454545">65
</span></span><span style=display:block;width:100%;background-color:#323232><span style="margin-right:.4em;padding:0 .4em;color:#454545">66
</span></span><span style=display:block;width:100%;background-color:#323232><span style="margin-right:.4em;padding:0 .4em;color:#454545">67
</span></span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#0087ff>func</span> <span style=color:#0087ff>TestGenerate</span>(t *testing.T) {
	testcases := []<span style=color:#0087ff>struct</span> {
		name   <span style=color:#af0000>string</span>
		books  []books.Book
		golden <span style=color:#af0000>string</span>
	}{
		{
			name: <span style=color:#00afaf>&#34;WithInventory&#34;</span>,
			books: []books.Book{
				books.Book{
					Title:     <span style=color:#00afaf>&#34;The Da Vinci Code&#34;</span>,
					Author:    <span style=color:#00afaf>&#34;Dan Brown&#34;</span>,
					Publisher: <span style=color:#00afaf>&#34;Corgi&#34;</span>,
					Pages:     <span style=color:#00afaf>592</span>,
					ISBN:      <span style=color:#00afaf>&#34;978-0552161275&#34;</span>,
					Price:     <span style=color:#00afaf>7</span>,
				},
				books.Book{
					Title:     <span style=color:#00afaf>&#34;American on Purpose&#34;</span>,
					Author:    <span style=color:#00afaf>&#34;Craig Ferguson&#34;</span>,
					Publisher: <span style=color:#00afaf>&#34;Harper Collins&#34;</span>,
					Pages:     <span style=color:#00afaf>288</span>,
					ISBN:      <span style=color:#00afaf>&#34;978-0061959158&#34;</span>,
					Price:     <span style=color:#00afaf>19</span>,
				},
			},
			golden: <span style=color:#00afaf>&#34;with_inventory&#34;</span>,
		},
		{
			name:   <span style=color:#00afaf>&#34;EmptyInventory&#34;</span>,
			books:  []books.Book{},
			golden: <span style=color:#00afaf>&#34;empty_inventory&#34;</span>,
		},
	}

	<span style=color:#5f8700>for</span> _, testcase := <span style=color:#5f8700>range</span> testcases {
		got := <span style=color:#0087ff>Generate</span>(testcase.books)
<span style=display:block;width:100%;background-color:#323232>		want := <span style=color:#0087ff>goldenValue</span>(t, testcase.golden, got, *update)
</span>
		<span style=color:#5f8700>if</span> got != want {
			t.<span style=color:#0087ff>Errorf</span>(<span style=color:#00afaf>&#34;Want:\n%s\nGot:\n%s&#34;</span>, want, got)
		}
	}
}

<span style=display:block;width:100%;background-color:#323232><span style=color:#0087ff>func</span> <span style=color:#0087ff>goldenValue</span>(t *testing.T, goldenFile <span style=color:#af0000>string</span>, actual <span style=color:#af0000>string</span>, update <span style=color:#af0000>bool</span>) <span style=color:#af0000>string</span> {
</span><span style=display:block;width:100%;background-color:#323232>	t.<span style=color:#0087ff>Helper</span>()
</span><span style=display:block;width:100%;background-color:#323232>	goldenPath := <span style=color:#00afaf>&#34;testdata/&#34;</span> + goldenFile + <span style=color:#00afaf>&#34;.golden&#34;</span>
</span><span style=display:block;width:100%;background-color:#323232>
</span><span style=display:block;width:100%;background-color:#323232>	f, err := os.<span style=color:#0087ff>OpenFile</span>(goldenPath, os.O_RDWR, <span style=color:#00afaf>0644</span>)
</span><span style=display:block;width:100%;background-color:#323232>	<span style=color:#5f8700>defer</span> f.<span style=color:#0087ff>Close</span>()
</span><span style=display:block;width:100%;background-color:#323232>
</span><span style=display:block;width:100%;background-color:#323232>	<span style=color:#5f8700>if</span> update {
</span><span style=display:block;width:100%;background-color:#323232>		_, err := f.<span style=color:#0087ff>WriteString</span>(actual)
</span><span style=display:block;width:100%;background-color:#323232>		<span style=color:#5f8700>if</span> err != <span style=color:#d75f00>nil</span> {
</span><span style=display:block;width:100%;background-color:#323232>			t.<span style=color:#0087ff>Fatalf</span>(<span style=color:#00afaf>&#34;Error writing to file %s: %s&#34;</span>, goldenPath, err)
</span><span style=display:block;width:100%;background-color:#323232>		}
</span><span style=display:block;width:100%;background-color:#323232>
</span><span style=display:block;width:100%;background-color:#323232>		<span style=color:#5f8700>return</span> actual
</span><span style=display:block;width:100%;background-color:#323232>	}
</span><span style=display:block;width:100%;background-color:#323232>
</span><span style=display:block;width:100%;background-color:#323232>	content, err := ioutil.<span style=color:#0087ff>ReadAll</span>(f)
</span><span style=display:block;width:100%;background-color:#323232>	<span style=color:#5f8700>if</span> err != <span style=color:#d75f00>nil</span> {
</span><span style=display:block;width:100%;background-color:#323232>		t.<span style=color:#0087ff>Fatalf</span>(<span style=color:#00afaf>&#34;Error opening file %s: %s&#34;</span>, goldenPath, err)
</span><span style=display:block;width:100%;background-color:#323232>	}
</span><span style=display:block;width:100%;background-color:#323232>	<span style=color:#5f8700>return</span> <span style=color:#0087ff>string</span>(content)
</span><span style=display:block;width:100%;background-color:#323232>}</span></code></pre></td></tr></table></div></div><p>The significant changes are in the highlighted lines above.</p><p>The <code>goldenValue</code> function takes the <code>goldenFile</code> name as an argument, with the
<code>actual</code> value of the test returned by the function under test and with the
<code>update</code> bool passed from the flag.</p><p>Then it takes three steps:</p><ol><li>It opens the golden file in an R/W mode.</li><li>If the <code>update</code> flag is <code>true</code>, it will update the golden file with the
contents saved in the <code>actual</code> argument and return it.</li><li>If the <code>update</code> flag is not set, it will continue to read the contents of
the golden file and return them as a string.</li></ol><p>If any of the reading or writing steps fail, it will crash the test and stop
further test execution.</p><p>Let&rsquo;s test this in action. First, the usual, flag-less run of <code>go test</code>:</p><div class=highlight><div style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#454545">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ go <span style=color:#0087ff>test</span> -v ./report/...
=== RUN   TestGenerate
--- PASS: TestGenerate (0.00s)
PASS
ok  	github.com/fteem/go-playground/golden-files/report0.005s &gt;}}</code></pre></td></tr></table></div></div><p>Now, let&rsquo;s change our implementation. We will remove the publisher column from
the report that will make our tests fail because the golden file expects the
Publisher column to be present:</p><div class=highlight><div style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">28
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ go <span style=color:#0087ff>test</span> -v ./report/...
=== RUN   TestGenerate
--- FAIL: TestGenerate (0.00s)
    report_test.go:61: Want:

        | Title         | Author        | Publisher |  Pages  |  ISBN  |  Price  |
        | ------------- | ------------- | --------- | ------- | ------ | ------- |
        | The Da Vinci Code | Dan Brown | Corgi | <span style=color:#00afaf>592</span> | 978-0552161275 | <span style=color:#00afaf>7</span> |
        | American on Purpose | Craig Ferguson | Harper Collins | <span style=color:#00afaf>288</span> | 978-0061959158 | <span style=color:#00afaf>19</span> |

        Got:

        | Title         | Author        |  Pages  |  ISBN  |  Price  |
        | ------------- | ------------- | ------- | ------ | ------- |
        | The Da Vinci Code | Dan Brown | <span style=color:#00afaf>592</span> | 978-0552161275 | <span style=color:#00afaf>7</span> |
        | American on Purpose | Craig Ferguson | <span style=color:#00afaf>288</span> | 978-0061959158 | <span style=color:#00afaf>19</span> |
    report_test.go:61: Want:

        | Title         | Author        | Publisher |  Pages  |  ISBN  |  Price  |
        | ------------- | ------------- | --------- | ------- | ------ | ------- |

        Got:

        | Title         | Author        |  Pages  |  ISBN  |  Price  |
        | ------------- | ------------- | ------- | ------ | ------- |
FAIL
FAIL	github.com/fteem/go-playground/golden-files/report	0.006s
FAIL</code></pre></td></tr></table></div></div><p>The difference in the two failing tests is noticeable – we&rsquo;re missing the
column. Since we know that this is the new behavior of the report going
forward, we only want to update the golden files. Let&rsquo;s add the <code>-update</code> flag:</p><div class=highlight><div style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#454545">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ go <span style=color:#0087ff>test</span> -v ./report/... -update
=== RUN   TestGenerate
--- PASS: TestGenerate (0.00s)
PASS
ok  	github.com/fteem/go-playground/golden-files/report	0.006s</code></pre></td></tr></table></div></div><p>Nothing special, only passing tests? Let&rsquo;s inspect the contents of the golden
files:</p><div class=highlight><div style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">12
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ cat report/testdata/with_inventory.golden report/testdata/empty_inventory.golden

report/testdata/with_inventory.golden
| Title         | Author        |  Pages  |  ISBN  |  Price  |
| ------------- | ------------- | ------- | ------ | ------- |
| The Da Vinci Code | Dan Brown | <span style=color:#00afaf>592</span> | 978-0552161275 | <span style=color:#00afaf>7</span> |
| American on Purpose | Craig Ferguson | <span style=color:#00afaf>288</span> | 978-0061959158 | <span style=color:#00afaf>19</span> |

report/testdata/empty_inventory.golden

| Title         | Author        |  Pages  |  ISBN  |  Price  |
| ------------- | ------------- | ------- | ------ | ------- |</code></pre></td></tr></table></div></div><p>Voilà! The using the <code>-update</code> flag, we removed the &ldquo;Publisher&rdquo; from our golden
files, and the tests pass.</p><h2 id=few-words-of-caution>Few words of caution<a hidden class=anchor aria-hidden=true href=#few-words-of-caution>#</a></h2><p>While the golden files are a simple technique that improves our tests'
legibility, they come with a few caveats.</p><p>It&rsquo;s important to remember that you have to version these files. They are part
of the project, and if you do not check them in your version control, your test
suite will fail the moment it&rsquo;s run in continuous integration.</p><p>Also, like <a href=/post/testing-in-go-fixtures>fixtures</a>, you should keep them in
your <code>testdata</code> directory. The <code>go build</code> tool ignores any files in a
<code>testdata</code> directory, and it excludes these files when building the binary.
While we are comparing golden files and fixtures, there is another similarity
between the two - the test files are not self-sufficient. This means that you
will have to know the contents of another file to understand what is the
expected outcome of your tests.</p><p>Furthermore, parsing the golden files can be funny (or frustrating), depending
on their content. Be careful when you&rsquo;re storing content like the one I showed
in the example above. If the golden file has lots of whitespaces, new lines or
indentation, parsing, and comparing it to other strings can be annoying to
debug.</p><p>Lastly, the <code>-update</code> flag has an important caveat: <strong>it must be available in
all packages</strong> of your project to function. If you would like to be able to run
<code>go test ./... -update</code> to update all golden files in your project, all
packages in the project must know of <code>-update</code>.</p><p>Even if there&rsquo;s one package that is not aware of <code>-update</code>, running the tests will
error out:</p><div class=highlight><div style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#454545">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>❯ go <span style=color:#0087ff>test</span> ./... -v -update
?   	github.com/fteem/go-playground/golden-files	[no <span style=color:#0087ff>test</span> files]
flag provided but not defined: -update</code></pre></td></tr></table></div></div><p>Such a behavior is because my Go module has more than one package in it, while
only one of them (<code>report</code>) knows of <code>-update</code>&rsquo;s existence.</p><p>In general, the benefits you get with golden files are great, but I suggest
treading carefully, given the caveats mentioned above.</p><section class=subscribe><b>Liked this article?</b>
You can <a href=https://www.buymeacoffee.com/ieftimov>buy me a coffee</a>.
Or simply <a href=/newsletter>subscribe to my
newsletter</a> and get my fresh posts in your inbox. It's short and sweet,
going out monthly to over 1,000 subscribers.</section></div><footer class=post-footer><nav class=paginav><a class=prev href=https://ieftimov.com/post/testing-in-go-clean-tests-using-t-cleanup/><span class=title>« Prev Page</span><br><span>Testing in Go: Clean Tests Using t.Cleanup</span></a>
<a class=next href=https://ieftimov.com/post/make-resilient-golang-net-http-servers-using-timeouts-deadlines-context-cancellation/><span class=title>Next Page »</span><br><span>Make resilient Go net/http servers using timeouts, deadlines and context cancellation</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Testing in Go: Golden Files on twitter" href="https://twitter.com/intent/tweet/?text=Testing%20in%20Go%3a%20Golden%20Files&url=https%3a%2f%2fieftimov.com%2fpost%2ftesting-in-go-golden-files%2f&hashtags="><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Testing in Go: Golden Files on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fieftimov.com%2fpost%2ftesting-in-go-golden-files%2f&title=Testing%20in%20Go%3a%20Golden%20Files&summary=Testing%20in%20Go%3a%20Golden%20Files&source=https%3a%2f%2fieftimov.com%2fpost%2ftesting-in-go-golden-files%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Testing in Go: Golden Files on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fieftimov.com%2fpost%2ftesting-in-go-golden-files%2f&title=Testing%20in%20Go%3a%20Golden%20Files"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Testing in Go: Golden Files on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fieftimov.com%2fpost%2ftesting-in-go-golden-files%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Testing in Go: Golden Files on whatsapp" href="https://api.whatsapp.com/send?text=Testing%20in%20Go%3a%20Golden%20Files%20-%20https%3a%2f%2fieftimov.com%2fpost%2ftesting-in-go-golden-files%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Testing in Go: Golden Files on telegram" href="https://telegram.me/share/url?text=Testing%20in%20Go%3a%20Golden%20Files&url=https%3a%2f%2fieftimov.com%2fpost%2ftesting-in-go-golden-files%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>Copyright 2021 © Ilija Eftimov</span>
<span>&#183;</span>
<span>Powered by <a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a></span>
<span>&#183;</span>
<span>Theme <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>window.onload=function(){localStorage.getItem("menu-scroll-position")&&(document.getElementById('menu').scrollLeft=localStorage.getItem("menu-scroll-position"))},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})});var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")};function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById('menu').scrollLeft)}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script></body></html>