<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Deep Dive in the Upcoming Go Error Inspection Changes | Ilija Eftimov ⚡️</title><meta name=keywords content="errors"><meta name=description content="The team behind the language started working on a document titled &ldquo;Go 2 Draft Designs&rdquo;. The draft document is part of the design process for Go v2.0. In this article we will zoom in at the proposal for error inspection in Go 2.
What&rsquo;s worth noting is that this is still part of a draft proposal. Still, from where we are standing at the moment, it&rsquo;s certain that these changes will be added to the language starting Go v1."><meta name=author content="Ilija"><link rel=canonical href=https://ieftimov.com/post/deep-dive-in-upcoming-go-error-inspection-changes/><link crossorigin=anonymous href=/assets/css/stylesheet.min.css rel="preload stylesheet" as=style><link rel=icon href=https://ieftimov.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://ieftimov.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://ieftimov.com/favicon-32x32.png><link rel=apple-touch-icon href=https://ieftimov.com/apple-touch-icon.png><link rel=mask-icon href=https://ieftimov.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.83.1"><script async defer data-domain=ieftimov.com src=https://plausible.io/js/plausible.js></script><link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel=stylesheet><meta property="og:title" content="Deep Dive in the Upcoming Go Error Inspection Changes"><meta property="og:description" content="The team behind the language started working on a document titled &ldquo;Go 2 Draft Designs&rdquo;. The draft document is part of the design process for Go v2.0. In this article we will zoom in at the proposal for error inspection in Go 2.
What&rsquo;s worth noting is that this is still part of a draft proposal. Still, from where we are standing at the moment, it&rsquo;s certain that these changes will be added to the language starting Go v1."><meta property="og:type" content="article"><meta property="og:url" content="https://ieftimov.com/post/deep-dive-in-upcoming-go-error-inspection-changes/"><meta property="og:image" content="https://ieftimov.com/cards/deep-dive-in-upcoming-go-error-inspection-changes.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-04-23T00:00:00+00:00"><meta property="article:modified_time" content="2019-04-23T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://ieftimov.com/cards/deep-dive-in-upcoming-go-error-inspection-changes.png"><meta name=twitter:title content="Deep Dive in the Upcoming Go Error Inspection Changes"><meta name=twitter:description content="The team behind the language started working on a document titled &ldquo;Go 2 Draft Designs&rdquo;. The draft document is part of the design process for Go v2.0. In this article we will zoom in at the proposal for error inspection in Go 2.
What&rsquo;s worth noting is that this is still part of a draft proposal. Still, from where we are standing at the moment, it&rsquo;s certain that these changes will be added to the language starting Go v1."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://ieftimov.com/posts/"},{"@type":"ListItem","position":2,"name":"Deep Dive in the Upcoming Go Error Inspection Changes","item":"https://ieftimov.com/post/deep-dive-in-upcoming-go-error-inspection-changes/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Deep Dive in the Upcoming Go Error Inspection Changes","name":"Deep Dive in the Upcoming Go Error Inspection Changes","description":"The team behind the language started working on a document titled \u0026ldquo;Go 2 Draft Designs\u0026rdquo;. The draft document is part of the design process for Go v2.0. In this article we will zoom in at the proposal for error inspection in Go 2.\nWhat\u0026rsquo;s worth noting is that this is still part of a draft proposal. Still, from where we are standing at the moment, it\u0026rsquo;s certain that these changes will be added to the language starting Go v1.","keywords":["errors"],"articleBody":"The team behind the language started working on a document titled “Go 2 Draft Designs”. The draft document is part of the design process for Go v2.0. In this article we will zoom in at the proposal for error inspection in Go 2.\nWhat’s worth noting is that this is still part of a draft proposal. Still, from where we are standing at the moment, it’s certain that these changes will be added to the language starting Go v1.13 and v2.0.\nBefore we go on, it’s good to note that this article is aimed at folks that consider themselves new to the language. Not just with time spent with the language, but also in terms of size of projects/codebases. So if that sounds like you - keep on reading, I promise it will be helpful to understand the pros and cons of errors in Go.\nIf you have experience with Go and error handling you might have a good idea about the topic. Still, you may find something of value in the article. Let me know in the comments section below!\nGo 2 Draft Designs The intent behind the draft documents is to create a discussion cornerstone for the community. They touch three important topics: generics, error handling and error value semantics.\nThe reason for discussing these three topics is… well, us – the community. The Go team got the community’s feedback on the shortcomings of the language via the annual Go user survey. And there is no surprise on the prioritised areas for v2.0: package management, errors and generics.\nPackage management was a big thing, but that area is already addressed with the introduction of modules.\nIn fact, here’s a more detailed breakdown of the biggest challenges that people face with Go today:\nImage blatantly linked from Go’s blog  If you would like to learn more, the Go team published a blog post with the results and other insights.\nAs we said earlier, in this article we will focus on the error inspection proposal. The error handling and formatting are quite interesting as well, but those are topics for other articles.\nShortcomings of the current errors inspection approach Before we go on to see what are the problems with the current situation in the ecosystem, let’s get a better understanding of errors first. Looking at the topic from my perspective, as a beginner in Go, it’s challenging to understand the shortcomings here.\nGo promotes the idea that errors are values. When something is a value, it means that we can assign it to a variable. This implies that we can work with errors via ordinary programming. No need for special exception flows or rescue blocks. For example, this is an error that’s a value:\n1 2 3 4 5  r, err := os.Open(src) if err != nil { return err } defer r.Close()   The the os.Open function returns a file for reading or an error. Assigning the error to a variable and checking for its presence (err != nil) is possible because errors are values. In contrast with other languages, when a it’s not possible to open a file, we have to catch/handle an exception.\nThis flexibility that Go unlocks is great. But also it changes they way we perceive and use errors as values in our programs. A side-effect of this is that equality checks and type assertion on errors has proved to be tricky and have limitations.\nIf you read the Problem Overview document on error values by Russ Cox, he describes four ways of testing for specific errors:\n Test for equality with sentinel errors, like io.EOF Check for an error implementation type using a type assertion or type switch Ad-hoc checks, like os.IsNotExist, check for a specific kind of error Substring searches in the error text reported by err.Error()  Let’s take this a step further.\nError wrapping The people in the Go ecosystem have created various packages that aid error inspection. For example, one of the most popular packages that serves this purpose is pkg/errors. Another one is Uber’s multierr. Others include spacemonkeygo/errors, hashicorp/errwrap and upspin.io/error.\nIf you would inspect each of these you would notice different patterns for error wrapping. Error wrapping is a technique where we wrap one error value in another error value, of a different type. The goal is to add more information to it. In 2016 Dave Cheney wrote an article on the topic, titled “Don’t just check errors, handle them gracefully”.\nThe basic idea is that any error that happens deeper in the call stack will be unavailable for inspection on the surface. We have to annotate errors down the stack, so we can inspect and handle the proper error at a certain level in the stack.\nLet’s look at an example: imagine we want to open a file that doesn’t exist.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14  package main import ( \"fmt\" \"os\" ) func main() { f, err := os.Open(\"notes.txt\") if err != nil { fmt.Print(fmt.Errorf(\"%+v\", err)) } defer f.Close() }   If we run this small program, we will get the following output:\n1 2  $ go run test.go open notes.txt: no such file or directory   There is no hint of the type of the error or where this error originated from, such as function name or line number. To be able to get more information to user, we would have to add annotation to our error:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14  package main import ( \"fmt\" \"os\" ) func main() { f, err := os.Open(\"notes.txt\") if err != nil { fmt.Print(fmt.Errorf(\"Error opening file: %+v\", err)) } defer f.Close() }   The output:\n1 2  $ go run test.go Error opening file: open notes.txt: no such file or directory%   A better way to approach this is to use error wrapping.\nHere’s a very simple example: our type will allow attaching of a timestamp to the error. It will also print the timestamp as part of the error message. The code:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37  package main import ( \"fmt\" \"os\" \"time\" ) type ErrorWithTime struct { err error // the wrapped error  t time.Time // the time when the error happened } func (e *ErrorWithTime) Error() string { return fmt.Sprintf(\"%v @ %s\", e.err, e.t) } func wrap(err error) *ErrorWithTime { return \u0026ErrorWithTime{err, time.Now()} } func openFile(filename string) (*os.File, error) { f, err := os.Open(filename) if err != nil { return nil, wrap(err) } return f, nil } func main() { file, err := openFile(\"notes.txt\") if err != nil { fmt.Print(err) } defer file.Close() }   The ErrorWithTime struct has two attributes: the wrapped error err and the time of the error occurrence t. The Error() function will include the timestamp of the occurrence alongside with the error itself. The wrap function is the one doing the magic. It takes an error as an argument and returns the error wrapped in a ErrorWithTime, with the exception timestamp attached (set to time.Now()).\nThe main function does not care about the type of the error. It checks for its presence and prints (if present). If we run the program, this will be the output:\n1 2  $ go run test.go open notes.txt: no such file or directory @ 2019-04-05 21:40:06.055665 +0200 CEST m=+0.000287159%   I admit - the timestamp of the error occurrence might not be that useful in this context. What is important is that it paints the idea how we can attach more information to errors by wrapping them. If you read Dave’s article I linked above, you will see the shortcomings of this approach and the argument for unwrapping.\nNow, having this in mind, let’s move back to the error inspection proposal and see what the authors are proposing.\nGo 2 Error Inspection While wrapping works, it comes at a certain cost, which the draft design document addresses:\n If a sentinel error is wrapped, then a program cannot check for the sentinel by a simple equality comparison. And if an error of some type T is wrapped (presumably in an error of a different type), then type-asserting the result to T will fail. If we encourage wrapping, we must also support alternatives to the two main techniques that a program can use to act on errors, equality checks and type assertions.\n So, let’s see how the authors of the proposal are going to address the two most important aspects of error wrapping: equality comparison and type assertion.\nUnwrapping In the draft document the authors acknowledge the need for an unwrapping mechanism. The idea behind that to be able to do any comparisons or assertions, we have to be able to unwrap errors. This is in fact a simple functionality of the custom error type, but it’s of exceptional importance.\nThat’s why they introduce the Wrapper interface:\n1 2 3 4 5 6 7 8 9  package errors // A Wrapper is an error implementation // wrapping context around another error. type Wrapper interface { // Unwrap returns the next error in the error chain. \t// If there is no next error, Unwrap returns nil. \tUnwrap() error }   The Unwrap function here does not have a body because we’re looking at an interface definition. This interface is quite important though. All types that will implement Wrapper will have inspection of wrapped errors.\nLet’s see a contrived example of a custom error type that implements the Wrapper interface:\n1 2 3 4 5  // ErrorWithTime is an error with a timestamp type ErrorWithTime struct { err error // the wrapped error \tt time.Time // the time when the error happened }   For the ErrorWithTime to implement the Wrapper interface, it needs to have a Unwrap function. The function will return the error that the custom error type contains:\n1 2 3  func (e *ErrorWithTime) Unwrap() error { return e.err }   That’s all. This will allow any of the next aspects, that we will discuss further, to function well with the ErrorWithTime type.\nType assertion using As Now, let’s combine two ideas: opening a file that does not exist and returning an error that contains a time of occurrence. Let’s reintroduce the ErrorWithTime type and its related functions:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14  type ErrorWithTime struct { err error // the wrapped error \tt time.Time // the time when the error happened } // Implements the Error interface func (e *ErrorWithTime) Error() string { return fmt.Sprintf(\"Error: %s, ocurred at: %s\\n\", e.err, e.t) } // Implements the Wrapper interface func (e *ErrorWithTime) Unwrap() error { return e.err }   To reiterate, the Unwrap function is the one that implements the Wrapper interface. And the Error function implements the Error interface. This means that we can unwrap any error value of our ErrorWithTime type.\nNow, let’s create a simple function that can open a file and return an error (if any):\n1 2 3 4 5 6 7 8 9 10  func openFile(path string) error { _, err := os.Open(path) if err != nil { return \u0026ErrorWithTime{ err: err, t: time.Now(), } } return nil }   This function is a tad useless because it only returns a potential error, but it does the trick for our example. If the os.Open call returns an error we will wrap it in a ErrorWithTime and attach the current time to it. Then, we’ll return it.\nNow, let’s see the main function:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14  func main() { err := openFile(\"non-existent-file\") if err != nil { var timeError *ErrorWithTime if xerrors.As(err, \u0026timeError) { fmt.Println(\"Failed at: \", timeError.t) } var pathError *os.PathError if xerrors.As(err, \u0026pathError) { fmt.Println(\"Failed at path:\", pathError.Path) } } }   Here’s how the new As function helps by taking care of the type assertion. It receives the error from the openFile function and asserts the error’s type to *ErrorWithTime. If the assertion is successful, it will use its t attribute to display the time when the error happened.\nThe same goes for asserting the error type to *os.PathError. Again, the *ErrorWithTime implements the Wrapper interface. This allows the xerrors.As function to unwrap the error and check for the type of the error under wraps. Let’s run the main function:\n1 2 3  $ go run as.go Failed at: 2019-04-21 18:11:01.922332 +0200 CEST m=+0.000303480 Failed at path: non-existent   Note that the error type returned from the openFile function is *ErrorWithTime. But, once it’s casted to a *os.PathError we cannot access the t attribute. This is because *ErrorWithTime implements t – not *os.PathError.\nLet’s test that with code:\n1 2 3 4 5 6 7 8 9 10  func main() { err := openFile(\"non-existent-file\") if err != nil { var pathError *os.PathError if xerrors.As(err, \u0026pathError) { fmt.Println(\"Failed at path:\", pathError.Path) fmt.Println(\"Failed at:\", pathError.t) } } }   This fails with the error:\n1  ./test.go:44:44: pathError.t undefined (type *os.PathError has no field or method t)   Value checking with Is While As allows us to take a value and assert its type, Golang has errors which are resistive to type assertions. They are special and have a special name - sentinel errors. Their name descends from the practice in computer programming of using a specific value to signify that no further processing is possible.\nWhen a caller handles a sentinel error, they have to compare the returned error value to a predeclared value using the equality operator. Here’s an example (adapted from A Tour of Go) that handles a io.EOF error:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18  package main import ( \"io\" \"strings\" ) func main() { r := strings.NewReader(\"Hello, Reader!\") b := make([]byte, 8) for { _, err := r.Read(b) if err == io.EOF { break } } }   The example above creates a strings.Reader and consumes its output 8 bytes at a time. When the reading hits a io.EOF (I/O End Of File) error, it will break the for loop and exit the program.\nSo, how does the new Is function help us in such cases? Well, if we would use the xerrors package in the same example, it would look like this:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20  package main import ( \"io\" \"strings\" \"golang.org/x/xerrors\" ) func main() { r := strings.NewReader(\"Hello, Reader!\") b := make([]byte, 8) for { _, err := r.Read(b) if xerrors.Is(err, io.EOF) { break } } }   The change is simple on the surface, but considerable under the hood. The Is function takes an error value and a sentinel error as arguments. If the error value implements Wrapper, it will unwrap its chain of error until it reaches (or not) the sentinel error. Hence, if it finds the sentinel error it will return true, otherwise false.\nLet’s expand the above example with our ErrorWithTime type and see the Is function in action:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46  package main import ( \"fmt\" \"io\" \"strings\" \"time\" \"golang.org/x/xerrors\" ) type ErrorWithTime struct { err error // the wrapped error \tt time.Time // the time when the error happened } func (e *ErrorWithTime) Error() string { return fmt.Sprintf(\"Error: %s, ocurred at: %s\\n\", e.err, e.t) } func (e *ErrorWithTime) Unwrap() error { return e.err } func readReader(r io.Reader) error { buffer := make([]byte, 8) for { _, err := r.Read(buffer) if err != nil { return \u0026ErrorWithTime{ err: err, t: time.Now(), } } } } func main() { r := strings.NewReader(\"Hello, Reader!\") err := readReader(r) if xerrors.Is(err, io.EOF) { fmt.Println(err) } }   When run, this will produce:\n1 2  $ go run eof.go Error: EOF, ocurred at: 2019-04-21 11:32:41.842139 +0200 CEST m=+0.000228985   The readReader function takes a io.Reader as argument and read it until the reading returns an error. When it returns the error, it will wrap it in an \u0026ErrorWithTime and returned to the caller (main). The caller then uses xerrors.Is to check if the error returned is actually a io.EOF under wraps. If it is, it will print the error.\nThis works because ErrorWithType implements Wrapper. This allows the caller to print the error message from the error value, while still being able to detect the error under wraps.\nPutting it in practice with xerrors So you might be wondering, how you can start using the Is and As functions in your current Go programs. Well, as you have noticed in the examples we used the xerrors package. This was in fact announced by Marcel van Lohuizen at dotGo 2019 in Paris - you can check his talk here. (If you’re curious how the event was in general, I published a report on it here.)\nThe xerrors package is built to support transitioning to the Go 2 proposal for error values. Most of the functions and types from xerrors will be incorporated into the standard library’s errors package in Go 1.13. The idea is that by using this package you can make your Go 1.12 code be compatible with 1.13 (and later version 2).\nYou can read its documentation and check out the examples included.\nIt is also worth mentioning that replacing equality checks with xerrors.Is and type assertions with xerrors.As will not change the meaning of existing programs that do not wrap errors and it will future-proof programs against wrapping.\nAs with any language changes, there will be situations where the new functions will not do the trick. For example, sometimes callers want to perform many checks against the same error. One such case would be when the caller would compare the error value against more than one sentinel value. In such cases we can still use Is and As. The drawback is in the way these functions walk through the chain of wrapped errors. This means they would walk up the chain multiple times, which is wasteful.\nIn any case, improving the situation with error inspection in Go is a good step forward. I am used to more conventional error handling. Still, I think that this is not a step in the wrong direction when it comes to error inspection. Also, I recommend reading the discussion section of the error inspection draft. It lays out some good guidelines on how to define and use your error types.\nWhat is your opinion on the proposal? Do you think it will simplify your life as a Go developer? Or do you maybe prefer a different approach? Let me know in the comments below!\nLiked this article? You can buy me a coffee. Or simply subscribe to my newsletter and get my fresh posts in your inbox. It's short and sweet, going out monthly to over 1,000 subscribers.  ","wordCount":"3195","inLanguage":"en","datePublished":"2019-04-23T00:00:00Z","dateModified":"2019-04-23T00:00:00Z","author":{"@type":"Person","name":"Ilija"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://ieftimov.com/post/deep-dive-in-upcoming-go-error-inspection-changes/"},"publisher":{"@type":"Organization","name":"Ilija Eftimov ⚡️","logo":{"@type":"ImageObject","url":"https://ieftimov.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://ieftimov.com/ accesskey=h title="Ilija Eftimov ⚡️ (Alt + H)">Ilija Eftimov ⚡️</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://ieftimov.com/ title=About><span>About</span></a></li><li><a href=https://ieftimov.com/posts title=Writing><span>Writing</span></a></li><li><a href=https://ieftimov.com/newsletter title=Newsletter><span>Newsletter</span></a></li><li><a href=https://forms.gle/orfXK5jh1LRaiFzo8 title="Suggest a topic"><span>Suggest a topic</span></a></li><li><a href=https://www.buymeacoffee.com/ieftimov title="Buy me a ☕"><span>Buy me a ☕</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Deep Dive in the Upcoming Go Error Inspection Changes</h1><div class=post-meta>April 23, 2019&nbsp;·&nbsp;15 min&nbsp;·&nbsp;Ilija</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><div class=details>Table of Contents</div></summary><div class=inner><ul><li><a href=#go-2-draft-designs aria-label="Go 2 Draft Designs">Go 2 Draft Designs</a></li><li><a href=#shortcomings-of-the-current-errors-inspection-approach aria-label="Shortcomings of the current errors inspection approach">Shortcomings of the current errors inspection approach</a><ul><li><a href=#error-wrapping aria-label="Error wrapping">Error wrapping</a></li></ul></li><li><a href=#go-2-error-inspection aria-label="Go 2 Error Inspection">Go 2 Error Inspection</a><ul><li><a href=#unwrapping aria-label=Unwrapping>Unwrapping</a></li><li><a href=#type-assertion-using-as aria-label="Type assertion using As">Type assertion using <code>As</code></a></li><li><a href=#value-checking-with-is aria-label="Value checking with Is">Value checking with <code>Is</code></a></li></ul></li><li><a href=#putting-it-in-practice-with-xerrors aria-label="Putting it in practice with xerrors">Putting it in practice with <code>xerrors</code></a></li></ul></div></details></div><div class=post-content><p>The team behind the language started working on a document titled <a href=https://go.googlesource.com/proposal/+/master/design/go2draft.md>&ldquo;Go 2 Draft
Designs&rdquo;</a>.
The draft document is part of the design process for Go v2.0. In this article
we will zoom in at the proposal for error inspection in Go 2.</p><p>What&rsquo;s worth noting is that this is still part of a draft proposal. Still, from
where we are standing at the moment, it&rsquo;s certain that these changes will be
added to the language starting Go v1.13 and v2.0.</p><p>Before we go on, it’s good to note that this article is aimed at folks that
consider themselves new to the language. Not just with time spent with the
language, but also in terms of size of projects/codebases. So if that sounds
like you - keep on reading, I promise it will be helpful to understand the pros
and cons of errors in Go.</p><p>If you have experience with Go and error handling you might have a good idea
about the topic. Still, you may find something of value in the article. Let me
know in the comments section below!</p><h2 id=go-2-draft-designs>Go 2 Draft Designs<a hidden class=anchor aria-hidden=true href=#go-2-draft-designs>#</a></h2><p>The intent behind the draft documents is to create a discussion cornerstone for
the community. They touch three important topics: generics, error handling and
error value semantics.</p><p>The reason for discussing these three topics is… well, us – the community. The
Go team got the community’s feedback on the shortcomings of the language via
the annual Go user survey. And there is no surprise on the prioritised areas
for v2.0: package management, errors and generics.</p><p>Package management was a big thing, but that area is already addressed with the
introduction of modules.</p><p>In fact, here&rsquo;s a more detailed breakdown of the biggest challenges that people
face with Go today:</p><figure class=imagecaption><img class=caption src=https://blog.golang.org/survey2018/fig14.svg caption="Image blatantly linked from Go&rsquo;s blog" alt="Image blatantly linked from Go&rsquo;s blog">
<span class=caption-text style="font-size:.75em;display:table;margin:0 auto 1.5em">Image blatantly linked from Go&rsquo;s blog</span></figure><p>If you would like to learn more, the Go team
published <a href=https://blog.golang.org/survey2018-results>a blog post</a> with the
results and other insights.</p><p>As we said earlier, in this article we will focus on the error inspection
proposal. The error handling and formatting are quite interesting as well, but
those are topics for other articles.</p><h2 id=shortcomings-of-the-current-errors-inspection-approach>Shortcomings of the current errors inspection approach<a hidden class=anchor aria-hidden=true href=#shortcomings-of-the-current-errors-inspection-approach>#</a></h2><p>Before we go on to see what are the problems with the current situation in the
ecosystem, let’s get a better understanding of errors first. Looking at the
topic from my perspective, as a beginner in Go, it’s challenging to understand
the shortcomings here.</p><p>Go promotes the idea that errors are values. When something is a value, it
means that we can assign it to a variable. This implies that we can work with
errors via ordinary programming. No need for special exception flows or rescue
blocks. For example, this is an error that’s a value:</p><div class=highlight><div style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#454545">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go>r, err := os.<span style=color:#0087ff>Open</span>(src)
<span style=color:#5f8700>if</span> err != <span style=color:#d75f00>nil</span> {
	<span style=color:#5f8700>return</span> err
}
<span style=color:#5f8700>defer</span> r.<span style=color:#0087ff>Close</span>()</code></pre></td></tr></table></div></div><p>The the <code>os.Open</code> function returns a file for reading or an error. Assigning
the error to a variable and checking for its presence (<code>err != nil</code>) is
possible because errors are values. In contrast with other languages, when a
it&rsquo;s not possible to open a file, we have to catch/handle an exception.</p><p>This flexibility that Go unlocks is great. But also it changes they way we
perceive and use errors as values in our programs. A side-effect of this is
that equality checks and type assertion on errors has proved to be tricky and
have limitations.</p><p>If you read the <a href=https://go.googlesource.com/proposal/+/master/design/go2draft-error-values-overview.md>Problem Overview
document</a>
on error values by Russ Cox, he describes four ways of testing for specific
errors:</p><ol><li>Test for equality with sentinel errors, like <code>io.EOF</code></li><li>Check for an error implementation type using a type assertion or type switch</li><li>Ad-hoc checks, like <code>os.IsNotExist</code>, check for a specific kind of error</li><li>Substring searches in the error text reported by <code>err.Error()</code></li></ol><p>Let&rsquo;s take this a step further.</p><h3 id=error-wrapping>Error wrapping<a hidden class=anchor aria-hidden=true href=#error-wrapping>#</a></h3><p>The people in the Go ecosystem have created various packages that aid error
inspection. For example, one of the most popular packages that serves this
purpose is <a href=https://github.com/pkg/errors><code>pkg/errors</code></a>. Another one is Uber&rsquo;s
<a href=https://github.com/uber-go/multierr><code>multierr</code></a>. Others include
<a href=https://godoc.org/github.com/spacemonkeygo/errors><code>spacemonkeygo/errors</code></a>,
<a href=https://godoc.org/github.com/hashicorp/errwrap><code>hashicorp/errwrap</code></a> and
<a href=https://godoc.org/upspin.io/errors><code>upspin.io/error</code></a>.</p><p>If you would inspect each of these you would notice different patterns for
error wrapping. Error wrapping is a technique where we wrap one error value in
another error value, of a different type. The goal is to add more information
to it. In 2016 Dave Cheney wrote an article on the topic, titled &ldquo;<a href=https://dave.cheney.net/2016/04/27/dont-just-check-errors-handle-them-gracefully>Don’t just
check errors, handle them
gracefully</a>&rdquo;.</p><p>The basic idea is that any error that happens deeper in the call stack will be
unavailable for inspection on the surface. We have to annotate errors down the
stack, so we can inspect and handle the proper error at a certain level in the
stack.</p><p>Let&rsquo;s look at an example: imagine we want to open a file that doesn&rsquo;t exist.</p><div class=highlight><div style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">14
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#d75f00>package</span> main

<span style=color:#d75f00>import</span> (
	<span style=color:#00afaf>&#34;fmt&#34;</span>
	<span style=color:#00afaf>&#34;os&#34;</span>
)

<span style=color:#0087ff>func</span> <span style=color:#0087ff>main</span>() {
	f, err := os.<span style=color:#0087ff>Open</span>(<span style=color:#00afaf>&#34;notes.txt&#34;</span>)
	<span style=color:#5f8700>if</span> err != <span style=color:#d75f00>nil</span> {
		fmt.<span style=color:#0087ff>Print</span>(fmt.<span style=color:#0087ff>Errorf</span>(<span style=color:#00afaf>&#34;%+v&#34;</span>, err))
	}
	<span style=color:#5f8700>defer</span> f.<span style=color:#0087ff>Close</span>()
}</code></pre></td></tr></table></div></div><p>If we run this small program, we will get the following output:</p><div class=highlight><div style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#454545">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>$ go run test.go
open notes.txt: no such file or directory</code></pre></td></tr></table></div></div><p>There is no hint of the type of the error or where this error originated from,
such as function name or line number. To be able to get more information to
user, we would have to add annotation to our error:</p><div class=highlight><div style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">14
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#d75f00>package</span> main

<span style=color:#d75f00>import</span> (
	<span style=color:#00afaf>&#34;fmt&#34;</span>
	<span style=color:#00afaf>&#34;os&#34;</span>
)

<span style=color:#0087ff>func</span> <span style=color:#0087ff>main</span>() {
	f, err := os.<span style=color:#0087ff>Open</span>(<span style=color:#00afaf>&#34;notes.txt&#34;</span>)
	<span style=color:#5f8700>if</span> err != <span style=color:#d75f00>nil</span> {
		fmt.<span style=color:#0087ff>Print</span>(fmt.<span style=color:#0087ff>Errorf</span>(<span style=color:#00afaf>&#34;Error opening file: %+v&#34;</span>, err))
	}
	<span style=color:#5f8700>defer</span> f.<span style=color:#0087ff>Close</span>()
}</code></pre></td></tr></table></div></div><p>The output:</p><div class=highlight><div style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#454545">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>$ go run test.go
Error opening file: open notes.txt: no such file or directory%</code></pre></td></tr></table></div></div><p>A better way to approach this is to use error wrapping.</p><p>Here’s a very simple example: our type will allow attaching of a timestamp to
the error. It will also print the timestamp as part of the error message. The
code:</p><div class=highlight><div style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">32
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">33
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">34
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">35
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">36
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">37
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#d75f00>package</span> main

<span style=color:#d75f00>import</span> (
    <span style=color:#00afaf>&#34;fmt&#34;</span>
    <span style=color:#00afaf>&#34;os&#34;</span>
    <span style=color:#00afaf>&#34;time&#34;</span>
)

<span style=color:#0087ff>type</span> ErrorWithTime <span style=color:#0087ff>struct</span> {
    err <span style=color:#af0000>error</span> <span style=color:#4e4e4e>// the wrapped error
</span><span style=color:#4e4e4e></span>    t time.Time <span style=color:#4e4e4e>// the time when the error happened
</span><span style=color:#4e4e4e></span>}

<span style=color:#0087ff>func</span> (e *ErrorWithTime) <span style=color:#0087ff>Error</span>() <span style=color:#af0000>string</span> {
    <span style=color:#5f8700>return</span> fmt.<span style=color:#0087ff>Sprintf</span>(<span style=color:#00afaf>&#34;%v @ %s&#34;</span>, e.err, e.t)
}

<span style=color:#0087ff>func</span> <span style=color:#0087ff>wrap</span>(err <span style=color:#af0000>error</span>) *ErrorWithTime {
    <span style=color:#5f8700>return</span> &amp;ErrorWithTime{err, time.<span style=color:#0087ff>Now</span>()}
}

<span style=color:#0087ff>func</span> <span style=color:#0087ff>openFile</span>(filename <span style=color:#af0000>string</span>) (*os.File, <span style=color:#af0000>error</span>) {
    f, err := os.<span style=color:#0087ff>Open</span>(filename)
    <span style=color:#5f8700>if</span> err != <span style=color:#d75f00>nil</span> {
        <span style=color:#5f8700>return</span> <span style=color:#d75f00>nil</span>, <span style=color:#0087ff>wrap</span>(err)
    }

    <span style=color:#5f8700>return</span> f, <span style=color:#d75f00>nil</span>
}

<span style=color:#0087ff>func</span> <span style=color:#0087ff>main</span>() {
    file, err := <span style=color:#0087ff>openFile</span>(<span style=color:#00afaf>&#34;notes.txt&#34;</span>)
    <span style=color:#5f8700>if</span> err != <span style=color:#d75f00>nil</span> {
        fmt.<span style=color:#0087ff>Print</span>(err)
    }
    <span style=color:#5f8700>defer</span> file.<span style=color:#0087ff>Close</span>()
}</code></pre></td></tr></table></div></div><p>The <code>ErrorWithTime</code> struct has two attributes: the wrapped error <code>err</code> and the
time of the error occurrence <code>t</code>. The <code>Error()</code> function will include the
timestamp of the occurrence alongside with the error itself. The <code>wrap</code>
function is the one doing the magic. It takes an error as an argument and
returns the error wrapped in a <code>ErrorWithTime</code>, with the exception timestamp
attached (set to <code>time.Now()</code>).</p><p>The <code>main</code> function does not care about the type of the error. It checks for
its presence and <code>print</code>s (if present). If we run the program, this will be
the output:</p><div class=highlight><div style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#454545">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>$ go run test.go
open notes.txt: no such file or directory @ 2019-04-05 21:40:06.055665 +0200 CEST m=+0.000287159%</code></pre></td></tr></table></div></div><p>I admit - the timestamp of the error occurrence might not be that useful in
this context. What is important is that it paints the idea how we can attach
more information to errors by wrapping them. If you read Dave’s article I
linked above, you will see the shortcomings of this approach and the argument
for unwrapping.</p><p>Now, having this in mind, let&rsquo;s move back to the error inspection proposal
and see what the authors are proposing.</p><h2 id=go-2-error-inspection>Go 2 Error Inspection<a hidden class=anchor aria-hidden=true href=#go-2-error-inspection>#</a></h2><p>While wrapping works, it comes at a certain cost, which the draft design
document addresses:</p><blockquote><p>If a sentinel error is wrapped, then a program cannot check for the
sentinel by a simple equality comparison. And if an error of some type T is
wrapped (presumably in an error of a different type), then type-asserting the
result to T will fail. If we encourage wrapping, we must also support
alternatives to the two main techniques that a program can use to act on
errors, equality checks and type assertions.</p></blockquote><p>So, let&rsquo;s see how the authors of the proposal are going to address the two
most important aspects of error wrapping: equality comparison and type
assertion.</p><h3 id=unwrapping>Unwrapping<a hidden class=anchor aria-hidden=true href=#unwrapping>#</a></h3><p>In the draft document the authors acknowledge the need for an unwrapping
mechanism. The idea behind that to be able to do any comparisons or assertions,
we have to be able to unwrap errors. This is in fact a simple functionality of
the custom error type, but it’s of exceptional importance.</p><p>That&rsquo;s why they introduce the <code>Wrapper</code> interface:</p><div class=highlight><div style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#454545">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">5
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">6
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">7
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">8
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#d75f00>package</span> errors

<span style=color:#4e4e4e>// A Wrapper is an error implementation
</span><span style=color:#4e4e4e>// wrapping context around another error.
</span><span style=color:#4e4e4e></span><span style=color:#0087ff>type</span> Wrapper <span style=color:#0087ff>interface</span> {
	<span style=color:#4e4e4e>// Unwrap returns the next error in the error chain.
</span><span style=color:#4e4e4e></span>	<span style=color:#4e4e4e>// If there is no next error, Unwrap returns nil.
</span><span style=color:#4e4e4e></span>	<span style=color:#0087ff>Unwrap</span>() <span style=color:#af0000>error</span>
}</code></pre></td></tr></table></div></div><p>The <code>Unwrap</code> function here does not have a body because we’re looking at an
<code>interface</code> definition. This interface is quite important though. All types
that will implement <code>Wrapper</code> will have inspection of wrapped errors.</p><p>Let&rsquo;s see a contrived example of a custom error type that implements the
<code>Wrapper</code> interface:</p><div class=highlight><div style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#454545">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">3
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">4
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#4e4e4e>// ErrorWithTime is an error with a timestamp
</span><span style=color:#4e4e4e></span><span style=color:#0087ff>type</span> ErrorWithTime <span style=color:#0087ff>struct</span> {
	err <span style=color:#af0000>error</span>     <span style=color:#4e4e4e>// the wrapped error
</span><span style=color:#4e4e4e></span>	t   time.Time <span style=color:#4e4e4e>// the time when the error happened
</span><span style=color:#4e4e4e></span>}</code></pre></td></tr></table></div></div><p>For the <code>ErrorWithTime</code> to implement the <code>Wrapper</code> interface, it needs to have
a <code>Unwrap</code> function. The function will return the error that the custom error
type contains:</p><div class=highlight><div style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#454545">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#0087ff>func</span> (e *ErrorWithTime) <span style=color:#0087ff>Unwrap</span>() <span style=color:#af0000>error</span> {
	<span style=color:#5f8700>return</span> e.err
}</code></pre></td></tr></table></div></div><p>That&rsquo;s all. This will allow any of the next aspects, that we will discuss
further, to function well with the <code>ErrorWithTime</code> type.</p><h3 id=type-assertion-using-as>Type assertion using <code>As</code><a hidden class=anchor aria-hidden=true href=#type-assertion-using-as>#</a></h3><p>Now, let’s combine two ideas: opening a file that does not exist and returning
an error that contains a time of occurrence. Let&rsquo;s reintroduce the
<code>ErrorWithTime</code> type and its related functions:</p><div class=highlight><div style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">14
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#0087ff>type</span> ErrorWithTime <span style=color:#0087ff>struct</span> {
	err <span style=color:#af0000>error</span>     <span style=color:#4e4e4e>// the wrapped error
</span><span style=color:#4e4e4e></span>	t   time.Time <span style=color:#4e4e4e>// the time when the error happened
</span><span style=color:#4e4e4e></span>}

<span style=color:#4e4e4e>// Implements the Error interface
</span><span style=color:#4e4e4e></span><span style=color:#0087ff>func</span> (e *ErrorWithTime) <span style=color:#0087ff>Error</span>() <span style=color:#af0000>string</span> {
	<span style=color:#5f8700>return</span> fmt.<span style=color:#0087ff>Sprintf</span>(<span style=color:#00afaf>&#34;Error: %s, ocurred at: %s\n&#34;</span>, e.err, e.t)
}

<span style=color:#4e4e4e>// Implements the Wrapper interface
</span><span style=color:#4e4e4e></span><span style=color:#0087ff>func</span> (e *ErrorWithTime) <span style=color:#0087ff>Unwrap</span>() <span style=color:#af0000>error</span> {
	<span style=color:#5f8700>return</span> e.err
}</code></pre></td></tr></table></div></div><p>To reiterate, the <code>Unwrap</code> function is the one that implements the <code>Wrapper</code>
interface. And the <code>Error</code> function implements the <code>Error</code> interface. This means
that we can unwrap any error value of our <code>ErrorWithTime</code> type.</p><p>Now, let&rsquo;s create a simple function that can open a file and return an error
(if any):</p><div class=highlight><div style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#0087ff>func</span> <span style=color:#0087ff>openFile</span>(path <span style=color:#af0000>string</span>) <span style=color:#af0000>error</span> {
	_, err := os.<span style=color:#0087ff>Open</span>(path)
	<span style=color:#5f8700>if</span> err != <span style=color:#d75f00>nil</span> {
		<span style=color:#5f8700>return</span> &amp;ErrorWithTime{
			err: err,
			t:   time.<span style=color:#0087ff>Now</span>(),
		}
	}
	<span style=color:#5f8700>return</span> <span style=color:#d75f00>nil</span>
}</code></pre></td></tr></table></div></div><p>This function is a tad useless because it only returns a potential error, but
it does the trick for our example. If the <code>os.Open</code> call returns an error we
will wrap it in a <code>ErrorWithTime</code> and attach the current time to it. Then,
we&rsquo;ll <code>return</code> it.</p><p>Now, let&rsquo;s see the <code>main</code> function:</p><div class=highlight><div style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">14
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#0087ff>func</span> <span style=color:#0087ff>main</span>() {
	err := <span style=color:#0087ff>openFile</span>(<span style=color:#00afaf>&#34;non-existent-file&#34;</span>)
	<span style=color:#5f8700>if</span> err != <span style=color:#d75f00>nil</span> {
		<span style=color:#0087ff>var</span> timeError *ErrorWithTime
		<span style=color:#5f8700>if</span> xerrors.<span style=color:#0087ff>As</span>(err, &amp;timeError) {
			fmt.<span style=color:#0087ff>Println</span>(<span style=color:#00afaf>&#34;Failed at: &#34;</span>, timeError.t)
		}

                <span style=color:#0087ff>var</span> pathError *os.PathError
                <span style=color:#5f8700>if</span> xerrors.<span style=color:#0087ff>As</span>(err, &amp;pathError) {
                        fmt.<span style=color:#0087ff>Println</span>(<span style=color:#00afaf>&#34;Failed at path:&#34;</span>, pathError.Path)
                }
	}
}</code></pre></td></tr></table></div></div><p>Here&rsquo;s how the new <code>As</code> function helps by taking care of the type assertion. It
receives the error from the <code>openFile</code> function and asserts the error&rsquo;s type to
<code>*ErrorWithTime</code>. If the assertion is successful, it will use its <code>t</code> attribute
to display the time when the error happened.</p><p>The same goes for asserting the error type to <code>*os.PathError</code>. Again, the
<code>*ErrorWithTime</code> implements the <code>Wrapper</code> interface. This allows the
<code>xerrors.As</code> function to unwrap the error and check for the type of the error
under wraps. Let’s run the <code>main</code> function:</p><div class=highlight><div style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#454545">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go>$ <span style=color:#5f8700>go</span> run as.<span style=color:#5f8700>go</span>
Failed at:  <span style=color:#00afaf>2019</span>-<span style=color:#00afaf>04</span>-<span style=color:#00afaf>21</span> <span style=color:#00afaf>18</span>:<span style=color:#00afaf>11</span>:<span style=color:#00afaf>01.922332</span> +<span style=color:#00afaf>0200</span> CEST m=+<span style=color:#00afaf>0.000303480</span>
Failed at path: non-existent</code></pre></td></tr></table></div></div><p>Note that the error type returned from the <code>openFile</code> function is
<code>*ErrorWithTime</code>. But, once it’s casted to a <code>*os.PathError</code> we cannot access
the <code>t</code> attribute. This is because <code>*ErrorWithTime</code> implements <code>t</code> – not
<code>*os.PathError</code>.</p><p>Let&rsquo;s test that with code:</p><div class=highlight><div style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#0087ff>func</span> <span style=color:#0087ff>main</span>() {
	err := <span style=color:#0087ff>openFile</span>(<span style=color:#00afaf>&#34;non-existent-file&#34;</span>)
	<span style=color:#5f8700>if</span> err != <span style=color:#d75f00>nil</span> {
                <span style=color:#0087ff>var</span> pathError *os.PathError
                <span style=color:#5f8700>if</span> xerrors.<span style=color:#0087ff>As</span>(err, &amp;pathError) {
                        fmt.<span style=color:#0087ff>Println</span>(<span style=color:#00afaf>&#34;Failed at path:&#34;</span>, pathError.Path)
                        fmt.<span style=color:#0087ff>Println</span>(<span style=color:#00afaf>&#34;Failed at:&#34;</span>, pathError.t)
                }
	}
}</code></pre></td></tr></table></div></div><p>This fails with the error:</p><div class=highlight><div style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#454545">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>./test.go:44:44: pathError.t undefined (type *os.PathError has no field or method t)</code></pre></td></tr></table></div></div><h3 id=value-checking-with-is>Value checking with <code>Is</code><a hidden class=anchor aria-hidden=true href=#value-checking-with-is>#</a></h3><p>While <code>As</code> allows us to take a value and assert its type, Golang has errors
which are resistive to type assertions. They are special and have a special
name - sentinel errors. Their name descends from the practice in computer
programming of using a specific value to signify that no further processing is
possible.</p><p>When a caller handles a sentinel error, they have to compare the returned error
value to a predeclared value using the equality operator. Here&rsquo;s an example
(adapted from <a href=https://tour.golang.org/methods/21>A Tour of Go</a>) that handles
a <code>io.EOF</code> error:</p><div class=highlight><div style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">18
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#d75f00>package</span> main

<span style=color:#d75f00>import</span> (
	<span style=color:#00afaf>&#34;io&#34;</span>
	<span style=color:#00afaf>&#34;strings&#34;</span>
)

<span style=color:#0087ff>func</span> <span style=color:#0087ff>main</span>() {
	r := strings.<span style=color:#0087ff>NewReader</span>(<span style=color:#00afaf>&#34;Hello, Reader!&#34;</span>)

	b := <span style=color:#0087ff>make</span>([]<span style=color:#af0000>byte</span>, <span style=color:#00afaf>8</span>)
	<span style=color:#5f8700>for</span> {
		_, err := r.<span style=color:#0087ff>Read</span>(b)
		<span style=color:#5f8700>if</span> err == io.EOF {
			<span style=color:#5f8700>break</span>
		}
	}
}</code></pre></td></tr></table></div></div><p>The example above creates a <code>strings.Reader</code> and consumes its output 8 bytes at
a time. When the reading hits a <code>io.EOF</code> (I/O End Of File) error, it will break
the <code>for</code> loop and exit the program.</p><p>So, how does the new <code>Is</code> function help us in such cases? Well, if we would use
the <code>xerrors</code> package in the same example, it would look like this:</p><div class=highlight><div style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">20
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#d75f00>package</span> main

<span style=color:#d75f00>import</span> (
	<span style=color:#00afaf>&#34;io&#34;</span>
	<span style=color:#00afaf>&#34;strings&#34;</span>

	<span style=color:#00afaf>&#34;golang.org/x/xerrors&#34;</span>
)

<span style=color:#0087ff>func</span> <span style=color:#0087ff>main</span>() {
	r := strings.<span style=color:#0087ff>NewReader</span>(<span style=color:#00afaf>&#34;Hello, Reader!&#34;</span>)

	b := <span style=color:#0087ff>make</span>([]<span style=color:#af0000>byte</span>, <span style=color:#00afaf>8</span>)
	<span style=color:#5f8700>for</span> {
		_, err := r.<span style=color:#0087ff>Read</span>(b)
		<span style=color:#5f8700>if</span> xerrors.<span style=color:#0087ff>Is</span>(err, io.EOF) {
			<span style=color:#5f8700>break</span>
		}
	}
}</code></pre></td></tr></table></div></div><p>The change is simple on the surface, but considerable under the hood.
The <code>Is</code> function takes an error value and a sentinel error as arguments. If
the error value implements <code>Wrapper</code>, it will unwrap its chain of error until
it reaches (or not) the sentinel error. Hence, if it finds the sentinel error it
will return <code>true</code>, otherwise <code>false</code>.</p><p>Let&rsquo;s expand the above example with our <code>ErrorWithTime</code> type and see the <code>Is</code>
function in action:</p><div class=highlight><div style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">32
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">33
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">34
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">35
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">36
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">37
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">38
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">39
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">40
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">41
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">42
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">43
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">44
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">45
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">46
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#d75f00>package</span> main

<span style=color:#d75f00>import</span> (
	<span style=color:#00afaf>&#34;fmt&#34;</span>
	<span style=color:#00afaf>&#34;io&#34;</span>
	<span style=color:#00afaf>&#34;strings&#34;</span>
	<span style=color:#00afaf>&#34;time&#34;</span>

	<span style=color:#00afaf>&#34;golang.org/x/xerrors&#34;</span>
)

<span style=color:#0087ff>type</span> ErrorWithTime <span style=color:#0087ff>struct</span> {
	err <span style=color:#af0000>error</span>     <span style=color:#4e4e4e>// the wrapped error
</span><span style=color:#4e4e4e></span>	t   time.Time <span style=color:#4e4e4e>// the time when the error happened
</span><span style=color:#4e4e4e></span>}

<span style=color:#0087ff>func</span> (e *ErrorWithTime) <span style=color:#0087ff>Error</span>() <span style=color:#af0000>string</span> {
	<span style=color:#5f8700>return</span> fmt.<span style=color:#0087ff>Sprintf</span>(<span style=color:#00afaf>&#34;Error: %s, ocurred at: %s\n&#34;</span>, e.err, e.t)
}

<span style=color:#0087ff>func</span> (e *ErrorWithTime) <span style=color:#0087ff>Unwrap</span>() <span style=color:#af0000>error</span> {
	<span style=color:#5f8700>return</span> e.err
}

<span style=color:#0087ff>func</span> <span style=color:#0087ff>readReader</span>(r io.Reader) <span style=color:#af0000>error</span> {
	buffer := <span style=color:#0087ff>make</span>([]<span style=color:#af0000>byte</span>, <span style=color:#00afaf>8</span>)
	<span style=color:#5f8700>for</span> {
		_, err := r.<span style=color:#0087ff>Read</span>(buffer)
		<span style=color:#5f8700>if</span> err != <span style=color:#d75f00>nil</span> {
			<span style=color:#5f8700>return</span> &amp;ErrorWithTime{
				err: err,
				t:   time.<span style=color:#0087ff>Now</span>(),
			}
		}
	}
}

<span style=color:#0087ff>func</span> <span style=color:#0087ff>main</span>() {
	r := strings.<span style=color:#0087ff>NewReader</span>(<span style=color:#00afaf>&#34;Hello, Reader!&#34;</span>)

	err := <span style=color:#0087ff>readReader</span>(r)

	<span style=color:#5f8700>if</span> xerrors.<span style=color:#0087ff>Is</span>(err, io.EOF) {
		fmt.<span style=color:#0087ff>Println</span>(err)
	}
}</code></pre></td></tr></table></div></div><p>When run, this will produce:</p><div class=highlight><div style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#454545">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>$ go run eof.go
Error: EOF, ocurred at: 2019-04-21 11:32:41.842139 +0200 CEST m=+0.000228985</code></pre></td></tr></table></div></div><p>The <code>readReader</code> function takes a <code>io.Reader</code> as argument and read it until the
reading returns an error. When it returns the error, it will wrap it in an
<code>&ErrorWithTime</code> and returned to the caller (<code>main</code>). The caller then uses
<code>xerrors.Is</code> to check if the error returned is actually a <code>io.EOF</code> under wraps.
If it is, it will print the error.</p><p>This works because <code>ErrorWithType</code> implements <code>Wrapper</code>. This allows the caller
to print the error message from the error value, while still being able to
detect the error under wraps.</p><h2 id=putting-it-in-practice-with-xerrors>Putting it in practice with <code>xerrors</code><a hidden class=anchor aria-hidden=true href=#putting-it-in-practice-with-xerrors>#</a></h2><p>So you might be wondering, how you can start using the <code>Is</code> and <code>As</code> functions
in your current Go programs. Well, as you have noticed in the examples we used
the <code>xerrors</code> package. This was in fact announced by Marcel van Lohuizen at
dotGo 2019 in Paris - you can check his talk
<a href=https://www.dotconferences.com/2019/03/marcel-van-lohuizen-go-2-error-values-today>here</a>.
(If you&rsquo;re curious how the event was in general, I published a report on it
<a href=/my-first-dotgo-conference>here</a>.)</p><p>The <code>xerrors</code> package is built to support transitioning to the Go 2 proposal
for error values. Most of the functions and types from <code>xerrors</code> will be
incorporated into the standard library’s errors package in Go 1.13. The idea is
that by using this package you can make your Go 1.12 code be compatible with
1.13 (and later version 2).</p><p>You can read its <a href=https://godoc.org/golang.org/x/xerrors>documentation</a> and
check out the examples included.</p><p>It is also worth mentioning that replacing equality checks with <code>xerrors.Is</code>
and type assertions with <code>xerrors.As</code> will not change the meaning of existing
programs that do not wrap errors and it will future-proof programs against
wrapping.</p><p>As with any language changes, there will be situations where the new functions
will not do the trick. For example, sometimes callers want to perform many
checks against the same error. One such case would be when the caller would
compare the error value against more than one sentinel value. In such cases we
can still use Is and As. The drawback is in the way these functions walk
through the chain of wrapped errors. This means they would walk up the chain
multiple times, which is wasteful.</p><p>In any case, improving the situation with error inspection in Go is a good step
forward. I am used to more conventional error handling. Still, I think that
this is not a step in the wrong direction when it comes to error inspection.
Also, I recommend reading the
<a href=https://go.googlesource.com/proposal/+/master/design/go2draft-error-inspection.md#discussion>discussion</a>
section of the error inspection draft. It lays out some good guidelines on how
to define and use your error types.</p><p>What is your opinion on the proposal? Do you think it will simplify your life
as a Go developer? Or do you maybe prefer a different approach? Let me know in
the comments below!</p><section class=subscribe><b>Liked this article?</b>
You can <a href=https://www.buymeacoffee.com/ieftimov>buy me a coffee</a>.
Or simply <a href=/newsletter>subscribe to my
newsletter</a> and get my fresh posts in your inbox. It's short and sweet,
going out monthly to over 1,000 subscribers.</section></div><footer class=post-footer><ul class=post-tags><li><a href=https://ieftimov.com/tags/errors/>errors</a></li></ul><nav class=paginav><a class=prev href=https://ieftimov.com/post/testing-in-go-first-principles/><span class=title>« Prev Page</span><br><span>Testing in Go: First Principles</span></a>
<a class=next href=https://ieftimov.com/post/my-first-dotgo-conference/><span class=title>Next Page »</span><br><span>My First dotGo Conference</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Deep Dive in the Upcoming Go Error Inspection Changes on twitter" href="https://twitter.com/intent/tweet/?text=Deep%20Dive%20in%20the%20Upcoming%20Go%20Error%20Inspection%20Changes&url=https%3a%2f%2fieftimov.com%2fpost%2fdeep-dive-in-upcoming-go-error-inspection-changes%2f&hashtags=errors"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Deep Dive in the Upcoming Go Error Inspection Changes on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fieftimov.com%2fpost%2fdeep-dive-in-upcoming-go-error-inspection-changes%2f&title=Deep%20Dive%20in%20the%20Upcoming%20Go%20Error%20Inspection%20Changes&summary=Deep%20Dive%20in%20the%20Upcoming%20Go%20Error%20Inspection%20Changes&source=https%3a%2f%2fieftimov.com%2fpost%2fdeep-dive-in-upcoming-go-error-inspection-changes%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Deep Dive in the Upcoming Go Error Inspection Changes on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fieftimov.com%2fpost%2fdeep-dive-in-upcoming-go-error-inspection-changes%2f&title=Deep%20Dive%20in%20the%20Upcoming%20Go%20Error%20Inspection%20Changes"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Deep Dive in the Upcoming Go Error Inspection Changes on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fieftimov.com%2fpost%2fdeep-dive-in-upcoming-go-error-inspection-changes%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Deep Dive in the Upcoming Go Error Inspection Changes on whatsapp" href="https://api.whatsapp.com/send?text=Deep%20Dive%20in%20the%20Upcoming%20Go%20Error%20Inspection%20Changes%20-%20https%3a%2f%2fieftimov.com%2fpost%2fdeep-dive-in-upcoming-go-error-inspection-changes%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Deep Dive in the Upcoming Go Error Inspection Changes on telegram" href="https://telegram.me/share/url?text=Deep%20Dive%20in%20the%20Upcoming%20Go%20Error%20Inspection%20Changes&url=https%3a%2f%2fieftimov.com%2fpost%2fdeep-dive-in-upcoming-go-error-inspection-changes%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>Copyright 2021 © Ilija Eftimov</span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>let menu=document.getElementById('menu');menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script></body></html>