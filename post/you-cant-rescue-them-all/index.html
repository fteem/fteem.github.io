<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>You Can&#39;t Rescue Them All - Ilija Eftimov</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta property="og:title" content="You Can&#39;t Rescue Them All" />
<meta property="og:description" content="Imagine you just woke up, took a shower and you immediately go to your coffee machine to make that strong, large, morning, double-shot, extra-spice-and-everything-nice cup of coffee. Sure, you go to the machine, press some buttons and the next thing you know, you are waiting for the coffee to start pouring into your cup. And then, something&#39;s not right, and something starts to smell bad. A morning nightmare, right?
Nothing Works All the Time You know, most of the things in our daily lives do not work at 100%." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ieftimov.com/post/you-cant-rescue-them-all/" />
<meta property="og:image" content="https://ieftimov.com/cards/you-cant-rescue-them-all.png" />
<meta property="article:published_time" content="2016-03-25T00:00:00+00:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://ieftimov.com/cards/you-cant-rescue-them-all.png"/>

<meta name="twitter:title" content="You Can&#39;t Rescue Them All"/>
<meta name="twitter:description" content="Imagine you just woke up, took a shower and you immediately go to your coffee machine to make that strong, large, morning, double-shot, extra-spice-and-everything-nice cup of coffee. Sure, you go to the machine, press some buttons and the next thing you know, you are waiting for the coffee to start pouring into your cup. And then, something&#39;s not right, and something starts to smell bad. A morning nightmare, right?
Nothing Works All the Time You know, most of the things in our daily lives do not work at 100%."/>
<link href='https://fonts.googleapis.com/css?family=Playfair+Display:700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" media="screen" href="https://ieftimov.com/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://ieftimov.com/css/main.css" />
		<link rel="stylesheet" type="text/css" href="https://ieftimov.com/css/overrides.css" />
	

	<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
		<script src="https://ieftimov.com/js/main.js"></script><script src="https://ieftimov.com/js/tooltip.js"></script>
</head>

<body>
	<div class="container wrapper">
		<div class="header">
	
		<div class="avatar">
			<a href="https://ieftimov.com/">
				<img src="https://pbs.twimg.com/profile_images/1194757753585225728/JbET17PZ_400x400.jpg" alt="Ilija Eftimov" />
			</a>
		</div>
	
	<h1 class="site-title"><a href="https://ieftimov.com/">Ilija Eftimov</a></h1>
	<div class="site-description"><p>Software engineer, author and open source contributor</p><nav class="nav social">
			<ul class="flat"><li><a href="https://github.com/fteem" title="Github"><i data-feather="github"></i></a></li><li><a href="https://twitter.com/fteem" title="Twitter"><i data-feather="twitter"></i></a></li><li><a href="https://www.linkedin.com/in/ieftimov" title="Linkedin"><i data-feather="linkedin"></i></a></li><li><a href="mailto:blog@ieftimov.com" title="Email"><i data-feather="mail"></i></a></li></ul>
		</nav>
	</div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="/">Home</a>
			</li>
			
			<li>
				<a href="/categories/testing-in-go">Testing in Go</a>
			</li>
			
			<li>
				<a href="/posts">Archive</a>
			</li>
			
			<li>
				<a href="/about">About</a>
			</li>
			
			<li>
				<a href="https://forms.gle/orfXK5jh1LRaiFzo8">Suggest a topic</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post">
			<div class="post-header">
				
					<div class="meta">
						<div class="date">
							<span class="day">25</span>
							<span class="rest">Mar 2016</span>
						</div>
					</div>
				
				<div class="matter">
					<h1 class="title">You Can&#39;t Rescue Them All</h1>
				</div>
			</div>
					
			<div class="markdown">
				<p>Imagine you just woke up, took a shower and you immediately go to your coffee
machine to make that strong, large, morning, double-shot,
extra-spice-and-everything-nice cup of coffee. Sure, you go to the machine,
press some buttons and the next thing you know, you are waiting for the coffee
to start pouring into your cup. And then, something's not right, and something
starts to smell bad. A morning nightmare, right?</p>
<h2 id="nothing-works-all-the-time">Nothing Works All the Time</h2>
<p>You know, most of the things in our daily lives do not work at 100%. The nice
thing is that we never expect them to do that. Yeah, sure, if something breaks,
like that coffee machine, it might give us a slight frustration (especially in
the morning), but we won't lose our shit to it. We usually either try to fix
it, of course, by turning it off and on again. Or we just throw it away and buy
a new thing. And as a side-win, it's what drives our economy forward.</p>
<p>But what's really frustrating for us developers is that software does an
exceptionally good job of misbehaving. Now this is where things can get hairy.
Our software is not always prepared for errors. In fact we usually think about
our code as this bulletproof titanium brick that does not fail under any
circumstances. But more then often, our bulletproof software can get nuked.
Houston, we have a problem.</p>
<h2 id="handling-exceptions">Handling Exceptions</h2>
<p>What I really dislike about the whole culture in programming about exceptions,
is that it's being taught as this really unimportant thing. We study them
briefly, usually one chapter in a book and we think we are done with it. Yeah,
until we get hit by a &ldquo;broken coffee machine&rdquo; problem and then we try to deal
with them.</p>
<p>In Ruby, we all know how to deal with exceptions. Sure, the syntax is nice:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="font-weight:bold">begin</span>
  <span style="color:#998;font-style:italic"># Some HTTP requests here...</span>
<span style="font-weight:bold">rescue</span> <span style="color:#008080">Timeout</span><span style="font-weight:bold">::</span><span style="color:#008080">Error</span> <span style="font-weight:bold">=</span><span style="font-weight:bold">&gt;</span> e
  <span style="color:#008080">Logger</span><span style="font-weight:bold">.</span>debug <span style="color:#b84">&#34;</span><span style="color:#b84">Timeout error:</span><span style="color:#b84">&#34;</span>
  <span style="color:#008080">Logger</span><span style="font-weight:bold">.</span>debug e<span style="font-weight:bold">.</span>message
<span style="font-weight:bold">end</span></code></pre></div>
<p>We wrap the code that we suspect will fail in a <code>begin</code> &amp; <code>rescue</code> blocks and we
can properly handle the exceptions. Sure, this works well, but I would like you
to focus on something else for this article - the exception class.</p>
<h2 id="what-should-we-rescue">What should we rescue?</h2>
<p>I am sure you have seen some piece of code where someone knew that an exception
could be thrown, and that person thinks they've done a good job by rescuing
<code>Exception</code>.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="font-weight:bold">begin</span>
  <span style="color:#998;font-style:italic"># Read a file</span>
  <span style="color:#998;font-style:italic"># Parse the file</span>
  <span style="color:#998;font-style:italic"># Send the parsed data to API</span>
<span style="font-weight:bold">rescue</span> <span style="color:#008080">Exception</span> <span style="font-weight:bold">=</span><span style="font-weight:bold">&gt;</span> e
  <span style="color:#008080">Logger</span><span style="font-weight:bold">.</span>debug <span style="color:#b84">&#34;</span><span style="color:#b84">Exceptions raised:</span><span style="color:#b84">&#34;</span>
  <span style="color:#008080">Logger</span><span style="font-weight:bold">.</span>debug e<span style="font-weight:bold">.</span>message
<span style="font-weight:bold">end</span></code></pre></div>
<p>Right, all good? Sure, we could have done more with the <code>rescue</code> block, but at
least we log the exceptions somewhere so we can more easily view them in the
future. There's a problem with this approach - you are essentially rescuing a
metric ton of Ruby exceptions. And if this is a piece of code in a Rails
application - the list is even longer. You are looking at couple of hundred
exception types!</p>
<p>And if you think that it's fine, I have a question for you. Do you take the
same measures/actions when your car:</p>
<ol>
<li>Has a blown up tire?</li>
<li>The engine does not want to start?</li>
<li>Door is frozen, because it's freezing cold outside?</li>
</ol>
<p>Of course you don't. Fixing a blown tire by looking under the hood would be
pretty silly, right? Well, it's the same as software - whatever goes wrong we
need to act accordingly, without generalisations.</p>
<p>For example, if a file will not open, there can be multiple reasons:</p>
<ol>
<li>Permissions</li>
<li>Corrupt file</li>
<li>The stream is prematurely closed, or was never opened</li>
<li>File does not exist</li>
</ol>
<p>Having all of these things in mind, we would need to write something like this:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#999">require</span> <span style="color:#b84">&#39;json&#39;</span>

<span style="font-weight:bold">begin</span>
  contents <span style="font-weight:bold">=</span> <span style="color:#008080">File</span><span style="font-weight:bold">.</span>read(<span style="color:#b84">&#34;</span><span style="color:#b84">users.json</span><span style="color:#b84">&#34;</span>)
  <span style="color:#008080">JSON</span><span style="font-weight:bold">.</span>parse(contents)
<span style="font-weight:bold">rescue</span> <span style="color:#008080">IOError</span> <span style="font-weight:bold">=</span><span style="font-weight:bold">&gt;</span> e
  $stdout<span style="font-weight:bold">.</span>puts e<span style="font-weight:bold">.</span>message <span style="color:#998;font-style:italic">#</span>
<span style="font-weight:bold">rescue</span> <span style="color:#008080">Errno</span><span style="font-weight:bold">::</span><span style="color:#008080">EACCES</span> <span style="font-weight:bold">=</span><span style="font-weight:bold">&gt;</span> e
  $stdout<span style="font-weight:bold">.</span>puts e<span style="font-weight:bold">.</span>message
  $stdout<span style="font-weight:bold">.</span>puts <span style="color:#b84">&#34;</span><span style="color:#b84">Will try to fix permissions and retry...</span><span style="color:#b84">&#34;</span>
  <span style="color:#999">system</span>(<span style="color:#b84">&#39;chmod +r users.json&#39;</span>)
  <span style="font-weight:bold">retry</span>
<span style="font-weight:bold">rescue</span> <span style="color:#008080">Errno</span><span style="font-weight:bold">::</span><span style="color:#008080">ENOENT</span> <span style="font-weight:bold">=</span><span style="font-weight:bold">&gt;</span> e
  $stdout<span style="font-weight:bold">.</span>puts e<span style="font-weight:bold">.</span>message <span style="color:#998;font-style:italic"># File does not exist</span>
  <span style="color:#999">exit</span>(<span style="color:#099">1</span><span style="font-weight:bold"></span>)
<span style="font-weight:bold">end</span></code></pre></div>
<p>Sure, this might seem a bit overcomplicated for most of the cases that you will
see in your day job, but I think that it paints the picture well. Our software
should know how to take care of different cases of misbehaviour.</p>
<h2 id="outro">Outro</h2>
<p>As a rule of thumb, you should keep your rescues short and sweet. And very
specific. You should think about in what ways your program can misbehave and
how you can recover from that error. Sure, it definitely is not that easy, but
if your throw couple of random values at your code in the tests, you can easily
spot some of the misbehaviours.</p>
<p>In the end, I'll leave you with this quote, from Betrand Meyer, from his book
<em>Object Oriented Software Construction</em>:</p>
<blockquote>
<p>In practice, the rescue clause should be a short sequence of simple
instructions designed to bring the object back to a stable state and to either
retry the operation or terminate with failure.</p>
</blockquote>
<p>And if you want to learn more about exception handling in Ruby, I recommend
<a href="http://exceptionalruby.com/">Exceptional Ruby</a>, by Avdi Grimm.</p>

			</div>

			<div class="tags">
				
					
						<ul class="flat">
							
							<li><a href="/tags/exceptions">exceptions</a></li>
							
						</ul>
					
				
			</div><div id="disqus_thread"></div>
<script type="text/javascript">
	(function () {
		
		
		if (window.location.hostname == "localhost")
			return;

		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		var disqus_shortname = 'eftimov';
		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
</script>
<noscript>Please enable JavaScript to view the </a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
	</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div> Copyright © 2014 - 2020 Ilija Eftimov |  <a href="https://github.com/knadh/hugo-ink">Ink</a> theme on <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-11264459-2', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<script>feather.replace()</script>
</body>
</html>
