<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Testing in Go: Dependency Injection | Ilija Eftimov ⚡️</title><meta name=keywords content><meta name=description content="In software engineering, over the years folks have developed many patterns, techniques and refactoring maneuvers. Some have been long forgotten, while others have stood the test of times.
Such a long-standing technique is dependency injection. It is a concept and a programming technique where a construct is passed (injected) to another construct that depends on it.
In Golang, like in other languages, we use it to simplify our code and make it more testable."><meta name=author content="Ilija"><link rel=canonical href=https://ieftimov.com/post/testing-in-go-dependency-injection/><link href=/assets/css/stylesheet.min.css rel="preload stylesheet" as=style><link rel=icon href=https://ieftimov.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://ieftimov.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://ieftimov.com/favicon-32x32.png><link rel=apple-touch-icon href=https://ieftimov.com/apple-touch-icon.png><link rel=mask-icon href=https://ieftimov.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.81.0"><script async defer data-domain=ieftimov.com src=https://plausible.io/js/plausible.js></script><meta property="og:title" content="Testing in Go: Dependency Injection"><meta property="og:description" content="In software engineering, over the years folks have developed many patterns, techniques and refactoring maneuvers. Some have been long forgotten, while others have stood the test of times.
Such a long-standing technique is dependency injection. It is a concept and a programming technique where a construct is passed (injected) to another construct that depends on it.
In Golang, like in other languages, we use it to simplify our code and make it more testable."><meta property="og:type" content="article"><meta property="og:url" content="https://ieftimov.com/post/testing-in-go-dependency-injection/"><meta property="og:image" content="https://ieftimov.com/cards/testing-in-go-dependency-injection.png"><meta property="article:published_time" content="2019-12-01T00:00:00+00:00"><meta property="article:modified_time" content="2019-12-01T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://ieftimov.com/cards/testing-in-go-dependency-injection.png"><meta name=twitter:title content="Testing in Go: Dependency Injection"><meta name=twitter:description content="In software engineering, over the years folks have developed many patterns, techniques and refactoring maneuvers. Some have been long forgotten, while others have stood the test of times.
Such a long-standing technique is dependency injection. It is a concept and a programming technique where a construct is passed (injected) to another construct that depends on it.
In Golang, like in other languages, we use it to simplify our code and make it more testable."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://ieftimov.com/posts/"},{"@type":"ListItem","position":2,"name":"Testing in Go: Dependency Injection","item":"https://ieftimov.com/post/testing-in-go-dependency-injection/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Testing in Go: Dependency Injection","name":"Testing in Go: Dependency Injection","description":"In software engineering, over the years folks have developed many patterns, techniques and refactoring maneuvers. Some have been long forgotten, while others have stood the test of …","keywords":[],"articleBody":"In software engineering, over the years folks have developed many patterns, techniques and refactoring maneuvers. Some have been long forgotten, while others have stood the test of times.\nSuch a long-standing technique is dependency injection. It is a concept and a programming technique where a construct is passed (injected) to another construct that depends on it.\nIn Golang, like in other languages, we use it to simplify our code and make it more testable. But, how much more? Let’s code through an example and see how dependency injection can help us out.\nSending notifications Imagine we are building an e-commerce website where people buy goods and we ship them the goods. When their order ships, we want to inform them through a notification.\nLet’s look at a very simple simulation of sending an SMS notification over an API:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19  package notifications import ( \"fmt\" \"github.com/fteem/order-notifications/sms\" \"github.com/fteem/order-notifications/user\" ) func InformOrderShipped(receiver user.User, orderID string) bool { message := fmt.Sprintf(\"Your order #%s is shipped!\", orderID) err := sms.Send(receiver, message) if err != nil { return false } return true }    For the sake of the example, we’ll simulate a network call in the sms.Send with arbitrary sleep time, so the function takes a few seconds to execute:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14  package sms import ( \"time\" \"github.com/fteem/order-notifications/user\" ) func Send(receiver user.User, message string) error { // Simulating API call... \ttime.Sleep(3 * time.Second) return nil }    Let us see a simple test for the InformOrderShipped function and what kind of challenges it brings:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18  package notifications import \"testing\" func TestInformOrderShipped(t *testing.T) { user := User{ Name: \"Peggy\", Phone: \"+12 345 678 999\", } orderID := \"12345\" got := InformOrderShipped(user, orderID) want := true if want != got { t.Errorf(\"Want '%t', got '%t'\", want, got) } }    While these tests do test the functionality of InformOrderShipped, it already has two issues:\n It lasts three seconds because of invoking sms.Send sleeps for three seconds. There’s no way to easily test what would happen if sms.Send actually returns an error.  Issue number one is something we can ignore for now, as it’s only a side-effect of the implementation of sms.Send. Issue number two, the lack of an easy way to mock sms.Send, is larger so we will address it first.\nInjecting the ability to send SMSes The simplest maneuver we can do in InformOrderShipped, instead of depending on the sms package, is to pass in the Send function as a function closure argument:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18  package notifications import ( \"fmt\" \"github.com/fteem/order-notifications/user\" ) func InformOrderShipped(receiver user.User, orderID string, sendSMS func(user.User, string) error) bool { message := fmt.Sprintf(\"Your order #%s is shipped!\", orderID) err := sendSMS(receiver, message) if err != nil { return false } return true }    Because Go allows us to provide the function as an argument, all we need to do is to specify its arguments and return types and invoke it in the main function. Just by having this in place, we achieve:\n Injecting the dependency on the sms.Send function, using a type rather then importing the actual function. We remove the explicit dependency on the sms package. We make our code easy to mock and test.  To prove these points, we will modify the test to include the two scenarios, when the SMS is successfully sent and when it returns an error:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47  package notifications import ( \"errors\" \"testing\" \"github.com/fteem/order-notifications/user\" ) func TestInformOrderShipped(t *testing.T) { cases := []struct { user user.User orderID string sendingError error name string want bool }{ { user: user.User{\"Peggy\", \"+12 345 678 999\"}, orderID: \"12345\", sendingError: nil, want: true, name: \"Successful send\", }, { user: user.User{\"Peggy\", \"+12 345 678 999\"}, orderID: \"12345\", sendingError: errors.New(\"Sending failed\"), want: false, name: \"Unsuccessful send\", }, } for _, tc := range cases { t.Run(tc.name, func(t *testing.T) { mockSend := func(user.User, string) error { return tc.sendingError } got := InformOrderShipped(tc.user, tc.orderID, mockSend) if tc.want != got { t.Errorf(\"Want '%t', got '%t'\", tc.want, got) } }) } }    In the test we use the table-driven approach, where we define two different test cases: when the SMS sending fails and when it does not.\nBecause our InformOrderShipped function expects a function as a third argument, in our test we create a function mock that has no functionality but returning an error value.\nThis allows us to pass in the mocked function, easily control its return value and avoid waiting for three seconds for the test to finish. We decouple our code, we make it more testable and, on top of that, it executes instantly.\nBut, can we take this further?\nNotifications are more than SMS SMSes are a bit outdated. Nowadays we very often rely on our cellular internet connections, native apps and push notifications to get real-time information about our orders. Also, as much as we dislike it, email is still the online communication king.\nBut you know what’s the best of the three? All of them. People want to be kept in the know, especially when the items that they spend their hard-earned monies on have been dispatched.\nSo, how can we make our code even more flexible, while keeping it easy to test and maintain?\nInterfaces to the rescue!\nGolang interfaces are a powerful construct. They are simple, named collections of method signatures. Interfaces are implicitly implemented, meaning a type implements an interface by implementing the functions specified in the interface. No need for explicit implements statements. (Yes, like yours Java.)\nLet’s introduce an interface called Sender, which defines a Send function:\n1 2 3  type Sender interface { Send(user.User, string) error }    Those of you that are very attentive will notice that the Send function in Sender has the same signature as the sms.Send function from the earlier example. That’s intentional - we want any implementor of the Sender interface to be able to send a notification to a User.\nLet’s make a sms.Dispatcher type which will implement the Sender interface and use it in our code:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16  package sms import ( \"time\" \"github.com/fteem/order-notifications/user\" ) type Dispatcher struct{} func (d Dispatcher) Send(receiver user.User, message string) error { // Simulating API call... \ttime.Sleep(3 * time.Second) return nil }    Now, we can pass an instance of the Dispatcher type in the InformOrderShipped function, which will invoke its Send function. Given that we already have the Sender interface defined, we can use it as an argument:\n1 2 3 4 5 6 7 8 9 10  func InformOrderShipped(receiver user.User, orderID string, sender Sender) bool { message := fmt.Sprintf(\"Your order #%s is shipped!\", orderID) err := sender.Send(receiver, message) if err != nil { return false } return true }    Why? Well, Dispatcher already implements the Sender function, which means that we can pass an instance and it will work. Here’s an example:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14  package main import ( \"github.com/fteem/order-notifications/orders\" \"github.com/fteem/order-notifications/sms\" \"github.com/fteem/order-notifications/user\" ) func main() { u := user.User{\"Peggy\", \"+123 456 789\"} orderID := \"123\" dispatcher := sms.Dispatcher{} orders.InformOrderShipped(u, orderID, dispatcher) }    How does such a change influence our tests? Interestingly, it doesn’t. While we lose the ability to pass in a function closure as an argument, we can still create a mock type that implements the Sender interface and use it as argument to the InformOrderShipped function:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52  package orders import ( \"errors\" \"testing\" \"github.com/fteem/order-notifications/user\" ) type mockSender struct { sendingError error } func (ms mockSender) Send(u user.User, m string) error { return ms.sendingError } func TestInformOrderShipped(t *testing.T) { cases := []struct { user user.User orderID string sendingError error name string want bool }{ { user: user.User{\"Peggy\", \"+12 345 678 999\"}, orderID: \"12345\", sendingError: nil, want: true, name: \"Successful send\", }, { user: user.User{\"Peggy\", \"+12 345 678 999\"}, orderID: \"12345\", sendingError: errors.New(\"Sending failed\"), want: false, name: \"Unsuccessful send\", }, } for _, tc := range cases { t.Run(tc.name, func(t *testing.T) { ms := mockSender{tc.sendingError} got := InformOrderShipped(tc.user, tc.orderID, ms) if tc.want != got { t.Errorf(\"Want '%t', got '%t'\", tc.want, got) } }) } }    Just a simple mockSender type does the trick. Because it implements the Send function and due to Go’s implicitly implementing interfaces mockSender is also a Sender. That means we can use it as an argument to the InformOrderShipped function.\n Coming soon!I am planning a course on testing in Go. Would you like to get a (free) sneak peek while I am building it? Sign up now!\nSubscribeI respect your privacy. Unsubscribe at any time. No spam, ever.\n.formkit-form[data-uid=\"d2c78f7648\"] *{box-sizing:border-box;}.formkit-form[data-uid=\"d2c78f7648\"]{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;}.formkit-form[data-uid=\"d2c78f7648\"] legend{border:none;font-size:inherit;margin-bottom:10px;padding:0;position:relative;display:table;}.formkit-form[data-uid=\"d2c78f7648\"] fieldset{border:0;padding:0.01em 0 0 0;margin:0;min-width:0;}.formkit-form[data-uid=\"d2c78f7648\"] body:not(:-moz-handler-blocked) fieldset{display:table-cell;}.formkit-form[data-uid=\"d2c78f7648\"] h1,.formkit-form[data-uid=\"d2c78f7648\"] h2,.formkit-form[data-uid=\"d2c78f7648\"] h3,.formkit-form[data-uid=\"d2c78f7648\"] h4,.formkit-form[data-uid=\"d2c78f7648\"] h5,.formkit-form[data-uid=\"d2c78f7648\"] h6{color:inherit;font-size:inherit;font-weight:inherit;}.formkit-form[data-uid=\"d2c78f7648\"] p{color:inherit;font-size:inherit;font-weight:inherit;}.formkit-form[data-uid=\"d2c78f7648\"] ol:not([template-default]),.formkit-form[data-uid=\"d2c78f7648\"] ul:not([template-default]),.formkit-form[data-uid=\"d2c78f7648\"] blockquote:not([template-default]){text-align:left;}.formkit-form[data-uid=\"d2c78f7648\"] p:not([template-default]),.formkit-form[data-uid=\"d2c78f7648\"] hr:not([template-default]),.formkit-form[data-uid=\"d2c78f7648\"] blockquote:not([template-default]),.formkit-form[data-uid=\"d2c78f7648\"] ol:not([template-default]),.formkit-form[data-uid=\"d2c78f7648\"] ul:not([template-default]){color:inherit;font-style:initial;}.formkit-form[data-uid=\"d2c78f7648\"][data-format=\"modal\"]{display:none;}.formkit-form[data-uid=\"d2c78f7648\"][data-format=\"slide in\"]{display:none;}.formkit-form[data-uid=\"d2c78f7648\"] .formkit-input,.formkit-form[data-uid=\"d2c78f7648\"] .formkit-select,.formkit-form[data-uid=\"d2c78f7648\"] .formkit-checkboxes{width:100%;}.formkit-form[data-uid=\"d2c78f7648\"] .formkit-button,.formkit-form[data-uid=\"d2c78f7648\"] .formkit-submit{border:0;border-radius:5px;color:#ffffff;cursor:pointer;display:inline-block;text-align:center;font-size:15px;font-weight:500;cursor:pointer;margin-bottom:15px;overflow:hidden;padding:0;position:relative;vertical-align:middle;}.formkit-form[data-uid=\"d2c78f7648\"] .formkit-button:hover,.formkit-form[data-uid=\"d2c78f7648\"] .formkit-submit:hover,.formkit-form[data-uid=\"d2c78f7648\"] .formkit-button:focus,.formkit-form[data-uid=\"d2c78f7648\"] .formkit-submit:focus{outline:none;}.formkit-form[data-uid=\"d2c78f7648\"] .formkit-button:hover  span,.formkit-form[data-uid=\"d2c78f7648\"] .formkit-submit:hover  span,.formkit-form[data-uid=\"d2c78f7648\"] .formkit-button:focus  span,.formkit-form[data-uid=\"d2c78f7648\"] .formkit-submit:focus  span{background-color:rgba(0,0,0,0.1);}.formkit-form[data-uid=\"d2c78f7648\"] .formkit-button  span,.formkit-form[data-uid=\"d2c78f7648\"] .formkit-submit  span{display:block;-webkit-transition:all 300ms ease-in-out;transition:all 300ms ease-in-out;padding:12px 24px;}.formkit-form[data-uid=\"d2c78f7648\"] .formkit-input{background:#ffffff;font-size:15px;padding:12px;border:1px solid #e3e3e3;-webkit-flex:1 0 auto;-ms-flex:1 0 auto;flex:1 0 auto;line-height:1.4;margin:0;-webkit-transition:border-color ease-out 300ms;transition:border-color ease-out 300ms;}.formkit-form[data-uid=\"d2c78f7648\"] .formkit-input:focus{outline:none;border-color:#1677be;-webkit-transition:border-color ease 300ms;transition:border-color ease 300ms;}.formkit-form[data-uid=\"d2c78f7648\"] .formkit-input::-webkit-input-placeholder{color:inherit;opacity:0.8;}.formkit-form[data-uid=\"d2c78f7648\"] .formkit-input::-moz-placeholder{color:inherit;opacity:0.8;}.formkit-form[data-uid=\"d2c78f7648\"] .formkit-input:-ms-input-placeholder{color:inherit;opacity:0.8;}.formkit-form[data-uid=\"d2c78f7648\"] .formkit-input::placeholder{color:inherit;opacity:0.8;}.formkit-form[data-uid=\"d2c78f7648\"] [data-group=\"dropdown\"]{position:relative;display:inline-block;width:100%;}.formkit-form[data-uid=\"d2c78f7648\"] [data-group=\"dropdown\"]::before{content:\"\";top:calc(50% - 2.5px);right:10px;position:absolute;pointer-events:none;border-color:#4f4f4f transparent transparent transparent;border-style:solid;border-width:6px 6px 0 6px;height:0;width:0;z-index:999;}.formkit-form[data-uid=\"d2c78f7648\"] [data-group=\"dropdown\"] select{height:auto;width:100%;cursor:pointer;color:#333333;line-height:1.4;margin-bottom:0;padding:0 6px;-webkit-appearance:none;-moz-appearance:none;appearance:none;font-size:15px;padding:12px;padding-right:25px;border:1px solid #e3e3e3;background:#ffffff;}.formkit-form[data-uid=\"d2c78f7648\"] [data-group=\"dropdown\"] select:focus{outline:none;}.formkit-form[data-uid=\"d2c78f7648\"] [data-group=\"checkboxes\"]{text-align:left;margin:0;}.formkit-form[data-uid=\"d2c78f7648\"] [data-group=\"checkboxes\"] [data-group=\"checkbox\"]{margin-bottom:10px;}.formkit-form[data-uid=\"d2c78f7648\"] [data-group=\"checkboxes\"] [data-group=\"checkbox\"] *{cursor:pointer;}.formkit-form[data-uid=\"d2c78f7648\"] [data-group=\"checkboxes\"] [data-group=\"checkbox\"]:last-of-type{margin-bottom:0;}.formkit-form[data-uid=\"d2c78f7648\"] [data-group=\"checkboxes\"] [data-group=\"checkbox\"] input[type=\"checkbox\"]{display:none;}.formkit-form[data-uid=\"d2c78f7648\"] [data-group=\"checkboxes\"] [data-group=\"checkbox\"] input[type=\"checkbox\"] + label::after{content:none;}.formkit-form[data-uid=\"d2c78f7648\"] [data-group=\"checkboxes\"] [data-group=\"checkbox\"] input[type=\"checkbox\"]:checked + label::after{border-color:#ffffff;content:\"\";}.formkit-form[data-uid=\"d2c78f7648\"] [data-group=\"checkboxes\"] [data-group=\"checkbox\"] input[type=\"checkbox\"]:checked + label::before{background:#10bf7a;border-color:#10bf7a;}.formkit-form[data-uid=\"d2c78f7648\"] [data-group=\"checkboxes\"] [data-group=\"checkbox\"] label{position:relative;display:inline-block;padding-left:28px;}.formkit-form[data-uid=\"d2c78f7648\"] [data-group=\"checkboxes\"] [data-group=\"checkbox\"] label::before,.formkit-form[data-uid=\"d2c78f7648\"] [data-group=\"checkboxes\"] [data-group=\"checkbox\"] label::after{position:absolute;content:\"\";display:inline-block;}.formkit-form[data-uid=\"d2c78f7648\"] [data-group=\"checkboxes\"] [data-group=\"checkbox\"] label::before{height:16px;width:16px;border:1px solid #e3e3e3;background:#ffffff;left:0px;top:3px;}.formkit-form[data-uid=\"d2c78f7648\"] [data-group=\"checkboxes\"] [data-group=\"checkbox\"] label::after{height:4px;width:8px;border-left:2px solid #4d4d4d;border-bottom:2px solid #4d4d4d;-webkit-transform:rotate(-45deg);-ms-transform:rotate(-45deg);transform:rotate(-45deg);left:4px;top:8px;}.formkit-form[data-uid=\"d2c78f7648\"] .formkit-alert{background:#f9fafb;border:1px solid #e3e3e3;border-radius:5px;-webkit-flex:1 0 auto;-ms-flex:1 0 auto;flex:1 0 auto;list-style:none;margin:25px auto;padding:12px;text-align:center;width:100%;}.formkit-form[data-uid=\"d2c78f7648\"] .formkit-alert:empty{display:none;}.formkit-form[data-uid=\"d2c78f7648\"] .formkit-alert-success{background:#d3fbeb;border-color:#10bf7a;color:#0c905c;}.formkit-form[data-uid=\"d2c78f7648\"] .formkit-alert-error{background:#fde8e2;border-color:#f2643b;color:#ea4110;}.formkit-form[data-uid=\"d2c78f7648\"] .formkit-spinner{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:0px;width:0px;margin:0 auto;position:absolute;top:0;left:0;right:0;width:0px;overflow:hidden;text-align:center;-webkit-transition:all 300ms ease-in-out;transition:all 300ms ease-in-out;}.formkit-form[data-uid=\"d2c78f7648\"] .formkit-spinner  div{margin:auto;width:12px;height:12px;background-color:#fff;opacity:0.3;border-radius:100%;display:inline-block;-webkit-animation:formkit-bouncedelay-formkit-form-data-uid-d2c78f7648- 1.4s infinite ease-in-out both;animation:formkit-bouncedelay-formkit-form-data-uid-d2c78f7648- 1.4s infinite ease-in-out both;}.formkit-form[data-uid=\"d2c78f7648\"] .formkit-spinner  div:nth-child(1){-webkit-animation-delay:-0.32s;animation-delay:-0.32s;}.formkit-form[data-uid=\"d2c78f7648\"] .formkit-spinner  div:nth-child(2){-webkit-animation-delay:-0.16s;animation-delay:-0.16s;}.formkit-form[data-uid=\"d2c78f7648\"] .formkit-submit[data-active] .formkit-spinner{opacity:1;height:100%;width:50px;}.formkit-form[data-uid=\"d2c78f7648\"] .formkit-submit[data-active] .formkit-spinner ~ span{opacity:0;}.formkit-form[data-uid=\"d2c78f7648\"] .formkit-powered-by[data-active=\"false\"]{opacity:0.35;}@-webkit-keyframes formkit-bouncedelay-formkit-form-data-uid-d2c78f7648-{0%,80%,100%{-webkit-transform:scale(0);-ms-transform:scale(0);transform:scale(0);}40%{-webkit-transform:scale(1);-ms-transform:scale(1);transform:scale(1);}}@keyframes formkit-bouncedelay-formkit-form-data-uid-d2c78f7648-{0%,80%,100%{-webkit-transform:scale(0);-ms-transform:scale(0);transform:scale(0);}40%{-webkit-transform:scale(1);-ms-transform:scale(1);transform:scale(1);}}.formkit-form[data-uid=\"d2c78f7648\"] blockquote{padding:10px 20px;margin:0 0 20px;border-left:5px solid #e1e1e1;} .formkit-form[data-uid=\"d2c78f7648\"]{border:1px solid #e3e3e3;max-width:700px;position:relative;overflow:hidden;}.formkit-form[data-uid=\"d2c78f7648\"] .formkit-background{width:100%;height:100%;position:absolute;top:0;left:0;background-size:cover;background-position:center;opacity:0.3;z-index:1;}.formkit-form[data-uid=\"d2c78f7648\"] [data-style=\"minimal\"]{padding:20px;width:100%;z-index:2;position:relative;}.formkit-form[data-uid=\"d2c78f7648\"] .formkit-header{margin:0 0 27px 0;text-align:center;}.formkit-form[data-uid=\"d2c78f7648\"] .formkit-subheader{margin:18px 0;text-align:center;}.formkit-form[data-uid=\"d2c78f7648\"] .formkit-guarantee{font-size:13px;margin:10px 0 15px 0;text-align:center;}.formkit-form[data-uid=\"d2c78f7648\"] .formkit-guarantee  p{margin:0;}.formkit-form[data-uid=\"d2c78f7648\"] .formkit-powered-by{color:#7d7d7d;display:block;font-size:12px;margin:10px 0 0 0;text-align:center;}.formkit-form[data-uid=\"d2c78f7648\"] .formkit-fields{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin:25px auto 0 auto;}.formkit-form[data-uid=\"d2c78f7648\"] .formkit-field{min-width:220px;}.formkit-form[data-uid=\"d2c78f7648\"] .formkit-field,.formkit-form[data-uid=\"d2c78f7648\"] .formkit-submit{margin:0 0 15px 0;-webkit-flex:1 0 100%;-ms-flex:1 0 100%;flex:1 0 100%;}.formkit-form[data-uid=\"d2c78f7648\"][min-width~=\"600\"] [data-style=\"minimal\"]{padding:0 40px;}.formkit-form[data-uid=\"d2c78f7648\"][min-width~=\"600\"] .formkit-fields[data-stacked=\"false\"]{margin-left:-5px;margin-right:-5px;}.formkit-form[data-uid=\"d2c78f7648\"][min-width~=\"600\"] .formkit-fields[data-stacked=\"false\"] .formkit-field,.formkit-form[data-uid=\"d2c78f7648\"][min-width~=\"600\"] .formkit-fields[data-stacked=\"false\"] .formkit-submit{margin:0 5px 15px 5px;}.formkit-form[data-uid=\"d2c78f7648\"][min-width~=\"600\"] .formkit-fields[data-stacked=\"false\"] .formkit-field{-webkit-flex:100 1 auto;-ms-flex:100 1 auto;flex:100 1 auto;}.formkit-form[data-uid=\"d2c78f7648\"][min-width~=\"600\"] .formkit-fields[data-stacked=\"false\"] .formkit-submit{-webkit-flex:1 1 auto;-ms-flex:1 1 auto;flex:1 1 auto;}  The flexibility that the Sender interface provides us cannot be overstated. Although the example is small and trivial, introducing another type of notification for the InformOrderShipped is simple:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16  package push import ( \"time\" \"github.com/fteem/order-notifications/user\" ) type Notifier struct{} func (n Notifier) Send(receiver user.User, message string) error { // Simulating API call... \ttime.Sleep(1 * time.Second) return nil }    This would result in no changes in the InformOrderShipped function, while the Notifier’s Send method can be used as the one of the Dispatcher:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19  package main import ( \"github.com/fteem/order-notifications/orders\" \"github.com/fteem/order-notifications/push\" \"github.com/fteem/order-notifications/sms\" \"github.com/fteem/order-notifications/user\" ) func main() { dispatcher := sms.Dispatcher{} notifier := push.Notifier{} u := user.User{\"Peggy\", \"+123 456 789\"} orderID := \"123\" orders.InformOrderShipped(u, orderID, dispatcher) orders.InformOrderShipped(u, orderID, notifier) }    With dependency injection in action, we were able not only to decouple our InformOrderShipped function from the sms package, but also by using an interface for dependency injection we got to use polymorphism. Simply put, polymorphism through interfaces allowed us to send SMSes and push notifications in the same InformOrderShipped function.\nLiked this article? Subscribe to my newsletter and get my fresh posts in your inbox. It's short and sweet, going out monthly to over 1,000 subscribers.  ","wordCount":"2044","inLanguage":"en","datePublished":"2019-12-01T00:00:00Z","dateModified":"2019-12-01T00:00:00Z","author":{"@type":"Person","name":"Ilija"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://ieftimov.com/post/testing-in-go-dependency-injection/"},"publisher":{"@type":"Organization","name":"Ilija Eftimov ⚡️","logo":{"@type":"ImageObject","url":"https://ieftimov.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://ieftimov.com/ accesskey=h title="Ilija Eftimov ⚡️ (Alt + H)">Ilija Eftimov ⚡️</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu onscroll=menu_on_scroll()><li><a href=https://ieftimov.com/posts title=Archive><span>Archive</span></a></li><li><a href=https://ieftimov.com/about title=About><span>About</span></a></li><li><a href=https://ieftimov.com/newsletter title=Newsletter><span>Newsletter</span></a></li><li><a href=https://forms.gle/orfXK5jh1LRaiFzo8 title="Suggest a topic"><span>Suggest a topic</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Testing in Go: Dependency Injection</h1><div class=post-meta>December 1, 2019&nbsp;·&nbsp;10 min&nbsp;·&nbsp;Ilija</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><div class=details>Table of Contents</div></summary><div class=inner><ul><ul><li><a href=#sending-notifications aria-label="Sending notifications">Sending notifications</a></li><li><a href=#injecting-the-ability-to-send-smses aria-label="Injecting the ability to send SMSes">Injecting the ability to send SMSes</a></li><li><a href=#notifications-are-more-than-sms aria-label="Notifications are more than SMS">Notifications are more than SMS</a></li></ul><li><a href=# aria-label="Coming soon!">Coming soon!</a></li></ul></div></details></div><div class=post-content><p>In software engineering, over the years folks have developed many patterns,
techniques and refactoring maneuvers. Some have been long forgotten, while
others have stood the test of times.</p><p>Such a long-standing technique is dependency injection. It is a concept and a
programming technique where a construct is passed (injected) to another
construct that depends on it.</p><p>In Golang, like in other languages, we use it to simplify our code and make it
more testable. But, how much more? Let&rsquo;s code through an example and see how
dependency injection can help us out.</p><p><img src=/testing-in-go-dependency-injection/notify.png alt></p><h2 id=sending-notifications>Sending notifications<a hidden class=anchor aria-hidden=true href=#sending-notifications>#</a></h2><p>Imagine we are building an e-commerce website where people buy goods and we
ship them the goods. When their order ships, we want to inform them through a
notification.</p><p>Let&rsquo;s look at a very simple simulation of sending an SMS notification over an
API:</p><div class=highlight><div style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">19
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#d75f00>package</span> notifications

<span style=color:#d75f00>import</span> (
	<span style=color:#00afaf>&#34;fmt&#34;</span>

	<span style=color:#00afaf>&#34;github.com/fteem/order-notifications/sms&#34;</span>
	<span style=color:#00afaf>&#34;github.com/fteem/order-notifications/user&#34;</span>
)

<span style=color:#0087ff>func</span> <span style=color:#0087ff>InformOrderShipped</span>(receiver user.User, orderID <span style=color:#af0000>string</span>) <span style=color:#af0000>bool</span> {
	message := fmt.<span style=color:#0087ff>Sprintf</span>(<span style=color:#00afaf>&#34;Your order #%s is shipped!&#34;</span>, orderID)
	err := sms.<span style=color:#0087ff>Send</span>(receiver, message)

	<span style=color:#5f8700>if</span> err != <span style=color:#d75f00>nil</span> {
		<span style=color:#5f8700>return</span> <span style=color:#d75f00>false</span>
	}

	<span style=color:#5f8700>return</span> <span style=color:#d75f00>true</span>
}
</code></pre></td></tr></table></div></div><p>For the sake of the example, we&rsquo;ll simulate a network call in the <code>sms.Send</code>
with arbitrary sleep time, so the function takes a few seconds to execute:</p><div class=highlight><div style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">14
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#d75f00>package</span> sms

<span style=color:#d75f00>import</span> (
	<span style=color:#00afaf>&#34;time&#34;</span>

	<span style=color:#00afaf>&#34;github.com/fteem/order-notifications/user&#34;</span>
)

<span style=color:#0087ff>func</span> <span style=color:#0087ff>Send</span>(receiver user.User, message <span style=color:#af0000>string</span>) <span style=color:#af0000>error</span> {
	<span style=color:#4e4e4e>// Simulating API call...
</span><span style=color:#4e4e4e></span>	time.<span style=color:#0087ff>Sleep</span>(<span style=color:#00afaf>3</span> * time.Second)

	<span style=color:#5f8700>return</span> <span style=color:#d75f00>nil</span>
}
</code></pre></td></tr></table></div></div><p>Let us see a simple test for the <code>InformOrderShipped</code> function and what kind of
challenges it brings:</p><div class=highlight><div style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">18
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#d75f00>package</span> notifications

<span style=color:#d75f00>import</span> <span style=color:#00afaf>&#34;testing&#34;</span>

<span style=color:#0087ff>func</span> <span style=color:#0087ff>TestInformOrderShipped</span>(t *testing.T) {
	user := User{
		Name:  <span style=color:#00afaf>&#34;Peggy&#34;</span>,
		Phone: <span style=color:#00afaf>&#34;+12 345 678 999&#34;</span>,
	}
	orderID := <span style=color:#00afaf>&#34;12345&#34;</span>

	got := <span style=color:#0087ff>InformOrderShipped</span>(user, orderID)
	want := <span style=color:#d75f00>true</span>

	<span style=color:#5f8700>if</span> want != got {
		t.<span style=color:#0087ff>Errorf</span>(<span style=color:#00afaf>&#34;Want &#39;%t&#39;, got &#39;%t&#39;&#34;</span>, want, got)
	}
}
</code></pre></td></tr></table></div></div><p>While these tests do test the functionality of <code>InformOrderShipped</code>, it already
has two issues:</p><ol><li>It lasts three seconds because of invoking <code>sms.Send</code> sleeps for three
seconds.</li><li>There&rsquo;s no way to <strong>easily</strong> test what would happen if <code>sms.Send</code> actually
returns an error.</li></ol><p>Issue number one is something we can ignore for now, as it&rsquo;s only a side-effect
of the implementation of <code>sms.Send</code>. Issue number two, the lack of an easy way
to mock <code>sms.Send</code>, is larger so we will address it first.</p><h2 id=injecting-the-ability-to-send-smses>Injecting the ability to send SMSes<a hidden class=anchor aria-hidden=true href=#injecting-the-ability-to-send-smses>#</a></h2><p>The simplest maneuver we can do in <code>InformOrderShipped</code>, instead of depending
on the <code>sms</code> package, is to pass in the <code>Send</code> function as a function closure
argument:</p><div class=highlight><div style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">18
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#d75f00>package</span> notifications

<span style=color:#d75f00>import</span> (
	<span style=color:#00afaf>&#34;fmt&#34;</span>

	<span style=color:#00afaf>&#34;github.com/fteem/order-notifications/user&#34;</span>
)

<span style=color:#0087ff>func</span> <span style=color:#0087ff>InformOrderShipped</span>(receiver user.User, orderID <span style=color:#af0000>string</span>, sendSMS <span style=color:#0087ff>func</span>(user.User, <span style=color:#af0000>string</span>) <span style=color:#af0000>error</span>) <span style=color:#af0000>bool</span> {
	message := fmt.<span style=color:#0087ff>Sprintf</span>(<span style=color:#00afaf>&#34;Your order #%s is shipped!&#34;</span>, orderID)
	err := <span style=color:#0087ff>sendSMS</span>(receiver, message)

	<span style=color:#5f8700>if</span> err != <span style=color:#d75f00>nil</span> {
		<span style=color:#5f8700>return</span> <span style=color:#d75f00>false</span>
	}

	<span style=color:#5f8700>return</span> <span style=color:#d75f00>true</span>
}
</code></pre></td></tr></table></div></div><p>Because Go allows us to provide the function as an argument, all we need to do
is to specify its arguments and return types and invoke it in the main
function.
Just by having this in place, we achieve:</p><ol><li>Injecting the dependency on the <code>sms.Send</code> function, using a type rather
then importing the actual function.</li><li>We remove the explicit dependency on the <code>sms</code> package.</li><li>We make our code easy to mock and test.</li></ol><p>To prove these points, we will modify the test to include the two scenarios,
when the SMS is successfully sent and when it returns an error:</p><div class=highlight><div style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">32
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">33
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">34
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">35
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">36
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">37
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">38
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">39
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">40
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">41
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">42
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">43
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">44
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">45
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">46
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">47
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#d75f00>package</span> notifications

<span style=color:#d75f00>import</span> (
	<span style=color:#00afaf>&#34;errors&#34;</span>
	<span style=color:#00afaf>&#34;testing&#34;</span>

	<span style=color:#00afaf>&#34;github.com/fteem/order-notifications/user&#34;</span>
)

<span style=color:#0087ff>func</span> <span style=color:#0087ff>TestInformOrderShipped</span>(t *testing.T) {
	cases := []<span style=color:#0087ff>struct</span> {
		user         user.User
		orderID      <span style=color:#af0000>string</span>
		sendingError <span style=color:#af0000>error</span>
		name         <span style=color:#af0000>string</span>
		want         <span style=color:#af0000>bool</span>
	}{
		{
			user:         user.User{<span style=color:#00afaf>&#34;Peggy&#34;</span>, <span style=color:#00afaf>&#34;+12 345 678 999&#34;</span>},
			orderID:      <span style=color:#00afaf>&#34;12345&#34;</span>,
			sendingError: <span style=color:#d75f00>nil</span>,
			want:         <span style=color:#d75f00>true</span>,
			name:         <span style=color:#00afaf>&#34;Successful send&#34;</span>,
		},
		{
			user:         user.User{<span style=color:#00afaf>&#34;Peggy&#34;</span>, <span style=color:#00afaf>&#34;+12 345 678 999&#34;</span>},
			orderID:      <span style=color:#00afaf>&#34;12345&#34;</span>,
			sendingError: errors.<span style=color:#0087ff>New</span>(<span style=color:#00afaf>&#34;Sending failed&#34;</span>),
			want:         <span style=color:#d75f00>false</span>,
			name:         <span style=color:#00afaf>&#34;Unsuccessful send&#34;</span>,
		},
	}

	<span style=color:#5f8700>for</span> _, tc := <span style=color:#5f8700>range</span> cases {
		t.<span style=color:#0087ff>Run</span>(tc.name, <span style=color:#0087ff>func</span>(t *testing.T) {
			mockSend := <span style=color:#0087ff>func</span>(user.User, <span style=color:#af0000>string</span>) <span style=color:#af0000>error</span> {
				<span style=color:#5f8700>return</span> tc.sendingError
			}

			got := <span style=color:#0087ff>InformOrderShipped</span>(tc.user, tc.orderID, mockSend)

			<span style=color:#5f8700>if</span> tc.want != got {
				t.<span style=color:#0087ff>Errorf</span>(<span style=color:#00afaf>&#34;Want &#39;%t&#39;, got &#39;%t&#39;&#34;</span>, tc.want, got)
			}
		})
	}
}
</code></pre></td></tr></table></div></div><p>In the test we use the <a href=/testing-in-go-table-driven-tests>table-driven
approach</a>, where we define two different
test cases: when the SMS sending fails and when it does not.</p><p>Because our <code>InformOrderShipped</code> function expects a function as a third
argument, in our test we create a function mock that has no functionality but
returning an error value.</p><p>This allows us to pass in the mocked function, easily control its return value
and avoid waiting for three seconds for the test to finish. We decouple our
code, we make it more testable and, on top of that, it executes instantly.</p><p>But, can we take this further?</p><h2 id=notifications-are-more-than-sms>Notifications are more than SMS<a hidden class=anchor aria-hidden=true href=#notifications-are-more-than-sms>#</a></h2><p>SMSes are a bit outdated. Nowadays we very often rely on our cellular internet
connections, native apps and push notifications to get real-time information
about our orders. Also, as much as we dislike it, email is still the online
communication king.</p><p>But you know what&rsquo;s the best of the three? All of them. People want to be kept
in the know, especially when the items that they spend their hard-earned monies
on have been dispatched.</p><p>So, how can we make our code even more flexible, while keeping it easy to test
and maintain?</p><p>Interfaces to the rescue!</p><p>Golang interfaces are a powerful construct. They are simple, named collections
of method signatures. Interfaces are implicitly implemented, meaning a type
implements an interface by implementing the functions specified in the
interface. No need for explicit <code>implements</code> statements. (Yes, like yours
Java.)</p><p>Let&rsquo;s introduce an interface called <code>Sender</code>, which defines a <code>Send</code> function:</p><div class=highlight><div style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#454545">1
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">2
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#0087ff>type</span> Sender <span style=color:#0087ff>interface</span> {
	<span style=color:#0087ff>Send</span>(user.User, <span style=color:#af0000>string</span>) <span style=color:#af0000>error</span>
}
</code></pre></td></tr></table></div></div><p>Those of you that are very attentive will notice that the <code>Send</code> function in
<code>Sender</code> has the same signature as the <code>sms.Send</code> function from the earlier
example. That&rsquo;s intentional - we want any implementor of the <code>Sender</code> interface
to be able to send a notification to a <code>User</code>.</p><p>Let&rsquo;s make a <code>sms.Dispatcher</code> type which will implement the <code>Sender</code> interface
and use it in our code:</p><div class=highlight><div style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">16
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#d75f00>package</span> sms

<span style=color:#d75f00>import</span> (
	<span style=color:#00afaf>&#34;time&#34;</span>

	<span style=color:#00afaf>&#34;github.com/fteem/order-notifications/user&#34;</span>
)

<span style=color:#0087ff>type</span> Dispatcher <span style=color:#0087ff>struct</span>{}

<span style=color:#0087ff>func</span> (d Dispatcher) <span style=color:#0087ff>Send</span>(receiver user.User, message <span style=color:#af0000>string</span>) <span style=color:#af0000>error</span> {
	<span style=color:#4e4e4e>// Simulating API call...
</span><span style=color:#4e4e4e></span>	time.<span style=color:#0087ff>Sleep</span>(<span style=color:#00afaf>3</span> * time.Second)

	<span style=color:#5f8700>return</span> <span style=color:#d75f00>nil</span>
}
</code></pre></td></tr></table></div></div><p>Now, we can pass an instance of the <code>Dispatcher</code> type in the
<code>InformOrderShipped</code> function, which will invoke its <code>Send</code> function. Given that
we already have the <code>Sender</code> interface defined, we can use it as an argument:</p><div class=highlight><div style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">10
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#0087ff>func</span> <span style=color:#0087ff>InformOrderShipped</span>(receiver user.User, orderID <span style=color:#af0000>string</span>, sender Sender) <span style=color:#af0000>bool</span> {
	message := fmt.<span style=color:#0087ff>Sprintf</span>(<span style=color:#00afaf>&#34;Your order #%s is shipped!&#34;</span>, orderID)
	err := sender.<span style=color:#0087ff>Send</span>(receiver, message)

	<span style=color:#5f8700>if</span> err != <span style=color:#d75f00>nil</span> {
		<span style=color:#5f8700>return</span> <span style=color:#d75f00>false</span>
	}

	<span style=color:#5f8700>return</span> <span style=color:#d75f00>true</span>
}
</code></pre></td></tr></table></div></div><p>Why? Well, <code>Dispatcher</code> already implements the <code>Sender</code> function, which means
that we can pass an instance and it will work. Here&rsquo;s an example:</p><div class=highlight><div style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">14
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#d75f00>package</span> main

<span style=color:#d75f00>import</span> (
	<span style=color:#00afaf>&#34;github.com/fteem/order-notifications/orders&#34;</span>
	<span style=color:#00afaf>&#34;github.com/fteem/order-notifications/sms&#34;</span>
	<span style=color:#00afaf>&#34;github.com/fteem/order-notifications/user&#34;</span>
)

<span style=color:#0087ff>func</span> <span style=color:#0087ff>main</span>() {
	u := user.User{<span style=color:#00afaf>&#34;Peggy&#34;</span>, <span style=color:#00afaf>&#34;+123 456 789&#34;</span>}
	orderID := <span style=color:#00afaf>&#34;123&#34;</span>
	dispatcher := sms.Dispatcher{}
	orders.<span style=color:#0087ff>InformOrderShipped</span>(u, orderID, dispatcher)
}
</code></pre></td></tr></table></div></div><p>How does such a change influence our tests? Interestingly, it doesn&rsquo;t. While we
lose the ability to pass in a function closure as an argument, we can still
create a mock type that implements the <code>Sender</code> interface and use it as
argument to the <code>InformOrderShipped</code> function:</p><div class=highlight><div style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">19
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">20
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">21
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">22
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">23
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">24
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">25
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">26
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">27
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">28
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">29
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">30
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">31
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">32
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">33
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">34
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">35
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">36
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">37
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">38
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">39
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">40
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">41
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">42
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">43
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">44
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">45
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">46
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">47
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">48
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">49
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">50
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">51
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">52
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#d75f00>package</span> orders

<span style=color:#d75f00>import</span> (
	<span style=color:#00afaf>&#34;errors&#34;</span>
	<span style=color:#00afaf>&#34;testing&#34;</span>

	<span style=color:#00afaf>&#34;github.com/fteem/order-notifications/user&#34;</span>
)

<span style=color:#0087ff>type</span> mockSender <span style=color:#0087ff>struct</span> {
	sendingError <span style=color:#af0000>error</span>
}

<span style=color:#0087ff>func</span> (ms mockSender) <span style=color:#0087ff>Send</span>(u user.User, m <span style=color:#af0000>string</span>) <span style=color:#af0000>error</span> {
	<span style=color:#5f8700>return</span> ms.sendingError
}

<span style=color:#0087ff>func</span> <span style=color:#0087ff>TestInformOrderShipped</span>(t *testing.T) {
	cases := []<span style=color:#0087ff>struct</span> {
		user         user.User
		orderID      <span style=color:#af0000>string</span>
		sendingError <span style=color:#af0000>error</span>
		name         <span style=color:#af0000>string</span>
		want         <span style=color:#af0000>bool</span>
	}{
		{
			user:         user.User{<span style=color:#00afaf>&#34;Peggy&#34;</span>, <span style=color:#00afaf>&#34;+12 345 678 999&#34;</span>},
			orderID:      <span style=color:#00afaf>&#34;12345&#34;</span>,
			sendingError: <span style=color:#d75f00>nil</span>,
			want:         <span style=color:#d75f00>true</span>,
			name:         <span style=color:#00afaf>&#34;Successful send&#34;</span>,
		},
		{
			user:         user.User{<span style=color:#00afaf>&#34;Peggy&#34;</span>, <span style=color:#00afaf>&#34;+12 345 678 999&#34;</span>},
			orderID:      <span style=color:#00afaf>&#34;12345&#34;</span>,
			sendingError: errors.<span style=color:#0087ff>New</span>(<span style=color:#00afaf>&#34;Sending failed&#34;</span>),
			want:         <span style=color:#d75f00>false</span>,
			name:         <span style=color:#00afaf>&#34;Unsuccessful send&#34;</span>,
		},
	}

	<span style=color:#5f8700>for</span> _, tc := <span style=color:#5f8700>range</span> cases {
		t.<span style=color:#0087ff>Run</span>(tc.name, <span style=color:#0087ff>func</span>(t *testing.T) {
			ms := mockSender{tc.sendingError}
			got := <span style=color:#0087ff>InformOrderShipped</span>(tc.user, tc.orderID, ms)

			<span style=color:#5f8700>if</span> tc.want != got {
				t.<span style=color:#0087ff>Errorf</span>(<span style=color:#00afaf>&#34;Want &#39;%t&#39;, got &#39;%t&#39;&#34;</span>, tc.want, got)
			}
		})
	}
}
</code></pre></td></tr></table></div></div><p>Just a simple <code>mockSender</code> type does the trick. Because it implements the
<code>Send</code> function and due to Go&rsquo;s implicitly implementing interfaces <code>mockSender</code>
is also a <code>Sender</code>. That means we can use it as an argument to the
<code>InformOrderShipped</code> function.</p><script src=https://f.convertkit.com/ckjs/ck.5.js></script><form action=https://app.convertkit.com/forms/1152282/subscriptions class="seva-form formkit-form" method=post data-sv-form=1152282 data-uid=d2c78f7648 data-format=inline data-version=5 data-options='{"settings":{"after_subscribe":{"action":"message","success_message":"Success! Now check your email to confirm your subscription.","redirect_url":""},"analytics":{"google":null,"facebook":null,"segment":null,"pinterest":null},"modal":{"trigger":"timer","scroll_percentage":null,"timer":5,"devices":"all","show_once_every":15},"powered_by":{"show":false,"url":"https://convertkit.com?utm_source=dynamic&utm_medium=referral&utm_campaign=poweredby&utm_content=form"},"recaptcha":{"enabled":false},"return_visitor":{"action":"show","custom_content":""},"slide_in":{"display_in":"bottom_right","trigger":"timer","scroll_percentage":null,"timer":5,"devices":"all","show_once_every":15},"sticky_bar":{"display_in":"top","trigger":"timer","scroll_percentage":null,"timer":5,"devices":"all","show_once_every":15}},"version":"5"}' min-width="400 500 600 700 800" style="background-color:#fff;border-radius:6px;margin:0 auto"><div class=formkit-background style=opacity:.3></div><div data-style=minimal><div class=formkit-header data-element=header style=color:#4d4d4d;font-size:20px;font-weight:700><h1>Coming soon!</h1></div><div class=formkit-subheader data-element=subheader style=color:#686868;font-size:15px><p>I am planning a course on testing in Go. Would you like to get a (free) sneak peek while I am building it? Sign up now!</p></div><ul class="formkit-alert formkit-alert-error" data-element=errors data-group=alert></ul><div data-element=fields data-stacked=false class="seva-fields formkit-fields"><div class=formkit-field><input class=formkit-input name=email_address placeholder="Your email address" required type=email style=color:#000;border-color:#e3e3e3;border-radius:4px;font-weight:400></div><button data-element=submit class="formkit-submit formkit-submit" style=color:#fff;background-color:#3700ff;border-radius:24px;font-weight:700><div class=formkit-spinner><div></div><div></div><div></div></div><span>Subscribe</span></button></div><div class=formkit-guarantee data-element=guarantee style=color:#4d4d4d;font-size:13px;font-weight:400><p>I respect your privacy. Unsubscribe at any time. No spam, ever.</p></div></div><style>.formkit-form[data-uid=d2c78f7648] *{box-sizing:border-box}.formkit-form[data-uid=d2c78f7648]{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.formkit-form[data-uid=d2c78f7648] legend{border:none;font-size:inherit;margin-bottom:10px;padding:0;position:relative;display:table}.formkit-form[data-uid=d2c78f7648] fieldset{border:0;padding:.01em 0 0;margin:0;min-width:0}.formkit-form[data-uid=d2c78f7648] body:not(:-moz-handler-blocked) fieldset{display:table-cell}.formkit-form[data-uid=d2c78f7648] h1,.formkit-form[data-uid=d2c78f7648] h2,.formkit-form[data-uid=d2c78f7648] h3,.formkit-form[data-uid=d2c78f7648] h4,.formkit-form[data-uid=d2c78f7648] h5,.formkit-form[data-uid=d2c78f7648] h6{color:inherit;font-size:inherit;font-weight:inherit}.formkit-form[data-uid=d2c78f7648] p{color:inherit;font-size:inherit;font-weight:inherit}.formkit-form[data-uid=d2c78f7648] ol:not([template-default]),.formkit-form[data-uid=d2c78f7648] ul:not([template-default]),.formkit-form[data-uid=d2c78f7648] blockquote:not([template-default]){text-align:left}.formkit-form[data-uid=d2c78f7648] p:not([template-default]),.formkit-form[data-uid=d2c78f7648] hr:not([template-default]),.formkit-form[data-uid=d2c78f7648] blockquote:not([template-default]),.formkit-form[data-uid=d2c78f7648] ol:not([template-default]),.formkit-form[data-uid=d2c78f7648] ul:not([template-default]){color:inherit;font-style:initial}.formkit-form[data-uid=d2c78f7648][data-format=modal]{display:none}.formkit-form[data-uid=d2c78f7648][data-format="slide in"]{display:none}.formkit-form[data-uid=d2c78f7648] .formkit-input,.formkit-form[data-uid=d2c78f7648] .formkit-select,.formkit-form[data-uid=d2c78f7648] .formkit-checkboxes{width:100%}.formkit-form[data-uid=d2c78f7648] .formkit-button,.formkit-form[data-uid=d2c78f7648] .formkit-submit{border:0;border-radius:5px;color:#fff;cursor:pointer;display:inline-block;text-align:center;font-size:15px;font-weight:500;cursor:pointer;margin-bottom:15px;overflow:hidden;padding:0;position:relative;vertical-align:middle}.formkit-form[data-uid=d2c78f7648] .formkit-button:hover,.formkit-form[data-uid=d2c78f7648] .formkit-submit:hover,.formkit-form[data-uid=d2c78f7648] .formkit-button:focus,.formkit-form[data-uid=d2c78f7648] .formkit-submit:focus{outline:none}.formkit-form[data-uid=d2c78f7648] .formkit-button:hover>span,.formkit-form[data-uid=d2c78f7648] .formkit-submit:hover>span,.formkit-form[data-uid=d2c78f7648] .formkit-button:focus>span,.formkit-form[data-uid=d2c78f7648] .formkit-submit:focus>span{background-color:rgba(0,0,0,.1)}.formkit-form[data-uid=d2c78f7648] .formkit-button>span,.formkit-form[data-uid=d2c78f7648] .formkit-submit>span{display:block;-webkit-transition:all 300ms ease-in-out;transition:all 300ms ease-in-out;padding:12px 24px}.formkit-form[data-uid=d2c78f7648] .formkit-input{background:#fff;font-size:15px;padding:12px;border:1px solid #e3e3e3;-webkit-flex:1 0 auto;-ms-flex:1 0 auto;flex:1 0 auto;line-height:1.4;margin:0;-webkit-transition:border-color ease-out 300ms;transition:border-color ease-out 300ms}.formkit-form[data-uid=d2c78f7648] .formkit-input:focus{outline:none;border-color:#1677be;-webkit-transition:border-color ease 300ms;transition:border-color ease 300ms}.formkit-form[data-uid=d2c78f7648] .formkit-input::-webkit-input-placeholder{color:inherit;opacity:.8}.formkit-form[data-uid=d2c78f7648] .formkit-input::-moz-placeholder{color:inherit;opacity:.8}.formkit-form[data-uid=d2c78f7648] .formkit-input:-ms-input-placeholder{color:inherit;opacity:.8}.formkit-form[data-uid=d2c78f7648] .formkit-input::placeholder{color:inherit;opacity:.8}.formkit-form[data-uid=d2c78f7648] [data-group=dropdown]{position:relative;display:inline-block;width:100%}.formkit-form[data-uid=d2c78f7648] [data-group=dropdown]::before{content:"";top:calc(50% - 2.5px);right:10px;position:absolute;pointer-events:none;border-color:#4f4f4f transparent transparent transparent;border-style:solid;border-width:6px 6px 0;height:0;width:0;z-index:999}.formkit-form[data-uid=d2c78f7648] [data-group=dropdown] select{height:auto;width:100%;cursor:pointer;color:#333;line-height:1.4;margin-bottom:0;padding:0 6px;-webkit-appearance:none;-moz-appearance:none;appearance:none;font-size:15px;padding:12px;padding-right:25px;border:1px solid #e3e3e3;background:#fff}.formkit-form[data-uid=d2c78f7648] [data-group=dropdown] select:focus{outline:none}.formkit-form[data-uid=d2c78f7648] [data-group=checkboxes]{text-align:left;margin:0}.formkit-form[data-uid=d2c78f7648] [data-group=checkboxes] [data-group=checkbox]{margin-bottom:10px}.formkit-form[data-uid=d2c78f7648] [data-group=checkboxes] [data-group=checkbox] *{cursor:pointer}.formkit-form[data-uid=d2c78f7648] [data-group=checkboxes] [data-group=checkbox]:last-of-type{margin-bottom:0}.formkit-form[data-uid=d2c78f7648] [data-group=checkboxes] [data-group=checkbox] input[type=checkbox]{display:none}.formkit-form[data-uid=d2c78f7648] [data-group=checkboxes] [data-group=checkbox] input[type=checkbox]+label::after{content:none}.formkit-form[data-uid=d2c78f7648] [data-group=checkboxes] [data-group=checkbox] input[type=checkbox]:checked+label::after{border-color:#fff;content:""}.formkit-form[data-uid=d2c78f7648] [data-group=checkboxes] [data-group=checkbox] input[type=checkbox]:checked+label::before{background:#10bf7a;border-color:#10bf7a}.formkit-form[data-uid=d2c78f7648] [data-group=checkboxes] [data-group=checkbox] label{position:relative;display:inline-block;padding-left:28px}.formkit-form[data-uid=d2c78f7648] [data-group=checkboxes] [data-group=checkbox] label::before,.formkit-form[data-uid=d2c78f7648] [data-group=checkboxes] [data-group=checkbox] label::after{position:absolute;content:"";display:inline-block}.formkit-form[data-uid=d2c78f7648] [data-group=checkboxes] [data-group=checkbox] label::before{height:16px;width:16px;border:1px solid #e3e3e3;background:#fff;left:0;top:3px}.formkit-form[data-uid=d2c78f7648] [data-group=checkboxes] [data-group=checkbox] label::after{height:4px;width:8px;border-left:2px solid #4d4d4d;border-bottom:2px solid #4d4d4d;-webkit-transform:rotate(-45deg);-ms-transform:rotate(-45deg);transform:rotate(-45deg);left:4px;top:8px}.formkit-form[data-uid=d2c78f7648] .formkit-alert{background:#f9fafb;border:1px solid #e3e3e3;border-radius:5px;-webkit-flex:1 0 auto;-ms-flex:1 0 auto;flex:1 0 auto;list-style:none;margin:25px auto;padding:12px;text-align:center;width:100%}.formkit-form[data-uid=d2c78f7648] .formkit-alert:empty{display:none}.formkit-form[data-uid=d2c78f7648] .formkit-alert-success{background:#d3fbeb;border-color:#10bf7a;color:#0c905c}.formkit-form[data-uid=d2c78f7648] .formkit-alert-error{background:#fde8e2;border-color:#f2643b;color:#ea4110}.formkit-form[data-uid=d2c78f7648] .formkit-spinner{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:0;width:0;margin:0 auto;position:absolute;top:0;left:0;right:0;width:0;overflow:hidden;text-align:center;-webkit-transition:all 300ms ease-in-out;transition:all 300ms ease-in-out}.formkit-form[data-uid=d2c78f7648] .formkit-spinner>div{margin:auto;width:12px;height:12px;background-color:#fff;opacity:.3;border-radius:100%;display:inline-block;-webkit-animation:formkit-bouncedelay-formkit-form-data-uid-d2c78f7648- 1.4s infinite ease-in-out both;animation:formkit-bouncedelay-formkit-form-data-uid-d2c78f7648- 1.4s infinite ease-in-out both}.formkit-form[data-uid=d2c78f7648] .formkit-spinner>div:nth-child(1){-webkit-animation-delay:-.32s;animation-delay:-.32s}.formkit-form[data-uid=d2c78f7648] .formkit-spinner>div:nth-child(2){-webkit-animation-delay:-.16s;animation-delay:-.16s}.formkit-form[data-uid=d2c78f7648] .formkit-submit[data-active] .formkit-spinner{opacity:1;height:100%;width:50px}.formkit-form[data-uid=d2c78f7648] .formkit-submit[data-active] .formkit-spinner~span{opacity:0}.formkit-form[data-uid=d2c78f7648] .formkit-powered-by[data-active=false]{opacity:.35}@-webkit-keyframes formkit-bouncedelay-formkit-form-data-uid-d2c78f7648-{0%,80%,100%{-webkit-transform:scale(0);-ms-transform:scale(0);transform:scale(0)}40%{-webkit-transform:scale(1);-ms-transform:scale(1);transform:scale(1)}}@keyframes formkit-bouncedelay-formkit-form-data-uid-d2c78f7648-{0%,80%,100%{-webkit-transform:scale(0);-ms-transform:scale(0);transform:scale(0)}40%{-webkit-transform:scale(1);-ms-transform:scale(1);transform:scale(1)}}.formkit-form[data-uid=d2c78f7648] blockquote{padding:10px 20px;margin:0 0 20px;border-left:5px solid #e1e1e1}.formkit-form[data-uid=d2c78f7648]{border:1px solid #e3e3e3;max-width:700px;position:relative;overflow:hidden}.formkit-form[data-uid=d2c78f7648] .formkit-background{width:100%;height:100%;position:absolute;top:0;left:0;background-size:cover;background-position:50%;opacity:.3;z-index:1}.formkit-form[data-uid=d2c78f7648] [data-style=minimal]{padding:20px;width:100%;z-index:2;position:relative}.formkit-form[data-uid=d2c78f7648] .formkit-header{margin:0 0 27px;text-align:center}.formkit-form[data-uid=d2c78f7648] .formkit-subheader{margin:18px 0;text-align:center}.formkit-form[data-uid=d2c78f7648] .formkit-guarantee{font-size:13px;margin:10px 0 15px;text-align:center}.formkit-form[data-uid=d2c78f7648] .formkit-guarantee>p{margin:0}.formkit-form[data-uid=d2c78f7648] .formkit-powered-by{color:#7d7d7d;display:block;font-size:12px;margin:10px 0 0;text-align:center}.formkit-form[data-uid=d2c78f7648] .formkit-fields{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin:25px auto 0}.formkit-form[data-uid=d2c78f7648] .formkit-field{min-width:220px}.formkit-form[data-uid=d2c78f7648] .formkit-field,.formkit-form[data-uid=d2c78f7648] .formkit-submit{margin:0 0 15px;-webkit-flex:1 0 100%;-ms-flex:1 0 100%;flex:1 0 100%}.formkit-form[data-uid=d2c78f7648][min-width~="600"] [data-style=minimal]{padding:0 40px}.formkit-form[data-uid=d2c78f7648][min-width~="600"] .formkit-fields[data-stacked=false]{margin-left:-5px;margin-right:-5px}.formkit-form[data-uid=d2c78f7648][min-width~="600"] .formkit-fields[data-stacked=false] .formkit-field,.formkit-form[data-uid=d2c78f7648][min-width~="600"] .formkit-fields[data-stacked=false] .formkit-submit{margin:0 5px 15px}.formkit-form[data-uid=d2c78f7648][min-width~="600"] .formkit-fields[data-stacked=false] .formkit-field{-webkit-flex:100 1 auto;-ms-flex:100 1 auto;flex:100 1 auto}.formkit-form[data-uid=d2c78f7648][min-width~="600"] .formkit-fields[data-stacked=false] .formkit-submit{-webkit-flex:1 1 auto;-ms-flex:1 1 auto;flex:auto}</style></form><p>The flexibility that the <code>Sender</code> interface provides us cannot be overstated.
Although the example is small and trivial, introducing another type of notification
for the <code>InformOrderShipped</code> is simple:</p><div class=highlight><div style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">16
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#d75f00>package</span> push

<span style=color:#d75f00>import</span> (
	<span style=color:#00afaf>&#34;time&#34;</span>

	<span style=color:#00afaf>&#34;github.com/fteem/order-notifications/user&#34;</span>
)

<span style=color:#0087ff>type</span> Notifier <span style=color:#0087ff>struct</span>{}

<span style=color:#0087ff>func</span> (n Notifier) <span style=color:#0087ff>Send</span>(receiver user.User, message <span style=color:#af0000>string</span>) <span style=color:#af0000>error</span> {
	<span style=color:#4e4e4e>// Simulating API call...
</span><span style=color:#4e4e4e></span>	time.<span style=color:#0087ff>Sleep</span>(<span style=color:#00afaf>1</span> * time.Second)

	<span style=color:#5f8700>return</span> <span style=color:#d75f00>nil</span>
}
</code></pre></td></tr></table></div></div><p>This would result in no changes in the <code>InformOrderShipped</code> function, while the
<code>Notifier</code>&rsquo;s <code>Send</code> method can be used as the one of the <code>Dispatcher</code>:</p><div class=highlight><div style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 1
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 2
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 3
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 4
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 5
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 6
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 7
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 8
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545"> 9
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">10
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">11
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">12
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">13
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">14
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">15
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">16
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">17
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">18
</span><span style="margin-right:.4em;padding:0 .4em;color:#454545">19
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre style=color:#8a8a8a;background-color:#1c1c1c;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#d75f00>package</span> main

<span style=color:#d75f00>import</span> (
	<span style=color:#00afaf>&#34;github.com/fteem/order-notifications/orders&#34;</span>
	<span style=color:#00afaf>&#34;github.com/fteem/order-notifications/push&#34;</span>
	<span style=color:#00afaf>&#34;github.com/fteem/order-notifications/sms&#34;</span>
	<span style=color:#00afaf>&#34;github.com/fteem/order-notifications/user&#34;</span>
)

<span style=color:#0087ff>func</span> <span style=color:#0087ff>main</span>() {
	dispatcher := sms.Dispatcher{}
	notifier := push.Notifier{}

	u := user.User{<span style=color:#00afaf>&#34;Peggy&#34;</span>, <span style=color:#00afaf>&#34;+123 456 789&#34;</span>}
	orderID := <span style=color:#00afaf>&#34;123&#34;</span>

	orders.<span style=color:#0087ff>InformOrderShipped</span>(u, orderID, dispatcher)
	orders.<span style=color:#0087ff>InformOrderShipped</span>(u, orderID, notifier)
}
</code></pre></td></tr></table></div></div><p>With dependency injection in action, we were able not only to decouple our
<code>InformOrderShipped</code> function from the <code>sms</code> package, but also by using an
interface for dependency injection we got to use polymorphism. Simply put,
polymorphism through interfaces allowed us to send SMSes and push notifications
in the same <code>InformOrderShipped</code> function.</p><section class=subscribe><b>Liked this article?</b> <a href=/newsletter>Subscribe to my
newsletter</a> and get my fresh posts in your inbox. It's short and sweet,
going out monthly to over 1,000 subscribers.</section></div><footer class=post-footer><nav class=paginav><a class=prev href=https://ieftimov.com/post/testing-in-go-test-doubles-by-example/><span class=title>« Prev Page</span><br><span>Testing in Go: Test Doubles by Example</span></a>
<a class=next href=https://ieftimov.com/post/simple-golang-database-seeding-abstraction-gorm/><span class=title>Next Page »</span><br><span>Simple Golang database seeding abstraction for Gorm</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Testing in Go: Dependency Injection on twitter" href="https://twitter.com/intent/tweet/?text=Testing%20in%20Go%3a%20Dependency%20Injection&url=https%3a%2f%2fieftimov.com%2fpost%2ftesting-in-go-dependency-injection%2f&hashtags="><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Testing in Go: Dependency Injection on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fieftimov.com%2fpost%2ftesting-in-go-dependency-injection%2f&title=Testing%20in%20Go%3a%20Dependency%20Injection&summary=Testing%20in%20Go%3a%20Dependency%20Injection&source=https%3a%2f%2fieftimov.com%2fpost%2ftesting-in-go-dependency-injection%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Testing in Go: Dependency Injection on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fieftimov.com%2fpost%2ftesting-in-go-dependency-injection%2f&title=Testing%20in%20Go%3a%20Dependency%20Injection"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Testing in Go: Dependency Injection on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fieftimov.com%2fpost%2ftesting-in-go-dependency-injection%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Testing in Go: Dependency Injection on whatsapp" href="https://api.whatsapp.com/send?text=Testing%20in%20Go%3a%20Dependency%20Injection%20-%20https%3a%2f%2fieftimov.com%2fpost%2ftesting-in-go-dependency-injection%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Testing in Go: Dependency Injection on telegram" href="https://telegram.me/share/url?text=Testing%20in%20Go%3a%20Dependency%20Injection&url=https%3a%2f%2fieftimov.com%2fpost%2ftesting-in-go-dependency-injection%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>Copyright 2021 © Ilija Eftimov</span>
<span>&#183;</span>
<span>Powered by <a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a></span>
<span>&#183;</span>
<span>Theme <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>window.onload=function(){localStorage.getItem("menu-scroll-position")&&(document.getElementById('menu').scrollLeft=localStorage.getItem("menu-scroll-position"))},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})});var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")};function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById('menu').scrollLeft)}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script></body></html>