<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Sprinkle some HATEOAS on your Rails APIs - Ilija Eftimov</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta property="og:title" content="Sprinkle some HATEOAS on your Rails APIs" />
<meta property="og:description" content="REST as a concept was introduced by Roy Fielding in his doctoral thesis, named Architectural Styles and the Design of Network-based Software Architectures. 16 years later, REST as an architecture is the most widely accepted way to design and build APIs. I am sure we have all heard about it, and most of us think we are building actual RESTful APIs. But, are we?
Let&#39;s remind ourselves what REST is and then continue on something else that supplements REST, called HATEOAS." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ieftimov.com/post/sprinkle-some-hateoas-on-rails-apis/" />
<meta property="og:image" content="https://ieftimov.com/cards/sprinkle-some-hateoas-on-rails-apis-1.png" />
<meta property="article:published_time" content="2016-06-26T00:00:00+00:00" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://ieftimov.com/cards/sprinkle-some-hateoas-on-rails-apis-1.png"/>

<meta name="twitter:title" content="Sprinkle some HATEOAS on your Rails APIs"/>
<meta name="twitter:description" content="REST as a concept was introduced by Roy Fielding in his doctoral thesis, named Architectural Styles and the Design of Network-based Software Architectures. 16 years later, REST as an architecture is the most widely accepted way to design and build APIs. I am sure we have all heard about it, and most of us think we are building actual RESTful APIs. But, are we?
Let&#39;s remind ourselves what REST is and then continue on something else that supplements REST, called HATEOAS."/>
<link href='https://fonts.googleapis.com/css?family=Playfair+Display:700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" media="screen" href="https://ieftimov.com/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://ieftimov.com/css/main.css" />
		<link rel="stylesheet" type="text/css" href="https://ieftimov.com/css/overrides.css" />
	

	<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
		<script src="https://ieftimov.com/js/main.js"></script><script src="https://ieftimov.com/js/tooltip.js"></script>
</head>

<body>
	<div class="container wrapper">
		<div class="header">
	
		<div class="avatar">
			<a href="https://ieftimov.com/">
				<img src="avatar.png" alt="Ilija Eftimov" />
			</a>
		</div>
	
	<h1 class="site-title"><a href="https://ieftimov.com/">Ilija Eftimov</a></h1>
	<div class="site-description"><p>A human, interested in building products and software.</p><nav class="nav social">
			<ul class="flat"><li><a href="https://github.com/fteem" title="Github"><i data-feather="github"></i></a></li><li><a href="https://twitter.com/fteem" title="Twitter"><i data-feather="twitter"></i></a></li><li><a href="https://www.linkedin.com/in/ieftimov" title="Linkedin"><i data-feather="linkedin"></i></a></li><li><a href="mailto:blog@ieftimov.com" title="Email"><i data-feather="mail"></i></a></li></ul>
		</nav>
	</div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="/categories/testing-in-go">Testing in Go</a>
			</li>
			
			<li>
				<a href="/posts">Archive</a>
			</li>
			
			<li>
				<a href="/about">About</a>
			</li>
			
			<li>
				<a href="https://forms.gle/orfXK5jh1LRaiFzo8">Suggest a topic</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post">
			<div class="post-header">
				
					<div class="meta">
						<div class="date">
							<span class="day">26</span>
							<span class="rest">Jun 2016</span>
						</div>
					</div>
				
				<div class="matter">
					<h1 class="title">Sprinkle some HATEOAS on your Rails APIs</h1>
				</div>
			</div>
					
			<div class="markdown">
				<p>REST as a concept was introduced by <a href="https://en.wikipedia.org/wiki/Roy_Fielding">Roy
Fielding</a> in his doctoral thesis,
named <a href="http://www.ics.uci.edu/~fielding/pubs/dissertation/top.htm">Architectural Styles and the Design of Network-based Software
Architectures</a>.  16
years later, REST as an architecture is the most widely accepted way to design
and build APIs. I am sure we have all heard about it, and most of us think we
are building actual RESTful APIs. But, are we?</p>
<p>Let's remind ourselves what REST is and then continue on something else that
supplements REST, called HATEOAS.</p>
<h2 id="so-what-was-rest-again">So, what was REST again?</h2>
<p>I was thinking of a good way to explain this, but this gem by Ryan Tomako named
<a href="http://web.archive.org/web/20130316031532/http://tomayko.com/writings/rest-to-my-wife">How I Explained REST to My
Wife</a>
is the best explanation of REST I have seen so far.</p>
<p>Overall, REST (an acronym for <em>REpresentational State Transfer</em>) is an
architecture over which the Internet is built upon. The easiest way to explain
REST is, in my opinion, the Richardson Maturity Model. Here, we will not go in
much depth, but if you want to learn RMM in more depth, I recommend reading
<a href="http://martinfowler.com/articles/richardsonMaturityModel.html">Richardson Maturity Model, steps toward the glory of
REST</a> written by
Martin Fowler.</p>
<p>The RMM explains REST in four levels:</p>
<ol>
<li>Use a protocol to do remote procedure calls (RPC).</li>
<li>Introduce Resources</li>
<li>HTTP Verbs</li>
<li>Hypermedia Controls</li>
</ol>
<p>Let's deconstruct all of these levels briefly.</p>
<h3 id="level-1">Level 1</h3>
<p>Level one basically states that we need to use a protocol (HTTP) to execute
procedure calls on some remote location (a server). This also means that we
will not use any of the mechanism that the protocol provides, but we will just
use it as a tunnel to send the requests and responses.</p>
<h3 id="level-2">Level 2</h3>
<p>Level two is something very familiar to all of us, I am sure. Resources. Back
in the day, when I was probably still in high school, RPC worked by
communicating with a single endpoint on a server. This is called a &ldquo;service
endpoint&rdquo;.</p>
<p>By implementing resources in an API, we provide multiple endpoints that will
represent the resources. This means that instead of having one single
multipurpose endpoint, we have an endpoint for every resource that the API
exposes.</p>
<h3 id="level-3">Level 3</h3>
<p>With level 1 and level 2 the mechanisms of the protocol were skipped, because
we think only about tunneling our calls instead of fully utilising the
protocol.  Level 3 takes this to the next level (pun intended) and states that
any RESTful service needs to utilise HTTP verbs so clients can interact with
resources.</p>
<p>If you are coming from Rails land, I am sure you already know this - there's a
big difference between GET, POST, PUT, PATCH and DELETE. Sure, you could handle
these in various ways in your backend, but this is where Rails shines - it
strongly encourages you to comply to REST.</p>
<p>If you do not obey Level 3 of the RMM, you could have a different endpoint for
every action on the API side. For example, if you had a <code>Pet</code> resource, to
create a new entry you could use a <code>/pets/create</code> or a <code>/pets/update</code> to update
it. By utilising Level 3, when HTTP verbs come into play, you would use
something that Rails makes super easy: <code>GET /pets/:id</code> to get a <code>Pet</code>, <code>POST /pets</code> to create a new <code>Pet</code> or <code>PATCH /pets</code> to update one.</p>
<h3 id="level-4">Level 4</h3>
<p>Now, while Rails does a great job to <strong>make you</strong> write RESTful APIs, Level 4
is something that falls onto you, the programmer, to implement. This is
something that most of us don't follow and we, as a community, still haven't
find the best way to accomplish.</p>
<p>Hypermedia Controls is REST's &ldquo;holy grail&rdquo;, and the ultimate level of
&ldquo;RESTfulness&rdquo;. It states that when an API is at level four, it's clients can
request resources in a specific data format and can navigate throughout the API
by using Hypermedia Controls.</p>
<p>If you find this confusing, let's take a step back and think about browsers and
websites. When you use a website you usually know only the entry point, in the
form of <code>domainname.tld</code>, like <code>ieftimov.com</code> or <code>google.com</code>. Then, by
interacting the website via your browser you navigate throughout the different
pages it has. Well, navigating is done by clicking on links, right? Imagine a
website that instead of having links makes your remember every URL on the
website and you have to type it in manually. Worst website ever!</p>
<p>Having this in mind, the idea of Hypermedia Controls means that a resource
should provide links, so a client that consumes the resource can navigate
through and interact with it without knowing any other endpoint except the
entry point. Just like normal websites - the page provides you with the links
so you can interact with it.</p>
<p>We will get into the format of the JSON responses that HATEOAS APIs return in a
bit, but first we will look at another important mechanism of HATEAOS - content
negotiation.</p>
<h2 id="content-negotiation">Content negotiation</h2>
<p>Content negotiation is a mechanism embedded into HTTP that allows web services
to serve different versions (or formats) of documents. Or in REST terminology,
resources. This is achieved by the <code>Accept</code> group of HTTP headers. For example,
when requesting a web page the user agent (the browser) sends these (or similar)
headers, depending on the browser:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8
Accept-Encoding: gzip, deflate, sdch, br
Accept-Language: en-US,en;q=0.8</code></pre></div>
<p>This tells the server that the user agent can accept the document in a
<code>text/html</code>, compressed with one of the specified compression schemes, formatted
in <code>en-US</code> (US English) language.</p>
<p>If we go back to APIs, Rails does a very good job in content negotiation. When
we are building apps nowadays, we usually make sure our resources have a <code>HTML</code>,
<code>JSON</code> and (maybe) an <code>XML</code> representation. I am sure all of us have seen this:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby">respond_to <span style="color:#b84">:html</span>, <span style="color:#b84">:json</span>, <span style="color:#b84">:xml</span>

<span style="font-weight:bold">def</span> <span style="color:#458;font-weight:bold"></span><span style="font-weight:bold"></span><span style="color:#900;font-weight:bold">index</span>
  @pets <span style="font-weight:bold">=</span> <span style="color:#008080">Pet</span><span style="font-weight:bold">.</span>all
  respond_with(@pets)
<span style="font-weight:bold">end</span></code></pre></div>
<p>Or maybe the older version of this code:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="font-weight:bold">def</span> <span style="color:#458;font-weight:bold"></span><span style="font-weight:bold"></span><span style="color:#900;font-weight:bold">index</span>
  @pets <span style="font-weight:bold">=</span> <span style="color:#008080">Pet</span><span style="font-weight:bold">.</span>all
  respond_to <span style="font-weight:bold">do</span> <span style="font-weight:bold">|</span><span style="color:#999">format</span><span style="font-weight:bold">|</span>
    <span style="color:#999">format</span><span style="font-weight:bold">.</span>html
    <span style="color:#999">format</span><span style="font-weight:bold">.</span>json { render <span style="color:#b84">:json</span> <span style="font-weight:bold">=</span><span style="font-weight:bold">&gt;</span> @pets }
    <span style="color:#999">format</span><span style="font-weight:bold">.</span>xml { render <span style="color:#b84">:xml</span> <span style="font-weight:bold">=</span><span style="font-weight:bold">&gt;</span> @pets }
  <span style="font-weight:bold">end</span>
<span style="font-weight:bold">end</span></code></pre></div>
<p>This tells our <code>index</code> action to allow three types of content format are
requested, via content negotiation. <code>HTML</code>, <code>JSON</code> and <code>XML</code> are in fact Media
(or MIME) types.</p>
<p>If you look at the example headers, you can notice the <code>q</code> parameter. This is
called a <em>Quality Value</em> and it is what makes one content type more important
than another. In other words, the <code>q</code> parameter adds a relative <em>weight</em> to the
preference for that associated kind of content.</p>
<p>For example, let's say we have the following <code>Accept</code> header:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">Accept: application/json; q=0.5, application/xml; q=0.001</code></pre></div>
<p>This tells the server that the client prefers JSON content type much more than
XML. If the <code>q</code> value is not specified, then the value is defaulted to 1. You
can read more about content negotiation in <a href="https://tools.ietf.org/html/rfc7231#section-5.3">RFC 7231</a>.</p>
<h2 id="hateoas">HATEOAS</h2>
<p>So what is HATEOAS? It is an acronym, just like REST, which translates to
<strong>H</strong>ypermedia <strong>A</strong>s <strong>T</strong>he <strong>E</strong>ngine <strong>O</strong>f <strong>A</strong>pplication <strong>S</strong>tate. Whoa,
what a mouthful, right?</p>
<p>Like we mentioned, Level 4 of the RMM states that an API should provide
hypermedia controls to navigate in and interact with. But, what does HATEOAS
have to do with this? Well, think about this - REST means Representational
State Transfer while HATEOAS means Hypermedia As The Engine Of Application
State. If you look just as the names, it makes sense that HATEOAS is a mechanism
of REST. It all revolves around application state and state transitions.</p>
<p>Too complex? Let's see an example of a usual JSON representation of a resource,
in this case, my user somewhere on a server:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl http://awesomeapi.com/users/1</code></pre></div>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#000080">&#34;user&#34;</span>: {
    <span style="color:#000080">&#34;first_name&#34;</span>: <span style="color:#b84">&#34;Ilija&#34;</span>,
    <span style="color:#000080">&#34;last_name&#34;</span>: <span style="color:#b84">&#34;Eftimov&#34;</span>,
    <span style="color:#000080">&#34;age&#34;</span>: <span style="color:#099">25</span>
  }
}</code></pre></div>
<p>Simple enough. Now, when we apply HATEOAS to our representations of resources,
it should look something like this:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#000080">&#34;user&#34;</span>: {
    <span style="color:#000080">&#34;first_name&#34;</span>: <span style="color:#b84">&#34;Ilija&#34;</span>,
    <span style="color:#000080">&#34;last_name&#34;</span>: <span style="color:#b84">&#34;Eftimov&#34;</span>,
    <span style="color:#000080">&#34;age&#34;</span>: <span style="color:#099">25</span>,
    <span style="color:#000080">&#34;links&#34;</span>: [
      {
        <span style="color:#000080">&#34;rel&#34;</span>: <span style="color:#b84">&#34;self&#34;</span>,
        <span style="color:#000080">&#34;href&#34;</span>: <span style="color:#b84">&#34;http://awesomeapi.com/users/1&#34;</span>
      },
      {
        <span style="color:#000080">&#34;rel&#34;</span>: <span style="color:#b84">&#34;roles&#34;</span>,
        <span style="color:#000080">&#34;href&#34;</span>: <span style="color:#b84">&#34;http://awesomeapi.com/users/1/roles&#34;</span>
      }
    ]
  }
}</code></pre></div>
<p>By providing the <code>links</code> we allow the clients to use hypermedia (in our case,
JSON) as the engine (list of available actions) of our application state
(changing the data on the API side). The idea here is that there should be only
one entry point to an API, or to a resource, and that the representation of the
resource should include all of the actions that can be executed on this
resources.</p>
<p>This means that a consumer of the API can take use the <code>self</code> attribute of the
<code>User</code> resource, and consider this the endpoint where it can execute actions on
it. By knowing that the API is RESTful, the client knows how to update the
resource:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl -X <span style="color:#b84">&#34;PUT&#34;</span> -d <span style="color:#b84">&#34;{ &#39;age&#39;: 26 }&#34;</span> http://awesomeapi.com/users/1</code></pre></div>
<p>Also, it knows how to delete the resource:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl -X <span style="color:#b84">&#34;DELETE&#34;</span> http://awesomeapi.com/users/1</code></pre></div>
<p>Furthermore, if it wants to see all of the roles for this user, it can execute
a <code>GET</code> request to the <code>roles</code> relation of the user:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl http://awesomeapi.com/users/1/roles</code></pre></div>
<p>As you can see, by putting HATEOAS in the mix, clients can interact with
resources just by getting the URIs from the resources and by assuming that the
API is level three RESTful (utilises HTTP verbs).</p>
<h2 id="hateoas-serializers">HATEOAS Serializers</h2>
<p>How can we make our Rails API implement Level 4 of RMM? Let's see an example.</p>
<p>Our API is part of a blog CMS. It has an <code>Author</code> model, which has a
one-to-many association with an <code>Article</code> model. This means that, one <code>Author</code>
can have multiple <code>Article</code>.</p>
<p>The <code>Author</code> model:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#998;font-style:italic"># == Schema Information</span>
<span style="color:#998;font-style:italic">#</span>
<span style="color:#998;font-style:italic"># Table name: authors</span>
<span style="color:#998;font-style:italic">#</span>
<span style="color:#998;font-style:italic">#  id         :integer          not null, primary key</span>
<span style="color:#998;font-style:italic">#  first_name :string</span>
<span style="color:#998;font-style:italic">#  last_name  :string</span>
<span style="color:#998;font-style:italic">#  created_at :datetime         not null</span>
<span style="color:#998;font-style:italic">#  updated_at :datetime         not null</span>
<span style="color:#998;font-style:italic">#</span>

<span style="font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Author</span> <span style="font-weight:bold">&lt;</span> <span style="color:#008080">ApplicationRecord</span>
  has_many <span style="color:#b84">:articles</span>
<span style="font-weight:bold">end</span></code></pre></div>
<p>And the <code>Article</code> model:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#998;font-style:italic"># == Schema Information</span>
<span style="color:#998;font-style:italic">#</span>
<span style="color:#998;font-style:italic"># Table name: articles</span>
<span style="color:#998;font-style:italic">#</span>
<span style="color:#998;font-style:italic">#  id         :integer          not null, primary key</span>
<span style="color:#998;font-style:italic">#  author_id  :integer</span>
<span style="color:#998;font-style:italic">#  title      :string</span>
<span style="color:#998;font-style:italic">#  body       :text</span>
<span style="color:#998;font-style:italic">#  created_at :datetime         not null</span>
<span style="color:#998;font-style:italic">#  updated_at :datetime         not null</span>
<span style="color:#998;font-style:italic">#</span>

<span style="font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Article</span> <span style="font-weight:bold">&lt;</span> <span style="color:#008080">ApplicationRecord</span>
  belongs_to <span style="color:#b84">:author</span>
<span style="font-weight:bold">end</span></code></pre></div>
<p>Our routes look like the following:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#008080">Rails</span><span style="font-weight:bold">.</span>application<span style="font-weight:bold">.</span>routes<span style="font-weight:bold">.</span>draw <span style="font-weight:bold">do</span>
  resources <span style="color:#b84">:authors</span> <span style="font-weight:bold">do</span>
    resources <span style="color:#b84">:articles</span>
  <span style="font-weight:bold">end</span>
<span style="font-weight:bold">end</span></code></pre></div>
<p>Finally, we will have serializers for both, the <code>Article</code> and the <code>Author</code> model.
For this example, we will use
<a href="https://github.com/rails-api/active_model_serializers">Active Model Serializers</a>.</p>
<h3 id="author-serializer">Author serializer</h3>
<p>All of the <code>Author</code> objects will be serialized by the <code>AuthorSerializer</code>. Let's
add the required attributes first to the serializer, and we can talk about
extension afterwards.</p>
<p>The <code>AuthorSerializer</code> class will look like this:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#998;font-style:italic"># == Schema Information</span>
<span style="color:#998;font-style:italic">#</span>
<span style="color:#998;font-style:italic"># Table name: authors</span>
<span style="color:#998;font-style:italic">#</span>
<span style="color:#998;font-style:italic">#  id         :integer          not null, primary key</span>
<span style="color:#998;font-style:italic">#  first_name :string</span>
<span style="color:#998;font-style:italic">#  last_name  :string</span>
<span style="color:#998;font-style:italic">#  created_at :datetime         not null</span>
<span style="color:#998;font-style:italic">#  updated_at :datetime         not null</span>
<span style="color:#998;font-style:italic">#</span>

<span style="font-weight:bold">class</span> <span style="color:#458;font-weight:bold">AuthorSerializer</span> <span style="font-weight:bold">&lt;</span> <span style="color:#008080">ActiveModel</span><span style="font-weight:bold">::</span><span style="color:#008080">Serializer</span>
  attributes <span style="color:#b84">:id</span>, <span style="color:#b84">:first_name</span>, <span style="color:#b84">:last_name</span>, <span style="color:#b84">:created_at</span>, <span style="color:#b84">:updated_at</span>
  has_many <span style="color:#b84">:articles</span>
  type <span style="color:#b84">:author</span>
<span style="font-weight:bold">end</span></code></pre></div>
<p>Super simple! I will leave the annotations in, to keep the context of the data
visible to us throughout this short example. In my everyday work, I usually
consult with the schema file if I forget the shape of the data instead of
adding annotations.</p>
<p>Let's try sending a <code>GET /authors</code> request and see what the data looks like.
For reference, this is the implementation of the index action in the
<code>AuthorsController</code>:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="font-weight:bold">class</span> <span style="color:#458;font-weight:bold">AuthorsController</span> <span style="font-weight:bold">&lt;</span> <span style="color:#008080">ApplicationController</span>
  <span style="font-weight:bold">def</span> <span style="color:#458;font-weight:bold"></span><span style="font-weight:bold"></span><span style="color:#900;font-weight:bold">index</span>
    render <span style="color:#b84">json</span>: <span style="color:#008080">Author</span><span style="font-weight:bold">.</span>all
  <span style="font-weight:bold">end</span>
<span style="font-weight:bold">end</span></code></pre></div>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">curl http://localhost:3000/authors</code></pre></div>
<p>This request will return the following JSON:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">[
  {
    <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#099">1</span>,
    <span style="color:#000080">&#34;first_name&#34;</span>: <span style="color:#b84">&#34;ilija&#34;</span>,
    <span style="color:#000080">&#34;last_name&#34;</span>: <span style="color:#b84">&#34;eftimov&#34;</span>,
    <span style="color:#000080">&#34;created_at&#34;</span>: <span style="color:#b84">&#34;2016-06-25T20:52:12.804Z&#34;</span>,
    <span style="color:#000080">&#34;updated_at&#34;</span>: <span style="color:#b84">&#34;2016-06-25T20:52:12.804Z&#34;</span>,
    <span style="color:#000080">&#34;articles&#34;</span>: [
      {
        <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#099">1</span>,
        <span style="color:#000080">&#34;title&#34;</span>: <span style="color:#b84">&#34;Lorem ipsum&#34;</span>,
        <span style="color:#000080">&#34;body&#34;</span>: <span style="color:#b84">&#34;Lorem ipsum dolor sit amet&#34;</span>,
        <span style="color:#000080">&#34;created_at&#34;</span>: <span style="color:#b84">&#34;2016-06-25T22:25:51.874Z&#34;</span>,
        <span style="color:#000080">&#34;updated_at&#34;</span>: <span style="color:#b84">&#34;2016-06-25T22:25:51.874Z&#34;</span>
      },
      {
        <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#099">2</span>,
        <span style="color:#000080">&#34;title&#34;</span>: <span style="color:#b84">&#34;A princess of Mars&#34;</span>,
        <span style="color:#000080">&#34;body&#34;</span>: <span style="color:#b84">&#34;His reference to the great games of which I had heard so much while among the Tharks convinced me that I had but jumped from purgatory into gehenna. After a few more words with the female, during which she assured him that I was now fully fit to travel, the jed ordered that we mount and ride after the main column. I was strapped securely to as wild and unmanageable a thoat as I had&#34;</span>,
        <span style="color:#000080">&#34;created_at&#34;</span>: <span style="color:#b84">&#34;2016-06-26T00:20:09.388Z&#34;</span>,
        <span style="color:#000080">&#34;updated_at&#34;</span>: <span style="color:#b84">&#34;2016-06-26T00:20:09.388Z&#34;</span>
      }
    ]
  }
]</code></pre></div>
<p>Since my database has only one <code>Author</code> instance, it returns only that one.
Also, the <code>Author</code> has two associated <code>Article</code> instances, so the serializer
includes them in the response.</p>
<h3 id="adding-links-to-our-serializer">Adding links to our serializer</h3>
<p>Now we have our serializer working. The next step is to extend it with <code>links</code>.
This is quite trivial to do using Active Model Serializers - we need to add a
new <code>links</code> attribute to the serializer, and provide the implementation of the
attribute (which will be a method in fact) in the class:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#998;font-style:italic"># == Schema Information</span>
<span style="color:#998;font-style:italic">#</span>
<span style="color:#998;font-style:italic"># Table name: authors</span>
<span style="color:#998;font-style:italic">#</span>
<span style="color:#998;font-style:italic">#  id         :integer          not null, primary key</span>
<span style="color:#998;font-style:italic">#  first_name :string</span>
<span style="color:#998;font-style:italic">#  last_name  :string</span>
<span style="color:#998;font-style:italic">#  created_at :datetime         not null</span>
<span style="color:#998;font-style:italic">#  updated_at :datetime         not null</span>
<span style="color:#998;font-style:italic">#</span>

<span style="font-weight:bold">class</span> <span style="color:#458;font-weight:bold">AuthorSerializer</span> <span style="font-weight:bold">&lt;</span> <span style="color:#008080">BaseSerializer</span>
  attributes <span style="color:#b84">:id</span>, <span style="color:#b84">:first_name</span>, <span style="color:#b84">:last_name</span>, <span style="color:#b84">:created_at</span>, <span style="color:#b84">:updated_at</span>, <span style="color:#b84">:links</span>
  has_many <span style="color:#b84">:articles</span>
  type <span style="color:#b84">:author</span>

  <span style="font-weight:bold">def</span> <span style="color:#458;font-weight:bold"></span><span style="font-weight:bold"></span><span style="color:#900;font-weight:bold">links</span>
    <span style="font-weight:bold">[</span>
      {
        <span style="color:#b84">rel</span>: <span style="color:#b84">:self</span>,
        <span style="color:#b84">href</span>: author_path(object)
      }
    <span style="font-weight:bold">]</span>
  <span style="font-weight:bold">end</span>
<span style="font-weight:bold">end</span></code></pre></div>
<p>As you can see, the implementation is quite simple. We add a new attribute
called <code>links</code>, and the method just returns an array of hashes. For starters,
we will have only one - the <code>self</code> link which will point to the resource whose
representation we are seeing.</p>
<p>But, if you execute the curl request again, you will gen an error, something
like:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">#&lt;NoMethodError: undefined method `author_path&#39; for #&lt;AuthorSerializer:0x007fe251b4c450&gt;&gt;</code></pre></div>
<p>This occurs because Rails&rsquo; route helpers are not included in the scope of the
serializers. This is easily fixable by including them to the serializer:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="font-weight:bold">class</span> <span style="color:#458;font-weight:bold">AuthorSerializer</span> <span style="font-weight:bold">&lt;</span> <span style="color:#008080">ActiveModel</span><span style="font-weight:bold">::</span><span style="color:#008080">Serializer</span>
  <span style="font-weight:bold">include</span> <span style="color:#008080">Rails</span><span style="font-weight:bold">.</span>application<span style="font-weight:bold">.</span>routes<span style="font-weight:bold">.</span>url_helpers

  <span style="color:#998;font-style:italic"># *snip*</span>
<span style="font-weight:bold">end</span></code></pre></div>
<p>If we execute the curl request again now, we will see the links in the JSON:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">[
  {
    <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#099">1</span>,
    <span style="color:#000080">&#34;first_name&#34;</span>: <span style="color:#b84">&#34;ilija&#34;</span>,
    <span style="color:#000080">&#34;last_name&#34;</span>: <span style="color:#b84">&#34;eftimov&#34;</span>,
    <span style="color:#000080">&#34;created_at&#34;</span>: <span style="color:#b84">&#34;2016-06-25T20:52:12.804Z&#34;</span>,
    <span style="color:#000080">&#34;updated_at&#34;</span>: <span style="color:#b84">&#34;2016-06-25T20:52:12.804Z&#34;</span>,
    <span style="color:#000080">&#34;links&#34;</span>: [
      {
        <span style="color:#000080">&#34;rel&#34;</span>: <span style="color:#b84">&#34;self&#34;</span>,
        <span style="color:#000080">&#34;href&#34;</span>: <span style="color:#b84">&#34;/authors/1&#34;</span>
      }
    ],
    <span style="color:#000080">&#34;articles&#34;</span>: [
      {
        <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#099">1</span>,
        <span style="color:#000080">&#34;title&#34;</span>: <span style="color:#b84">&#34;Lorem ipsum&#34;</span>,
        <span style="color:#000080">&#34;body&#34;</span>: <span style="color:#b84">&#34;Lorem ipsum dolor sit amet&#34;</span>,
        <span style="color:#000080">&#34;created_at&#34;</span>: <span style="color:#b84">&#34;2016-06-25T22:25:51.874Z&#34;</span>,
        <span style="color:#000080">&#34;updated_at&#34;</span>: <span style="color:#b84">&#34;2016-06-25T22:25:51.874Z&#34;</span>
      },
      {
        <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#099">2</span>,
        <span style="color:#000080">&#34;title&#34;</span>: <span style="color:#b84">&#34;A princess of Mars&#34;</span>,
        <span style="color:#000080">&#34;body&#34;</span>: <span style="color:#b84">&#34;His reference to the great games of which I had heard so much while among the Tharks convinced me that I had but jumped from purgatory into gehenna. After a few more words with the female, during which she assured him that I was now fully fit to travel, the jed ordered that we mount and ride after the main column. I was strapped securely to as wild and unmanageable a thoat as I had&#34;</span>,
        <span style="color:#000080">&#34;created_at&#34;</span>: <span style="color:#b84">&#34;2016-06-26T00:20:09.388Z&#34;</span>,
        <span style="color:#000080">&#34;updated_at&#34;</span>: <span style="color:#b84">&#34;2016-06-26T00:20:09.388Z&#34;</span>
      }
    ]
  }
]</code></pre></div>
<p>Great stuff! We added <em>some</em> HATEOAS to our resources.</p>
<h2 id="specifications">Specifications</h2>
<p>Before we continue to add any more hypermedia to our resources, we need to put
some thought into this. As you can see, we went on to implement the <code>links</code>
attribute to the serializer without any thought. Sure, you might say, I am the
creator of the API and I will structure the responses of the API as I please.</p>
<p>True, you are the author of the API, but that statement is false. Imagine if
all of us thought of a way to implement hypermedia in a different way? Every
single API would be different in it's hypermedia controls and it would be a
hell to find your way around.</p>
<p>Well, the sad part is that we still don't know how to do HATEOAS. Or better
said, we still don't know <strong>the best way</strong> to do HATEOAS. That is why, people
have tried to create specifications, which have been somewhat adopted.</p>
<h3 id="hal">HAL</h3>
<p>From <a href="http://stateless.co/hal_specification.html">HAL</a>&lsquo;s documentation:</p>
<blockquote>
<p>HAL is a simple format that gives a consistent and easy way to hyperlink
between resources in your API.</p>
</blockquote>
<p>As you can see, the motivation behind HAL is to create an easy and consistent
way to add hypermedia controls. Just like any other specification, HAL provides
a set of conventions for expressing hyperlinks in either JSON or XML.</p>
<p>This is an example of a JSON that applies the HAL specification:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
    <span style="color:#000080">&#34;_links&#34;</span>: {
        <span style="color:#000080">&#34;self&#34;</span>: { <span style="color:#000080">&#34;href&#34;</span>: <span style="color:#b84">&#34;/orders&#34;</span> },
        <span style="color:#000080">&#34;curies&#34;</span>: [{ <span style="color:#000080">&#34;name&#34;</span>: <span style="color:#b84">&#34;ea&#34;</span>, <span style="color:#000080">&#34;href&#34;</span>: <span style="color:#b84">&#34;http://example.com/docs/rels/{rel}&#34;</span>, <span style="color:#000080">&#34;templated&#34;</span>: <span style="font-weight:bold">true</span> }],
        <span style="color:#000080">&#34;next&#34;</span>: { <span style="color:#000080">&#34;href&#34;</span>: <span style="color:#b84">&#34;/orders?page=2&#34;</span> },
        <span style="color:#000080">&#34;ea:find&#34;</span>: {
            <span style="color:#000080">&#34;href&#34;</span>: <span style="color:#b84">&#34;/orders{?id}&#34;</span>,
            <span style="color:#000080">&#34;templated&#34;</span>: <span style="font-weight:bold">true</span>
        },
        <span style="color:#000080">&#34;ea:admin&#34;</span>: [{
            <span style="color:#000080">&#34;href&#34;</span>: <span style="color:#b84">&#34;/admins/2&#34;</span>,
            <span style="color:#000080">&#34;title&#34;</span>: <span style="color:#b84">&#34;Fred&#34;</span>
        }, {
            <span style="color:#000080">&#34;href&#34;</span>: <span style="color:#b84">&#34;/admins/5&#34;</span>,
            <span style="color:#000080">&#34;title&#34;</span>: <span style="color:#b84">&#34;Kate&#34;</span>
        }]
    },
    <span style="color:#000080">&#34;currentlyProcessing&#34;</span>: <span style="color:#099">14</span>,
    <span style="color:#000080">&#34;shippedToday&#34;</span>: <span style="color:#099">20</span>,
    <span style="color:#000080">&#34;_embedded&#34;</span>: {
        <span style="color:#000080">&#34;ea:order&#34;</span>: [{
            <span style="color:#000080">&#34;_links&#34;</span>: {
                <span style="color:#000080">&#34;self&#34;</span>: { <span style="color:#000080">&#34;href&#34;</span>: <span style="color:#b84">&#34;/orders/123&#34;</span> },
                <span style="color:#000080">&#34;ea:basket&#34;</span>: { <span style="color:#000080">&#34;href&#34;</span>: <span style="color:#b84">&#34;/baskets/98712&#34;</span> },
                <span style="color:#000080">&#34;ea:customer&#34;</span>: { <span style="color:#000080">&#34;href&#34;</span>: <span style="color:#b84">&#34;/customers/7809&#34;</span> }
            },
            <span style="color:#000080">&#34;total&#34;</span>: <span style="color:#099">30.00</span>,
            <span style="color:#000080">&#34;currency&#34;</span>: <span style="color:#b84">&#34;USD&#34;</span>,
            <span style="color:#000080">&#34;status&#34;</span>: <span style="color:#b84">&#34;shipped&#34;</span>
        }, {
            <span style="color:#000080">&#34;_links&#34;</span>: {
                <span style="color:#000080">&#34;self&#34;</span>: { <span style="color:#000080">&#34;href&#34;</span>: <span style="color:#b84">&#34;/orders/124&#34;</span> },
                <span style="color:#000080">&#34;ea:basket&#34;</span>: { <span style="color:#000080">&#34;href&#34;</span>: <span style="color:#b84">&#34;/baskets/97213&#34;</span> },
                <span style="color:#000080">&#34;ea:customer&#34;</span>: { <span style="color:#000080">&#34;href&#34;</span>: <span style="color:#b84">&#34;/customers/12369&#34;</span> }
            },
            <span style="color:#000080">&#34;total&#34;</span>: <span style="color:#099">20.00</span>,
            <span style="color:#000080">&#34;currency&#34;</span>: <span style="color:#b84">&#34;USD&#34;</span>,
            <span style="color:#000080">&#34;status&#34;</span>: <span style="color:#b84">&#34;processing&#34;</span>
        }]
    }
}</code></pre></div>
<h3 id="json-api">JSON API</h3>
<p>JSON API, just like HAL is:</p>
<blockquote>
<p>a specification for how a client should request that resources be fetched or
modified, and how a server should respond to those requests.</p>
</blockquote>
<p>It was was originally drafted by Yehuda Katz in 2013. This first draft was
extracted from the JSON transport implicitly defined by Ember Data’s REST
adapter. From there on, it picked up some popularity, but I cannot say with
certainty that it's the de facto API specification.</p>
<p>This is an example of a JSON that applies the JSON API specification:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#000080">&#34;data&#34;</span>: [{
    <span style="color:#000080">&#34;type&#34;</span>: <span style="color:#b84">&#34;articles&#34;</span>,
    <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#b84">&#34;1&#34;</span>,
    <span style="color:#000080">&#34;attributes&#34;</span>: {
      <span style="color:#000080">&#34;title&#34;</span>: <span style="color:#b84">&#34;JSON API paints my bikeshed!&#34;</span>,
      <span style="color:#000080">&#34;body&#34;</span>: <span style="color:#b84">&#34;The shortest article. Ever.&#34;</span>,
      <span style="color:#000080">&#34;created&#34;</span>: <span style="color:#b84">&#34;2015-05-22T14:56:29.000Z&#34;</span>,
      <span style="color:#000080">&#34;updated&#34;</span>: <span style="color:#b84">&#34;2015-05-22T14:56:28.000Z&#34;</span>
    },
    <span style="color:#000080">&#34;relationships&#34;</span>: {
      <span style="color:#000080">&#34;author&#34;</span>: {
        <span style="color:#000080">&#34;data&#34;</span>: {<span style="color:#000080">&#34;id&#34;</span>: <span style="color:#b84">&#34;42&#34;</span>, <span style="color:#000080">&#34;type&#34;</span>: <span style="color:#b84">&#34;people&#34;</span>}
      }
    }
  }],
  <span style="color:#000080">&#34;included&#34;</span>: [
    {
      <span style="color:#000080">&#34;type&#34;</span>: <span style="color:#b84">&#34;people&#34;</span>,
      <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#b84">&#34;42&#34;</span>,
      <span style="color:#000080">&#34;attributes&#34;</span>: {
        <span style="color:#000080">&#34;name&#34;</span>: <span style="color:#b84">&#34;John&#34;</span>,
        <span style="color:#000080">&#34;age&#34;</span>: <span style="color:#099">80</span>,
        <span style="color:#000080">&#34;gender&#34;</span>: <span style="color:#b84">&#34;male&#34;</span>
      }
    }
  ]
}</code></pre></div>
<h3 id="other-standards">Other standards</h3>
<p>As you can imagine, people have tried to create a good JSON standard for quite
some time. Some of the more popular specs are
<a href="http://json-ld.org/">JSON for Linking Data</a>, also known as JSON-LD;
<a href="http://amundsen.com/media-types/collection/">Collection+JSON</a> and
<a href="https://github.com/kevinswiber/siren">SIREN</a>.</p>
<h2 id="json-api-and-active-model-serializers">JSON API and Active Model Serializers</h2>
<p>Since JSON API is picking up momentum and Active Model Serializers has a very
good integration of it, we will stick to it and carry on with the
implementation. Active Model Serializers on a high-level works through two
parts: serializers and adapters. From the documentation:</p>
<blockquote>
<p>Serializers describe which attributes and relationships should be serialized.
Adapters describe how attributes and relationships should be serialized.</p>
</blockquote>
<p>To get our JSON serialized in the JSON API format, we need to use a different
adapter called, believe it or not, <code>:json_api</code>. Personally, I prefer to do this
type of configuration in an initializer file:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#998;font-style:italic"># config/initializers/active_model_serializers.rb</span>

<span style="color:#008080">ActiveModelSerializers</span><span style="font-weight:bold">.</span>config<span style="font-weight:bold">.</span>adapter <span style="font-weight:bold">=</span> <span style="color:#b84">:json_api</span></code></pre></div>
<p>By setting the adapter to <code>:json_api</code>, our API will produce and consume JSON
formatted in the JSON API spec. If we execute the same API call that we did
earlier, we will get a newly formatted JSON:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#000080">&#34;data&#34;</span>: [
    {
      <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#b84">&#34;1&#34;</span>,
      <span style="color:#000080">&#34;type&#34;</span>: <span style="color:#b84">&#34;author&#34;</span>,
      <span style="color:#000080">&#34;attributes&#34;</span>: {
        <span style="color:#000080">&#34;first-name&#34;</span>: <span style="color:#b84">&#34;ilija&#34;</span>,
        <span style="color:#000080">&#34;last-name&#34;</span>: <span style="color:#b84">&#34;eftimov&#34;</span>,
        <span style="color:#000080">&#34;created-at&#34;</span>: <span style="color:#b84">&#34;2016-06-25T20:52:12.804Z&#34;</span>,
        <span style="color:#000080">&#34;updated-at&#34;</span>: <span style="color:#b84">&#34;2016-06-25T20:52:12.804Z&#34;</span>
      },
      <span style="color:#000080">&#34;relationships&#34;</span>: {
        <span style="color:#000080">&#34;articles&#34;</span>: {
          <span style="color:#000080">&#34;data&#34;</span>: [
            {
              <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#b84">&#34;1&#34;</span>,
              <span style="color:#000080">&#34;type&#34;</span>: <span style="color:#b84">&#34;article&#34;</span>
            },
            {
              <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#b84">&#34;2&#34;</span>,
              <span style="color:#000080">&#34;type&#34;</span>: <span style="color:#b84">&#34;article&#34;</span>
            }
          ]
        }
      },
      <span style="color:#000080">&#34;links&#34;</span>: {
        <span style="color:#000080">&#34;self&#34;</span>: {
          <span style="color:#000080">&#34;href&#34;</span>: <span style="color:#b84">&#34;/authors/1&#34;</span>
        }
      }
    }
  ]
}</code></pre></div>
<p>As you can notice, the JSON that we get back has a completely different
structure compared to what we have before. The reason is that the JSON API
adapter that we use now formats the JSON in the JSON API Spec format.</p>
<p>Another cool thing about the JSON API adapter is that it allows us to specify
links very explicitly, with a very nice DSL:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="font-weight:bold">class</span> <span style="color:#458;font-weight:bold">AuthorSerializer</span> <span style="font-weight:bold">&lt;</span> <span style="color:#008080">ActiveModel</span><span style="font-weight:bold">::</span><span style="color:#008080">Serializer</span>
  attributes <span style="color:#b84">:id</span>, <span style="color:#b84">:first_name</span>, <span style="color:#b84">:last_name</span>, <span style="color:#b84">:created_at</span>, <span style="color:#b84">:updated_at</span>
  has_many <span style="color:#b84">:articles</span>
  type <span style="color:#b84">:author</span>

  link <span style="color:#b84">:self</span> <span style="font-weight:bold">do</span>
    href author_path(object)
  <span style="font-weight:bold">end</span>
<span style="font-weight:bold">end</span></code></pre></div>
<p>Also, we do not have to specify the <code>links</code> as an attribute and we can remove
the <code>include</code> line that mixed-in Rails&rsquo; url helpers in our serializer. If we
call the <code>/authors</code> endpoint with a <code>GET</code> request again, we will see an
extended JSON, that again complies with the JSON API Spec:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#000080">&#34;data&#34;</span>: [
    {
      <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#b84">&#34;1&#34;</span>,
      <span style="color:#000080">&#34;type&#34;</span>: <span style="color:#b84">&#34;author&#34;</span>,
      <span style="color:#000080">&#34;attributes&#34;</span>: {
        <span style="color:#000080">&#34;first-name&#34;</span>: <span style="color:#b84">&#34;ilija&#34;</span>,
        <span style="color:#000080">&#34;last-name&#34;</span>: <span style="color:#b84">&#34;eftimov&#34;</span>,
        <span style="color:#000080">&#34;created-at&#34;</span>: <span style="color:#b84">&#34;2016-06-25T20:52:12.804Z&#34;</span>,
        <span style="color:#000080">&#34;updated-at&#34;</span>: <span style="color:#b84">&#34;2016-06-25T20:52:12.804Z&#34;</span>
      },
      <span style="color:#000080">&#34;relationships&#34;</span>: {
        <span style="color:#000080">&#34;articles&#34;</span>: {
          <span style="color:#000080">&#34;data&#34;</span>: [
            {
              <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#b84">&#34;1&#34;</span>,
              <span style="color:#000080">&#34;type&#34;</span>: <span style="color:#b84">&#34;article&#34;</span>
            },
            {
              <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#b84">&#34;2&#34;</span>,
              <span style="color:#000080">&#34;type&#34;</span>: <span style="color:#b84">&#34;article&#34;</span>
            }
          ]
        }
      },
      <span style="color:#000080">&#34;links&#34;</span>: {
        <span style="color:#000080">&#34;self&#34;</span>: {
          <span style="color:#000080">&#34;href&#34;</span>: <span style="color:#b84">&#34;/authors/1&#34;</span>
        }
      }
    }
  ]
}</code></pre></div>
<h2 id="including-additional-resources">Including additional resources</h2>
<p>Since AMS is an awesome gem, it allows you to include additional resources by
including them in the controllers:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="font-weight:bold">class</span> <span style="color:#458;font-weight:bold">AuthorsController</span> <span style="font-weight:bold">&lt;</span> <span style="color:#008080">ApplicationController</span>
  <span style="font-weight:bold">def</span> <span style="color:#458;font-weight:bold"></span><span style="font-weight:bold"></span><span style="color:#900;font-weight:bold">index</span>
    render <span style="color:#b84">json</span>: <span style="color:#008080">Author</span><span style="font-weight:bold">.</span>all, <span style="font-weight:bold">include</span>: <span style="color:#b84">&#39;articles&#39;</span>
  <span style="font-weight:bold">end</span>
<span style="font-weight:bold">end</span></code></pre></div>
<p>By including the <code>Article</code> association of on the <code>Author</code> model, we are able to
extend the JSON result with the associated articles for each of the users:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#000080">&#34;data&#34;</span>: [
    {
      <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#b84">&#34;1&#34;</span>,
      <span style="color:#000080">&#34;type&#34;</span>: <span style="color:#b84">&#34;author&#34;</span>,
      <span style="color:#000080">&#34;attributes&#34;</span>: {
        <span style="color:#000080">&#34;first-name&#34;</span>: <span style="color:#b84">&#34;ilija&#34;</span>,
        <span style="color:#000080">&#34;last-name&#34;</span>: <span style="color:#b84">&#34;eftimov&#34;</span>,
        <span style="color:#000080">&#34;created-at&#34;</span>: <span style="color:#b84">&#34;2016-06-25T20:52:12.804Z&#34;</span>,
        <span style="color:#000080">&#34;updated-at&#34;</span>: <span style="color:#b84">&#34;2016-06-25T20:52:12.804Z&#34;</span>
      },
      <span style="color:#000080">&#34;relationships&#34;</span>: {
        <span style="color:#000080">&#34;articles&#34;</span>: {
          <span style="color:#000080">&#34;data&#34;</span>: [
            {
              <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#b84">&#34;1&#34;</span>,
              <span style="color:#000080">&#34;type&#34;</span>: <span style="color:#b84">&#34;article&#34;</span>
            },
            {
              <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#b84">&#34;2&#34;</span>,
              <span style="color:#000080">&#34;type&#34;</span>: <span style="color:#b84">&#34;article&#34;</span>
            }
          ]
        }
      },
      <span style="color:#000080">&#34;links&#34;</span>: {
        <span style="color:#000080">&#34;self&#34;</span>: {
          <span style="color:#000080">&#34;href&#34;</span>: <span style="color:#b84">&#34;/authors/1&#34;</span>
        }
      }
    }
  ],
  <span style="color:#000080">&#34;included&#34;</span>: [
    {
      <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#b84">&#34;1&#34;</span>,
      <span style="color:#000080">&#34;type&#34;</span>: <span style="color:#b84">&#34;article&#34;</span>,
      <span style="color:#000080">&#34;attributes&#34;</span>: {
        <span style="color:#000080">&#34;title&#34;</span>: <span style="color:#b84">&#34;Lorem ipsum&#34;</span>,
        <span style="color:#000080">&#34;body&#34;</span>: <span style="color:#b84">&#34;Lorem ipsum dolor sit amet&#34;</span>,
        <span style="color:#000080">&#34;created-at&#34;</span>: <span style="color:#b84">&#34;2016-06-25T22:25:51.874Z&#34;</span>,
        <span style="color:#000080">&#34;updated-at&#34;</span>: <span style="color:#b84">&#34;2016-06-25T22:25:51.874Z&#34;</span>
      },
      <span style="color:#000080">&#34;relationships&#34;</span>: {
        <span style="color:#000080">&#34;author&#34;</span>: {
          <span style="color:#000080">&#34;data&#34;</span>: {
            <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#b84">&#34;1&#34;</span>,
            <span style="color:#000080">&#34;type&#34;</span>: <span style="color:#b84">&#34;author&#34;</span>
          }
        }
      },
      <span style="color:#000080">&#34;links&#34;</span>: {
        <span style="color:#000080">&#34;self&#34;</span>: {
          <span style="color:#000080">&#34;href&#34;</span>: <span style="color:#b84">&#34;/authors/1/articles/1&#34;</span>
        }
      }
    },
    {
      <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#b84">&#34;2&#34;</span>,
      <span style="color:#000080">&#34;type&#34;</span>: <span style="color:#b84">&#34;article&#34;</span>,
      <span style="color:#000080">&#34;attributes&#34;</span>: {
        <span style="color:#000080">&#34;title&#34;</span>: <span style="color:#b84">&#34;A princess of Mars&#34;</span>,
        <span style="color:#000080">&#34;body&#34;</span>: <span style="color:#b84">&#34;His reference to the great games of which I had heard so much while among the Tharks convinced me that I had but jumped from purgatory into gehenna. After a few more words with the female, during which she assured him that I was now fully fit to travel, the jed ordered that we mount and ride after the main column. I was strapped securely to as wild and unmanageable a thoat as I had&#34;</span>,
        <span style="color:#000080">&#34;created-at&#34;</span>: <span style="color:#b84">&#34;2016-06-26T00:20:09.388Z&#34;</span>,
        <span style="color:#000080">&#34;updated-at&#34;</span>: <span style="color:#b84">&#34;2016-06-26T00:20:09.388Z&#34;</span>
      },
      <span style="color:#000080">&#34;relationships&#34;</span>: {
        <span style="color:#000080">&#34;author&#34;</span>: {
          <span style="color:#000080">&#34;data&#34;</span>: {
            <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#b84">&#34;1&#34;</span>,
            <span style="color:#000080">&#34;type&#34;</span>: <span style="color:#b84">&#34;author&#34;</span>
          }
        }
      },
      <span style="color:#000080">&#34;links&#34;</span>: {
        <span style="color:#000080">&#34;self&#34;</span>: {
          <span style="color:#000080">&#34;href&#34;</span>: <span style="color:#b84">&#34;/authors/1/articles/2&#34;</span>
        }
      }
    }
  ]
}</code></pre></div>
<p>Although this is quite nice, beware that this introduces N+1 queries for every
resource that we fetch. That's why, usually <code>index</code> actions return only the
requested resources, while <code>show</code> actions tend to include some additional
resources:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="font-weight:bold">class</span> <span style="color:#458;font-weight:bold">AuthorsController</span> <span style="font-weight:bold">&lt;</span> <span style="color:#008080">ApplicationController</span>
  <span style="font-weight:bold">def</span> <span style="color:#458;font-weight:bold"></span><span style="font-weight:bold"></span><span style="color:#900;font-weight:bold">index</span>
    render <span style="color:#b84">json</span>: <span style="color:#008080">Author</span><span style="font-weight:bold">.</span>all
  <span style="font-weight:bold">end</span>

  <span style="font-weight:bold">def</span> <span style="color:#458;font-weight:bold"></span><span style="font-weight:bold"></span><span style="color:#900;font-weight:bold">show</span>
    author <span style="font-weight:bold">=</span> <span style="color:#008080">Author</span><span style="font-weight:bold">.</span>find(params<span style="font-weight:bold">[</span><span style="color:#b84">:id</span><span style="font-weight:bold">]</span>)
    render <span style="color:#b84">json</span>: author, <span style="font-weight:bold">include</span>: <span style="color:#b84">:articles</span>
  <span style="font-weight:bold">end</span>
<span style="font-weight:bold">end</span></code></pre></div>
<p>This will add all of the articles found for the author that we requested:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#000080">&#34;data&#34;</span>: {
    <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#b84">&#34;1&#34;</span>,
    <span style="color:#000080">&#34;type&#34;</span>: <span style="color:#b84">&#34;author&#34;</span>,
    <span style="color:#000080">&#34;attributes&#34;</span>: {
      <span style="color:#000080">&#34;first-name&#34;</span>: <span style="color:#b84">&#34;ilija&#34;</span>,
      <span style="color:#000080">&#34;last-name&#34;</span>: <span style="color:#b84">&#34;eftimov&#34;</span>,
      <span style="color:#000080">&#34;created-at&#34;</span>: <span style="color:#b84">&#34;2016-06-25T20:52:12.804Z&#34;</span>,
      <span style="color:#000080">&#34;updated-at&#34;</span>: <span style="color:#b84">&#34;2016-06-25T20:52:12.804Z&#34;</span>
    },
    <span style="color:#000080">&#34;relationships&#34;</span>: {
      <span style="color:#000080">&#34;articles&#34;</span>: {
        <span style="color:#000080">&#34;data&#34;</span>: [
          {
            <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#b84">&#34;1&#34;</span>,
            <span style="color:#000080">&#34;type&#34;</span>: <span style="color:#b84">&#34;article&#34;</span>
          },
          {
            <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#b84">&#34;2&#34;</span>,
            <span style="color:#000080">&#34;type&#34;</span>: <span style="color:#b84">&#34;article&#34;</span>
          }
        ]
      }
    },
    <span style="color:#000080">&#34;links&#34;</span>: {
      <span style="color:#000080">&#34;self&#34;</span>: {
        <span style="color:#000080">&#34;href&#34;</span>: <span style="color:#b84">&#34;/authors/1&#34;</span>
      }
    }
  },
  <span style="color:#000080">&#34;included&#34;</span>: [
    {
      <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#b84">&#34;1&#34;</span>,
      <span style="color:#000080">&#34;type&#34;</span>: <span style="color:#b84">&#34;article&#34;</span>,
      <span style="color:#000080">&#34;attributes&#34;</span>: {
        <span style="color:#000080">&#34;title&#34;</span>: <span style="color:#b84">&#34;Lorem ipsum&#34;</span>,
        <span style="color:#000080">&#34;body&#34;</span>: <span style="color:#b84">&#34;Lorem ipsum dolor sit amet&#34;</span>,
        <span style="color:#000080">&#34;created-at&#34;</span>: <span style="color:#b84">&#34;2016-06-25T22:25:51.874Z&#34;</span>,
        <span style="color:#000080">&#34;updated-at&#34;</span>: <span style="color:#b84">&#34;2016-06-25T22:25:51.874Z&#34;</span>
      },
      <span style="color:#000080">&#34;relationships&#34;</span>: {
        <span style="color:#000080">&#34;author&#34;</span>: {
          <span style="color:#000080">&#34;data&#34;</span>: {
            <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#b84">&#34;1&#34;</span>,
            <span style="color:#000080">&#34;type&#34;</span>: <span style="color:#b84">&#34;author&#34;</span>
          }
        }
      },
      <span style="color:#000080">&#34;links&#34;</span>: {
        <span style="color:#000080">&#34;self&#34;</span>: {
          <span style="color:#000080">&#34;href&#34;</span>: <span style="color:#b84">&#34;/authors/1/articles/1&#34;</span>
        }
      }
    },
    {
      <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#b84">&#34;2&#34;</span>,
      <span style="color:#000080">&#34;type&#34;</span>: <span style="color:#b84">&#34;article&#34;</span>,
      <span style="color:#000080">&#34;attributes&#34;</span>: {
        <span style="color:#000080">&#34;title&#34;</span>: <span style="color:#b84">&#34;A princess of Mars&#34;</span>,
        <span style="color:#000080">&#34;body&#34;</span>: <span style="color:#b84">&#34;His reference to the great games of which I had heard so much while among the Tharks convinced me that I had but jumped from purgatory into gehenna. After a few more words with the female, during which she assured him that I was now fully fit to travel, the jed ordered that we mount and ride after the main column. I was strapped securely to as wild and unmanageable a thoat as I had&#34;</span>,
        <span style="color:#000080">&#34;created-at&#34;</span>: <span style="color:#b84">&#34;2016-06-26T00:20:09.388Z&#34;</span>,
        <span style="color:#000080">&#34;updated-at&#34;</span>: <span style="color:#b84">&#34;2016-06-26T00:20:09.388Z&#34;</span>
      },
      <span style="color:#000080">&#34;relationships&#34;</span>: {
        <span style="color:#000080">&#34;author&#34;</span>: {
          <span style="color:#000080">&#34;data&#34;</span>: {
            <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#b84">&#34;1&#34;</span>,
            <span style="color:#000080">&#34;type&#34;</span>: <span style="color:#b84">&#34;author&#34;</span>
          }
        }
      },
      <span style="color:#000080">&#34;links&#34;</span>: {
        <span style="color:#000080">&#34;self&#34;</span>: {
          <span style="color:#000080">&#34;href&#34;</span>: <span style="color:#b84">&#34;/authors/1/articles/2&#34;</span>
        }
      }
    }
  ]
}</code></pre></div>
<p>As you can notice, because we supplied the <code>has_many</code> association in the
serializer, AMS knows to utilise the correct serializer for each of the
included resources. This adds the same structure to the included resources and
the requested resource, which makes the result consistent and parsing this JSON
much easier.</p>
<h2 id="navigating-resources">Navigating resources</h2>
<p>Now, to actually see how easy it is to navigate through resources, let's
implement the <code>ArticlesController#show</code> action as well:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="font-weight:bold">class</span> <span style="color:#458;font-weight:bold">ArticlesController</span> <span style="font-weight:bold">&lt;</span> <span style="color:#008080">ApplicationController</span>

  <span style="font-weight:bold">def</span> <span style="color:#458;font-weight:bold"></span><span style="font-weight:bold"></span><span style="color:#900;font-weight:bold">show</span>
    article <span style="font-weight:bold">=</span> <span style="color:#008080">Article</span><span style="font-weight:bold">.</span>find_by(<span style="color:#b84">author_id</span>: params<span style="font-weight:bold">[</span><span style="color:#b84">:author_id</span><span style="font-weight:bold">]</span>, <span style="color:#999">id</span>: params<span style="font-weight:bold">[</span><span style="color:#b84">:id</span><span style="font-weight:bold">]</span>)
    render <span style="color:#b84">json</span>: article
  <span style="font-weight:bold">end</span>
<span style="font-weight:bold">end</span></code></pre></div>
<p>Super simple - we find the <code>Article</code> by the <code>author_id</code> and the <code>id</code> params and
render it as a JSON. If we call <code>GET /authors/1/articles/2</code>, we will get the
JSON API representation of the <code>Article</code> object:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#000080">&#34;data&#34;</span>: {
    <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#b84">&#34;2&#34;</span>,
    <span style="color:#000080">&#34;type&#34;</span>: <span style="color:#b84">&#34;article&#34;</span>,
    <span style="color:#000080">&#34;attributes&#34;</span>: {
      <span style="color:#000080">&#34;title&#34;</span>: <span style="color:#b84">&#34;A princess of Mars&#34;</span>,
      <span style="color:#000080">&#34;body&#34;</span>: <span style="color:#b84">&#34;His reference to the great games of which I had heard so much while among the Tharks convinced me that I had but jumped from purgatory into gehenna. After a few more words with the female, during which she assured him that I was now fully fit to travel, the jed ordered that we mount and ride after the main column. I was strapped securely to as wild and unmanageable a thoat as I had&#34;</span>,
      <span style="color:#000080">&#34;created-at&#34;</span>: <span style="color:#b84">&#34;2016-06-26T00:20:09.388Z&#34;</span>,
      <span style="color:#000080">&#34;updated-at&#34;</span>: <span style="color:#b84">&#34;2016-06-26T00:20:09.388Z&#34;</span>
    },
    <span style="color:#000080">&#34;relationships&#34;</span>: {
      <span style="color:#000080">&#34;author&#34;</span>: {
        <span style="color:#000080">&#34;data&#34;</span>: {
          <span style="color:#000080">&#34;id&#34;</span>: <span style="color:#b84">&#34;1&#34;</span>,
          <span style="color:#000080">&#34;type&#34;</span>: <span style="color:#b84">&#34;author&#34;</span>
        }
      }
    },
    <span style="color:#000080">&#34;links&#34;</span>: {
      <span style="color:#000080">&#34;self&#34;</span>: {
        <span style="color:#000080">&#34;href&#34;</span>: <span style="color:#b84">&#34;/authors/1/articles/2&#34;</span>
      }
    }
  }
}</code></pre></div>
<p>If you use <a href="https://www.getpostman.com/">Postman</a>, which I really enjoy using,
or any other API browser to test the endpoints you could see how easy it is to
navigate the resources:</p>
<p><img src="/postman-hateoas-1.png" alt=""></p>
<p>Just link in the web browser, you know the entry point
<code>localhost:3000/authors</code>.  From there you can click on the <code>links</code> property of
the <code>Author</code> and get the single <code>Author</code> resource:</p>
<p><img src="/postman-hateoas-2.png" alt=""></p>
<p>By seeing the resource with all of it's included resources, then you can click
on any of the links on the included <code>Article</code> resources, and see their
attributes in JSON format:</p>
<p><img src="/postman-hateoas-3.png" alt=""></p>
<p>This is what essentially HATEOAS means - navigating and interacting with
resources via the endpoints that are provided in the JSON representation of the
resources.</p>
<h2 id="outro">Outro</h2>
<p>As you can see, to understand and learn what Hypermedia As The Engine Of
Application State is, there is quite a bit of context that we need to get in
our heads. Although all of this sometimes can appear as quite complex, Rails
makes implementing HATEOAS APIs quite easy, as you could see in the examples.
Sure, there is more to hypermedia controls, but these examples should be more
than enough to get your feet wet.</p>
<p>Also, the HATEOAS concept seems quite complex on the surface, but when you
deconstruct it it's quite simple, because we have already seen the same
behaviour in web browsers. The issue of why it seems quite complex is because
we haven't even thought about normal web sites like RESTful APIs, and
vice-versa.</p>
<p>If you want to see the actual implementation of the endpoints that we worked
with in this article, you can check <a href="https://github.com/fteem/hateoas">this
repo</a> on Github.</p>
<h2 id="additional-reading">Additional reading</h2>
<ul>
<li><a href="https://tools.ietf.org/html/rfc5988">Web Linking - RFC 5988</a></li>
<li><a href="http://timelessrepo.com/haters-gonna-hateoas">Haters gonna HATEOAS</a></li>
<li><a href="http://martinfowler.com/articles/richardsonMaturityModel.html">Richardson Maturity Model, steps toward the glory of REST</a></li>
<li><a href="http://restcookbook.com/Miscellaneous/richardsonmaturitymodel/">What is the Richardson Maturity Model?</a></li>
<li><a href="https://en.wikipedia.org/wiki/Media_type">Media type</a></li>
<li><a href="https://tools.ietf.org/html/rfc7231#section-5.3">Content negotiation</a></li>
</ul>

			</div>

			<div class="tags">
				
					
						<ul class="flat">
							
							<li><a href="/tags/http">HTTP</a></li>
							
							<li><a href="/tags/apis">APIs</a></li>
							
							<li><a href="/tags/hateoas">HATEOAS</a></li>
							
						</ul>
					
				
			</div><div id="disqus_thread"></div>
<script type="text/javascript">
	(function () {
		
		
		if (window.location.hostname == "localhost")
			return;

		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		var disqus_shortname = 'eftimov';
		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
</script>
<noscript>Please enable JavaScript to view the </a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
	</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div> Copyright © 2014 - 2020 Ilija Eftimov |  <a href="https://github.com/knadh/hugo-ink">Ink</a> theme on <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-11264459-2', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<script>feather.replace()</script>
</body>
</html>
