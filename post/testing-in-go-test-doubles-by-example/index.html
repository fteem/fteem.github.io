<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Testing in Go: Test Doubles by Example | Ilija Eftimov ⚡️</title><meta name=keywords content><meta name=description content="One of the biggest misconceptions is that doubles are a specific implementation of mocks or other testing constructs that we use in testing.
Dummies, mocks, stubs, fakes, and spies ARE test doubles. Test double is the category of these test constructs. Over the years, there has been some confusion around this concept.
It is my observation that this confusion arises from the naming of testing constructs that the popular testing frameworks use."><meta name=author content="Ilija"><link rel=canonical href=https://ieftimov.com/post/testing-in-go-test-doubles-by-example/><link crossorigin=anonymous href=/assets/css/stylesheet.min.css rel="preload stylesheet" as=style><link rel=icon href=https://ieftimov.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://ieftimov.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://ieftimov.com/favicon-32x32.png><link rel=apple-touch-icon href=https://ieftimov.com/apple-touch-icon.png><link rel=mask-icon href=https://ieftimov.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.83.1"><script async defer data-domain=ieftimov.com src=https://plausible.io/js/plausible.js></script><link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel=stylesheet><meta property="og:title" content="Testing in Go: Test Doubles by Example"><meta property="og:description" content="One of the biggest misconceptions is that doubles are a specific implementation of mocks or other testing constructs that we use in testing.
Dummies, mocks, stubs, fakes, and spies ARE test doubles. Test double is the category of these test constructs. Over the years, there has been some confusion around this concept.
It is my observation that this confusion arises from the naming of testing constructs that the popular testing frameworks use."><meta property="og:type" content="article"><meta property="og:url" content="https://ieftimov.com/post/testing-in-go-test-doubles-by-example/"><meta property="og:image" content="https://ieftimov.com/cards/testing-in-go-test-doubles-by-example.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-12-16T00:00:00+00:00"><meta property="article:modified_time" content="2019-12-16T00:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://ieftimov.com/cards/testing-in-go-test-doubles-by-example.png"><meta name=twitter:title content="Testing in Go: Test Doubles by Example"><meta name=twitter:description content="One of the biggest misconceptions is that doubles are a specific implementation of mocks or other testing constructs that we use in testing.
Dummies, mocks, stubs, fakes, and spies ARE test doubles. Test double is the category of these test constructs. Over the years, there has been some confusion around this concept.
It is my observation that this confusion arises from the naming of testing constructs that the popular testing frameworks use."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://ieftimov.com/posts/"},{"@type":"ListItem","position":2,"name":"Testing in Go: Test Doubles by Example","item":"https://ieftimov.com/post/testing-in-go-test-doubles-by-example/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Testing in Go: Test Doubles by Example","name":"Testing in Go: Test Doubles by Example","description":"One of the biggest misconceptions is that doubles are a specific implementation of mocks or other testing constructs that we use in testing.\nDummies, mocks, stubs, fakes, and spies ARE test doubles. Test double is the category of these test constructs. Over the years, there has been some confusion around this concept.\nIt is my observation that this confusion arises from the naming of testing constructs that the popular testing frameworks use.","keywords":[],"articleBody":"One of the biggest misconceptions is that doubles are a specific implementation of mocks or other testing constructs that we use in testing.\nDummies, mocks, stubs, fakes, and spies ARE test doubles. Test double is the category of these test constructs. Over the years, there has been some confusion around this concept.\nIt is my observation that this confusion arises from the naming of testing constructs that the popular testing frameworks use. Also, the words mock and doubles have been used interchangeably over the years, and their definitions got skewed.\nIn any case, without further ado, let’s dive in and explore each of these categories of test doubles.\n  Dummies The simplest type of test double is a test dummy. In a nutshell, it means that the instance is just a placeholder for another one, but its functions do not return anything.\nLet’s imagine the following scenario. We have a Phonebook type that has a slice of Person as an attribute. Each Person has a FirstName, LastName, and Phone attributes. Also, the Phonebook has a Find method through which we can find a person’s phone number using their first and last names.\nThe Find method uses a Searcher object whose Search function it uses to find the entry in the slice of people. Searcher’s implementation is not essential at this moment.\npackage main import ( \"errors\" ) var ( ErrMissingArgs = errors.New(\"FirstName and LastName are mandatory arguments\") ErrNoPersonFound = errors.New(\"No person found\") ) type Searcher interface { Search(people []*Person, firstName string, lastName string) *Person } type Person struct { FirstName string LastName string Phone string } type Phonebook struct { People []*Person } func (p *Phonebook) Find(searcher Searcher, firstName, lastName string) (string, error) { if firstName == \"\" || lastName == \"\" { return \"\", ErrMissingArgs } person := searcher.Search(p.People, firstName, lastName) if person == nil { return \"\", ErrNoPersonFound } return person.Phone, nil } Imagine we want to test the Find method of the Phonebook. How would you approach it? Here’s one way:\ntype DummySearcher struct{} func (ds DummySearcher) Search(people []*Person, firstName, lastName string) *Person { return \u0026Person{} } func TestFindReturnsError(t *testing.T) { phonebook := \u0026Phonebook{} want := ErrMissingArgs _, got := phonebook.Find(DummySearcher{}, \"\", \"\") if got != want { t.Errorf(\"Want '%s', got '%s'\", want, got) } } To test that the Find method returns an error when one of the arguments is blank, we do not care about the implementation of the Searcher argument. In such cases, where the functionality of the injected dependency is irrelevant, all we need is an instance that we can just pass in, and the compiler won’t complain.\nSuch instances are called dummies. They are test doubles that have no functionality and that we don’t want people to use.\nStubs Using the same example from above, how would we test that the Find method when supplied the firstName and lastName arguments will work as expected?\ntype StubSearcher struct { phone string } func (ss StubSearcher) Search(people []*Person, firstName, lastName string) *Person { return \u0026Person{ FirstName: firstName, LastName: lastName, Phone: ss.phone, } } func TestFindReturnsPerson(t *testing.T) { fakePhone := \"+31 65 222 333\" phonebook := \u0026Phonebook{} phone, _ := phonebook.Find(StubSearcher{fakePhone}, \"Jane\", \"Doe\") if phone != fakePhone { t.Errorf(\"Want '%s', got '%s'\", fakePhone, phone) } } When we want to make the Searcher implementation return an actual value that we can assert against, we need a stub. Instead of understanding what it would take to set up and/or implement a proper Searcher, you just create a stub implementation that returns only one value. This is the idea behind stubs.\nSpies Again, using the Phonebook and Searcher example from above, let’s imagine we would like to write a test where we want to be sure we invoke the Searcher.Search function. How can we do that?\ntype SpySearcher struct { phone string searchWasCalled bool } func (ss *SpySearcher) Search(people []*Person, firstName, lastName string) *Person { ss.searchWasCalled = true return \u0026Person{ FirstName: firstName, LastName: lastName, Phone: ss.phone, } } func TestFindCallsSearchAndReturnsPerson(t *testing.T) { fakePhone := \"+31 65 222 333\" phonebook := \u0026Phonebook{} spy := \u0026SpySearcher{phone: fakePhone} phone, _ := phonebook.Find(spy, \"Jane\", \"Doe\") if !spy.searchWasCalled { t.Errorf(\"Expected to call 'Search' in 'Find', but it wasn't.\") } if phone != fakePhone { t.Errorf(\"Want '%s', got '%s'\", fakePhone, phone) } } You can think of spies as an upgrade of stubs. While they return a predefined value, just like stubs, spies also remember whether we called a specific method. Often, spies also keep track of how many times we call a particular function.\nThat’s what spy is - a stub that keeps track of invocations of its methods.\nMocks In the beginning, people started using mock for similar (but not the same) things, and the word got left hanging in the air without a proper definition. Some think of stubs as mocks; others do not even think of mocks as types of instances.\nIt’s generally accepted to use “mocking” when thinking about creating objects that simulate the behavior of real objects or units.\nBut mocks are a thing of their own. They have the same characteristics as the stubs \u0026 spies, with a bit more.\nAlso, in Go, they are a bit tricky to implement, especially in a generic way. Still, for this example, we will do a home-made implementation:\ntype MockSearcher struct { phone string methodsToCall map[string]bool } func (ms *MockSearcher) Search(people []*Person, firstName, lastName string) *Person { ms.methodsToCall[\"Search\"] = true return \u0026Person{ FirstName: firstName, LastName: lastName, Phone: ms.phone, } } func (ms *MockSearcher) ExpectToCall(methodName string) { if ms.methodsToCall == nil { ms.methodsToCall = make(map[string]bool) } ms.methodsToCall[methodName] = false } func (ms *MockSearcher) Verify(t *testing.T) { for methodName, called := range ms.methodsToCall { if !called { t.Errorf(\"Expected to call '%s', but it wasn't.\", methodName) } } } func TestFindCallsSearchAndReturnsPersonUsingMock(t *testing.T) { fakePhone := \"+31 65 222 333\" phonebook := \u0026Phonebook{} mock := \u0026MockSearcher{phone: fakePhone} mock.ExpectToCall(\"Search\") phone, _ := phonebook.Find(mock, \"Jane\", \"Doe\") if phone != fakePhone { t.Errorf(\"Want '%s', got '%s'\", fakePhone, phone) } mock.Verify(t) } This approach is more involved, but there’s no magic to it. The MockSearcher implementation has a methodsToCall map, which will store all of the methods that we expect to call on an instance of this type.\nThe ExpectToCall method will take a method name as an argument. It will store the method to the methodsToCall map (as the key) and a false as the value. By setting it to false, we set a mark on that method that we expect to call it (yet we still haven’t called it).\nIn MockSearcher’s Search method, we mark the Search method as called. We do this by setting the true value for the \"Search\" key in the methodsToCall map. In essence, the key we’ve set to false in the ExpectToCall method we set to true here.\nLastly, the Verify method will go over all of the methods that we marked as to-be-called on the mock. If it finds one still set to false, it will mark the test as failed.\nMocks work by setting certain expectations on them. We implement some stub-like functionality while keeping track of the methods that have been called. Finally, we ask the mock to verify if our code met all of its expectations.\nIt’s worth stating that this is a home-made solution, and as such, it has some caveats. If you would like to use mocks in your tests, there are some excellent Golang libraries out there like golang/mock or stretchr/testify.\nFakes These test doubles, unlike stubs, spies, and mocks, truly have an implementation. In our example, this would mean that a fake would have an actual implementation of the Search method.\nLet’s see a Searcher fake in action:\ntype FakeSearcher struct{} func (fs FakeSearcher) Search(people []*Person, firstName string, lastName string) *Person { if len(people) == 0 { return nil } return people[0] } func TestFindCallsSearchAndReturnsEmptyStringForNoPerson(t *testing.T) { phonebook := \u0026Phonebook{} fake := \u0026FakeSearcher{} phone, _ := phonebook.Find(fake, \"Jane\", \"Doe\") if phone != \"\" { t.Errorf(\"Wanted '', got '%s'\", phone) } } What you see is a FakeSearcher type, who’s Search method has an implementation that (kinda) makes sense. If the slice of *Person is empty, it will return nil. Otherwise, it will return the first item in the slice.\nWhile this Search method is not production-ready, because it doesn’t make much sense, it still has the behavior of a fake Searcher. If we didn’t have it’s implementation accessible (looking at it as a black box), one could think it’s the real deal instead of a fake.\nThat’s what fakes are - implementations that look like the real thing. But they only do the trick in the scope of the test.\nAnother such familiar example in the community is an in-memory database driver used as fake to a real database driver.\nWhen To Use What Now that we went through all of the test doubles and their implementations, the last question that we need to answer is: what test double should we use in which circumstances?\nAs with many other things in software development, the answer is: it depends.\nYou must keep in mind is what are you really testing. That is also known as the unit under test. If the unit under test requires a double of any sort, you should provide the simplest test double that will make your test do its work and that it will suffice to make the test pass.\nSo, refrain from using bloated mocks if a stub does the trick. The rule of thumb is: use the simplest test double that you can. And after the test passes, see if you can refactor and simplify further.\nAnd lastly, make sure not to downright mock out everything – sometimes invoking the actual implementation (e.g., like in an integration test) can be a great idea.\nAdditional reading:\n “The Little Mocker” by Uncle Bob “TestDouble” by Martin Fowler “Testing on the Toilet: Know Your Test Doubles” by Andrew Trenk   Liked this article? Subscribe to my newsletter and get future articles in your inbox. It's a short and sweet read, going out to +1000 of other engineers.  I care about your privacy, and will never send you spam. You can unsubscribe at any time.\n ","wordCount":"1693","inLanguage":"en","datePublished":"2019-12-16T00:00:00Z","dateModified":"2019-12-16T00:00:00Z","author":{"@type":"Person","name":"Ilija"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://ieftimov.com/post/testing-in-go-test-doubles-by-example/"},"publisher":{"@type":"Organization","name":"Ilija Eftimov ⚡️","logo":{"@type":"ImageObject","url":"https://ieftimov.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://ieftimov.com/ accesskey=h title="Ilija Eftimov ⚡️ (Alt + H)">Ilija Eftimov ⚡️</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://ieftimov.com/ title=About><span>About</span></a></li><li><a href=https://ieftimov.com/posts title=Writing><span>Writing</span></a></li><li><a href=https://ieftimov.com/newsletter title=Newsletter><span>Newsletter</span></a></li><li><a href=https://forms.gle/orfXK5jh1LRaiFzo8 title="Suggest a topic"><span>Suggest a topic</span></a></li><li><a href=https://www.buymeacoffee.com/ieftimov title="Buy me a ☕"><span>Buy me a ☕</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Testing in Go: Test Doubles by Example</h1><div class=post-meta>December 16, 2019&nbsp;·&nbsp;8 min&nbsp;·&nbsp;Ilija</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><div class=details>Table of Contents</div></summary><div class=inner><ul><li><a href=#dummies aria-label=Dummies>Dummies</a></li><li><a href=#stubs aria-label=Stubs>Stubs</a></li><li><a href=#spies aria-label=Spies>Spies</a></li><li><a href=#mocks aria-label=Mocks>Mocks</a></li><li><a href=#fakes aria-label=Fakes>Fakes</a></li><li><a href=#when-to-use-what aria-label="When To Use What">When To Use What</a></li></ul></div></details></div><div class=post-content><p>One of the biggest misconceptions is that doubles are a specific implementation
of mocks or other testing constructs that we use in testing.</p><p>Dummies, mocks, stubs, fakes, and spies ARE test doubles. Test double is the
category of these test constructs. Over the years, there has been some
confusion around this concept.</p><p>It is my observation that this confusion arises from the naming of testing
constructs that the popular testing frameworks use. Also, the words mock and
doubles have been used interchangeably over the years, and their definitions
got skewed.</p><p>In any case, without further ado, let&rsquo;s dive in and explore each of these
categories of test doubles.</p><figure class=imagecaption><img class=caption src=/testing-in-go-test-doubles-by-example/fitting_pieces.png caption alt="Girl with geometric objects">
<span class=caption-text style="font-size:.75em;display:table;margin:0 auto 1.5em"></span></figure><h2 id=dummies>Dummies<a hidden class=anchor aria-hidden=true href=#dummies>#</a></h2><p>The simplest type of test double is a test dummy. In a nutshell, it means that
the instance is just a placeholder for another one, but its functions do not
return anything.</p><p>Let&rsquo;s imagine the following scenario. We have a <code>Phonebook</code> type that has a
slice of <code>Person</code> as an attribute. Each <code>Person</code> has a <code>FirstName</code>, <code>LastName</code>,
and <code>Phone</code> attributes. Also, the <code>Phonebook</code> has a <code>Find</code> method through which
we can find a person&rsquo;s phone number using their first and last names.</p><p>The <code>Find</code> method uses a <code>Searcher</code> object whose <code>Search</code> function it uses to
find the entry in the slice of people. <code>Searcher</code>&rsquo;s implementation is not
essential at this moment.</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#719e07>package</span> main

<span style=color:#719e07>import</span> (
	<span style=color:#2aa198>&#34;errors&#34;</span>
)

<span style=color:#268bd2>var</span> (
	ErrMissingArgs   = errors.<span style=color:#268bd2>New</span>(<span style=color:#2aa198>&#34;FirstName and LastName are mandatory arguments&#34;</span>)
	ErrNoPersonFound = errors.<span style=color:#268bd2>New</span>(<span style=color:#2aa198>&#34;No person found&#34;</span>)
)

<span style=color:#268bd2>type</span> Searcher <span style=color:#268bd2>interface</span> {
	<span style=color:#268bd2>Search</span>(people []<span style=color:#719e07>*</span>Person, firstName <span style=color:#dc322f>string</span>, lastName <span style=color:#dc322f>string</span>) <span style=color:#719e07>*</span>Person
}

<span style=color:#268bd2>type</span> Person <span style=color:#268bd2>struct</span> {
	FirstName <span style=color:#dc322f>string</span>
	LastName  <span style=color:#dc322f>string</span>
	Phone     <span style=color:#dc322f>string</span>
}

<span style=color:#268bd2>type</span> Phonebook <span style=color:#268bd2>struct</span> {
	People []<span style=color:#719e07>*</span>Person
}

<span style=color:#268bd2>func</span> (p <span style=color:#719e07>*</span>Phonebook) <span style=color:#268bd2>Find</span>(searcher Searcher, firstName, lastName <span style=color:#dc322f>string</span>) (<span style=color:#dc322f>string</span>, <span style=color:#dc322f>error</span>) {
	<span style=color:#719e07>if</span> firstName <span style=color:#719e07>==</span> <span style=color:#2aa198>&#34;&#34;</span> <span style=color:#719e07>||</span> lastName <span style=color:#719e07>==</span> <span style=color:#2aa198>&#34;&#34;</span> {
		<span style=color:#719e07>return</span> <span style=color:#2aa198>&#34;&#34;</span>, ErrMissingArgs
	}

	person <span style=color:#719e07>:=</span> searcher.<span style=color:#268bd2>Search</span>(p.People, firstName, lastName)

	<span style=color:#719e07>if</span> person <span style=color:#719e07>==</span> <span style=color:#cb4b16>nil</span> {
		<span style=color:#719e07>return</span> <span style=color:#2aa198>&#34;&#34;</span>, ErrNoPersonFound
	}

	<span style=color:#719e07>return</span> person.Phone, <span style=color:#cb4b16>nil</span>
}</code></pre></div><p>Imagine we want to test the <code>Find</code> method of the <code>Phonebook</code>. How would you
approach it? Here&rsquo;s one way:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#268bd2>type</span> DummySearcher <span style=color:#268bd2>struct</span>{}

<span style=color:#268bd2>func</span> (ds DummySearcher) <span style=color:#268bd2>Search</span>(people []<span style=color:#719e07>*</span>Person, firstName, lastName <span style=color:#dc322f>string</span>) <span style=color:#719e07>*</span>Person {
	<span style=color:#719e07>return</span> <span style=color:#719e07>&amp;</span>Person{}
}

<span style=color:#268bd2>func</span> <span style=color:#268bd2>TestFindReturnsError</span>(t <span style=color:#719e07>*</span>testing.T) {
	phonebook <span style=color:#719e07>:=</span> <span style=color:#719e07>&amp;</span>Phonebook{}

	want <span style=color:#719e07>:=</span> ErrMissingArgs
	_, got <span style=color:#719e07>:=</span> phonebook.<span style=color:#268bd2>Find</span>(DummySearcher{}, <span style=color:#2aa198>&#34;&#34;</span>, <span style=color:#2aa198>&#34;&#34;</span>)

	<span style=color:#719e07>if</span> got <span style=color:#719e07>!=</span> want {
		t.<span style=color:#268bd2>Errorf</span>(<span style=color:#2aa198>&#34;Want &#39;%s&#39;, got &#39;%s&#39;&#34;</span>, want, got)
	}
}</code></pre></div><p>To test that the <code>Find</code> method returns an error when one of the arguments is
blank, we do not care about the implementation of the <code>Searcher</code> argument. In
such cases, where the functionality of the injected dependency is irrelevant,
all we need is an instance that we can just pass in, and the compiler won&rsquo;t
complain.</p><p>Such instances are called dummies. They are test doubles that have no
functionality and that we don&rsquo;t want people to use.</p><h2 id=stubs>Stubs<a hidden class=anchor aria-hidden=true href=#stubs>#</a></h2><p>Using the same example from above, how would we test that the <code>Find</code> method
when supplied the <code>firstName</code> and <code>lastName</code> arguments will work as expected?</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#268bd2>type</span> StubSearcher <span style=color:#268bd2>struct</span> {
	phone <span style=color:#dc322f>string</span>
}

<span style=color:#268bd2>func</span> (ss StubSearcher) <span style=color:#268bd2>Search</span>(people []<span style=color:#719e07>*</span>Person, firstName, lastName <span style=color:#dc322f>string</span>) <span style=color:#719e07>*</span>Person {
	<span style=color:#719e07>return</span> <span style=color:#719e07>&amp;</span>Person{
		FirstName: firstName,
		LastName:  lastName,
		Phone:     ss.phone,
	}
}

<span style=color:#268bd2>func</span> <span style=color:#268bd2>TestFindReturnsPerson</span>(t <span style=color:#719e07>*</span>testing.T) {
	fakePhone <span style=color:#719e07>:=</span> <span style=color:#2aa198>&#34;+31 65 222 333&#34;</span>
	phonebook <span style=color:#719e07>:=</span> <span style=color:#719e07>&amp;</span>Phonebook{}

	phone, _ <span style=color:#719e07>:=</span> phonebook.<span style=color:#268bd2>Find</span>(StubSearcher{fakePhone}, <span style=color:#2aa198>&#34;Jane&#34;</span>, <span style=color:#2aa198>&#34;Doe&#34;</span>)

	<span style=color:#719e07>if</span> phone <span style=color:#719e07>!=</span> fakePhone {
		t.<span style=color:#268bd2>Errorf</span>(<span style=color:#2aa198>&#34;Want &#39;%s&#39;, got &#39;%s&#39;&#34;</span>, fakePhone, phone)
	}
}</code></pre></div><p>When we want to make the <code>Searcher</code> implementation return an actual value that
we can assert against, we need a stub. Instead of understanding what it would
take to set up and/or implement a proper <code>Searcher</code>, you just create a stub
implementation that returns only one value. This is the idea behind stubs.</p><h2 id=spies>Spies<a hidden class=anchor aria-hidden=true href=#spies>#</a></h2><p>Again, using the <code>Phonebook</code> and <code>Searcher</code> example from above, let&rsquo;s imagine
we would like to write a test where we want to be sure we invoke the
<code>Searcher.Search</code> function. How can we do that?</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#268bd2>type</span> SpySearcher <span style=color:#268bd2>struct</span> {
	phone           <span style=color:#dc322f>string</span>
	searchWasCalled <span style=color:#dc322f>bool</span>
}

<span style=color:#268bd2>func</span> (ss <span style=color:#719e07>*</span>SpySearcher) <span style=color:#268bd2>Search</span>(people []<span style=color:#719e07>*</span>Person, firstName, lastName <span style=color:#dc322f>string</span>) <span style=color:#719e07>*</span>Person {
	ss.searchWasCalled = <span style=color:#cb4b16>true</span>
	<span style=color:#719e07>return</span> <span style=color:#719e07>&amp;</span>Person{
		FirstName: firstName,
		LastName:  lastName,
		Phone:     ss.phone,
	}
}

<span style=color:#268bd2>func</span> <span style=color:#268bd2>TestFindCallsSearchAndReturnsPerson</span>(t <span style=color:#719e07>*</span>testing.T) {
	fakePhone <span style=color:#719e07>:=</span> <span style=color:#2aa198>&#34;+31 65 222 333&#34;</span>
	phonebook <span style=color:#719e07>:=</span> <span style=color:#719e07>&amp;</span>Phonebook{}
	spy <span style=color:#719e07>:=</span> <span style=color:#719e07>&amp;</span>SpySearcher{phone: fakePhone}

	phone, _ <span style=color:#719e07>:=</span> phonebook.<span style=color:#268bd2>Find</span>(spy, <span style=color:#2aa198>&#34;Jane&#34;</span>, <span style=color:#2aa198>&#34;Doe&#34;</span>)

	<span style=color:#719e07>if</span> !spy.searchWasCalled {
		t.<span style=color:#268bd2>Errorf</span>(<span style=color:#2aa198>&#34;Expected to call &#39;Search&#39; in &#39;Find&#39;, but it wasn&#39;t.&#34;</span>)
	}

	<span style=color:#719e07>if</span> phone <span style=color:#719e07>!=</span> fakePhone {
		t.<span style=color:#268bd2>Errorf</span>(<span style=color:#2aa198>&#34;Want &#39;%s&#39;, got &#39;%s&#39;&#34;</span>, fakePhone, phone)
	}
}</code></pre></div><p>You can think of spies as an upgrade of stubs. While they return a predefined
value, just like stubs, spies also remember whether we called a specific
method. Often, spies also keep track of how many times we call a particular
function.</p><p>That&rsquo;s what spy is - a stub that keeps track of invocations of its methods.</p><h2 id=mocks>Mocks<a hidden class=anchor aria-hidden=true href=#mocks>#</a></h2><p>In the beginning, people started using mock for similar (but not the same)
things, and the word got left hanging in the air without a proper definition.
Some think of stubs as mocks; others do not even think of mocks as types of
instances.</p><p>It&rsquo;s generally accepted to use “mocking” when thinking about creating objects
that simulate the behavior of real objects or units.</p><p>But mocks are a thing of their own. They have the same characteristics as the
stubs & spies, with a bit more.</p><p>Also, in Go, they are a bit tricky to implement, especially in a generic way.
Still, for this example, we will do a home-made implementation:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#268bd2>type</span> MockSearcher <span style=color:#268bd2>struct</span> {
	phone         <span style=color:#dc322f>string</span>
	methodsToCall <span style=color:#268bd2>map</span>[<span style=color:#dc322f>string</span>]<span style=color:#dc322f>bool</span>
}

<span style=color:#268bd2>func</span> (ms <span style=color:#719e07>*</span>MockSearcher) <span style=color:#268bd2>Search</span>(people []<span style=color:#719e07>*</span>Person, firstName, lastName <span style=color:#dc322f>string</span>) <span style=color:#719e07>*</span>Person {
	ms.methodsToCall[<span style=color:#2aa198>&#34;Search&#34;</span>] = <span style=color:#cb4b16>true</span>
	<span style=color:#719e07>return</span> <span style=color:#719e07>&amp;</span>Person{
		FirstName: firstName,
		LastName:  lastName,
		Phone:     ms.phone,
	}
}

<span style=color:#268bd2>func</span> (ms <span style=color:#719e07>*</span>MockSearcher) <span style=color:#268bd2>ExpectToCall</span>(methodName <span style=color:#dc322f>string</span>) {
	<span style=color:#719e07>if</span> ms.methodsToCall <span style=color:#719e07>==</span> <span style=color:#cb4b16>nil</span> {
		ms.methodsToCall = <span style=color:#b58900>make</span>(<span style=color:#268bd2>map</span>[<span style=color:#dc322f>string</span>]<span style=color:#dc322f>bool</span>)
	}
	ms.methodsToCall[methodName] = <span style=color:#cb4b16>false</span>
}

<span style=color:#268bd2>func</span> (ms <span style=color:#719e07>*</span>MockSearcher) <span style=color:#268bd2>Verify</span>(t <span style=color:#719e07>*</span>testing.T) {
	<span style=color:#719e07>for</span> methodName, called <span style=color:#719e07>:=</span> <span style=color:#719e07>range</span> ms.methodsToCall {
		<span style=color:#719e07>if</span> !called {
			t.<span style=color:#268bd2>Errorf</span>(<span style=color:#2aa198>&#34;Expected to call &#39;%s&#39;, but it wasn&#39;t.&#34;</span>, methodName)
		}
	}
}

<span style=color:#268bd2>func</span> <span style=color:#268bd2>TestFindCallsSearchAndReturnsPersonUsingMock</span>(t <span style=color:#719e07>*</span>testing.T) {
	fakePhone <span style=color:#719e07>:=</span> <span style=color:#2aa198>&#34;+31 65 222 333&#34;</span>
	phonebook <span style=color:#719e07>:=</span> <span style=color:#719e07>&amp;</span>Phonebook{}
	mock <span style=color:#719e07>:=</span> <span style=color:#719e07>&amp;</span>MockSearcher{phone: fakePhone}
	mock.<span style=color:#268bd2>ExpectToCall</span>(<span style=color:#2aa198>&#34;Search&#34;</span>)

	phone, _ <span style=color:#719e07>:=</span> phonebook.<span style=color:#268bd2>Find</span>(mock, <span style=color:#2aa198>&#34;Jane&#34;</span>, <span style=color:#2aa198>&#34;Doe&#34;</span>)

	<span style=color:#719e07>if</span> phone <span style=color:#719e07>!=</span> fakePhone {
		t.<span style=color:#268bd2>Errorf</span>(<span style=color:#2aa198>&#34;Want &#39;%s&#39;, got &#39;%s&#39;&#34;</span>, fakePhone, phone)
	}

	mock.<span style=color:#268bd2>Verify</span>(t)
}</code></pre></div><p>This approach is more involved, but there&rsquo;s no magic to it. The <code>MockSearcher</code>
implementation has a <code>methodsToCall</code> map, which will store all of the methods
that we expect to call on an instance of this type.</p><p>The <code>ExpectToCall</code> method will take a method name as an argument. It will store
the method to the <code>methodsToCall</code> map (as the key) and a <code>false</code> as the value.
By setting it to <code>false</code>, we set a mark on that method that we expect to call
it (yet we still haven&rsquo;t called it).</p><p>In <code>MockSearcher</code>&rsquo;s <code>Search</code> method, we mark the <code>Search</code> method as called. We
do this by setting the <code>true</code> value for the <code>"Search"</code> key in the
<code>methodsToCall</code> map. In essence, the key we&rsquo;ve set to <code>false</code> in the
<code>ExpectToCall</code> method we set to <code>true</code> here.</p><p>Lastly, the <code>Verify</code> method will go over all of the methods that we marked as
to-be-called on the mock. If it finds one still set to <code>false</code>, it will mark
the test as failed.</p><p>Mocks work by setting certain expectations on them. We implement some stub-like
functionality while keeping track of the methods that have been called.
Finally, we ask the mock to verify if our code met all of its expectations.</p><p>It&rsquo;s worth stating that this is a home-made solution, and as such, it has some
caveats. If you would like to use mocks in your tests, there are some excellent
Golang libraries out there like <a href=https://github.com/golang/mock>golang/mock</a>
or <a href=https://github.com/stretchr/testify>stretchr/testify</a>.</p><h2 id=fakes>Fakes<a hidden class=anchor aria-hidden=true href=#fakes>#</a></h2><p>These test doubles, unlike stubs, spies, and mocks, truly have an
implementation. In our example, this would mean that a fake would have an
actual implementation of the <code>Search</code> method.</p><p>Let&rsquo;s see a <code>Searcher</code> fake in action:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#268bd2>type</span> FakeSearcher <span style=color:#268bd2>struct</span>{}

<span style=color:#268bd2>func</span> (fs FakeSearcher) <span style=color:#268bd2>Search</span>(people []<span style=color:#719e07>*</span>Person, firstName <span style=color:#dc322f>string</span>, lastName <span style=color:#dc322f>string</span>) <span style=color:#719e07>*</span>Person {
	<span style=color:#719e07>if</span> <span style=color:#b58900>len</span>(people) <span style=color:#719e07>==</span> <span style=color:#2aa198>0</span> {
		<span style=color:#719e07>return</span> <span style=color:#cb4b16>nil</span>
	}

	<span style=color:#719e07>return</span> people[<span style=color:#2aa198>0</span>]
}

<span style=color:#268bd2>func</span> <span style=color:#268bd2>TestFindCallsSearchAndReturnsEmptyStringForNoPerson</span>(t <span style=color:#719e07>*</span>testing.T) {
	phonebook <span style=color:#719e07>:=</span> <span style=color:#719e07>&amp;</span>Phonebook{}
	fake <span style=color:#719e07>:=</span> <span style=color:#719e07>&amp;</span>FakeSearcher{}

	phone, _ <span style=color:#719e07>:=</span> phonebook.<span style=color:#268bd2>Find</span>(fake, <span style=color:#2aa198>&#34;Jane&#34;</span>, <span style=color:#2aa198>&#34;Doe&#34;</span>)

	<span style=color:#719e07>if</span> phone <span style=color:#719e07>!=</span> <span style=color:#2aa198>&#34;&#34;</span> {
		t.<span style=color:#268bd2>Errorf</span>(<span style=color:#2aa198>&#34;Wanted &#39;&#39;, got &#39;%s&#39;&#34;</span>, phone)
	}
}</code></pre></div><p>What you see is a <code>FakeSearcher</code> type, who&rsquo;s <code>Search</code> method has an
implementation that (kinda) makes sense. If the slice of <code>*Person</code> is empty, it
will return <code>nil</code>. Otherwise, it will return the first item in the slice.</p><p>While this <code>Search</code> method is not production-ready, because it doesn&rsquo;t make
much sense, it still has the behavior of a fake <code>Searcher</code>. If we didn&rsquo;t have
it&rsquo;s implementation accessible (looking at it as a black box), one could think
it&rsquo;s the real deal instead of a fake.</p><p>That&rsquo;s what fakes are - implementations that look like the real thing. But they
only do the trick in the scope of the test.</p><p>Another such familiar example in the community is an in-memory database driver
used as fake to a real database driver.</p><h2 id=when-to-use-what>When To Use What<a hidden class=anchor aria-hidden=true href=#when-to-use-what>#</a></h2><p>Now that we went through all of the test doubles and their implementations, the
last question that we need to answer is: what test double should we use in
which circumstances?</p><p>As with many other things in software development, the answer is: it depends.</p><p>You must keep in mind is <em>what are you really testing</em>. That is also known as
<em>the unit under test</em>. If the unit under test requires a double of any sort,
you should provide the simplest test double that will make your test do its
work and that it will suffice to make the test pass.</p><p>So, refrain from using bloated mocks if a stub does the trick. The rule of
thumb is: use the simplest test double that you can. And after the test passes,
see if you can refactor and simplify further.</p><p>And lastly, make sure not to downright mock out everything – sometimes invoking
the actual implementation (e.g., like in an integration test) can be a great
idea.</p><p>Additional reading:</p><ul><li><a href=https://blog.cleancoder.com/uncle-bob/2014/05/14/TheLittleMocker.html>&ldquo;The Little
Mocker&rdquo;</a>
by Uncle Bob</li><li><a href=https://martinfowler.com/bliki/TestDouble.html>&ldquo;TestDouble&rdquo;</a> by Martin
Fowler</li><li><a href=https://testing.googleblog.com/2013/07/testing-on-toilet-know-your-test-doubles.html>&ldquo;Testing on the Toilet: Know Your Test
Doubles&rdquo;</a>
by Andrew Trenk</li></ul><section class=subscribe><p><b>Liked this article?</b>
Subscribe to my newsletter and get future articles in your inbox. It's a
short and sweet read, going out to +1000 of other engineers.</p><script async data-uid=5495dc64a0 src=https://ilija.ck.page/5495dc64a0/index.js></script><p class=privacy>I care about your privacy, and will never send you spam. You can unsubscribe at any time.</p></section></div><footer class=post-footer><nav class=paginav><a class=prev href=https://ieftimov.com/post/make-resilient-golang-net-http-servers-using-timeouts-deadlines-context-cancellation/><span class=title>« Prev Page</span><br><span>Make resilient Go net/http servers using timeouts, deadlines and context cancellation</span></a>
<a class=next href=https://ieftimov.com/post/testing-in-go-dependency-injection/><span class=title>Next Page »</span><br><span>Testing in Go: Dependency Injection</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Testing in Go: Test Doubles by Example on twitter" href="https://twitter.com/intent/tweet/?text=Testing%20in%20Go%3a%20Test%20Doubles%20by%20Example&url=https%3a%2f%2fieftimov.com%2fpost%2ftesting-in-go-test-doubles-by-example%2f&hashtags="><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Testing in Go: Test Doubles by Example on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fieftimov.com%2fpost%2ftesting-in-go-test-doubles-by-example%2f&title=Testing%20in%20Go%3a%20Test%20Doubles%20by%20Example&summary=Testing%20in%20Go%3a%20Test%20Doubles%20by%20Example&source=https%3a%2f%2fieftimov.com%2fpost%2ftesting-in-go-test-doubles-by-example%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Testing in Go: Test Doubles by Example on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fieftimov.com%2fpost%2ftesting-in-go-test-doubles-by-example%2f&title=Testing%20in%20Go%3a%20Test%20Doubles%20by%20Example"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Testing in Go: Test Doubles by Example on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fieftimov.com%2fpost%2ftesting-in-go-test-doubles-by-example%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Testing in Go: Test Doubles by Example on whatsapp" href="https://api.whatsapp.com/send?text=Testing%20in%20Go%3a%20Test%20Doubles%20by%20Example%20-%20https%3a%2f%2fieftimov.com%2fpost%2ftesting-in-go-test-doubles-by-example%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Testing in Go: Test Doubles by Example on telegram" href="https://telegram.me/share/url?text=Testing%20in%20Go%3a%20Test%20Doubles%20by%20Example&url=https%3a%2f%2fieftimov.com%2fpost%2ftesting-in-go-test-doubles-by-example%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>Copyright 2021 © Ilija Eftimov</span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>let menu=document.getElementById('menu');menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script></body></html>