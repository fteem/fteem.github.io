<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Refactoring in Ruby: Smelly Parameters Lists - Ilija Eftimov</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta property="og:title" content="Refactoring in Ruby: Smelly Parameters Lists" />
<meta property="og:description" content="Ruby is a really clear and expressive language, but we developers sure know how to make a mess. Even when you think your classes are nicely written and tested, things can still get out of hand. I am pretty sure you&#39;ve heard one (or more) of your more experienced colleagues/mentors tell you that &ldquo;something is smelly&rdquo; in the code. Well, in this article we will cover one of the simplest code smells" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ieftimov.com/post/refactoring-smelly-parameters-lists/" />
<meta property="article:published_time" content="2016-01-04T00:00:00+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Refactoring in Ruby: Smelly Parameters Lists"/>
<meta name="twitter:description" content="Ruby is a really clear and expressive language, but we developers sure know how to make a mess. Even when you think your classes are nicely written and tested, things can still get out of hand. I am pretty sure you&#39;ve heard one (or more) of your more experienced colleagues/mentors tell you that &ldquo;something is smelly&rdquo; in the code. Well, in this article we will cover one of the simplest code smells"/>
<link href='https://fonts.googleapis.com/css?family=Playfair+Display:700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" media="screen" href="https://ieftimov.com/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://ieftimov.com/css/main.css" />
		<link rel="stylesheet" type="text/css" href="https://ieftimov.com/css/overrides.css" />
	

	<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
		<script src="https://ieftimov.com/js/main.js"></script><script src="https://ieftimov.com/js/tooltip.js"></script>
</head>

<body>
	<div class="container wrapper">
		<div class="header">
	
		<div class="avatar">
			<a href="https://ieftimov.com/">
				<img src="https://pbs.twimg.com/profile_images/1194757753585225728/JbET17PZ_400x400.jpg" alt="Ilija Eftimov" />
			</a>
		</div>
	
	<h1 class="site-title"><a href="https://ieftimov.com/">Ilija Eftimov</a></h1>
	<div class="site-description"><p>Software engineer, author and open source contributor</p><nav class="nav social">
			<ul class="flat"><li><a href="https://github.com/fteem" title="Github"><i data-feather="github"></i></a></li><li><a href="https://twitter.com/fteem" title="Twitter"><i data-feather="twitter"></i></a></li><li><a href="https://www.linkedin.com/in/ieftimov" title="Linkedin"><i data-feather="linkedin"></i></a></li><li><a href="mailto:blog@ieftimov.com" title="Email"><i data-feather="mail"></i></a></li></ul>
		</nav>
	</div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="/">Home</a>
			</li>
			
			<li>
				<a href="/categories/testing-in-go">Testing in Go</a>
			</li>
			
			<li>
				<a href="/posts">Archive</a>
			</li>
			
			<li>
				<a href="/about">About</a>
			</li>
			
			<li>
				<a href="https://forms.gle/orfXK5jh1LRaiFzo8">Suggest a topic</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post">
			<div class="post-header">
				
					<div class="meta">
						<div class="date">
							<span class="day">04</span>
							<span class="rest">Jan 2016</span>
						</div>
					</div>
				
				<div class="matter">
					<h1 class="title">Refactoring in Ruby: Smelly Parameters Lists</h1>
				</div>
			</div>
					
			<div class="markdown">
				<p>Ruby is a really clear and expressive language, but we developers sure know how
to make a mess. Even when you think your classes are nicely written and tested,
things can still get out of hand. I am pretty sure you've heard one (or more)
of your more experienced colleagues/mentors tell you that &ldquo;something is smelly&rdquo;
in the code. Well, in this article we will cover one of the simplest code
smells</p>
<ul>
<li>long parameters lists in your method signatures.</li>
</ul>
<h2 id="code-smells">Code Smells</h2>
<p>First, what are code smells? According to the <a href="https://en.wikipedia.org/wiki/Code_smell">Wikipedia
article</a> on Code smell:</p>
<blockquote>
<p>Code smell, also known as bad smell, in computer programming code, refers to
any symptom in the source code of a program that possibly indicates a deeper
problem.</p>
</blockquote>
<p>Another very imporant point is this:</p>
<blockquote>
<p>Code smells are usually not bugsâ€”they are not technically incorrect and do
not currently prevent the program from functioning. Instead, they indicate
weaknesses in design that may be slowing down development or increasing the
risk of bugs or failures in the future. Bad code smells are an important
reason for technical debt.</p>
</blockquote>
<p>These couple of sentences explain what code smells are very nicely. If you
would like to know more, I encourage you to head over to the Wikipedia article.</p>
<p>Now, back to our code smell - long parameters list.</p>
<h2 id="long-parameters-lists">Long Parameters Lists</h2>
<p>This code smell is quite easy to detect - just look for methods with 3, 4 or
more parameters. Now, while to some of you this might be okay, let's see why
this is an actual code smell.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Person</span>
  <span style="font-weight:bold">def</span> <span style="color:#458;font-weight:bold"></span><span style="font-weight:bold"></span><span style="color:#900;font-weight:bold">initialize</span>(first_name, last_name, age, sex, height, weight)
    @first_name <span style="font-weight:bold">=</span> first_name
    @last_name <span style="font-weight:bold">=</span> last_name
    @age       <span style="font-weight:bold">=</span> age
    @sex       <span style="font-weight:bold">=</span> sex
    @height    <span style="font-weight:bold">=</span> height
    @weight    <span style="font-weight:bold">=</span> weight
  <span style="font-weight:bold">end</span>
<span style="font-weight:bold">end</span></code></pre></div>
<p>Just creating a new object of the <code>Person</code> class can lead to bugs. For example,
it's really easy to mix up the height and weight, also the first and last name.
Then, just reading the signature of the initializer is super hard. And even if
this long of an initializer signature can be acceptable to you, imagine doing
this for any other method that you do not invoke that often.</p>
<p>Take this for example:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Invitation</span>
  <span style="font-weight:bold">def</span> <span style="color:#458;font-weight:bold">self</span><span style="font-weight:bold">.</span><span style="color:#900;font-weight:bold">deliver!</span>(first_name, last_name, email, date, time, venue, dress_code)
    <span style="color:#008080">Invitation</span><span style="font-weight:bold">.</span>create(<span style="color:#b84">to</span>: <span style="color:#b84">&#34;</span><span style="color:#b84">#{</span>first_name<span style="color:#b84">}</span><span style="color:#b84"> </span><span style="color:#b84">#{</span>last_name<span style="color:#b84">}</span><span style="color:#b84">&#34;</span>, <span style="color:#b84">email</span>: email)
    <span style="color:#008080">UserMailer</span><span style="font-weight:bold">.</span>invitation(first_name, last_name, date, time, venue, dress_code)
  <span style="font-weight:bold">end</span>
<span style="font-weight:bold">end</span></code></pre></div>
<p>I hope that this paints the picture well that long paratemeters lists can lead
to bugs and confusion. So, how do we refactor them?</p>
<h2 id="replace-parameter-with-method-call">Replace Parameter with Method Call</h2>
<p>One refactoring pattern that could help us here is the Replace Parameter with
Method Call pattern. Let's take this as an example:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Discount</span>
  <span style="font-weight:bold">def</span> <span style="color:#458;font-weight:bold"></span><span style="font-weight:bold"></span><span style="color:#900;font-weight:bold">initialize</span>(store, price, quantity)
    @store <span style="font-weight:bold">=</span> store
    @price <span style="font-weight:bold">=</span> price
    @quantity <span style="font-weight:bold">=</span> quantity
  <span style="font-weight:bold">end</span>

  <span style="font-weight:bold">def</span> <span style="color:#458;font-weight:bold"></span><span style="font-weight:bold"></span><span style="color:#900;font-weight:bold">effective_cost</span>
    base_price <span style="font-weight:bold">=</span> @quantity <span style="font-weight:bold">*</span> @price
    discount <span style="font-weight:bold">=</span> @store<span style="font-weight:bold">.</span>seasonal_discount
    apply(base_price, discount)
  <span style="font-weight:bold">end</span>

  <span style="font-weight:bold">def</span> <span style="color:#458;font-weight:bold"></span><span style="font-weight:bold"></span><span style="color:#900;font-weight:bold">apply</span>(base_price, discount)
    base_price <span style="font-weight:bold">-</span> discount
  <span style="font-weight:bold">end</span>
<span style="font-weight:bold">end</span></code></pre></div>
<p>As you can see, we use the <code>Discount#effective_cost</code> method to calculate a
discounted price. Now, the problem lies where we need to pass in the discount
as parameter to the <code>Discount#apply</code> method. Instead of doing that, we can
reduce the parameters list of the <code>apply</code> method to one.</p>
<p>This can be achieved by substituting the parameter with a method call and
pushing the logic of retrieving the discount down to the <code>apply</code> method:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Discount</span>
  <span style="font-weight:bold">def</span> <span style="color:#458;font-weight:bold"></span><span style="font-weight:bold"></span><span style="color:#900;font-weight:bold">initialize</span>(store, price, quantity)
    @store <span style="font-weight:bold">=</span> store
    @price <span style="font-weight:bold">=</span> price
    @quantity <span style="font-weight:bold">=</span> quantity
  <span style="font-weight:bold">end</span>

  <span style="font-weight:bold">def</span> <span style="color:#458;font-weight:bold"></span><span style="font-weight:bold"></span><span style="color:#900;font-weight:bold">effective_cost</span>
    base_price <span style="font-weight:bold">=</span> @quantity <span style="font-weight:bold">*</span> @price
    calculate_effective_cost(base_price)
  <span style="font-weight:bold">end</span>

  <span style="font-weight:bold">def</span> <span style="color:#458;font-weight:bold"></span><span style="font-weight:bold"></span><span style="color:#900;font-weight:bold">apply</span>(base_price)
    discount <span style="font-weight:bold">=</span> @store<span style="font-weight:bold">.</span>seasonal_discount
    base_price <span style="font-weight:bold">-</span> discount
  <span style="font-weight:bold">end</span>
<span style="font-weight:bold">end</span></code></pre></div>
<p>As you can see, by refactoring the parameter into to a method call, we reduced
the number of parameters and made the method signatures much cleaner.</p>
<h2 id="preserving-a-whole-object">Preserving a Whole Object</h2>
<p>Now, using the same example, let's take a look at another refactoring pattern -
the Preserve Whole Object pattern. The example that we will use is the
refactored version of the code from the last section:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Discount</span>
  <span style="font-weight:bold">def</span> <span style="color:#458;font-weight:bold"></span><span style="font-weight:bold"></span><span style="color:#900;font-weight:bold">initialize</span>(store, price, quantity)
    @store <span style="font-weight:bold">=</span> store
    @price <span style="font-weight:bold">=</span> price
    @quantity <span style="font-weight:bold">=</span> quantity
  <span style="font-weight:bold">end</span>

  <span style="font-weight:bold">def</span> <span style="color:#458;font-weight:bold"></span><span style="font-weight:bold"></span><span style="color:#900;font-weight:bold">effective_cost</span>
    base_price <span style="font-weight:bold">=</span> @quantity <span style="font-weight:bold">*</span> @price
    calculate_effective_cost(base_price)
  <span style="font-weight:bold">end</span>

  <span style="font-weight:bold">def</span> <span style="color:#458;font-weight:bold"></span><span style="font-weight:bold"></span><span style="color:#900;font-weight:bold">apply</span>(base_price)
    discount <span style="font-weight:bold">=</span> @store<span style="font-weight:bold">.</span>seasonal_discount
    base_price <span style="font-weight:bold">-</span> discount
  <span style="font-weight:bold">end</span>
<span style="font-weight:bold">end</span></code></pre></div>
<p>Preserve Whole Object states that instead of passing raw data as parameters,
one can send the same data encapsulated in an object. Let's see how this
pattern can improve our code:</p>
<p>First, instead of passing in the price and the quantity as separate data, we
can introduce a new object to our program - a <code>Order</code>. The <code>Order</code> will hold
the price of the product and the quantity that was ordered.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Order</span>
  <span style="font-weight:bold">attr_reader</span> <span style="color:#b84">:price</span>, <span style="color:#b84">:quantity</span>
  <span style="font-weight:bold">def</span> <span style="color:#458;font-weight:bold"></span><span style="font-weight:bold"></span><span style="color:#900;font-weight:bold">initialize</span>(product, quantity)
    @price    <span style="font-weight:bold">=</span> product<span style="font-weight:bold">.</span>price
    @quantity <span style="font-weight:bold">=</span> quantity
  <span style="font-weight:bold">end</span>
<span style="font-weight:bold">end</span></code></pre></div>
<p>Then, in the initializer of our <code>Discount</code> class, instead of passing in the raw
data we will pass an <code>Order</code> object as a parameter:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Discount</span>
  <span style="font-weight:bold">def</span> <span style="color:#458;font-weight:bold"></span><span style="font-weight:bold"></span><span style="color:#900;font-weight:bold">initialize</span>(store, order)
    @store <span style="font-weight:bold">=</span> store
    @order <span style="font-weight:bold">=</span> order
  <span style="font-weight:bold">end</span>

  <span style="font-weight:bold">def</span> <span style="color:#458;font-weight:bold"></span><span style="font-weight:bold"></span><span style="color:#900;font-weight:bold">effective_cost</span>
    base_price <span style="font-weight:bold">=</span> @order<span style="font-weight:bold">.</span>quantity <span style="font-weight:bold">*</span> @order<span style="font-weight:bold">.</span>price
    calculate_effective_cost(base_price)
  <span style="font-weight:bold">end</span>

  <span style="font-weight:bold">def</span> <span style="color:#458;font-weight:bold"></span><span style="font-weight:bold"></span><span style="color:#900;font-weight:bold">calculate_effective_cost</span>(base_price)
    discount <span style="font-weight:bold">=</span> @store<span style="font-weight:bold">.</span>seasonal_discount
    base_price <span style="font-weight:bold">-</span> discount
  <span style="font-weight:bold">end</span>
<span style="font-weight:bold">end</span></code></pre></div>
<p>As you can see, by taking this step, the list of parameters in the initializer
of the <code>Discount</code> class fell down from three to two.</p>
<h2 id="introduce-parameter-object-pattern">Introduce Parameter Object pattern</h2>
<p>Another way of getting rid of long parameters lists is the Introduce Parameter
Object pattern. The pattern basically states that when a certain list of
parameters has a <strong>solid logical link</strong> between them, it is a good practice to
wrap them in a data structure/object. This will make the code more testable and
will improve it's readibility.</p>
<p>Personally, I would enforce using this pattern if the parameters are being
repeated in multiple places/classes/methods.</p>
<p>For this section, we will change the example. We will use a <code>Invoice</code> class
which has an issue date and a due date:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Invoice</span>
  <span style="font-weight:bold">def</span> <span style="color:#458;font-weight:bold">self</span><span style="font-weight:bold">.</span><span style="color:#900;font-weight:bold">deliver</span>(issue_date, due_date)
    <span style="color:#998;font-style:italic"># Deliver the invoice here somehow...</span>
  <span style="font-weight:bold">end</span>

  <span style="font-weight:bold">def</span> <span style="color:#458;font-weight:bold">self</span><span style="font-weight:bold">.</span><span style="color:#900;font-weight:bold">store</span>(issue_date, due_date)
    <span style="color:#998;font-style:italic"># Store the invoice here somehow...</span>
  <span style="font-weight:bold">end</span>
<span style="font-weight:bold">end</span></code></pre></div>
<p>Now, since we have a logical link between the parameters here (and duplication
in the same time), we can extract the <code>issue_date</code> and <code>due_date</code> into a
<code>DateRange</code> object:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="font-weight:bold">class</span> <span style="color:#458;font-weight:bold">DateRange</span>
  <span style="font-weight:bold">def</span> <span style="color:#458;font-weight:bold"></span><span style="font-weight:bold"></span><span style="color:#900;font-weight:bold">initialize</span>(start_date, end_date)
    @start_date <span style="font-weight:bold">=</span> start_date
    @end_date   <span style="font-weight:bold">=</span> end_date
  <span style="font-weight:bold">end</span>

  <span style="font-weight:bold">def</span> <span style="color:#458;font-weight:bold"></span><span style="font-weight:bold"></span><span style="color:#900;font-weight:bold">started?</span>
    <span style="color:#008080">Date</span><span style="font-weight:bold">.</span>today <span style="font-weight:bold">&gt;</span> @start_date
  <span style="font-weight:bold">end</span>

  <span style="font-weight:bold">def</span> <span style="color:#458;font-weight:bold"></span><span style="font-weight:bold"></span><span style="color:#900;font-weight:bold">ended?</span>
    <span style="color:#008080">Date</span><span style="font-weight:bold">.</span>today <span style="font-weight:bold">&gt;</span> @end_date
  <span style="font-weight:bold">end</span>
<span style="font-weight:bold">end</span></code></pre></div>
<p>As you can see, we have made the <code>DateRange</code> class as a general purpose class
for any other date ranges. Now, instead of passing the dates separately as
parameters, we can pass in a DateRange object in the <code>Invoice</code> class:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Invoice</span>
  <span style="font-weight:bold">def</span> <span style="color:#458;font-weight:bold">self</span><span style="font-weight:bold">.</span><span style="color:#900;font-weight:bold">deliver</span>(date_range)
    <span style="font-weight:bold">if</span> date_range<span style="font-weight:bold">.</span>ended?
      <span style="color:#998;font-style:italic"># Deliver with a warning notice</span>
    <span style="font-weight:bold">else</span>
      <span style="color:#998;font-style:italic"># Just deliver the invoice</span>
    <span style="font-weight:bold">end</span>
  <span style="font-weight:bold">end</span>

  <span style="font-weight:bold">def</span> <span style="color:#458;font-weight:bold">self</span><span style="font-weight:bold">.</span><span style="color:#900;font-weight:bold">store</span>(date_range)
    <span style="font-weight:bold">if</span> date_range<span style="font-weight:bold">.</span>started?
      <span style="color:#998;font-style:italic"># Store the invoice here somehow...</span>
    <span style="font-weight:bold">end</span>
  <span style="font-weight:bold">end</span>
<span style="font-weight:bold">end</span></code></pre></div>
<p>As you can see, this allows us to easily modify the behaviour of the methods in
the <code>Invoice</code> class, adding points to readibility and testability of the
methods. Also, the <code>DateRange</code> class is dead-easy to test at this point.</p>
<h2 id="taking-a-step-back">Taking a step back</h2>
<p>The three patterns we covered in this article are a nice way to remove the code
smell around long parameters lists. I guess that some of them are just an
intuitive way to remove the code smell to some. If that is so - great, you do
not have to see them as patterns. If not - not a big deal, always look for
logical links in the parameters and try to encapsulate the data in some way.
With a bit of practice, you can easily apply these patterns on your own.</p>
<p>Hope you enjoyed this refactoring article. If you would like to learn more
about refactoring, check out <a href="/tdd-extract-class">the article</a> on the Extract
Class refactoring pattern.</p>

			</div>

			<div class="tags">
				
					
						<ul class="flat">
							
							<li><a href="/tags/smelly">smelly</a></li>
							
							<li><a href="/tags/parameters">parameters</a></li>
							
							<li><a href="/tags/lists">lists</a></li>
							
						</ul>
					
				
			</div><div id="disqus_thread"></div>
<script type="text/javascript">
	(function () {
		
		
		if (window.location.hostname == "localhost")
			return;

		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		var disqus_shortname = 'eftimov';
		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
</script>
<noscript>Please enable JavaScript to view the </a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
	</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div> Copyright Â© 2014 - 2019 Ilija Eftimov |  <a href="https://github.com/knadh/hugo-ink">Ink</a> theme on <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-11264459-2', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<script>feather.replace()</script>
</body>
</html>
