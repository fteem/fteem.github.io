<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Testing in Go: go test - Ilija Eftimov</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta property="og:title" content="Testing in Go: go test" />
<meta property="og:description" content="As I was going down the stairs I remember feeling the temperature dropping. It was an astounding experience descending towards the basement in my grandparents&rsquo; house – it felt cooler and quieter. The light was warm and dimmed, with creepy shadows dropping behind the old furniture that was serving its last years before getting disposed to the city cleaning service.
Image taken from Undraw.  One of the rooms in the basement was my grandfather’s workshop." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ieftimov.com/post/testing-in-go-go-test/" />
<meta property="og:image" content="https://ieftimov.com/cards/testing-in-go-go-test.png" />
<meta property="article:published_time" content="2019-07-01T00:00:00+00:00" />
<meta property="article:modified_time" content="2019-07-01T00:00:00+00:00" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://ieftimov.com/cards/testing-in-go-go-test.png"/>

<meta name="twitter:title" content="Testing in Go: go test"/>
<meta name="twitter:description" content="As I was going down the stairs I remember feeling the temperature dropping. It was an astounding experience descending towards the basement in my grandparents&rsquo; house – it felt cooler and quieter. The light was warm and dimmed, with creepy shadows dropping behind the old furniture that was serving its last years before getting disposed to the city cleaning service.
Image taken from Undraw.  One of the rooms in the basement was my grandfather’s workshop."/>
<link href='https://fonts.googleapis.com/css?family=Playfair+Display:700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" media="screen" href="https://ieftimov.com/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://ieftimov.com/css/main.css" />
		<link rel="stylesheet" type="text/css" href="https://ieftimov.com/css/overrides.css" />
	

	<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
		<script src="https://ieftimov.com/js/main.js"></script><script src="https://ieftimov.com/js/tooltip.js"></script>
</head>

<body>
	<div class="container wrapper">
		<div class="header">
	
		<div class="avatar">
			<a href="https://ieftimov.com/">
				<img src="avatar.png" alt="Ilija Eftimov" />
			</a>
		</div>
	
	<h1 class="site-title"><a href="https://ieftimov.com/">Ilija Eftimov</a></h1>
	<div class="site-description"><p>A human, interested in building products and software.</p><nav class="nav social">
			<ul class="flat"><li><a href="https://github.com/fteem" title="Github"><i data-feather="github"></i></a></li><li><a href="https://twitter.com/fteem" title="Twitter"><i data-feather="twitter"></i></a></li><li><a href="https://www.linkedin.com/in/ieftimov" title="Linkedin"><i data-feather="linkedin"></i></a></li><li><a href="mailto:blog@ieftimov.com" title="Email"><i data-feather="mail"></i></a></li></ul>
		</nav>
	</div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="/categories/testing-in-go">Testing in Go</a>
			</li>
			
			<li>
				<a href="/posts">Archive</a>
			</li>
			
			<li>
				<a href="/about">About</a>
			</li>
			
			<li>
				<a href="https://forms.gle/orfXK5jh1LRaiFzo8">Suggest a topic</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post">
			<div class="post-header">
				
					<div class="meta">
						<div class="date">
							<span class="day">01</span>
							<span class="rest">Jul 2019</span>
						</div>
					</div>
				
				<div class="matter">
					<h1 class="title">Testing in Go: go test</h1>
				</div>
			</div>
					
			<div class="markdown">
				<p>As I was going down the stairs I remember feeling the temperature dropping. It
was an astounding experience descending towards the basement in my
grandparents&rsquo; house – it felt cooler and quieter. The light was warm and
dimmed, with creepy shadows dropping behind the old furniture that was serving
its last years before getting disposed to the city cleaning service.</p>












<figure class="imagecaption">
  <img class="caption" src="/testing-in-go-go-test/moving_forward.png" title="Image taken from Undraw." alt="Person pushing a big box with an right-pointing arrow">
  <span class="caption-text">Image taken from <a href="https://undraw.co/">Undraw</a>.</span>
</figure>

<p>One of the rooms in the basement was my grandfather’s workshop. There were many
tools that he collected over the years. Some were hanging on the wall, making
it quite hard for me to reach them. The ones on the working desk were easy to
reach, yet very hard to carry. At least for 5-year-olds.</p>
<p>It was one of the first times I remember trying to handle any tooling.
Watching my grandfather working with tools was always great because I could see
something get created in front of my eyes. I remember him making me a pair of
nunchucks (not a good idea!) A mundane task for him, but I was watching a
magician conjure a pair of home-made nunchucks out of some wood and a very
light chain.  Very cool!</p>
<p>Years later I realised that knowing how to use my tools to create things out of
thin air is one of my great joys. Programmers are also builders, so we have to
know our tools well. We are not making physical masterpieces (nunchuks
anyone?), but we sure have to learn our tools to build good software.</p>
<p>That's why in this article we will look at one important tool from our Go
toolbox - the <code>go test</code> command.</p>
<h2 id="what-is-go-test-anyway">What is <code>go test</code> anyway?</h2>
<p>If you're going to remember anything, remember this: <code>go test</code> is a command
which automates the execution of test files and functions in a Go project. The
<code>go test</code> command ships with Go itself, so if you have Go installed there's
nothing to check - it's available on your machine.</p>
<p><code>go test</code> will recompile each package along with any files with names matching
the file pattern <code>*_test.go</code>. These <code>*_test.go</code> files can contain test
functions, benchmark functions, and example functions. Each listed package will
cause the execution of a separate test binary.</p>
<p><code>go test</code> compiles test files, that declare a package, ending with the suffix
<code>*_test.go</code> as a separate package. It then links them with the main test binary
and runs them.</p>
<p>While <code>go test</code> seems simple on the surface, it actually has many options and
commands. It allows for control of what test to be run, as in file-specific or
package-specific tests, has flags for skipping tests, reporting test coverage
and other options. Also, it has smart caching mechanisms under the hood, to
avoids rebuilding packages every time we run our tests.</p>
<p><code>go test</code> is a compact yet a rich tool that every Gopher should have a solid
command of. We will not look at all its features, but at the end of this
article, we will have a good understanding of the workings of the tool.</p>












<figure class="imagecaption">
  <img class="caption" src="/testing-in-go-go-test/jogging.png" title="Image taken from Undraw." alt="Person running">
  <span class="caption-text">Image taken from <a href="https://undraw.co/">Undraw</a>.</span>
</figure>

<h2 id="running-modes">Running modes</h2>
<p><code>go test</code> has two running modes. Understanding them is essential to having an
easy time working with the tool:</p>
<ol>
<li>Local directory mode, or running without arguments</li>
<li>Package list mode, or running with arguments</li>
</ol>
<p>In the <strong>local directory mode</strong>, <code>go test</code> compiles the package sources and
tests found in the current directory and then runs the resulting test binary.
This mode disables caching. After the package test finishes, <code>go test</code> prints a
summary line showing the test status (&lsquo;ok&rsquo; or &lsquo;FAIL&rsquo;), the package name, and
elapsed time.</p>
<p>To run your tests in this mode, run <code>go test</code> in your project's root directory.</p>
<p>In the <strong>package list mode</strong>, <code>go test</code> compiles and tests each of the packages
listed as arguments to the command. If a package test passes, <code>go test</code> prints
only the final &lsquo;ok&rsquo; summary line. If a package test fails, go test prints the
full test output.</p>
<p>To run your test in this mode, run <code>go test</code> with explicit package arguments.
For example, we can run <code>go test PACKAGE_NAME</code> to test a specific package or
<code>go test ./...</code> to test all packages in a directory tree or <code>go test .</code> to run
all tests in the current directory.</p>
<p>In our daily work with <code>go test</code>, the difference between the two modes is
caching.</p>
<p>When we run <code>go test</code> in package list mode it will cache successful package
test results to avoid unnecessary reruns. When it can find the result of a test
in the cache, <code>go test</code> will redisplay the cached result instead of running the
tests again. When this happens, <code>go test</code> will annotate the test results with
<code>(cached)</code> in place of the elapsed time in the summary line.</p>
<h2 id="test-run-control">Test run control</h2>
<p>One of the major features of the <code>go test</code> command is the ability to control
what tests files and test functions we can run. As we discussed before, <code>go test</code> has two modes to which we can supply package or file names. Additionally,
we can also selectively run one or more test functions.</p>
<p>To have an easier time further in this post, we will define a type <code>Person</code>.
It will have two functions: a constructor <code>NewPerson</code> and a function <code>older</code>,
which will take a <code>*Person</code> and return if one <code>*Person</code> is older than another
<code>*Person</code>.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="font-weight:bold">package</span> person

<span style="font-weight:bold">import</span> <span style="color:#b84">&#34;errors&#34;</span>

<span style="font-weight:bold">type</span> Person <span style="font-weight:bold">struct</span> {
	age <span style="color:#458;font-weight:bold">int</span>
}

<span style="font-weight:bold">func</span> <span style="color:#900;font-weight:bold">NewPerson</span>(age <span style="color:#458;font-weight:bold">int</span>) (<span style="font-weight:bold">*</span>Person, <span style="color:#458;font-weight:bold">error</span>) {
	<span style="font-weight:bold">if</span> age &lt; <span style="color:#099">1</span> {
		<span style="font-weight:bold">return</span> <span style="font-weight:bold">nil</span>, errors.<span style="color:#900;font-weight:bold">New</span>(<span style="color:#b84">&#34;A person is at least 1 years old&#34;</span>)
	}

	<span style="font-weight:bold">return</span> <span style="font-weight:bold">&amp;</span>Person{
		age: age,
	}, <span style="font-weight:bold">nil</span>
}

<span style="font-weight:bold">func</span> (p <span style="font-weight:bold">*</span>Person) <span style="color:#900;font-weight:bold">older</span>(other <span style="font-weight:bold">*</span>Person) <span style="color:#458;font-weight:bold">bool</span> {
	<span style="font-weight:bold">return</span> p.age &gt; other.age
}</code></pre></div>
<p>Let's add tests for the constructor and the <code>older</code> function. We want to test
that the constructor will return an error when a negative integer is passed as
the <code>age</code> argument:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="font-weight:bold">package</span> person

<span style="font-weight:bold">import</span> (
	<span style="color:#b84">&#34;testing&#34;</span>
)

<span style="font-weight:bold">func</span> <span style="color:#900;font-weight:bold">TestNewPersonPositiveAge</span>(t <span style="font-weight:bold">*</span>testing.T) {
	_, err <span style="font-weight:bold">:=</span> <span style="color:#900;font-weight:bold">NewPerson</span>(<span style="color:#099">1</span>)
	<span style="font-weight:bold">if</span> err <span style="font-weight:bold">!=</span> <span style="font-weight:bold">nil</span> {
		t.<span style="color:#900;font-weight:bold">Errorf</span>(<span style="color:#b84">&#34;Expected person, received %v&#34;</span>, err)
	}
}

<span style="font-weight:bold">func</span> <span style="color:#900;font-weight:bold">TestNewPersonNegativeAge</span>(t <span style="font-weight:bold">*</span>testing.T) {
	p, err <span style="font-weight:bold">:=</span> <span style="color:#900;font-weight:bold">NewPerson</span>(<span style="font-weight:bold">-</span><span style="color:#099">1</span>)
	<span style="font-weight:bold">if</span> err <span style="font-weight:bold">==</span> <span style="font-weight:bold">nil</span> {
		t.<span style="color:#900;font-weight:bold">Errorf</span>(<span style="color:#b84">&#34;Expected error, received %v&#34;</span>, p)
	}
}</code></pre></div>
<p>Let's add two more tests for the <code>older</code> function. We will create two <code>*Person</code>
with different ages and check for the return value of the <code>older</code> function:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="font-weight:bold">func</span> <span style="color:#900;font-weight:bold">TestOlderFirstOlderThanSecond</span>(t <span style="font-weight:bold">*</span>testing.T) {
	p1, _ <span style="font-weight:bold">:=</span> <span style="color:#900;font-weight:bold">NewPerson</span>(<span style="color:#099">1</span>)
	p2, _ <span style="font-weight:bold">:=</span> <span style="color:#900;font-weight:bold">NewPerson</span>(<span style="color:#099">2</span>)

	<span style="font-weight:bold">if</span> p1.<span style="color:#900;font-weight:bold">older</span>(p2) {
		t.<span style="color:#900;font-weight:bold">Errorf</span>(<span style="color:#b84">&#34;Expected p1 with age %d to be younger than p2 with age %d&#34;</span>, p1.age, p2.age)
	}
}

<span style="font-weight:bold">func</span> <span style="color:#900;font-weight:bold">TestOlderSecondOlderThanFirst</span>(t <span style="font-weight:bold">*</span>testing.T) {
	p1, _ <span style="font-weight:bold">:=</span> <span style="color:#900;font-weight:bold">NewPerson</span>(<span style="color:#099">2</span>)
	p2, _ <span style="font-weight:bold">:=</span> <span style="color:#900;font-weight:bold">NewPerson</span>(<span style="color:#099">1</span>)

	<span style="font-weight:bold">if</span> !p1.<span style="color:#900;font-weight:bold">older</span>(p2) {
		t.<span style="color:#900;font-weight:bold">Errorf</span>(<span style="color:#b84">&#34;Expected p1 with age %d to be older than p2 with age %d&#34;</span>, p1.age, p2.age)
	}
}</code></pre></div>
<p>(If you find the tests a bit confusing I apologise - tried hard to make them
more readable but it was hard. I guess that says something about the example.)</p>
<p>The first way to control tests running is by supplying the test files as
arguments to the <code>go test</code> command. For example, if we have a <code>person.go</code> and
<code>person_test.go</code> files, we need to run:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ go <span style="color:#999">test</span> person.go person_test.go
ok  	command-line-arguments	0.005s</code></pre></div>
<p>The <code>go test</code> command prints only the final <code>ok</code>, because all the test cases
passed. If we would like to see a more detailed output, we can use the <code>-v</code>
flag:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ go <span style="color:#999">test</span> person.go person_test.go -v
<span style="font-weight:bold">=</span><span style="font-weight:bold">=</span><span style="font-weight:bold">=</span> RUN   TestNewPersonPositiveAge
--- PASS: TestNewPersonPositiveAge <span style="font-weight:bold">(</span>0.00s<span style="font-weight:bold">)</span>
<span style="font-weight:bold">=</span><span style="font-weight:bold">=</span><span style="font-weight:bold">=</span> RUN   TestNewPersonNegativeAge
--- PASS: TestNewPersonNegativeAge <span style="font-weight:bold">(</span>0.00s<span style="font-weight:bold">)</span>
<span style="font-weight:bold">=</span><span style="font-weight:bold">=</span><span style="font-weight:bold">=</span> RUN   TestOlderFirstOlderThanSecond
--- PASS: TestOlderFirstOlderThanSecond <span style="font-weight:bold">(</span>0.00s<span style="font-weight:bold">)</span>
<span style="font-weight:bold">=</span><span style="font-weight:bold">=</span><span style="font-weight:bold">=</span> RUN   TestOlderSecondOlderThanFirst
--- PASS: TestOlderSecondOlderThanFirst <span style="font-weight:bold">(</span>0.00s<span style="font-weight:bold">)</span>
PASS
ok  	command-line-arguments	0.005s</code></pre></div>
<p>The second way to run the test for the <code>person</code> package is to supply its name
to the <code>go test</code> command:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ go <span style="color:#999">test</span> person
ok  	person	0.004s</code></pre></div>
<p>This way, the <code>go test</code> locates the package, builds it and runs its tests.
(Adding the <code>-v</code> flag will produce the same output as before.)</p>
<p>The third way to run tests is by specifying a test function to be run, using
the <code>-run</code> flag. The flag takes an argument, which is a regex that will try to
match against any test functions in the current directory. For example, if we
would like to run the <code>TestNewPersonPositiveAge</code> and <code>TestNewPersonNegativeAge</code>
function, we can do this:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ go <span style="color:#999">test</span> -run TestNewPerson -v
<span style="font-weight:bold">=</span><span style="font-weight:bold">=</span><span style="font-weight:bold">=</span> RUN   TestNewPersonPositiveAge
--- PASS: TestNewPersonPositiveAge <span style="font-weight:bold">(</span>0.00s<span style="font-weight:bold">)</span>
<span style="font-weight:bold">=</span><span style="font-weight:bold">=</span><span style="font-weight:bold">=</span> RUN   TestNewPersonNegativeAge
--- PASS: TestNewPersonNegativeAge <span style="font-weight:bold">(</span>0.00s<span style="font-weight:bold">)</span>
PASS
ok  	person	0.004s</code></pre></div>
<p>If we mistakenly supply a regexp that will not match anything, <code>go test</code> will
inform us about it:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ go <span style="color:#999">test</span> -run TestFoo -v
testing: warning: no tests to run
PASS
ok  	person	0.004s</code></pre></div>
<h2 id="failing-fast">Failing Fast</h2>
<p>Often when running tests we want to lower the waiting time and stop at the
first test failure we hit. The default mode is to wait for all tests to finish
before the errors are reported, so depending on the project this can save us
some time.</p>
<p>To do this, <code>go test</code> has a special flag we can use: <code>-failfast</code>. Fail fast
does what it advertises: it will stop at the first test that fails, exiting the
process that is running the test suite/files. To see it in action, we will
break one of the test functions for the <code>older</code> function that we introduced
earlier:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#998;font-style:italic">// Removing everything else for brewity...
</span><span style="color:#998;font-style:italic"></span>
<span style="font-weight:bold">func</span> <span style="color:#900;font-weight:bold">TestOlderFirstOlderThanSecond</span>(t <span style="font-weight:bold">*</span>testing.T) {
	p1, _ <span style="font-weight:bold">:=</span> <span style="color:#900;font-weight:bold">NewPerson</span>(<span style="color:#099">100</span>)
	p2, _ <span style="font-weight:bold">:=</span> <span style="color:#900;font-weight:bold">NewPerson</span>(<span style="color:#099">2</span>)

	<span style="font-weight:bold">if</span> p1.<span style="color:#900;font-weight:bold">older</span>(p2) {
		t.<span style="color:#900;font-weight:bold">Errorf</span>(<span style="color:#b84">&#34;Expected p1 with age %d to be younger than p2 with age %d&#34;</span>, p1.age, p2.age)
	}
}</code></pre></div>
<p>We know this test will fail: <code>p1</code> will be older than <code>p2</code>, because they are
<code>100</code> and <code>2</code> years old respectively. If we run <code>go test</code> it will run all the
test functions, regardless if some fail:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ go <span style="color:#999">test</span> -v
<span style="font-weight:bold">=</span><span style="font-weight:bold">=</span><span style="font-weight:bold">=</span> RUN   TestNewPersonPositiveAge
--- PASS: TestNewPersonPositiveAge <span style="font-weight:bold">(</span>0.00s<span style="font-weight:bold">)</span>
<span style="font-weight:bold">=</span><span style="font-weight:bold">=</span><span style="font-weight:bold">=</span> RUN   TestNewPersonNegativeAge
--- PASS: TestNewPersonNegativeAge <span style="font-weight:bold">(</span>0.00s<span style="font-weight:bold">)</span>
<span style="font-weight:bold">=</span><span style="font-weight:bold">=</span><span style="font-weight:bold">=</span> RUN   TestOlderFirstOlderThanSecond
--- FAIL: TestOlderFirstOlderThanSecond <span style="font-weight:bold">(</span>0.00s<span style="font-weight:bold">)</span>
    person_test.go:26: Expected p1 with age <span style="color:#099">100</span> to be younger than p2 with age <span style="color:#008080">2</span>
<span style="font-weight:bold">=</span><span style="font-weight:bold">=</span><span style="font-weight:bold">=</span> RUN   TestOlderSecondOlderThanFirst
--- PASS: TestOlderSecondOlderThanFirst <span style="font-weight:bold">(</span>0.00s<span style="font-weight:bold">)</span>
FAIL
<span style="color:#999">exit</span> status <span style="color:#099">1</span>
FAIL	person	0.004s</code></pre></div>
<p>Now, let's see the difference if we add the <code>-failfast</code> flag:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ go <span style="color:#999">test</span> -v -failfast
<span style="font-weight:bold">=</span><span style="font-weight:bold">=</span><span style="font-weight:bold">=</span> RUN   TestNewPersonPositiveAge
--- PASS: TestNewPersonPositiveAge <span style="font-weight:bold">(</span>0.00s<span style="font-weight:bold">)</span>
<span style="font-weight:bold">=</span><span style="font-weight:bold">=</span><span style="font-weight:bold">=</span> RUN   TestNewPersonNegativeAge
--- PASS: TestNewPersonNegativeAge <span style="font-weight:bold">(</span>0.00s<span style="font-weight:bold">)</span>
<span style="font-weight:bold">=</span><span style="font-weight:bold">=</span><span style="font-weight:bold">=</span> RUN   TestOlderFirstOlderThanSecond
--- FAIL: TestOlderFirstOlderThanSecond <span style="font-weight:bold">(</span>0.00s<span style="font-weight:bold">)</span>
    person_test.go:26: Expected p1 with age <span style="color:#099">100</span> to be younger than p2 with age <span style="color:#099">2</span>
FAIL
<span style="color:#999">exit</span> status <span style="color:#099">1</span>
FAIL	person	0.004s</code></pre></div>
<p>By adding the <code>-failfast</code> flag we actually stopped right where we got the first
failure - when running the <code>TestOlderFirstOlderThanSecond</code> test function. This
option is useful when we do some heavier refactorings of our code. If our
refactor breaks some tests, instead of being overwhelmed by all the errors we
can add the <code>-failfast</code> flag and fix errors one by one.</p>
<p>Next time you do some big refactors give it a shot, it might save you some
sanity as you're fixing the tests.</p>












<figure class="imagecaption">
  <img class="caption" src="/testing-in-go-go-test/pie_chart.png" title="Image taken from Undraw." alt="Person next to a pie chart">
  <span class="caption-text">Image taken from <a href="https://undraw.co/">Undraw</a>.</span>
</figure>

<h2 id="coverage">Coverage</h2>
<p>Another interesting feature that is packed in <code>go test</code> is test coverage. Taken
from Go's website from the <a href="https://blog.golang.org/cover">blog post on
coverage</a>:</p>
<blockquote>
<p>Test coverage is a term that describes how much of a package's code is
exercised by running the package's tests. If executing the test suite causes
80% of the package's source statements to be run, we say that the test
coverage is 80%.</p>
</blockquote>
<p>We will not go in detail here on how the coverage tools work. I recommend
referring to the &ldquo;Test coverage for Go&rdquo; section in the aforementioned post to
understand how it actually measures the coverage.</p>
<p>If we would like to check the test coverage on our <code>Person</code> type and its
functions, we can run <code>go test -cover</code>:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ go <span style="color:#999">test</span> -cover
PASS
coverage: 100.0% of statements
ok  	person	0.004s</code></pre></div>
<p>This is great - it means that our tests cover all the functionality of our
functions. To see the coverage tool in action, we can add some more
functionality to the <code>NewPerson</code> constructor function. Creating a person that
is 1000 years old doesn't make much sense, especially
<a href="https://en.wikipedia.org/wiki/List_of_the_verified_oldest_people">knowing</a>
that the older person ever recorded was 122 years old. We can extend the
constructor to validate that the newly created <code>Person</code> instance cannot be
older than 130 years:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="font-weight:bold">package</span> person

<span style="font-weight:bold">import</span> <span style="color:#b84">&#34;errors&#34;</span>

<span style="font-weight:bold">type</span> Person <span style="font-weight:bold">struct</span> {
	age <span style="color:#458;font-weight:bold">int</span>
}

<span style="font-weight:bold">func</span> <span style="color:#900;font-weight:bold">NewPerson</span>(age <span style="color:#458;font-weight:bold">int</span>) (<span style="font-weight:bold">*</span>Person, <span style="color:#458;font-weight:bold">error</span>) {
	<span style="font-weight:bold">if</span> age &lt; <span style="color:#099">1</span> {
		<span style="font-weight:bold">return</span> <span style="font-weight:bold">nil</span>, errors.<span style="color:#900;font-weight:bold">New</span>(<span style="color:#b84">&#34;A person is at least 1 years old&#34;</span>)
	}

	<span style="font-weight:bold">if</span> age <span style="font-weight:bold">&gt;=</span> <span style="color:#099">130</span> {
		<span style="font-weight:bold">return</span> <span style="font-weight:bold">nil</span>, errors.<span style="color:#900;font-weight:bold">New</span>(<span style="color:#b84">&#34;A person cannot be older than 130 years&#34;</span>)
	}

	<span style="font-weight:bold">return</span> <span style="font-weight:bold">&amp;</span>Person{
		age: age,
	}, <span style="font-weight:bold">nil</span>
}

<span style="font-weight:bold">func</span> (p <span style="font-weight:bold">*</span>Person) <span style="color:#900;font-weight:bold">older</span>(other <span style="font-weight:bold">*</span>Person) <span style="color:#458;font-weight:bold">bool</span> {
	<span style="font-weight:bold">return</span> p.age &gt; other.age
}</code></pre></div>
<p>If we would run the coverage report again, we will see the following output:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ go <span style="color:#999">test</span> -cover -v
<span style="font-weight:bold">=</span><span style="font-weight:bold">=</span><span style="font-weight:bold">=</span> RUN   TestNewPersonPositiveAge
--- PASS: TestNewPersonPositiveAge <span style="font-weight:bold">(</span>0.00s<span style="font-weight:bold">)</span>
<span style="font-weight:bold">=</span><span style="font-weight:bold">=</span><span style="font-weight:bold">=</span> RUN   TestNewPersonNegativeAge
--- PASS: TestNewPersonNegativeAge <span style="font-weight:bold">(</span>0.00s<span style="font-weight:bold">)</span>
<span style="font-weight:bold">=</span><span style="font-weight:bold">=</span><span style="font-weight:bold">=</span> RUN   TestOlderFirstOlderThanSecond
--- PASS: TestOlderFirstOlderThanSecond <span style="font-weight:bold">(</span>0.00s<span style="font-weight:bold">)</span>
<span style="font-weight:bold">=</span><span style="font-weight:bold">=</span><span style="font-weight:bold">=</span> RUN   TestOlderSecondOlderThanFirst
--- PASS: TestOlderSecondOlderThanFirst <span style="font-weight:bold">(</span>0.00s<span style="font-weight:bold">)</span>
PASS
coverage: 83.3% of statements
ok  	person	0.004s</code></pre></div>
<p>Whoops, our coverage dropped from 100% to 83.3%. To see where our problem is,
we can ask <code>go test</code> to create a coverage profile for us, using the
<code>-coverprofile</code> flag:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ go <span style="color:#999">test</span> -coverprofile<span style="font-weight:bold">=</span>prof.out
PASS
coverage: 83.3% of statements
ok  	person	0.004s</code></pre></div>
<p>This will create a <code>prof.out</code> file, looking like this:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ cat prof.out
mode: <span style="color:#999">set</span>
person/person.go:9.42,10.13 <span style="color:#099">1</span> <span style="color:#099">1</span>
person/person.go:14.2,14.16 <span style="color:#099">1</span> <span style="color:#099">1</span>
person/person.go:18.2,20.3 <span style="color:#099">1</span> <span style="color:#099">1</span>
person/person.go:10.13,12.3 <span style="color:#099">1</span> <span style="color:#099">1</span>
person/person.go:14.16,16.3 <span style="color:#099">1</span> <span style="color:#099">0</span>
person/person.go:23.44,25.2 <span style="color:#099">1</span> <span style="color:#099">1</span></code></pre></div>
<p>We don't have to understand the output here, because Go has another tool that
we can use with the profile file to visualise the coverage report better: its
name is <code>go tool cover</code>. Using the <code>prof.out</code> profile file we have, we can
generate an HTML page that will visualise what parts of the code are covered by
tests:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ go tool cover -html<span style="font-weight:bold">=</span>prof.out</code></pre></div>
<p>This command pops open our browser with a page looking like this:</p>












<figure class="imagecaption">
  <img class="caption" src="/testing-in-go-go-test/coverage-report.png" title="The output of the command in web browser" alt="The output of the command in web browser">
  <span class="caption-text">The output of the command in web browser</span>
</figure>

<p>Looking at the image above, the red coloured code is the one that is never run.
In other words, the red code is not covered, while the green one is. The grey
code is not tracked, because from the coverage tool perspective it's
boilerplate (read: not needed to be tested).</p>
<p>From the image, it's clear that our tests never run the new branch where we
handle unreasonably old age as the argument. Let's add another quick test function
that will cover this functionality:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#998;font-style:italic">// person_test.go
</span><span style="color:#998;font-style:italic"></span><span style="font-weight:bold">func</span> <span style="color:#900;font-weight:bold">TestNewPersonHugeAge</span>(t <span style="font-weight:bold">*</span>testing.T) {
	p, err <span style="font-weight:bold">:=</span> <span style="color:#900;font-weight:bold">NewPerson</span>(<span style="color:#099">150</span>)
	<span style="font-weight:bold">if</span> err <span style="font-weight:bold">==</span> <span style="font-weight:bold">nil</span> {
		t.<span style="color:#900;font-weight:bold">Errorf</span>(<span style="color:#b84">&#34;Expected error, received %v&#34;</span>, p)
	}
}</code></pre></div>
<p>After running <code>go test -coverprofile=hundred.out -v</code> we will see the coverage
go back to 100% again:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ go <span style="color:#999">test</span> -coverprofile<span style="font-weight:bold">=</span>hundred.out -v
<span style="font-weight:bold">=</span><span style="font-weight:bold">=</span><span style="font-weight:bold">=</span> RUN   TestNewPersonPositiveAge
--- PASS: TestNewPersonPositiveAge <span style="font-weight:bold">(</span>0.00s<span style="font-weight:bold">)</span>
<span style="font-weight:bold">=</span><span style="font-weight:bold">=</span><span style="font-weight:bold">=</span> RUN   TestNewPersonNegativeAge
--- PASS: TestNewPersonNegativeAge <span style="font-weight:bold">(</span>0.00s<span style="font-weight:bold">)</span>
<span style="font-weight:bold">=</span><span style="font-weight:bold">=</span><span style="font-weight:bold">=</span> RUN   TestNewPersonHugeAge
--- PASS: TestNewPersonHugeAge <span style="font-weight:bold">(</span>0.00s<span style="font-weight:bold">)</span>
<span style="font-weight:bold">=</span><span style="font-weight:bold">=</span><span style="font-weight:bold">=</span> RUN   TestOlderFirstOlderThanSecond
--- PASS: TestOlderFirstOlderThanSecond <span style="font-weight:bold">(</span>0.00s<span style="font-weight:bold">)</span>
<span style="font-weight:bold">=</span><span style="font-weight:bold">=</span><span style="font-weight:bold">=</span> RUN   TestOlderSecondOlderThanFirst
--- PASS: TestOlderSecondOlderThanFirst <span style="font-weight:bold">(</span>0.00s<span style="font-weight:bold">)</span>
PASS
coverage: 100.0% of statements
ok  	person	0.004s</code></pre></div>
<p>Here's the HTML output of the coverage profile:</p>












<figure class="imagecaption">
  <img class="caption" src="/testing-in-go-go-test/coverage-report-100.png" title="The output of the command in web browser" alt="The output of the command in web browser">
  <span class="caption-text">The output of the command in web browser</span>
</figure>

<p>The <code>go test</code> and <code>go tool cover</code> tools packs more combined functionality. I
encourage you to read more about it in <a href="https://blog.golang.org/cover">the official blog
post</a> and to expriment further with the tools.</p>
<h2 id="running-modes-1">Running modes</h2>
<p>Software is built to serve highly mutable business requirements, which results
in applications that grow and evolve over time. Such applications are
(hopefully) well tested, with tests operating on unit, integration and
end-to-end levels.</p>
<p>A common technique on bigger projects often is to be explicit what type of
tests we want to run. For example, when running <code>go test</code>, do we want to
include running the integration tests of the project, or just the unit tests?
In such cases, there are two useful techniques that come out of the box with
Go: build tags and short mode.</p>
<h3 id="using--short-mode">Using <code>-short</code> mode</h3>
<p>The <code>-short</code> mode for <code>go test</code> allows us to mark any long-running tests to be
skipped in this mode. <code>go test</code> and the <code>testing</code> package support this via the
<code>t.Skip()</code>, the <code>testing.Short()</code> functions and the <code>-short</code> flag.</p>
<p>We can skip a test function by checking if the short mode is on and invoking
the <code>t.Skip</code> function if that returns <code>true</code>. Let's see this by changing an
earlier example:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="font-weight:bold">func</span> <span style="color:#900;font-weight:bold">TestOlderFirstOlderThanSecond</span>(t <span style="font-weight:bold">*</span>testing.T) {
	<span style="font-weight:bold">if</span> testing.<span style="color:#900;font-weight:bold">Short</span>() {
		t.<span style="color:#900;font-weight:bold">Skip</span>(<span style="color:#b84">&#34;Skipping long-running test.&#34;</span>)
	}
	p1, _ <span style="font-weight:bold">:=</span> <span style="color:#900;font-weight:bold">NewPerson</span>(<span style="color:#099">1</span>)
	p2, _ <span style="font-weight:bold">:=</span> <span style="color:#900;font-weight:bold">NewPerson</span>(<span style="color:#099">2</span>)

	<span style="font-weight:bold">if</span> p1.<span style="color:#900;font-weight:bold">older</span>(p2) {
		t.<span style="color:#900;font-weight:bold">Errorf</span>(<span style="color:#b84">&#34;Expected p1 with age %d to be younger than p2 with age %d&#34;</span>, p1.age, p2.age)
	}
}</code></pre></div>
<p>If we run the tests normally, using <code>go test -v</code> we should see no change in the
output:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ go <span style="color:#999">test</span> -v
<span style="font-weight:bold">=</span><span style="font-weight:bold">=</span><span style="font-weight:bold">=</span> RUN   TestNewPersonPositiveAge
--- PASS: TestNewPersonPositiveAge <span style="font-weight:bold">(</span>0.00s<span style="font-weight:bold">)</span>
<span style="font-weight:bold">=</span><span style="font-weight:bold">=</span><span style="font-weight:bold">=</span> RUN   TestNewPersonNegativeAge
--- PASS: TestNewPersonNegativeAge <span style="font-weight:bold">(</span>0.00s<span style="font-weight:bold">)</span>
<span style="font-weight:bold">=</span><span style="font-weight:bold">=</span><span style="font-weight:bold">=</span> RUN   TestNewPersonHugeAge
--- PASS: TestNewPersonHugeAge <span style="font-weight:bold">(</span>0.00s<span style="font-weight:bold">)</span>
<span style="font-weight:bold">=</span><span style="font-weight:bold">=</span><span style="font-weight:bold">=</span> RUN   TestOlderFirstOlderThanSecond
--- PASS: TestOlderFirstOlderThanSecond <span style="font-weight:bold">(</span>0.00s<span style="font-weight:bold">)</span>
<span style="font-weight:bold">=</span><span style="font-weight:bold">=</span><span style="font-weight:bold">=</span> RUN   TestOlderSecondOlderThanFirst
--- PASS: TestOlderSecondOlderThanFirst <span style="font-weight:bold">(</span>0.00s<span style="font-weight:bold">)</span>
PASS
ok  	person	0.004s</code></pre></div>
<p>If we would enable the short mode using the <code>-short</code> flag, we should see the
change in the behaviour and output:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ go <span style="color:#999">test</span> -short -v
<span style="font-weight:bold">=</span><span style="font-weight:bold">=</span><span style="font-weight:bold">=</span> RUN   TestNewPersonPositiveAge
--- PASS: TestNewPersonPositiveAge <span style="font-weight:bold">(</span>0.00s<span style="font-weight:bold">)</span>
<span style="font-weight:bold">=</span><span style="font-weight:bold">=</span><span style="font-weight:bold">=</span> RUN   TestNewPersonNegativeAge
--- PASS: TestNewPersonNegativeAge <span style="font-weight:bold">(</span>0.00s<span style="font-weight:bold">)</span>
<span style="font-weight:bold">=</span><span style="font-weight:bold">=</span><span style="font-weight:bold">=</span> RUN   TestNewPersonHugeAge
--- PASS: TestNewPersonHugeAge <span style="font-weight:bold">(</span>0.00s<span style="font-weight:bold">)</span>
<span style="font-weight:bold">=</span><span style="font-weight:bold">=</span><span style="font-weight:bold">=</span> RUN   TestOlderFirstOlderThanSecond
--- SKIP: TestOlderFirstOlderThanSecond <span style="font-weight:bold">(</span>0.00s<span style="font-weight:bold">)</span>
    person_test.go:30: Skipping long-running test.
<span style="font-weight:bold">=</span><span style="font-weight:bold">=</span><span style="font-weight:bold">=</span> RUN   TestOlderSecondOlderThanFirst
--- PASS: TestOlderSecondOlderThanFirst <span style="font-weight:bold">(</span>0.00s<span style="font-weight:bold">)</span>
PASS
ok  	person	0.005s</code></pre></div>
<p>We can see that the output contains one <code>SKIP</code> line, meaning in short mode <code>go test</code> skipped the test function. We can use <code>-short</code> in other ways, besides
skipping a test. For example, mocking networks calls instead of opening a
connection or loading simple fixtures instead of loading them from a database.
The options are many, it all depends on the function that the test is covering.</p>












<figure class="imagecaption">
  <img class="caption" src="/testing-in-go-go-test/building_blocks.png" title="Image taken from Undraw." alt="Person building a brick wall">
  <span class="caption-text">Image taken from <a href="https://undraw.co/">Undraw</a>.</span>
</figure>

<h3 id="using-build-tags">Using build tags</h3>
<p><code>go test</code> supports build tags out of the box, like the <code>-short</code> flag. While we
apply the short mode on the function level, we use the build tags on a file
level. This means that there is no way to use build tags to skip one or a few
functions. Rather, build tags are used to run (or skip) a special type of test
files from our test suite.</p>
<script src="https://f.convertkit.com/ckjs/ck.5.js"></script>
      <form action="https://app.convertkit.com/forms/1152282/subscriptions" class="seva-form formkit-form" method="post" data-sv-form="1152282" data-uid="d2c78f7648" data-format="inline" data-version="5" data-options="{&quot;settings&quot;:{&quot;after_subscribe&quot;:{&quot;action&quot;:&quot;message&quot;,&quot;success_message&quot;:&quot;Success! Now check your email to confirm your subscription.&quot;,&quot;redirect_url&quot;:&quot;&quot;},&quot;analytics&quot;:{&quot;google&quot;:null,&quot;facebook&quot;:null,&quot;segment&quot;:null,&quot;pinterest&quot;:null},&quot;modal&quot;:{&quot;trigger&quot;:&quot;timer&quot;,&quot;scroll_percentage&quot;:null,&quot;timer&quot;:5,&quot;devices&quot;:&quot;all&quot;,&quot;show_once_every&quot;:15},&quot;powered_by&quot;:{&quot;show&quot;:false,&quot;url&quot;:&quot;https://convertkit.com?utm_source=dynamic&amp;utm_medium=referral&amp;utm_campaign=poweredby&amp;utm_content=form&quot;},&quot;recaptcha&quot;:{&quot;enabled&quot;:false},&quot;return_visitor&quot;:{&quot;action&quot;:&quot;show&quot;,&quot;custom_content&quot;:&quot;&quot;},&quot;slide_in&quot;:{&quot;display_in&quot;:&quot;bottom_right&quot;,&quot;trigger&quot;:&quot;timer&quot;,&quot;scroll_percentage&quot;:null,&quot;timer&quot;:5,&quot;devices&quot;:&quot;all&quot;,&quot;show_once_every&quot;:15},&quot;sticky_bar&quot;:{&quot;display_in&quot;:&quot;top&quot;,&quot;trigger&quot;:&quot;timer&quot;,&quot;scroll_percentage&quot;:null,&quot;timer&quot;:5,&quot;devices&quot;:&quot;all&quot;,&quot;show_once_every&quot;:15}},&quot;version&quot;:&quot;5&quot;}" min-width="400 500 600 700 800" style="background-color: rgb(255, 255, 255); border-radius: 6px; margin: 0 auto;"><div class="formkit-background" style="opacity: 0.3;"></div><div data-style="minimal"><div class="formkit-header" data-element="header" style="color: rgb(77, 77, 77); font-size: 20px; font-weight: 700;"><h1>Coming soon!</h1></div><div class="formkit-subheader" data-element="subheader" style="color: rgb(104, 104, 104); font-size: 15px;"><p>I am planning a course on testing in Go. Would you like to get a (free) sneak peek while I am building it? Sign up now!</p></div><ul class="formkit-alert formkit-alert-error" data-element="errors" data-group="alert"></ul><div data-element="fields" data-stacked="false" class="seva-fields formkit-fields"><div class="formkit-field"><input class="formkit-input" name="email_address" placeholder="Your email address" required="" type="email" style="color: rgb(0, 0, 0); border-color: rgb(227, 227, 227); border-radius: 4px; font-weight: 400;"></div><button data-element="submit" class="formkit-submit formkit-submit" style="color: rgb(255, 255, 255); background-color: rgb(55, 0, 255); border-radius: 24px; font-weight: 700;"><div class="formkit-spinner"><div></div><div></div><div></div></div><span>Subscribe</span></button></div><div class="formkit-guarantee" data-element="guarantee" style="color: rgb(77, 77, 77); font-size: 13px; font-weight: 400;"><p>I respect your privacy. Unsubscribe at any time. No spam, ever.</p></div></div><style>.formkit-form[data-uid="d2c78f7648"] *{box-sizing:border-box;}.formkit-form[data-uid="d2c78f7648"]{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;}.formkit-form[data-uid="d2c78f7648"] legend{border:none;font-size:inherit;margin-bottom:10px;padding:0;position:relative;display:table;}.formkit-form[data-uid="d2c78f7648"] fieldset{border:0;padding:0.01em 0 0 0;margin:0;min-width:0;}.formkit-form[data-uid="d2c78f7648"] body:not(:-moz-handler-blocked) fieldset{display:table-cell;}.formkit-form[data-uid="d2c78f7648"] h1,.formkit-form[data-uid="d2c78f7648"] h2,.formkit-form[data-uid="d2c78f7648"] h3,.formkit-form[data-uid="d2c78f7648"] h4,.formkit-form[data-uid="d2c78f7648"] h5,.formkit-form[data-uid="d2c78f7648"] h6{color:inherit;font-size:inherit;font-weight:inherit;}.formkit-form[data-uid="d2c78f7648"] p{color:inherit;font-size:inherit;font-weight:inherit;}.formkit-form[data-uid="d2c78f7648"] ol:not([template-default]),.formkit-form[data-uid="d2c78f7648"] ul:not([template-default]),.formkit-form[data-uid="d2c78f7648"] blockquote:not([template-default]){text-align:left;}.formkit-form[data-uid="d2c78f7648"] p:not([template-default]),.formkit-form[data-uid="d2c78f7648"] hr:not([template-default]),.formkit-form[data-uid="d2c78f7648"] blockquote:not([template-default]),.formkit-form[data-uid="d2c78f7648"] ol:not([template-default]),.formkit-form[data-uid="d2c78f7648"] ul:not([template-default]){color:inherit;font-style:initial;}.formkit-form[data-uid="d2c78f7648"][data-format="modal"]{display:none;}.formkit-form[data-uid="d2c78f7648"][data-format="slide in"]{display:none;}.formkit-form[data-uid="d2c78f7648"] .formkit-input,.formkit-form[data-uid="d2c78f7648"] .formkit-select,.formkit-form[data-uid="d2c78f7648"] .formkit-checkboxes{width:100%;}.formkit-form[data-uid="d2c78f7648"] .formkit-button,.formkit-form[data-uid="d2c78f7648"] .formkit-submit{border:0;border-radius:5px;color:#ffffff;cursor:pointer;display:inline-block;text-align:center;font-size:15px;font-weight:500;cursor:pointer;margin-bottom:15px;overflow:hidden;padding:0;position:relative;vertical-align:middle;}.formkit-form[data-uid="d2c78f7648"] .formkit-button:hover,.formkit-form[data-uid="d2c78f7648"] .formkit-submit:hover,.formkit-form[data-uid="d2c78f7648"] .formkit-button:focus,.formkit-form[data-uid="d2c78f7648"] .formkit-submit:focus{outline:none;}.formkit-form[data-uid="d2c78f7648"] .formkit-button:hover > span,.formkit-form[data-uid="d2c78f7648"] .formkit-submit:hover > span,.formkit-form[data-uid="d2c78f7648"] .formkit-button:focus > span,.formkit-form[data-uid="d2c78f7648"] .formkit-submit:focus > span{background-color:rgba(0,0,0,0.1);}.formkit-form[data-uid="d2c78f7648"] .formkit-button > span,.formkit-form[data-uid="d2c78f7648"] .formkit-submit > span{display:block;-webkit-transition:all 300ms ease-in-out;transition:all 300ms ease-in-out;padding:12px 24px;}.formkit-form[data-uid="d2c78f7648"] .formkit-input{background:#ffffff;font-size:15px;padding:12px;border:1px solid #e3e3e3;-webkit-flex:1 0 auto;-ms-flex:1 0 auto;flex:1 0 auto;line-height:1.4;margin:0;-webkit-transition:border-color ease-out 300ms;transition:border-color ease-out 300ms;}.formkit-form[data-uid="d2c78f7648"] .formkit-input:focus{outline:none;border-color:#1677be;-webkit-transition:border-color ease 300ms;transition:border-color ease 300ms;}.formkit-form[data-uid="d2c78f7648"] .formkit-input::-webkit-input-placeholder{color:inherit;opacity:0.8;}.formkit-form[data-uid="d2c78f7648"] .formkit-input::-moz-placeholder{color:inherit;opacity:0.8;}.formkit-form[data-uid="d2c78f7648"] .formkit-input:-ms-input-placeholder{color:inherit;opacity:0.8;}.formkit-form[data-uid="d2c78f7648"] .formkit-input::placeholder{color:inherit;opacity:0.8;}.formkit-form[data-uid="d2c78f7648"] [data-group="dropdown"]{position:relative;display:inline-block;width:100%;}.formkit-form[data-uid="d2c78f7648"] [data-group="dropdown"]::before{content:"";top:calc(50% - 2.5px);right:10px;position:absolute;pointer-events:none;border-color:#4f4f4f transparent transparent transparent;border-style:solid;border-width:6px 6px 0 6px;height:0;width:0;z-index:999;}.formkit-form[data-uid="d2c78f7648"] [data-group="dropdown"] select{height:auto;width:100%;cursor:pointer;color:#333333;line-height:1.4;margin-bottom:0;padding:0 6px;-webkit-appearance:none;-moz-appearance:none;appearance:none;font-size:15px;padding:12px;padding-right:25px;border:1px solid #e3e3e3;background:#ffffff;}.formkit-form[data-uid="d2c78f7648"] [data-group="dropdown"] select:focus{outline:none;}.formkit-form[data-uid="d2c78f7648"] [data-group="checkboxes"]{text-align:left;margin:0;}.formkit-form[data-uid="d2c78f7648"] [data-group="checkboxes"] [data-group="checkbox"]{margin-bottom:10px;}.formkit-form[data-uid="d2c78f7648"] [data-group="checkboxes"] [data-group="checkbox"] *{cursor:pointer;}.formkit-form[data-uid="d2c78f7648"] [data-group="checkboxes"] [data-group="checkbox"]:last-of-type{margin-bottom:0;}.formkit-form[data-uid="d2c78f7648"] [data-group="checkboxes"] [data-group="checkbox"] input[type="checkbox"]{display:none;}.formkit-form[data-uid="d2c78f7648"] [data-group="checkboxes"] [data-group="checkbox"] input[type="checkbox"] + label::after{content:none;}.formkit-form[data-uid="d2c78f7648"] [data-group="checkboxes"] [data-group="checkbox"] input[type="checkbox"]:checked + label::after{border-color:#ffffff;content:"";}.formkit-form[data-uid="d2c78f7648"] [data-group="checkboxes"] [data-group="checkbox"] input[type="checkbox"]:checked + label::before{background:#10bf7a;border-color:#10bf7a;}.formkit-form[data-uid="d2c78f7648"] [data-group="checkboxes"] [data-group="checkbox"] label{position:relative;display:inline-block;padding-left:28px;}.formkit-form[data-uid="d2c78f7648"] [data-group="checkboxes"] [data-group="checkbox"] label::before,.formkit-form[data-uid="d2c78f7648"] [data-group="checkboxes"] [data-group="checkbox"] label::after{position:absolute;content:"";display:inline-block;}.formkit-form[data-uid="d2c78f7648"] [data-group="checkboxes"] [data-group="checkbox"] label::before{height:16px;width:16px;border:1px solid #e3e3e3;background:#ffffff;left:0px;top:3px;}.formkit-form[data-uid="d2c78f7648"] [data-group="checkboxes"] [data-group="checkbox"] label::after{height:4px;width:8px;border-left:2px solid #4d4d4d;border-bottom:2px solid #4d4d4d;-webkit-transform:rotate(-45deg);-ms-transform:rotate(-45deg);transform:rotate(-45deg);left:4px;top:8px;}.formkit-form[data-uid="d2c78f7648"] .formkit-alert{background:#f9fafb;border:1px solid #e3e3e3;border-radius:5px;-webkit-flex:1 0 auto;-ms-flex:1 0 auto;flex:1 0 auto;list-style:none;margin:25px auto;padding:12px;text-align:center;width:100%;}.formkit-form[data-uid="d2c78f7648"] .formkit-alert:empty{display:none;}.formkit-form[data-uid="d2c78f7648"] .formkit-alert-success{background:#d3fbeb;border-color:#10bf7a;color:#0c905c;}.formkit-form[data-uid="d2c78f7648"] .formkit-alert-error{background:#fde8e2;border-color:#f2643b;color:#ea4110;}.formkit-form[data-uid="d2c78f7648"] .formkit-spinner{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:0px;width:0px;margin:0 auto;position:absolute;top:0;left:0;right:0;width:0px;overflow:hidden;text-align:center;-webkit-transition:all 300ms ease-in-out;transition:all 300ms ease-in-out;}.formkit-form[data-uid="d2c78f7648"] .formkit-spinner > div{margin:auto;width:12px;height:12px;background-color:#fff;opacity:0.3;border-radius:100%;display:inline-block;-webkit-animation:formkit-bouncedelay-formkit-form-data-uid-d2c78f7648- 1.4s infinite ease-in-out both;animation:formkit-bouncedelay-formkit-form-data-uid-d2c78f7648- 1.4s infinite ease-in-out both;}.formkit-form[data-uid="d2c78f7648"] .formkit-spinner > div:nth-child(1){-webkit-animation-delay:-0.32s;animation-delay:-0.32s;}.formkit-form[data-uid="d2c78f7648"] .formkit-spinner > div:nth-child(2){-webkit-animation-delay:-0.16s;animation-delay:-0.16s;}.formkit-form[data-uid="d2c78f7648"] .formkit-submit[data-active] .formkit-spinner{opacity:1;height:100%;width:50px;}.formkit-form[data-uid="d2c78f7648"] .formkit-submit[data-active] .formkit-spinner ~ span{opacity:0;}.formkit-form[data-uid="d2c78f7648"] .formkit-powered-by[data-active="false"]{opacity:0.35;}@-webkit-keyframes formkit-bouncedelay-formkit-form-data-uid-d2c78f7648-{0%,80%,100%{-webkit-transform:scale(0);-ms-transform:scale(0);transform:scale(0);}40%{-webkit-transform:scale(1);-ms-transform:scale(1);transform:scale(1);}}@keyframes formkit-bouncedelay-formkit-form-data-uid-d2c78f7648-{0%,80%,100%{-webkit-transform:scale(0);-ms-transform:scale(0);transform:scale(0);}40%{-webkit-transform:scale(1);-ms-transform:scale(1);transform:scale(1);}}.formkit-form[data-uid="d2c78f7648"] blockquote{padding:10px 20px;margin:0 0 20px;border-left:5px solid #e1e1e1;} .formkit-form[data-uid="d2c78f7648"]{border:1px solid #e3e3e3;max-width:700px;position:relative;overflow:hidden;}.formkit-form[data-uid="d2c78f7648"] .formkit-background{width:100%;height:100%;position:absolute;top:0;left:0;background-size:cover;background-position:center;opacity:0.3;z-index:1;}.formkit-form[data-uid="d2c78f7648"] [data-style="minimal"]{padding:20px;width:100%;z-index:2;position:relative;}.formkit-form[data-uid="d2c78f7648"] .formkit-header{margin:0 0 27px 0;text-align:center;}.formkit-form[data-uid="d2c78f7648"] .formkit-subheader{margin:18px 0;text-align:center;}.formkit-form[data-uid="d2c78f7648"] .formkit-guarantee{font-size:13px;margin:10px 0 15px 0;text-align:center;}.formkit-form[data-uid="d2c78f7648"] .formkit-guarantee > p{margin:0;}.formkit-form[data-uid="d2c78f7648"] .formkit-powered-by{color:#7d7d7d;display:block;font-size:12px;margin:10px 0 0 0;text-align:center;}.formkit-form[data-uid="d2c78f7648"] .formkit-fields{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin:25px auto 0 auto;}.formkit-form[data-uid="d2c78f7648"] .formkit-field{min-width:220px;}.formkit-form[data-uid="d2c78f7648"] .formkit-field,.formkit-form[data-uid="d2c78f7648"] .formkit-submit{margin:0 0 15px 0;-webkit-flex:1 0 100%;-ms-flex:1 0 100%;flex:1 0 100%;}.formkit-form[data-uid="d2c78f7648"][min-width~="600"] [data-style="minimal"]{padding:0 40px;}.formkit-form[data-uid="d2c78f7648"][min-width~="600"] .formkit-fields[data-stacked="false"]{margin-left:-5px;margin-right:-5px;}.formkit-form[data-uid="d2c78f7648"][min-width~="600"] .formkit-fields[data-stacked="false"] .formkit-field,.formkit-form[data-uid="d2c78f7648"][min-width~="600"] .formkit-fields[data-stacked="false"] .formkit-submit{margin:0 5px 15px 5px;}.formkit-form[data-uid="d2c78f7648"][min-width~="600"] .formkit-fields[data-stacked="false"] .formkit-field{-webkit-flex:100 1 auto;-ms-flex:100 1 auto;flex:100 1 auto;}.formkit-form[data-uid="d2c78f7648"][min-width~="600"] .formkit-fields[data-stacked="false"] .formkit-submit{-webkit-flex:1 1 auto;-ms-flex:1 1 auto;flex:1 1 auto;} </style></form>

<p>There are a couple of rules on build tags. As indicated in
<a href="https://stackoverflow.com/a/28007631/601555">this</a> Stack Overflow answer:</p>
<ul>
<li>build tags are special comments, with the format <code>// +build TAGNAME</code></li>
<li>we have to place the tag on the first line of the file</li>
<li>we have to add an empty line after the tag</li>
<li>the tag name comment cannot have a dash, but it allows underscores</li>
</ul>
<p>Following these rules, we can add a tag to our <code>person_test.go</code> file from
earlier:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#998;font-style:italic">// +build person_tests
</span><span style="color:#998;font-style:italic"></span>
<span style="font-weight:bold">package</span> person

<span style="font-weight:bold">import</span> (
	<span style="color:#b84">&#34;testing&#34;</span>
)

<span style="font-weight:bold">/</span><span style="font-weight:bold">/</span> Snipped<span style="font-weight:bold">...</span></code></pre></div>
<p>(The <code>person_tests</code> tag is a useless when we have only one file in the test
suite, but we will add it for experimentational purposes.)</p>
<p>To add the build tag to our <code>go test</code> command, we need to run <code>go test -tags=TAG_NAME</code>. To run the files with the <code>person_tests</code> build tag:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ go <span style="color:#999">test</span> -tags<span style="font-weight:bold">=</span>person_tests -v
<span style="font-weight:bold">=</span><span style="font-weight:bold">=</span><span style="font-weight:bold">=</span> RUN   TestNewPersonPositiveAge
--- PASS: TestNewPersonPositiveAge <span style="font-weight:bold">(</span>0.00s<span style="font-weight:bold">)</span>
<span style="font-weight:bold">=</span><span style="font-weight:bold">=</span><span style="font-weight:bold">=</span> RUN   TestNewPersonNegativeAge
--- PASS: TestNewPersonNegativeAge <span style="font-weight:bold">(</span>0.00s<span style="font-weight:bold">)</span>
<span style="font-weight:bold">=</span><span style="font-weight:bold">=</span><span style="font-weight:bold">=</span> RUN   TestNewPersonHugeAge
--- PASS: TestNewPersonHugeAge <span style="font-weight:bold">(</span>0.00s<span style="font-weight:bold">)</span>
<span style="font-weight:bold">=</span><span style="font-weight:bold">=</span><span style="font-weight:bold">=</span> RUN   TestOlderFirstOlderThanSecond
--- PASS: TestOlderFirstOlderThanSecond <span style="font-weight:bold">(</span>0.00s<span style="font-weight:bold">)</span>
<span style="font-weight:bold">=</span><span style="font-weight:bold">=</span><span style="font-weight:bold">=</span> RUN   TestOlderSecondOlderThanFirst
--- PASS: TestOlderSecondOlderThanFirst <span style="font-weight:bold">(</span>0.00s<span style="font-weight:bold">)</span>
PASS
ok  	person	0.005s</code></pre></div>
<p>Based on the supplied tag, <code>go test</code> detects the files tagged with
<code>person_tests</code> and runs them. If we would supply a tag that does not exist in
the package, the output would report that no files are found:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ go <span style="color:#999">test</span> -tags<span style="font-weight:bold">=</span>foo -v
?   	person	<span style="font-weight:bold">[</span>no <span style="color:#999">test</span> files<span style="font-weight:bold">]</span></code></pre></div>
<h2 id="notable-mentions">Notable mentions</h2>
<p>Covering all the features that <code>go test</code> packs in a single post is a hard
undertaking. Here I will mention some other useful features that you should try
to use and read more on:</p>
<ul>
<li>List tests with <code>-list</code>: to list tests, benchmarks, or examples matching a
regular expression passed as the argument. The usage of the <code>-list</code> flags is
analogous to the <code>-run</code> flag that we discussed before. When we use this flag
<code>go test</code> will not run any tests, benchmarks or examples.</li>
<li>Disabling caching with <code>-count</code>: as we discussed before, <code>go test</code> by default
caches test results for packages. It then uses them to skip running tests
that have are not modified between two runs. Although can improve the
performance, there are times when we would like to disable the caching using
the <code>-count=1</code> flag.</li>
<li>Get JSON output using <code>-json</code>: if we would like to take the output of <code>go test</code> and process it using a program, having it in a JSON format is better
than normal text. This flag will convert the output to JSON, so processing it
with a program is less cumbersome.</li>
<li>Use more CPU cores using <code>-cpu</code>: this flag will set the <code>GOMAXPROCS</code> variable
to the argument that we pass to the flag. It limits the number of operating
system threads that can execute user-level Go code simultaneously.</li>
<li>Detect race conditions using <code>-race</code>: since it's very easy to write
concurrent code in Go, race conditions are always a risk. Go's tooling is
great in this regard - it has a fully integrated race conditions detector in
its toolchain. You can read more about it in <a href="https://blog.golang.org/race-detector">its announcement blog
post</a>.</li>
</ul>

<script>
    (function(h,o,t,j,a,r){
        h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
        h._hjSettings={hjid:1585609,hjsv:6};
        a=o.getElementsByTagName('head')[0];
        r=o.createElement('script');r.async=1;
        r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
        a.appendChild(r);
    })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
</script>


			</div>

			<div class="tags">
				
					
				
			</div><div id="disqus_thread"></div>
<script type="text/javascript">
	(function () {
		
		
		if (window.location.hostname == "localhost")
			return;

		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		var disqus_shortname = 'eftimov';
		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
</script>
<noscript>Please enable JavaScript to view the </a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
	</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div> Copyright © 2014 - 2020 Ilija Eftimov |  <a href="https://github.com/knadh/hugo-ink">Ink</a> theme on <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-11264459-2', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<script>feather.replace()</script>
</body>
</html>
