<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Refactoring in Ruby: Primitive Obsession | Ilija Eftimov ⚡️</title><meta name=keywords content="primitive obsession"><meta name=description content="We&rsquo;ve all been at this point where we have bloated our classes with primitive values all over the place. Usually, we drop in primitive constants that, for whatever reason, we think that are a good fit to the class. Or sometimes, we just dump primitive values instead of small objects, thinking &ldquo;it&rsquo;s okay, it&rsquo;s just an attribute in the class&rdquo;. But, does it always make sense?
The problem Say we have a project for a finance journalist who wants us to automate his text editor to do some random fixes to his texts, on the fly."><meta name=author content="Ilija Eftimov"><link rel=canonical href=https://ieftimov.com/post/primitive-obsession-ruby/><link crossorigin=anonymous href=/assets/css/stylesheet.min.css rel="preload stylesheet" as=style><link rel=icon href=https://ieftimov.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://ieftimov.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://ieftimov.com/favicon-32x32.png><link rel=apple-touch-icon href=https://ieftimov.com/apple-touch-icon.png><link rel=mask-icon href=https://ieftimov.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.83.1"><script async defer data-domain=ieftimov.com src=https://plausible.io/js/plausible.js></script><link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel=stylesheet><meta property="og:title" content="Refactoring in Ruby: Primitive Obsession"><meta property="og:description" content="We&rsquo;ve all been at this point where we have bloated our classes with primitive values all over the place. Usually, we drop in primitive constants that, for whatever reason, we think that are a good fit to the class. Or sometimes, we just dump primitive values instead of small objects, thinking &ldquo;it&rsquo;s okay, it&rsquo;s just an attribute in the class&rdquo;. But, does it always make sense?
The problem Say we have a project for a finance journalist who wants us to automate his text editor to do some random fixes to his texts, on the fly."><meta property="og:type" content="article"><meta property="og:url" content="https://ieftimov.com/post/primitive-obsession-ruby/"><meta property="og:image" content="https://ieftimov.com/cards/primitive-obsession-ruby.png"><meta property="article:section" content="posts"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://ieftimov.com/cards/primitive-obsession-ruby.png"><meta name=twitter:title content="Refactoring in Ruby: Primitive Obsession"><meta name=twitter:description content="We&rsquo;ve all been at this point where we have bloated our classes with primitive values all over the place. Usually, we drop in primitive constants that, for whatever reason, we think that are a good fit to the class. Or sometimes, we just dump primitive values instead of small objects, thinking &ldquo;it&rsquo;s okay, it&rsquo;s just an attribute in the class&rdquo;. But, does it always make sense?
The problem Say we have a project for a finance journalist who wants us to automate his text editor to do some random fixes to his texts, on the fly."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://ieftimov.com/posts/"},{"@type":"ListItem","position":2,"name":"Refactoring in Ruby: Primitive Obsession","item":"https://ieftimov.com/post/primitive-obsession-ruby/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Refactoring in Ruby: Primitive Obsession","name":"Refactoring in Ruby: Primitive Obsession","description":"We\u0026rsquo;ve all been at this point where we have bloated our classes with primitive values all over the place. Usually, we drop in primitive constants that, for whatever reason, we think that are a good fit to the class. Or sometimes, we just dump primitive values instead of small objects, thinking \u0026ldquo;it\u0026rsquo;s okay, it\u0026rsquo;s just an attribute in the class\u0026rdquo;. But, does it always make sense?\nThe problem Say we have a project for a finance journalist who wants us to automate his text editor to do some random fixes to his texts, on the fly.","keywords":["primitive obsession"],"articleBody":"We’ve all been at this point where we have bloated our classes with primitive values all over the place. Usually, we drop in primitive constants that, for whatever reason, we think that are a good fit to the class. Or sometimes, we just dump primitive values instead of small objects, thinking “it’s okay, it’s just an attribute in the class”. But, does it always make sense?\nThe problem Say we have a project for a finance journalist who wants us to automate his text editor to do some random fixes to his texts, on the fly. The automation is basically adding his name and date to the footer of the text that he’s writing, and to change currencies abbreviations to symbols. The good thing for us is that his editor is written in Ruby, and has the ability to add custom I/O streams to it’s I/O stack.\nSo, our specification for this I/O stream, is:\n limit text to no more than 10000 words append journalist name to end of article swap popular currency names abbreviations with symbols  After a bit of work, we come up with this quick hack for a I/O stream:\nrequire 'stringio' class FinanceIO class MaximumLengthExceeded  StandardError; end MAX_WORDS = 10000 MIN_WORDS = 2000 AUTHOR_NAME = \"John Smith\" AUTHOR_EMAIL = \"j.smith@nytimes.com\" CURRENCIES = [ [\"USD\", \"$\"], [\"GBP\", \"£\"], [\"JPY\", \"¥\"], [\"CHF\", \"₣\"], [\"EUR\", \"€\"], [\"INR\", \"₹\"], [\"GEN\", \"¤\"] # General currency sign ] def initialize @io = StringIO.new end def puts(arg) if @io.string.split(\"\").length = MAX_WORDS || @io.string.split(\"\").length = MIN_WORDS raise TextLengthExceeded.new(\"The text must be within #{MIN_WORDS}and #{MAX_WORDS}words.\") else CURRENCIES.each do |abbrv, symbol| arg.gsub!(abbrv,symbol) end @io.puts(arg) end end def on_exit append_author end def method_missing(method_name, *args, \u0026block) if @io.respond_to?(method_name) @io.send(method_name, *args) else super(method_name, *args, \u0026block) end end private def append_author @io.puts(\"\\n\") @io.puts(AUTHOR_NAME) @io.puts(\"\\n\") @io.puts(AUTHOR_EMAIL) @io.puts(\"\\n\") end end The FinanceIO class is a wrapper around a StringIO, which overrides a couple of methods, but relays any other method calls to the wrapped StringIO object. This allows us to do our work easily, while not breaking when any object of the I/O stack tries to call a built-in method on our object.\nLet’s break down the example. The MAX_WORDS and MIN_WORDS is a limitation that our client (the journalist) has been given by the newspaper he works for, or in other words, his articles cannot be loger than 10000 words. The AUTHOR_NAME constant is the name of our author. We don’t need to enable customization for this piece of data, because our client wanted to make our life easier by agreeing that he will not change his name any time soon. The AUTHOR_EMAIL constant is the author public email address. Next, the CURRENCIES constant is a two-dimensional array which contains the abbreviations and the symbols of the most popular currencies that the journalist uses while writing his finance articles.\nMost of the functionality described in the spec is done within the FinanceIO#puts method:\ndef puts(arg) if @io.string.split(\"\").length = MAX_WORDS || @io.string.split(\"\").length = MIN_WORDS raise TextLengthExceeded.new(\"The text must be within #{@limitations.min_words}and #{@limitations.max_words}words.\") else CURRENCIES.each do |abbrv, symbol| arg.gsub!(abbrv,symbol) end @io.puts(arg) end end The puts method takes a string as an argument, and saves it to the stream. But, before it does that, it checks if the text is longer than 10000 words. If it is, it will raise an exception that the text editor will handle gracefully. If not, it will carry on to substitute any of the currency abbreviations in the text with the corresponding symbol.\nAlso, the FinanceIO#on_exit is a method which will append the author name in the footer of the text.\ndef on_exit append_author end This will get automatically invoked by the editor, as an callback before the journalist closes his editor.\nThis will surely work, and it complies with our imaginary text editor. Sure, it might be a bit dirty, but it does the trick. Now, a question to ourselves - what should we do about the data in the constants? There seems to be much behaviour in connection with these constants. Aside of that, it’s just plain data and it doesn’t really add too much noise to our class and the functionality is easy to follow… right?\nThe Code Smell Well, sure, the fields don’t do much noise, but this is exactly the way of thinking that creates these code smells. You could argue that the FinanceIO class is pretty simple to follow, and you would be right. The problem lies in the practice, which will eventually bloat the class with so much “static” data, to a point of total confusion. Sure, our journalist could be happy with our hack, which is great, but he will surely come back one day with more specs for customizations. That’s what usually happy customers do - they return for more stuff.\nAlthough this code smell is not that dangerous at first, it will cause havoc in the near future. The Primitive Obsession code smell is one of the simplest ones. It can be spotted in classes where primitives are used to “simulate” types. This means that instead of separating a data type for the primitives, we keep some sort of a primitive value, whether it’s a string, or a number or an array of any values. As a next step, we usually add simple names to these primitive values (see our class above), and we keep on thinking that it is very clear what these values do.\nAnother occurance of this code smell is creating a “field simulation”. This happens when we add an array of primitive values to the class, which contains some data that is used in the class logic, somewhere.\nSure, three to five values are easy to track. What happens when you get to twenty? Thirty maybe? Yeah, I have seen some classes where these primitive values are all over the place, and let me tell you, it’s no fun!\nSo, how can we avoid and/or detect this code smell? Let’s see!\nRefactoring When it comes to refactoring this code smell, you can take multiple paths. For example, if you have a large variety of these primitives, you can always look for logical links between them. Another way is, if these primitive values are used as method parameters, we could introduce a parameter objects, or we could change arrays into objects as well. There are more forms of this code smell, but let’s tackle them one by one and see the approaches to refactoring.\nLogical linking Like we saw earlier, often these primitive values have some logial link between them. Although our list of primitives is not that long, you can see the logical link between AUTHOR_NAME and AUTHOR_EMAIL, right?\nSince the logical link between these two primitives and the FinanceIO#append_author method are easily noticable, we know that these two constants and the method should be grouped in some way. Here, we can refactor the values with an object, which will be called Author:\nclass Author attr_reader :first_name, :last_name, :email def initialize(first_name = \"John\", last_name = \"Smith\", email = \"j.smith@nytimes.com\") @first_name = first_name @last_name = last_name @email = email end def full_name last_name + \" \" + first_name end end Pretty straight forward. Now, if you think about it, you can notice that the FinanceIO#append_author is basically the signature of the journalist. So, we can extract that method into our new Author class:\ndef signature %Q{ #{full_name}#{email}} end Now, having the behaviour and the values extracted to a separate class, we can refactor FinanceIO a bit:\nrequire 'stringio' class FinanceIO class MaximumLengthExceeded  StandardError; end MAX_WORDS = 10000 MIN_WORDS = 2000 CURRENCIES = [ [\"USD\", \"$\"], [\"GBP\", \"£\"], [\"JPY\", \"¥\"], [\"CHF\", \"₣\"], [\"EUR\", \"€\"], [\"INR\", \"₹\"], [\"GEN\", \"¤\"] # General currency sign ] def initialize @io = StringIO.new @author = Author.new end def puts(arg) if @io.string.split(\"\").length = MAX_WORDS || @io.string.split(\"\").length = MIN_WORDS raise TextLengthExceeded.new(\"The text must be within #{MIN_WORDS}and #{MAX_WORDS}words.\") else CURRENCIES.each do |abbrv, symbol| arg.gsub!(abbrv,symbol) end @io.puts(arg) end end def on_exit @io.puts(@author.signature) end def method_missing(method_name, *args, \u0026block) if @io.respond_to?(method_name) @io.send(method_name, *args) else super(method_name, *args, \u0026block) end end end Much cleaner, right? We have the values and the behaviour extracted to a separate class, and the Author#signature method clearly shows that the behaviour revolving the author signature should be a part of the Author class.\nNow, since the first name, last name and email are set to default parameters on the Author#initialize method, we could go a step further and extract them to a DefaultAuthor subclass:\nclass DefaultAuthor  Author def initialize super(\"John\", \"Smith\", \"j.smith@nytimes.com\") end end Having this class, we can easily customize our FinanceIO stream and use a non-default author just by tweaking the constructor by using dependency injection:\nclass FinanceIO # snipped.. def initialize(author = DefaultAuthor.new) @io = StringIO.new @author = author end # snipped.. end Replacing the array with… something meaningful When we got to this step I assume you were wondering what we will do with the CURRENCIES two-dimensional array. Well, let’s disect the array a bit and see what we are actually dealing with.\nWell, just like the array name states, we are dealing with a bunch of currencies here, ergo, we need a Currency class to encapsulate the abbreviation and the symbol:\nclass Currency attr_reader :abbreviation, :symbol def initialize(abbreviation, symbol) @abbreviation = abbreviation @symbol = symbol end end So, how can we eliminate the array from the FinanceIO class and move it somewhere else? Let’s start moving the array step by step - first, by extracting it into the Currency class. We will move the collection and we will also add a utility method Currency.all which will return a collection of all the currencies, as Currency objects:\nclass Currency DEFAULT_CURRENCIES = [ [\"USD\", \"$\"], [\"GBP\", \"£\"], [\"JPY\", \"¥\"], [\"CHF\", \"₣\"], [\"EUR\", \"€\"], [\"INR\", \"₹\"], [\"GEN\", \"¤\"] ] def self.all(currencies_list = DEFAULT_CURRENCIES) currencies_list.collect do |abbr, sym| new(abbr, sym) end end attr_reader :abbreviation, :symbol def initialize(abbreviation, symbol) @abbreviation = abbreviation @symbol = symbol end end Now, refactoring the FinanceIO#puts method should be straight forward:\ndef puts(arg) if @io.string.split(\"\").length = MAX_WORDS || @io.string.split(\"\").length = MIN_WORDS return MaximumLengthExceeded.new(\"You've reached the maximum length.\") else Currency.all.each do |currency| arg.gsub!(currency.abbreviation, currency.symbol) end @io.puts(arg) end end Sure, this could work, but we still have a bit of polution in the Currency class. What we could do, instead of keeping the currencies as a constant, we could move them to a method, or better yet, move them to a new class, with a method that would return all of them:\nclass DefaultCurrencies def self.all [ [\"USD\", \"$\"], [\"GBP\", \"£\"], [\"JPY\", \"¥\"], [\"CHF\", \"₣\"], [\"EUR\", \"€\"], [\"INR\", \"₹\"], [\"GEN\", \"¤\"] ] end end Then, adding this class as a depenency to the Currency class will be pretty easy. But also, uncoupling it will be also easy, if we decide to move these hardcoded primitive values to a database:\nclass Currency def self.all DefaultCurrencies.all.collect do |abbr, sym| new(abbr, sym) end end attr_reader :abbreviation, :symbol def initialize(abbreviation, symbol) @abbreviation = abbreviation @symbol = symbol end end With this step we have encapsulated our collection of data, and made it easy to replace in next iteration of our program. Our Currency class only depends on a class method, which would return a two-dimensional array with the currencies data. With this in place, we can come back to the FinanceIO class and polish it up.\nIntroducing a parameter object Let’s look at the state of our FinanceIO class now. The only leftovers from our refactoring are the MAX_WORDS and MIN_WORDS primitives. Their purpose is to limit the length of the text that the author can write. Let’s see how we can refactor it out of the class.\nIf you look at the FinanceIO#puts method, you can notice that these constants are used only as a parameter, to check if the length words are within the limit.\nHaving this in mind, we can extract a Parameter Object. Parameter objects are usually like containers for data that has same or similar role. Our limitation primitives are a nice example - they do not belong to the FinanceIO class, but their only purpose is to validate the input of the user. Let’s extract them out to a separate class:\nclass EditorialLimitations attr_reader :max_words, :min_words def initialize @max_words = 10000 @min_words = 2000 end def within?(text) text_length = words(text) text_length = @min_words \u0026\u0026 text_length = @max_words end private def words(txt) txt.split(\"\").length end end As you can see, by extracting this parameter object, we are even able to extract the logic which will validate the text of the journalist. Now, let’s use our newly created class in the program:\nrequire 'stringio' class FinanceIO class MaximumLengthExceeded  StandardError; end def initialize @io = StringIO.new @author = Author.new @limitations = EditorialLimitations.new end def puts(arg) if @limitations.within?(io.string) Currency.all.each do |currency| arg.gsub!(currency.abbreviation, currency.symbol) end else raise TextLengthExceeded.new(\"The text must be within #{@limitations.min_words}and #{@limitations.max_words}words.\") end @io.puts(arg) end def on_exit @io.puts(@author.signature) end def method_missing(method_name, *args, \u0026block) if @io.respond_to?(method_name) @io.send(method_name, *args) else super(method_name, *args, \u0026block) end end end As you can see, although there’s still a lot going on in the FinanceIO#puts method, it’s much easier to understand what’s going on. Also, if we would write tests around this code, testing would be much easier.\nOutro We could do more refactoring here, especially in the FinanceIO#puts method, but for the scope of this article we will stop there. I encourage you to carry on with refactoring the code, and writing some tests - practice makes it perfect, doesn’t it?\nUntil next time!\nLiked this article? Subscribe to my newsletter and get future articles in your inbox. It's a short and sweet read, going out to hundreds of other engineers.\n    ","wordCount":"2256","inLanguage":"en","datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","author":{"@type":"Person","name":"Ilija Eftimov"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://ieftimov.com/post/primitive-obsession-ruby/"},"publisher":{"@type":"Organization","name":"Ilija Eftimov ⚡️","logo":{"@type":"ImageObject","url":"https://ieftimov.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://ieftimov.com/ accesskey=h title="Ilija Eftimov ⚡️ (Alt + H)">Ilija Eftimov ⚡️</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://ieftimov.com/ title=About><span>About</span></a></li><li><a href=https://ieftimov.com/posts title=Writing><span>Writing</span></a></li><li><a href=https://www.getrevue.co/profile/itsilija title=Subscribe><span>Subscribe</span></a></li><li><a href=https://ieftimov.com/index.xml title=RSS><span>RSS</span></a></li><li><a href=https://forms.gle/orfXK5jh1LRaiFzo8 title="Suggest a topic"><span>Suggest a topic</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Refactoring in Ruby: Primitive Obsession</h1><div class=post-meta>March 8, 2016&nbsp;·&nbsp;11 min&nbsp;·&nbsp;Ilija Eftimov</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><div class=details>Table of Contents</div></summary><div class=inner><ul><li><a href=#the-problem aria-label="The problem">The problem</a></li><li><a href=#the-code-smell aria-label="The Code Smell">The Code Smell</a></li><li><a href=#refactoring aria-label=Refactoring>Refactoring</a><ul><li><a href=#logical-linking aria-label="Logical linking">Logical linking</a></li><li><a href=#replacing-the-array-with-something-meaningful aria-label="Replacing the array with&amp;hellip; something meaningful">Replacing the array with&mldr; something meaningful</a></li><li><a href=#introducing-a-parameter-object aria-label="Introducing a parameter object">Introducing a parameter object</a></li></ul></li><li><a href=#outro aria-label=Outro>Outro</a></li></ul></div></details></div><div class=post-content><p>We&rsquo;ve all been at this point where we have bloated our classes with primitive
values all over the place. Usually, we drop in primitive constants that, for
whatever reason, we think that are a good fit to the class. Or sometimes, we
just dump primitive values instead of small objects, thinking &ldquo;it&rsquo;s okay, it&rsquo;s
just an attribute in the class&rdquo;. But, does it always make sense?</p><h2 id=the-problem>The problem<a hidden class=anchor aria-hidden=true href=#the-problem>#</a></h2><p>Say we have a project for a finance journalist who wants us to automate his
text editor to do some random fixes to his texts, on the fly. The automation is
basically adding his name and date to the footer of the text that he&rsquo;s writing,
and to change currencies abbreviations to symbols. The good thing for us is
that his editor is written in Ruby, and has the ability to add custom I/O
streams to it&rsquo;s I/O stack.</p><p>So, our specification for this I/O stream, is:</p><ul><li>limit text to no more than 10000 words</li><li>append journalist name to end of article</li><li>swap popular currency names abbreviations with symbols</li></ul><p>After a bit of work, we come up with this quick hack for a I/O stream:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#b58900>require</span> <span style=color:#2aa198>&#39;stringio&#39;</span>

<span style=color:#719e07>class</span> <span style=color:#268bd2>FinanceIO</span>
  <span style=color:#719e07>class</span> <span style=color:#268bd2>MaximumLengthExceeded</span> <span style=color:#719e07>&lt;</span> <span style=color:#cb4b16>StandardError</span>; <span style=color:#719e07>end</span>

  <span style=color:#cb4b16>MAX_WORDS</span> <span style=color:#719e07>=</span> <span style=color:#2aa198>10000</span>
  <span style=color:#cb4b16>MIN_WORDS</span> <span style=color:#719e07>=</span> <span style=color:#2aa198>2000</span>
  <span style=color:#cb4b16>AUTHOR_NAME</span>  <span style=color:#719e07>=</span> <span style=color:#2aa198>&#34;John Smith&#34;</span>
  <span style=color:#cb4b16>AUTHOR_EMAIL</span> <span style=color:#719e07>=</span> <span style=color:#2aa198>&#34;j.smith@nytimes.com&#34;</span>
  <span style=color:#cb4b16>CURRENCIES</span> <span style=color:#719e07>=</span> <span style=color:#719e07>[</span>
    <span style=color:#719e07>[</span><span style=color:#2aa198>&#34;USD&#34;</span>, <span style=color:#2aa198>&#34;$&#34;</span><span style=color:#719e07>]</span>,
    <span style=color:#719e07>[</span><span style=color:#2aa198>&#34;GBP&#34;</span>, <span style=color:#2aa198>&#34;£&#34;</span><span style=color:#719e07>]</span>,
    <span style=color:#719e07>[</span><span style=color:#2aa198>&#34;JPY&#34;</span>, <span style=color:#2aa198>&#34;¥&#34;</span><span style=color:#719e07>]</span>,
    <span style=color:#719e07>[</span><span style=color:#2aa198>&#34;CHF&#34;</span>, <span style=color:#2aa198>&#34;₣&#34;</span><span style=color:#719e07>]</span>,
    <span style=color:#719e07>[</span><span style=color:#2aa198>&#34;EUR&#34;</span>, <span style=color:#2aa198>&#34;€&#34;</span><span style=color:#719e07>]</span>,
    <span style=color:#719e07>[</span><span style=color:#2aa198>&#34;INR&#34;</span>, <span style=color:#2aa198>&#34;₹&#34;</span><span style=color:#719e07>]</span>,
    <span style=color:#719e07>[</span><span style=color:#2aa198>&#34;GEN&#34;</span>, <span style=color:#2aa198>&#34;¤&#34;</span><span style=color:#719e07>]</span>  <span style=color:#586e75># General currency sign</span>
  <span style=color:#719e07>]</span>

  <span style=color:#719e07>def</span> <span style=color:#268bd2>initialize</span>
    @io <span style=color:#719e07>=</span> <span style=color:#cb4b16>StringIO</span><span style=color:#719e07>.</span>new
  <span style=color:#719e07>end</span>

  <span style=color:#719e07>def</span> <span style=color:#268bd2>puts</span>(arg)
    <span style=color:#719e07>if</span> @io<span style=color:#719e07>.</span>string<span style=color:#719e07>.</span>split(<span style=color:#2aa198>&#34;&#34;</span>)<span style=color:#719e07>.</span>length <span style=color:#719e07>&gt;=</span> <span style=color:#cb4b16>MAX_WORDS</span> <span style=color:#719e07>||</span> @io<span style=color:#719e07>.</span>string<span style=color:#719e07>.</span>split(<span style=color:#2aa198>&#34;&#34;</span>)<span style=color:#719e07>.</span>length <span style=color:#719e07>=&lt;</span> <span style=color:#cb4b16>MIN_WORDS</span>
      <span style=color:#719e07>raise</span> <span style=color:#cb4b16>TextLengthExceeded</span><span style=color:#719e07>.</span>new(<span style=color:#2aa198>&#34;The text must be within </span><span style=color:#2aa198>#{</span><span style=color:#cb4b16>MIN_WORDS</span><span style=color:#2aa198>}</span><span style=color:#2aa198> and </span><span style=color:#2aa198>#{</span><span style=color:#cb4b16>MAX_WORDS</span><span style=color:#2aa198>}</span><span style=color:#2aa198> words.&#34;</span>)
    <span style=color:#719e07>else</span>
      <span style=color:#cb4b16>CURRENCIES</span><span style=color:#719e07>.</span>each <span style=color:#719e07>do</span> <span style=color:#719e07>|</span>abbrv, symbol<span style=color:#719e07>|</span>
        arg<span style=color:#719e07>.</span>gsub!(abbrv,symbol)
      <span style=color:#719e07>end</span>
      @io<span style=color:#719e07>.</span>puts(arg)
    <span style=color:#719e07>end</span>
  <span style=color:#719e07>end</span>

  <span style=color:#719e07>def</span> <span style=color:#268bd2>on_exit</span>
    append_author
  <span style=color:#719e07>end</span>

  <span style=color:#719e07>def</span> <span style=color:#268bd2>method_missing</span>(method_name, <span style=color:#719e07>*</span>args, <span style=color:#719e07>&amp;</span>block)
    <span style=color:#719e07>if</span> @io<span style=color:#719e07>.</span>respond_to?(method_name)
      @io<span style=color:#719e07>.</span>send(method_name, <span style=color:#719e07>*</span>args)
    <span style=color:#719e07>else</span>
      <span style=color:#719e07>super</span>(method_name, <span style=color:#719e07>*</span>args, <span style=color:#719e07>&amp;</span>block)
    <span style=color:#719e07>end</span>
  <span style=color:#719e07>end</span>

  <span style=color:#719e07>private</span>

  <span style=color:#719e07>def</span> <span style=color:#268bd2>append_author</span>
    @io<span style=color:#719e07>.</span>puts(<span style=color:#2aa198>&#34;</span><span style=color:#cb4b16>\n</span><span style=color:#2aa198>&#34;</span>)
    @io<span style=color:#719e07>.</span>puts(<span style=color:#cb4b16>AUTHOR_NAME</span>)
    @io<span style=color:#719e07>.</span>puts(<span style=color:#2aa198>&#34;</span><span style=color:#cb4b16>\n</span><span style=color:#2aa198>&#34;</span>)
    @io<span style=color:#719e07>.</span>puts(<span style=color:#cb4b16>AUTHOR_EMAIL</span>)
    @io<span style=color:#719e07>.</span>puts(<span style=color:#2aa198>&#34;</span><span style=color:#cb4b16>\n</span><span style=color:#2aa198>&#34;</span>)
  <span style=color:#719e07>end</span>

<span style=color:#719e07>end</span></code></pre></div><p>The <code>FinanceIO</code> class is a wrapper around a <code>StringIO</code>, which overrides a
couple of methods, but relays any other method calls to the wrapped <code>StringIO</code>
object. This allows us to do our work easily, while not breaking when any
object of the I/O stack tries to call a built-in method on our object.</p><p>Let&rsquo;s break down the example. The <code>MAX_WORDS</code> and <code>MIN_WORDS</code> is a limitation
that our client (the journalist) has been given by the newspaper he works for,
or in other words, his articles cannot be loger than 10000 words. The
<code>AUTHOR_NAME</code> constant is the name of our author. We don&rsquo;t need to enable
customization for this piece of data, because our client wanted to make our
life easier by agreeing that he will not change his name any time soon. The
<code>AUTHOR_EMAIL</code> constant is the author public email address. Next, the
<code>CURRENCIES</code> constant is a two-dimensional array which contains the
abbreviations and the symbols of the most popular currencies that the
journalist uses while writing his finance articles.</p><p>Most of the functionality described in the spec is done within the
<code>FinanceIO#puts</code> method:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#719e07>def</span> <span style=color:#268bd2>puts</span>(arg)
  <span style=color:#719e07>if</span> @io<span style=color:#719e07>.</span>string<span style=color:#719e07>.</span>split(<span style=color:#2aa198>&#34;&#34;</span>)<span style=color:#719e07>.</span>length <span style=color:#719e07>&gt;=</span> <span style=color:#cb4b16>MAX_WORDS</span> <span style=color:#719e07>||</span> @io<span style=color:#719e07>.</span>string<span style=color:#719e07>.</span>split(<span style=color:#2aa198>&#34;&#34;</span>)<span style=color:#719e07>.</span>length <span style=color:#719e07>=&lt;</span> <span style=color:#cb4b16>MIN_WORDS</span>
    <span style=color:#719e07>raise</span> <span style=color:#cb4b16>TextLengthExceeded</span><span style=color:#719e07>.</span>new(<span style=color:#2aa198>&#34;The text must be within </span><span style=color:#2aa198>#{</span>@limitations<span style=color:#719e07>.</span>min_words<span style=color:#2aa198>}</span><span style=color:#2aa198> and </span><span style=color:#2aa198>#{</span>@limitations<span style=color:#719e07>.</span>max_words<span style=color:#2aa198>}</span><span style=color:#2aa198> words.&#34;</span>)
  <span style=color:#719e07>else</span>
    <span style=color:#cb4b16>CURRENCIES</span><span style=color:#719e07>.</span>each <span style=color:#719e07>do</span> <span style=color:#719e07>|</span>abbrv, symbol<span style=color:#719e07>|</span>
      arg<span style=color:#719e07>.</span>gsub!(abbrv,symbol)
    <span style=color:#719e07>end</span>
    @io<span style=color:#719e07>.</span>puts(arg)
  <span style=color:#719e07>end</span>
<span style=color:#719e07>end</span></code></pre></div><p>The <code>puts</code> method takes a string as an argument, and saves it to the stream.
But, before it does that, it checks if the text is longer than 10000 words. If
it is, it will raise an exception that the text editor will handle gracefully.
If not, it will carry on to substitute any of the currency abbreviations in the
text with the corresponding symbol.</p><p>Also, the <code>FinanceIO#on_exit</code> is a method which will append the author name
in the footer of the text.</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#719e07>def</span> <span style=color:#268bd2>on_exit</span>
  append_author
<span style=color:#719e07>end</span></code></pre></div><p>This will get automatically invoked by the editor, as an callback before the
journalist closes his editor.</p><p>This will surely work, and it complies with our imaginary text editor. Sure, it
might be a bit dirty, but it does the trick. Now, a question to ourselves -
what should we do about the data in the constants? There seems to be much
behaviour in connection with these constants. Aside of that, it&rsquo;s just plain
data and it doesn&rsquo;t really add too much noise to our class and the
functionality is easy to follow&mldr; right?</p><h2 id=the-code-smell>The Code Smell<a hidden class=anchor aria-hidden=true href=#the-code-smell>#</a></h2><p>Well, sure, the fields don&rsquo;t do much noise, but this is exactly the way of
thinking that creates these code smells. You could argue that the <code>FinanceIO</code>
class is pretty simple to follow, and you would be right. The problem lies in
the practice, which will eventually bloat the class with so much &ldquo;static&rdquo; data,
to a point of total confusion. Sure, our journalist could be happy with our
hack, which is great, but he will surely come back one day with more specs for
customizations. That&rsquo;s what usually happy customers do - they return for more
stuff.</p><p>Although this code smell is not that dangerous at first, it <strong>will</strong> cause
havoc in the near future. The <strong>Primitive Obsession</strong> code smell is one of the
simplest ones. It can be spotted in classes where primitives are used to
&ldquo;simulate&rdquo; types. This means that instead of separating a data type for the
primitives, we keep some sort of a primitive value, whether it&rsquo;s a string, or a
number or an array of any values. As a next step, we usually add simple names
to these primitive values (see our class above), and we keep on thinking that
it is very clear what these values do.</p><p>Another occurance of this code smell is creating a &ldquo;field simulation&rdquo;. This
happens when we add an array of primitive values to the class, which contains
some data that is used in the class logic, somewhere.</p><p>Sure, three to five values are easy to track. What happens when you get to
twenty? Thirty maybe? Yeah, I have seen some classes where these primitive
values are all over the place, and let me tell you, it&rsquo;s no fun!</p><p>So, how can we avoid and/or detect this code smell? Let&rsquo;s see!</p><h2 id=refactoring>Refactoring<a hidden class=anchor aria-hidden=true href=#refactoring>#</a></h2><p>When it comes to refactoring this code smell, you can take multiple paths. For
example, if you have a large variety of these primitives, you can always look
for logical links between them. Another way is, if these primitive values are
used as method parameters, we could introduce a parameter objects, or we could
change arrays into objects as well. There are more forms of this code smell,
but let&rsquo;s tackle them one by one and see the approaches to refactoring.</p><h3 id=logical-linking>Logical linking<a hidden class=anchor aria-hidden=true href=#logical-linking>#</a></h3><p>Like we saw earlier, often these primitive values have some logial link between
them. Although our list of primitives is not that long, you can see the logical
link between <code>AUTHOR_NAME</code> and <code>AUTHOR_EMAIL</code>, right?</p><p>Since the logical link between these two primitives and the
<code>FinanceIO#append_author</code> method are easily noticable, we know that these two
constants and the method should be grouped in some way. Here, we can refactor
the values with an object, which will be called <code>Author</code>:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#719e07>class</span> <span style=color:#268bd2>Author</span>
  <span style=color:#719e07>attr_reader</span> <span style=color:#2aa198>:first_name</span>, <span style=color:#2aa198>:last_name</span>, <span style=color:#2aa198>:email</span>
  <span style=color:#719e07>def</span> <span style=color:#268bd2>initialize</span>(first_name <span style=color:#719e07>=</span> <span style=color:#2aa198>&#34;John&#34;</span>, last_name <span style=color:#719e07>=</span> <span style=color:#2aa198>&#34;Smith&#34;</span>, email <span style=color:#719e07>=</span> <span style=color:#2aa198>&#34;j.smith@nytimes.com&#34;</span>)
    @first_name <span style=color:#719e07>=</span> first_name
    @last_name <span style=color:#719e07>=</span> last_name
    @email   <span style=color:#719e07>=</span> email
  <span style=color:#719e07>end</span>

  <span style=color:#719e07>def</span> <span style=color:#268bd2>full_name</span>
    last_name <span style=color:#719e07>+</span> <span style=color:#2aa198>&#34; &#34;</span> <span style=color:#719e07>+</span> first_name
  <span style=color:#719e07>end</span>
<span style=color:#719e07>end</span></code></pre></div><p>Pretty straight forward. Now, if you think about it, you can notice that the
<code>FinanceIO#append_author</code> is basically the signature of the journalist. So, we
can extract that method into our new <code>Author</code> class:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#719e07>def</span> <span style=color:#268bd2>signature</span>
<span style=color:#2aa198>%Q{
</span><span style=color:#2aa198>  </span><span style=color:#2aa198>#{</span>full_name<span style=color:#2aa198>}</span><span style=color:#2aa198>
</span><span style=color:#2aa198>
</span><span style=color:#2aa198>  </span><span style=color:#2aa198>#{</span>email<span style=color:#2aa198>}</span><span style=color:#2aa198>
</span><span style=color:#2aa198>}</span>
<span style=color:#719e07>end</span></code></pre></div><p>Now, having the behaviour and the values extracted to a separate class, we can
refactor <code>FinanceIO</code> a bit:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#b58900>require</span> <span style=color:#2aa198>&#39;stringio&#39;</span>

<span style=color:#719e07>class</span> <span style=color:#268bd2>FinanceIO</span>
  <span style=color:#719e07>class</span> <span style=color:#268bd2>MaximumLengthExceeded</span> <span style=color:#719e07>&lt;</span> <span style=color:#cb4b16>StandardError</span>; <span style=color:#719e07>end</span>

  <span style=color:#cb4b16>MAX_WORDS</span> <span style=color:#719e07>=</span> <span style=color:#2aa198>10000</span>
  <span style=color:#cb4b16>MIN_WORDS</span> <span style=color:#719e07>=</span> <span style=color:#2aa198>2000</span>
  <span style=color:#cb4b16>CURRENCIES</span> <span style=color:#719e07>=</span> <span style=color:#719e07>[</span>
    <span style=color:#719e07>[</span><span style=color:#2aa198>&#34;USD&#34;</span>, <span style=color:#2aa198>&#34;$&#34;</span><span style=color:#719e07>]</span>,
    <span style=color:#719e07>[</span><span style=color:#2aa198>&#34;GBP&#34;</span>, <span style=color:#2aa198>&#34;£&#34;</span><span style=color:#719e07>]</span>,
    <span style=color:#719e07>[</span><span style=color:#2aa198>&#34;JPY&#34;</span>, <span style=color:#2aa198>&#34;¥&#34;</span><span style=color:#719e07>]</span>,
    <span style=color:#719e07>[</span><span style=color:#2aa198>&#34;CHF&#34;</span>, <span style=color:#2aa198>&#34;₣&#34;</span><span style=color:#719e07>]</span>,
    <span style=color:#719e07>[</span><span style=color:#2aa198>&#34;EUR&#34;</span>, <span style=color:#2aa198>&#34;€&#34;</span><span style=color:#719e07>]</span>,
    <span style=color:#719e07>[</span><span style=color:#2aa198>&#34;INR&#34;</span>, <span style=color:#2aa198>&#34;₹&#34;</span><span style=color:#719e07>]</span>,
    <span style=color:#719e07>[</span><span style=color:#2aa198>&#34;GEN&#34;</span>, <span style=color:#2aa198>&#34;¤&#34;</span><span style=color:#719e07>]</span>  <span style=color:#586e75># General currency sign</span>
  <span style=color:#719e07>]</span>

  <span style=color:#719e07>def</span> <span style=color:#268bd2>initialize</span>
    @io <span style=color:#719e07>=</span> <span style=color:#cb4b16>StringIO</span><span style=color:#719e07>.</span>new
    @author <span style=color:#719e07>=</span> <span style=color:#cb4b16>Author</span><span style=color:#719e07>.</span>new
  <span style=color:#719e07>end</span>

  <span style=color:#719e07>def</span> <span style=color:#268bd2>puts</span>(arg)
    <span style=color:#719e07>if</span> @io<span style=color:#719e07>.</span>string<span style=color:#719e07>.</span>split(<span style=color:#2aa198>&#34;&#34;</span>)<span style=color:#719e07>.</span>length <span style=color:#719e07>&gt;=</span> <span style=color:#cb4b16>MAX_WORDS</span> <span style=color:#719e07>||</span> @io<span style=color:#719e07>.</span>string<span style=color:#719e07>.</span>split(<span style=color:#2aa198>&#34;&#34;</span>)<span style=color:#719e07>.</span>length <span style=color:#719e07>=&lt;</span> <span style=color:#cb4b16>MIN_WORDS</span>
      <span style=color:#719e07>raise</span> <span style=color:#cb4b16>TextLengthExceeded</span><span style=color:#719e07>.</span>new(<span style=color:#2aa198>&#34;The text must be within </span><span style=color:#2aa198>#{</span><span style=color:#cb4b16>MIN_WORDS</span><span style=color:#2aa198>}</span><span style=color:#2aa198> and </span><span style=color:#2aa198>#{</span><span style=color:#cb4b16>MAX_WORDS</span><span style=color:#2aa198>}</span><span style=color:#2aa198> words.&#34;</span>)
    <span style=color:#719e07>else</span>
      <span style=color:#cb4b16>CURRENCIES</span><span style=color:#719e07>.</span>each <span style=color:#719e07>do</span> <span style=color:#719e07>|</span>abbrv, symbol<span style=color:#719e07>|</span>
        arg<span style=color:#719e07>.</span>gsub!(abbrv,symbol)
      <span style=color:#719e07>end</span>
      @io<span style=color:#719e07>.</span>puts(arg)
    <span style=color:#719e07>end</span>
  <span style=color:#719e07>end</span>

  <span style=color:#719e07>def</span> <span style=color:#268bd2>on_exit</span>
    @io<span style=color:#719e07>.</span>puts(@author<span style=color:#719e07>.</span>signature)
  <span style=color:#719e07>end</span>

  <span style=color:#719e07>def</span> <span style=color:#268bd2>method_missing</span>(method_name, <span style=color:#719e07>*</span>args, <span style=color:#719e07>&amp;</span>block)
    <span style=color:#719e07>if</span> @io<span style=color:#719e07>.</span>respond_to?(method_name)
      @io<span style=color:#719e07>.</span>send(method_name, <span style=color:#719e07>*</span>args)
    <span style=color:#719e07>else</span>
      <span style=color:#719e07>super</span>(method_name, <span style=color:#719e07>*</span>args, <span style=color:#719e07>&amp;</span>block)
    <span style=color:#719e07>end</span>
  <span style=color:#719e07>end</span>

<span style=color:#719e07>end</span></code></pre></div><p>Much cleaner, right? We have the values and the behaviour extracted to a
separate class, and the <code>Author#signature</code> method clearly shows that the
behaviour revolving the author signature should be a part of the <code>Author</code>
class.</p><p>Now, since the first name, last name and email are set to default parameters on
the <code>Author#initialize</code> method, we could go a step further and extract them to
a <code>DefaultAuthor</code> subclass:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#719e07>class</span> <span style=color:#268bd2>DefaultAuthor</span> <span style=color:#719e07>&lt;</span> <span style=color:#cb4b16>Author</span>
  <span style=color:#719e07>def</span> <span style=color:#268bd2>initialize</span>
    <span style=color:#719e07>super</span>(<span style=color:#2aa198>&#34;John&#34;</span>, <span style=color:#2aa198>&#34;Smith&#34;</span>, <span style=color:#2aa198>&#34;j.smith@nytimes.com&#34;</span>)
  <span style=color:#719e07>end</span>
<span style=color:#719e07>end</span></code></pre></div><p>Having this class, we can easily customize our <code>FinanceIO</code> stream and use a
non-default author just by tweaking the constructor by using dependency
injection:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#719e07>class</span> <span style=color:#268bd2>FinanceIO</span>
  <span style=color:#586e75># snipped..</span>

  <span style=color:#719e07>def</span> <span style=color:#268bd2>initialize</span>(author <span style=color:#719e07>=</span> <span style=color:#cb4b16>DefaultAuthor</span><span style=color:#719e07>.</span>new)
    @io     <span style=color:#719e07>=</span> <span style=color:#cb4b16>StringIO</span><span style=color:#719e07>.</span>new
    @author <span style=color:#719e07>=</span> author
  <span style=color:#719e07>end</span>

  <span style=color:#586e75># snipped..</span>
<span style=color:#719e07>end</span></code></pre></div><h3 id=replacing-the-array-with-something-meaningful>Replacing the array with&mldr; something meaningful<a hidden class=anchor aria-hidden=true href=#replacing-the-array-with-something-meaningful>#</a></h3><p>When we got to this step I assume you were wondering what we will do with the
<code>CURRENCIES</code> two-dimensional array. Well, let&rsquo;s disect the array a bit and see
what we are actually dealing with.</p><p>Well, just like the array name states, we are dealing with a bunch of
currencies here, ergo, we need a <code>Currency</code> class to encapsulate the
abbreviation and the symbol:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#719e07>class</span> <span style=color:#268bd2>Currency</span>
  <span style=color:#719e07>attr_reader</span> <span style=color:#2aa198>:abbreviation</span>, <span style=color:#2aa198>:symbol</span>
  <span style=color:#719e07>def</span> <span style=color:#268bd2>initialize</span>(abbreviation, symbol)
    @abbreviation <span style=color:#719e07>=</span> abbreviation
    @symbol       <span style=color:#719e07>=</span> symbol
  <span style=color:#719e07>end</span>
<span style=color:#719e07>end</span></code></pre></div><p>So, how can we eliminate the array from the <code>FinanceIO</code> class and move it
somewhere else? Let&rsquo;s start moving the array step by step - first, by
extracting it into the <code>Currency</code> class. We will move the collection and we
will also add a utility method <code>Currency.all</code> which will return a collection of
all the currencies, as <code>Currency</code> objects:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#719e07>class</span> <span style=color:#268bd2>Currency</span>
  <span style=color:#cb4b16>DEFAULT_CURRENCIES</span> <span style=color:#719e07>=</span> <span style=color:#719e07>[</span>
    <span style=color:#719e07>[</span><span style=color:#2aa198>&#34;USD&#34;</span>, <span style=color:#2aa198>&#34;$&#34;</span><span style=color:#719e07>]</span>,
    <span style=color:#719e07>[</span><span style=color:#2aa198>&#34;GBP&#34;</span>, <span style=color:#2aa198>&#34;£&#34;</span><span style=color:#719e07>]</span>,
    <span style=color:#719e07>[</span><span style=color:#2aa198>&#34;JPY&#34;</span>, <span style=color:#2aa198>&#34;¥&#34;</span><span style=color:#719e07>]</span>,
    <span style=color:#719e07>[</span><span style=color:#2aa198>&#34;CHF&#34;</span>, <span style=color:#2aa198>&#34;₣&#34;</span><span style=color:#719e07>]</span>,
    <span style=color:#719e07>[</span><span style=color:#2aa198>&#34;EUR&#34;</span>, <span style=color:#2aa198>&#34;€&#34;</span><span style=color:#719e07>]</span>,
    <span style=color:#719e07>[</span><span style=color:#2aa198>&#34;INR&#34;</span>, <span style=color:#2aa198>&#34;₹&#34;</span><span style=color:#719e07>]</span>,
    <span style=color:#719e07>[</span><span style=color:#2aa198>&#34;GEN&#34;</span>, <span style=color:#2aa198>&#34;¤&#34;</span><span style=color:#719e07>]</span>
  <span style=color:#719e07>]</span>

  <span style=color:#719e07>def</span> <span style=color:#268bd2>self</span><span style=color:#719e07>.</span><span style=color:#268bd2>all</span>(currencies_list <span style=color:#719e07>=</span> <span style=color:#cb4b16>DEFAULT_CURRENCIES</span>)
    currencies_list<span style=color:#719e07>.</span>collect <span style=color:#719e07>do</span> <span style=color:#719e07>|</span>abbr, sym<span style=color:#719e07>|</span>
      <span style=color:#719e07>new</span>(abbr, sym)
    <span style=color:#719e07>end</span>
  <span style=color:#719e07>end</span>

  <span style=color:#719e07>attr_reader</span> <span style=color:#2aa198>:abbreviation</span>, <span style=color:#2aa198>:symbol</span>
  <span style=color:#719e07>def</span> <span style=color:#268bd2>initialize</span>(abbreviation, symbol)
    @abbreviation <span style=color:#719e07>=</span> abbreviation
    @symbol       <span style=color:#719e07>=</span> symbol
  <span style=color:#719e07>end</span>
<span style=color:#719e07>end</span></code></pre></div><p>Now, refactoring the <code>FinanceIO#puts</code> method should be straight forward:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#719e07>def</span> <span style=color:#268bd2>puts</span>(arg)
  <span style=color:#719e07>if</span> @io<span style=color:#719e07>.</span>string<span style=color:#719e07>.</span>split(<span style=color:#2aa198>&#34;&#34;</span>)<span style=color:#719e07>.</span>length <span style=color:#719e07>&gt;=</span> <span style=color:#cb4b16>MAX_WORDS</span> <span style=color:#719e07>||</span> @io<span style=color:#719e07>.</span>string<span style=color:#719e07>.</span>split(<span style=color:#2aa198>&#34;&#34;</span>)<span style=color:#719e07>.</span>length <span style=color:#719e07>=&lt;</span> <span style=color:#cb4b16>MIN_WORDS</span>
    <span style=color:#719e07>return</span> <span style=color:#cb4b16>MaximumLengthExceeded</span><span style=color:#719e07>.</span>new(<span style=color:#2aa198>&#34;You&#39;ve reached the maximum length.&#34;</span>)
  <span style=color:#719e07>else</span>
    <span style=color:#cb4b16>Currency</span><span style=color:#719e07>.</span>all<span style=color:#719e07>.</span>each <span style=color:#719e07>do</span> <span style=color:#719e07>|</span>currency<span style=color:#719e07>|</span>
      arg<span style=color:#719e07>.</span>gsub!(currency<span style=color:#719e07>.</span>abbreviation, currency<span style=color:#719e07>.</span>symbol)
    <span style=color:#719e07>end</span>
    @io<span style=color:#719e07>.</span>puts(arg)
  <span style=color:#719e07>end</span>
<span style=color:#719e07>end</span></code></pre></div><p>Sure, this could work, but we still have a bit of polution in the <code>Currency</code>
class. What we could do, instead of keeping the currencies as a constant, we
could move them to a method, or better yet, move them to a new class, with a
method that would return all of them:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#719e07>class</span> <span style=color:#268bd2>DefaultCurrencies</span>
  <span style=color:#719e07>def</span> <span style=color:#268bd2>self</span><span style=color:#719e07>.</span><span style=color:#268bd2>all</span>
    <span style=color:#719e07>[</span>
      <span style=color:#719e07>[</span><span style=color:#2aa198>&#34;USD&#34;</span>, <span style=color:#2aa198>&#34;$&#34;</span><span style=color:#719e07>]</span>,
      <span style=color:#719e07>[</span><span style=color:#2aa198>&#34;GBP&#34;</span>, <span style=color:#2aa198>&#34;£&#34;</span><span style=color:#719e07>]</span>,
      <span style=color:#719e07>[</span><span style=color:#2aa198>&#34;JPY&#34;</span>, <span style=color:#2aa198>&#34;¥&#34;</span><span style=color:#719e07>]</span>,
      <span style=color:#719e07>[</span><span style=color:#2aa198>&#34;CHF&#34;</span>, <span style=color:#2aa198>&#34;₣&#34;</span><span style=color:#719e07>]</span>,
      <span style=color:#719e07>[</span><span style=color:#2aa198>&#34;EUR&#34;</span>, <span style=color:#2aa198>&#34;€&#34;</span><span style=color:#719e07>]</span>,
      <span style=color:#719e07>[</span><span style=color:#2aa198>&#34;INR&#34;</span>, <span style=color:#2aa198>&#34;₹&#34;</span><span style=color:#719e07>]</span>,
      <span style=color:#719e07>[</span><span style=color:#2aa198>&#34;GEN&#34;</span>, <span style=color:#2aa198>&#34;¤&#34;</span><span style=color:#719e07>]</span>
    <span style=color:#719e07>]</span>
  <span style=color:#719e07>end</span>
<span style=color:#719e07>end</span></code></pre></div><p>Then, adding this class as a depenency to the <code>Currency</code> class will be pretty
easy. But also, <strong>uncoupling</strong> it will be also easy, if we decide to move these
hardcoded primitive values to a database:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#719e07>class</span> <span style=color:#268bd2>Currency</span>
  <span style=color:#719e07>def</span> <span style=color:#268bd2>self</span><span style=color:#719e07>.</span><span style=color:#268bd2>all</span>
    <span style=color:#cb4b16>DefaultCurrencies</span><span style=color:#719e07>.</span>all<span style=color:#719e07>.</span>collect <span style=color:#719e07>do</span> <span style=color:#719e07>|</span>abbr, sym<span style=color:#719e07>|</span>
      <span style=color:#719e07>new</span>(abbr, sym)
    <span style=color:#719e07>end</span>
  <span style=color:#719e07>end</span>

  <span style=color:#719e07>attr_reader</span> <span style=color:#2aa198>:abbreviation</span>, <span style=color:#2aa198>:symbol</span>
  <span style=color:#719e07>def</span> <span style=color:#268bd2>initialize</span>(abbreviation, symbol)
    @abbreviation <span style=color:#719e07>=</span> abbreviation
    @symbol       <span style=color:#719e07>=</span> symbol
  <span style=color:#719e07>end</span>
<span style=color:#719e07>end</span></code></pre></div><p>With this step we have encapsulated our collection of data, and made it easy to
replace in next iteration of our program. Our <code>Currency</code> class only depends on
a class method, which would return a two-dimensional array with the currencies
data. With this in place, we can come back to the <code>FinanceIO</code> class and polish
it up.</p><h3 id=introducing-a-parameter-object>Introducing a parameter object<a hidden class=anchor aria-hidden=true href=#introducing-a-parameter-object>#</a></h3><p>Let&rsquo;s look at the state of our <code>FinanceIO</code> class now. The only leftovers from
our refactoring are the <code>MAX_WORDS</code> and <code>MIN_WORDS</code> primitives. Their purpose
is to limit the length of the text that the author can write. Let&rsquo;s see how we
can refactor it out of the class.</p><p>If you look at the <code>FinanceIO#puts</code> method, you can notice that these constants
are used only as a parameter, to check if the length words are within the
limit.</p><p>Having this in mind, we can extract a <strong>Parameter Object</strong>. Parameter objects
are usually like containers for data that has same or similar role. Our
limitation primitives are a nice example - they do not belong to the
<code>FinanceIO</code> class, but their only purpose is to validate the input of the user.
Let&rsquo;s extract them out to a separate class:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#719e07>class</span> <span style=color:#268bd2>EditorialLimitations</span>
  <span style=color:#719e07>attr_reader</span> <span style=color:#2aa198>:max_words</span>, <span style=color:#2aa198>:min_words</span>
  <span style=color:#719e07>def</span> <span style=color:#268bd2>initialize</span>
    @max_words <span style=color:#719e07>=</span> <span style=color:#2aa198>10000</span>
    @min_words <span style=color:#719e07>=</span> <span style=color:#2aa198>2000</span>
  <span style=color:#719e07>end</span>

  <span style=color:#719e07>def</span> <span style=color:#268bd2>within?</span>(text)
    text_length <span style=color:#719e07>=</span> words(text)
    text_length <span style=color:#719e07>&gt;=</span> @min_words <span style=color:#719e07>&amp;&amp;</span> text_length <span style=color:#719e07>=&lt;</span> @max_words
  <span style=color:#719e07>end</span>

  <span style=color:#719e07>private</span>

  <span style=color:#719e07>def</span> <span style=color:#268bd2>words</span>(txt)
    txt<span style=color:#719e07>.</span>split(<span style=color:#2aa198>&#34;&#34;</span>)<span style=color:#719e07>.</span>length
  <span style=color:#719e07>end</span>
<span style=color:#719e07>end</span></code></pre></div><p>As you can see, by extracting this parameter object, we are even able to
extract the logic which will validate the text of the journalist. Now, let&rsquo;s
use our newly created class in the program:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#b58900>require</span> <span style=color:#2aa198>&#39;stringio&#39;</span>

<span style=color:#719e07>class</span> <span style=color:#268bd2>FinanceIO</span>
  <span style=color:#719e07>class</span> <span style=color:#268bd2>MaximumLengthExceeded</span> <span style=color:#719e07>&lt;</span> <span style=color:#cb4b16>StandardError</span>; <span style=color:#719e07>end</span>

  <span style=color:#719e07>def</span> <span style=color:#268bd2>initialize</span>
    @io          <span style=color:#719e07>=</span> <span style=color:#cb4b16>StringIO</span><span style=color:#719e07>.</span>new
    @author      <span style=color:#719e07>=</span> <span style=color:#cb4b16>Author</span><span style=color:#719e07>.</span>new
    @limitations <span style=color:#719e07>=</span> <span style=color:#cb4b16>EditorialLimitations</span><span style=color:#719e07>.</span>new
  <span style=color:#719e07>end</span>

  <span style=color:#719e07>def</span> <span style=color:#268bd2>puts</span>(arg)
    <span style=color:#719e07>if</span> @limitations<span style=color:#719e07>.</span>within?(io<span style=color:#719e07>.</span>string)
      <span style=color:#cb4b16>Currency</span><span style=color:#719e07>.</span>all<span style=color:#719e07>.</span>each <span style=color:#719e07>do</span> <span style=color:#719e07>|</span>currency<span style=color:#719e07>|</span>
        arg<span style=color:#719e07>.</span>gsub!(currency<span style=color:#719e07>.</span>abbreviation, currency<span style=color:#719e07>.</span>symbol)
      <span style=color:#719e07>end</span>
    <span style=color:#719e07>else</span>
      <span style=color:#719e07>raise</span> <span style=color:#cb4b16>TextLengthExceeded</span><span style=color:#719e07>.</span>new(<span style=color:#2aa198>&#34;The text must be within </span><span style=color:#2aa198>#{</span>@limitations<span style=color:#719e07>.</span>min_words<span style=color:#2aa198>}</span><span style=color:#2aa198> and </span><span style=color:#2aa198>#{</span>@limitations<span style=color:#719e07>.</span>max_words<span style=color:#2aa198>}</span><span style=color:#2aa198> words.&#34;</span>)
    <span style=color:#719e07>end</span>
    @io<span style=color:#719e07>.</span>puts(arg)
  <span style=color:#719e07>end</span>

  <span style=color:#719e07>def</span> <span style=color:#268bd2>on_exit</span>
    @io<span style=color:#719e07>.</span>puts(@author<span style=color:#719e07>.</span>signature)
  <span style=color:#719e07>end</span>

  <span style=color:#719e07>def</span> <span style=color:#268bd2>method_missing</span>(method_name, <span style=color:#719e07>*</span>args, <span style=color:#719e07>&amp;</span>block)
    <span style=color:#719e07>if</span> @io<span style=color:#719e07>.</span>respond_to?(method_name)
      @io<span style=color:#719e07>.</span>send(method_name, <span style=color:#719e07>*</span>args)
    <span style=color:#719e07>else</span>
      <span style=color:#719e07>super</span>(method_name, <span style=color:#719e07>*</span>args, <span style=color:#719e07>&amp;</span>block)
    <span style=color:#719e07>end</span>
  <span style=color:#719e07>end</span>

<span style=color:#719e07>end</span></code></pre></div><p>As you can see, although there&rsquo;s still a lot going on in the <code>FinanceIO#puts</code>
method, it&rsquo;s much easier to understand what&rsquo;s going on. Also, if we would write
tests around this code, testing would be much easier.</p><h2 id=outro>Outro<a hidden class=anchor aria-hidden=true href=#outro>#</a></h2><p>We could do more refactoring here, especially in the <code>FinanceIO#puts</code> method,
but for the scope of this article we will stop there. I encourage you to carry
on with refactoring the code, and writing some tests - practice makes it
perfect, doesn&rsquo;t it?</p><p>Until next time!</p><div id=revue-embed><form action=https://www.getrevue.co/profile/itsilija/add_subscriber method=post id=revue-form name=revue-form target=_blank><p><b>Liked this article?</b>
Subscribe to my newsletter and get future articles in your inbox. It's a
short and sweet read, going out to hundreds of other engineers.</p><div class=revue-form-group><input class=revue-form-field placeholder="Your email address..." type=email name=member[email] id=member_email></div><div class=revue-form-actions><input type=submit value=Subscribe name=member[subscribe] id=member_submit></div></form></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://ieftimov.com/tags/primitive-obsession/>primitive obsession</a></li></ul><nav class=paginav><a class=prev href=https://ieftimov.com/post/you-cant-rescue-them-all/><span class=title>« Prev Page</span><br><span>You Can't Rescue Them All</span></a>
<a class=next href=https://ieftimov.com/post/postgresql-indexes-btree/><span class=title>Next Page »</span><br><span>PostgreSQL Indexes: B-Tree</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Refactoring in Ruby: Primitive Obsession on twitter" href="https://twitter.com/intent/tweet/?text=Refactoring%20in%20Ruby%3a%20Primitive%20Obsession&url=https%3a%2f%2fieftimov.com%2fpost%2fprimitive-obsession-ruby%2f&hashtags=primitiveobsession"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Refactoring in Ruby: Primitive Obsession on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fieftimov.com%2fpost%2fprimitive-obsession-ruby%2f&title=Refactoring%20in%20Ruby%3a%20Primitive%20Obsession&summary=Refactoring%20in%20Ruby%3a%20Primitive%20Obsession&source=https%3a%2f%2fieftimov.com%2fpost%2fprimitive-obsession-ruby%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Refactoring in Ruby: Primitive Obsession on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fieftimov.com%2fpost%2fprimitive-obsession-ruby%2f&title=Refactoring%20in%20Ruby%3a%20Primitive%20Obsession"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Refactoring in Ruby: Primitive Obsession on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fieftimov.com%2fpost%2fprimitive-obsession-ruby%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Refactoring in Ruby: Primitive Obsession on whatsapp" href="https://api.whatsapp.com/send?text=Refactoring%20in%20Ruby%3a%20Primitive%20Obsession%20-%20https%3a%2f%2fieftimov.com%2fpost%2fprimitive-obsession-ruby%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Refactoring in Ruby: Primitive Obsession on telegram" href="https://telegram.me/share/url?text=Refactoring%20in%20Ruby%3a%20Primitive%20Obsession&url=https%3a%2f%2fieftimov.com%2fpost%2fprimitive-obsession-ruby%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>Copyright 2022 © Ilija Eftimov</span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>let menu=document.getElementById('menu');menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script></body></html>