<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>TDD Patterns: Humble Object | Ilija Eftimov ⚡️</title><meta name=keywords content="patterns,humble,object"><meta name=description content="We all know that there are different design patterns. They are all quite trivial to learn, but, the trick lies in applying them. When should we use this or that pattern and will that help in making our code better and cleaner. Well, tests are code as well and, you guessed it, there are some testing patterns that are around for a while.
Today, we will take a look at one of them."><meta name=author content="Ilija Eftimov"><link rel=canonical href=https://ieftimov.com/post/tdd-humble-object/><link crossorigin=anonymous href=/assets/css/stylesheet.min.css rel="preload stylesheet" as=style><link rel=icon href=https://ieftimov.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://ieftimov.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://ieftimov.com/favicon-32x32.png><link rel=apple-touch-icon href=https://ieftimov.com/apple-touch-icon.png><link rel=mask-icon href=https://ieftimov.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.83.1"><script async defer data-domain=ieftimov.com src=https://plausible.io/js/plausible.js></script><link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel=stylesheet><meta property="og:title" content="TDD Patterns: Humble Object"><meta property="og:description" content="We all know that there are different design patterns. They are all quite trivial to learn, but, the trick lies in applying them. When should we use this or that pattern and will that help in making our code better and cleaner. Well, tests are code as well and, you guessed it, there are some testing patterns that are around for a while.
Today, we will take a look at one of them."><meta property="og:type" content="article"><meta property="og:url" content="https://ieftimov.com/post/tdd-humble-object/"><meta property="article:section" content="posts"><meta name=twitter:card content="summary"><meta name=twitter:title content="TDD Patterns: Humble Object"><meta name=twitter:description content="We all know that there are different design patterns. They are all quite trivial to learn, but, the trick lies in applying them. When should we use this or that pattern and will that help in making our code better and cleaner. Well, tests are code as well and, you guessed it, there are some testing patterns that are around for a while.
Today, we will take a look at one of them."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://ieftimov.com/posts/"},{"@type":"ListItem","position":2,"name":"TDD Patterns: Humble Object","item":"https://ieftimov.com/post/tdd-humble-object/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"TDD Patterns: Humble Object","name":"TDD Patterns: Humble Object","description":"We all know that there are different design patterns. They are all quite trivial to learn, but, the trick lies in applying them. When should we use this or that pattern and will that help in making our code better and cleaner. Well, tests are code as well and, you guessed it, there are some testing patterns that are around for a while.\nToday, we will take a look at one of them.","keywords":["patterns","humble","object"],"articleBody":"We all know that there are different design patterns. They are all quite trivial to learn, but, the trick lies in applying them. When should we use this or that pattern and will that help in making our code better and cleaner. Well, tests are code as well and, you guessed it, there are some testing patterns that are around for a while.\nToday, we will take a look at one of them. It is a useful one and also it has an interesting name - the Humble Object Pattern.\nThe problem Think about this. You are building an API client/wrapper. You read the documentation, you understand the model and the intent of the API and how everything is composed. You start writing your code, keeping it in small chunks (i.e. classes). You are a responsible programmer, you want to have your code well documented and tested. All of this is nice. And then, you get to this part where you start mocking your HTTP calls and stuff easily gets messy.\nHow can we avoid this? Is there a better way?\nHumble Object Let us take a detour. A bit of history first. I think that Uncle Bob has a really good definition of the Humble Object pattern in Episode 23 of his Clean Code videos:\nIn case you find the definition confusing, let’s tear it apart. First, the boundaries. When one says boundaries, it means that the person is referring to the part of the system that communicates with other software that is not written by you, but your software is dependent on it. For example, let’s say your software creates cron jobs. The boundary lies beween the software that will call the cronjob system command and the operating system.\nSo, this means when using the Humble Object pattern, we extract as much logic as we can from the boundary class(es), thus making them humble. The extracted logic will be moved to another class, which will be easily testable. On the other hand, the humble code will be dependant on the extracted class, but testing it won’t be necessary, because it doesn’t hold any business logic.\nUsually, when explaining the humble object, people use GUIs or async code as examples. We won’t go down that path today. Let’s try finding an example which we might run into more frequently.\nBack to the problem Now, that we undestand the motivation and the theory behind this pattern, let’s continue with aforementioned design problem.\nTackling any programming problem, in my opinion, is best understood via some code. Here’s an example. We will make a tiny API wrapper of the REST Countries API, more specifically, the World Capitals API.\nrequire 'net/http' require 'json' class CapitalsClient API_ENDPOINT = \"https://restcountries.eu/rest/v1/capital/\" def self.find(capital_name) uri = URI(API_ENDPOINT + capital_name) response = Net::HTTP.get(uri) result = JSON.parse(response).first currencies = result['currencies'].map {|currency| Currency.new(currency) } Country.new({ name: result[\"name\"], capital: result[\"capital\"], region: result[\"region\"], population: result[\"population\"], latitude: result[\"latlng\"][0], longitude: result[\"latlng\"][1], native_name: result[\"nativeName\"], currencies: currencies }) end end The CapitalsClient will issue a GET request to the API endpoint, get the result and build a Country object from the results. This is what the JSON result looks like for London, UK:\n[ { \"name\": \"United Kingdom\", \"capital\": \"London\", \"altSpellings\": [ \"GB\", \"UK\", \"Great Britain\" ], \"relevance\": \"2.5\", \"region\": \"Europe\", \"subregion\": \"Northern Europe\", \"translations\": { \"de\": \"Vereinigtes Königreich\", \"es\": \"Reino Unido\", \"fr\": \"Royaume-Uni\", \"ja\": \"イギリス\", \"it\": \"Regno Unito\" }, \"population\": 64105654, \"latlng\": [ 54, -2 ], \"demonym\": \"British\", \"area\": 242900, \"gini\": 34, \"timezones\": [ \"UTC−08:00\", \"UTC−05:00\", \"UTC−04:00\", \"UTC−03:00\", \"UTC−02:00\", \"UTC\", \"UTC+01:00\", \"UTC+02:00\", \"UTC+06:00\" ], \"borders\": [ \"IRL\" ], \"nativeName\": \"United Kingdom\", \"callingCodes\": [ \"44\" ], \"topLevelDomain\": [ \".uk\" ], \"alpha2Code\": \"GB\", \"alpha3Code\": \"GBR\", \"currencies\": [ \"GBP\" ], \"languages\": [ \"en\" ] } ] For completeness sake, let’s see the Currency and Country classes.\nclass Currency def initialize code @code = code end def to_s @code end end class Country attr_reader :name, :capital, :region, :population, :latitude, :longitude, :native_name, :currencies def initialize attrs @name = attrs.fetch(\"name\",nil) @capital = attrs.fetch(\"capital\",nil) @region = attrs.fetch(\"region\",nil) @population = attrs.fetch(\"population\",nil) @latitude = attrs.fetch(\"latlng\",[]).first @longitude = attrs.fetch(\"latlng\",[]).last @native_name = attrs.fetch(\"nativeName\",nil) @currencies = attrs.fetch(\"currencies\", []) end end Now, let’s revisit the CountryClient class. We’ve all done this - we fetch the JSON, parse it and build the currencies and country object(s). Now, testing is interesting.\nFirst, we’ll need to stub the GET request using Webmock and assert on the Country object that we receive as a result of the CapitalsClient::find method. Another approach is to use VCR and record the request going out and replay it whenever needed.\nrequire 'minitest/autorun' require 'webmock/minitest' class CountryClientTest  Minitest::Test def test_client_fetches_countries response = %Q{ [ { \"name\": \"United Kingdom\", \"capital\": \"London\", \"region\": \"Europe\", \"population\": 64105654, \"latlng\": [54, -2], \"nativeName\": \"United Kingdom\" } ] } stub_request(:get, CountryClient::API_ENDPOINT + \"London\").to_return(body: response) country = CapitalsClient.find(\"London\") assert_equal \"London\", country.name assert_equal \"United Kingdom\", country.name assert_equal \"Europe\", country.region end end Now, this works, it’s fine. But, what exactly are we testing here? I am sure we have all done this multiple times. Look at the test class name - CountryClientTest. We should be testing the client, not setting assertions on the country object. The CountryClient acts like a factory, not like an API client.\nAlso, think about this - stubbing, although it looks fine, it’s basically isolation. While we cannot completely rely on pulling real data from the API for each of our tests, we shouldn’t also go overboard with it.\nWhile one can argue that stubbing external services is all good, what would the case be if you used a library that was actually fetching the data and building it for you? What would you test if the wrapper was made by someone else and you are using it in a Rails app? You could go on and stub the library, but you have no idea if the API and/or the wrapper had any changes made to them.\nBut, let’s take a step back. How can we apply the humble object pattern here?\nApplying the pattern If you remember, the pattern states that we need to extract most of the logic near the boundaries of the system, so the code on the boundary itself is so humble, it doesn’t need to be tested. But, the humble object should be dependent on the extracted code.\nLet’s try to refactor our code by doing exactly that.\nFirst, the CountryClient. It sure does more than it should. Let’s make it humble. The first step would be to make it an API client. Exactly that, nothing more or less. This means that it will only issue HTTP GET to the API. Hint: think of the Single-responsibility principle.\nrequire 'net/http' class CapitalsClient API_ENDPOINT = \"https://restcountries.eu/rest/v1/capital/\" def self.find(capital_name) uri = URI(API_ENDPOINT + capital_name) Net::HTTP.get(uri) end end That’s it. Again, CapitalsClient just sends the request and it returns it’s response. Now, the extracted logic.\nSince the code that we extracted was actually building the Country object, we can create a CountryBuilder class out of it:\nrequire 'json' class CountryBuilder def self.build json result = JSON.parse(response).first currencies = result['currencies'].map {|currency| Currency.new(currency) } Country.new({ name: result[\"name\"], capital: result[\"capital\"], region: result[\"region\"], population: result[\"population\"], latitude: result[\"latlng\"][0], longitude: result[\"latlng\"][1], native_name: result[\"nativeName\"], currencies: currencies }) end end The CountryBuilder.build method will receive the JSON and build the Country object on it’s own. The next, obvious step, is to test this class. If you look at the test we wrote earlier, you can notice that the test is 90% done, it just needs some tweaking.\nrequire 'minitest/autorun' class CountryBuilderTest  Minitest::Test def test_build_builds_the_country response = %Q{ [ { \"name\": \"United Kingdom\", \"capital\": \"London\", \"region\": \"Europe\", \"population\": 64105654, \"latlng\": [54, -2], \"nativeName\": \"United Kingdom\" } ] } country = CountryBuilder.build(response) # Sanity check assert_equal Country, country.class # Useful assertions assert_equal \"London\", country.name assert_equal \"United Kingdom\", country.name assert_equal \"Europe\", country.region end end The key differences in the new and old test is that the new one is missing the Webmock request stub. Also, we are testing the builder class, which does what it should - receives the response as a JSON, builds an object of a class and returns it. But, what happens now to the CapitalsClient? Well, nothing too complicated. If you remember, the pattern states that the humble object should depend on the extracted code.\nIf you look at the code below, it should all make sense:\nrequire 'net/http' class CapitalsClient API_ENDPOINT = \"https://restcountries.eu/rest/v1/capital/\" def self.find(capital_name) uri = URI(API_ENDPOINT + capital_name) response = Net::HTTP.get(uri) CountryBuilder.build(response) end end So, we add the dependency, making CapitalsClient use CountryBuilder to create the country out of the JSON payload.\nAnd, what about testing CapitalsClient? Well, we don’t really need to test it. Even if we wanted to test it, we could only write a test with a test spy that would expect CountryBuilder.build to be called. But, how useful is that test? If we wrote it, we would tie our test to the implementation of the production code. This means that if the implementation of this method changes in the future, but it’s output does not, our tests will fail although we haven’t broken our code.\nOutro As you can see, although very simple, this humble pattern can make a difference when we want to leave out heavy stubbing to external services, APIs or interfaces and just focus on our code where “the magic” happens. Also, at least for me, this type of refactor comes very natural in these situations. But, knowing the pattern guides us towards making only one entry point to our code (or, dependency).\nLiked this article? Subscribe to my newsletter and get future articles in your inbox. It's a short and sweet read, going out to hundreds of other engineers.\n    ","wordCount":"1604","inLanguage":"en","datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","author":{"@type":"Person","name":"Ilija Eftimov"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://ieftimov.com/post/tdd-humble-object/"},"publisher":{"@type":"Organization","name":"Ilija Eftimov ⚡️","logo":{"@type":"ImageObject","url":"https://ieftimov.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://ieftimov.com/ accesskey=h title="Ilija Eftimov ⚡️ (Alt + H)">Ilija Eftimov ⚡️</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://ieftimov.com/ title=About><span>About</span></a></li><li><a href=https://ieftimov.com/posts title=Writing><span>Writing</span></a></li><li><a href=https://www.getrevue.co/profile/itsilija title=Subscribe><span>Subscribe</span></a></li><li><a href=https://ieftimov.com/index.xml title=RSS><span>RSS</span></a></li><li><a href=https://forms.gle/orfXK5jh1LRaiFzo8 title="Suggest a topic"><span>Suggest a topic</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>TDD Patterns: Humble Object</h1><div class=post-meta>August 15, 2015&nbsp;·&nbsp;8 min&nbsp;·&nbsp;Ilija Eftimov</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><div class=details>Table of Contents</div></summary><div class=inner><ul><li><a href=#the-problem aria-label="The problem">The problem</a></li><li><a href=#humble-object aria-label="Humble Object">Humble Object</a></li><li><a href=#back-to-the-problem aria-label="Back to the problem">Back to the problem</a></li><li><a href=#applying-the-pattern aria-label="Applying the pattern">Applying the pattern</a></li><li><a href=#outro aria-label=Outro>Outro</a></li></ul></div></details></div><div class=post-content><p>We all know that there are different design patterns. They are all quite
trivial to learn, but, the trick lies in applying them. When should we use this
or that pattern and will that help in making our code better and cleaner. Well,
tests are code as well and, you guessed it, there are some testing patterns
that are around for a while.</p><p>Today, we will take a look at one of them. It is a useful one and also it has
an interesting name - the Humble Object Pattern.</p><h2 id=the-problem>The problem<a hidden class=anchor aria-hidden=true href=#the-problem>#</a></h2><p>Think about this. You are building an API client/wrapper. You read the
documentation, you understand the model and the intent of the API and how
everything is composed. You start writing your code, keeping it in small
chunks (i.e. classes). You are a responsible programmer, you want to have your
code well documented and tested. All of this is nice. And then, you get to this
part where you start mocking your HTTP calls and stuff easily gets messy.</p><p>How can we avoid this? Is there a better way?</p><h2 id=humble-object>Humble Object<a hidden class=anchor aria-hidden=true href=#humble-object>#</a></h2><p>Let us take a detour. A bit of history first. I think that Uncle Bob has a
really good definition of the Humble Object pattern in <a href=http://cleancoders.com/episode/clean-code-episode-23-p2/show>Episode
23</a> of his Clean
Code videos:</p><p>In case you find the definition confusing, let&rsquo;s tear it apart. First, the
boundaries. When one says boundaries, it means that the person is referring to
the part of the system that communicates with other software that is not
written by you, but your software is dependent on it. For example, let&rsquo;s say
your software creates cron jobs. The boundary lies beween the software that
will call the cronjob system command and the operating system.</p><p>So, this means when using the Humble Object pattern, we extract as much logic
as we can from the boundary class(es), thus making them humble. The extracted
logic will be moved to another class, which will be easily testable. On the
other hand, the humble code will be dependant on the extracted class, but
testing it won&rsquo;t be necessary, because it doesn&rsquo;t hold any business logic.</p><p>Usually, when explaining the humble object, people use GUIs or async code as
examples. We won&rsquo;t go down that path today. Let&rsquo;s try finding an example which
we might run into more frequently.</p><h2 id=back-to-the-problem>Back to the problem<a hidden class=anchor aria-hidden=true href=#back-to-the-problem>#</a></h2><p>Now, that we undestand the motivation and the theory behind this pattern, let&rsquo;s
continue with aforementioned design problem.</p><p>Tackling any programming problem, in my opinion, is best understood via some
code. Here&rsquo;s an example. We will make a tiny API wrapper of the REST Countries
API, more specifically, the <a href=https://restcountries.eu/rest/v1/capital/london>World Capitals
API</a>.</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#b58900>require</span> <span style=color:#2aa198>&#39;net/http&#39;</span>
<span style=color:#b58900>require</span> <span style=color:#2aa198>&#39;json&#39;</span>

<span style=color:#719e07>class</span> <span style=color:#268bd2>CapitalsClient</span>
  <span style=color:#cb4b16>API_ENDPOINT</span> <span style=color:#719e07>=</span> <span style=color:#2aa198>&#34;https://restcountries.eu/rest/v1/capital/&#34;</span>

  <span style=color:#719e07>def</span> <span style=color:#268bd2>self</span><span style=color:#719e07>.</span><span style=color:#268bd2>find</span>(capital_name)
    uri <span style=color:#719e07>=</span> <span style=color:#cb4b16>URI</span>(<span style=color:#cb4b16>API_ENDPOINT</span> <span style=color:#719e07>+</span> capital_name)
    response <span style=color:#719e07>=</span> <span style=color:#cb4b16>Net</span><span style=color:#719e07>::</span><span style=color:#cb4b16>HTTP</span><span style=color:#719e07>.</span>get(uri)
    result <span style=color:#719e07>=</span> <span style=color:#cb4b16>JSON</span><span style=color:#719e07>.</span>parse(response)<span style=color:#719e07>.</span>first
    currencies <span style=color:#719e07>=</span> result<span style=color:#719e07>[</span><span style=color:#2aa198>&#39;currencies&#39;</span><span style=color:#719e07>].</span>map {<span style=color:#719e07>|</span>currency<span style=color:#719e07>|</span> <span style=color:#cb4b16>Currency</span><span style=color:#719e07>.</span>new(currency) }

    <span style=color:#cb4b16>Country</span><span style=color:#719e07>.</span>new({ <span style=color:#b58900>name</span>: result<span style=color:#719e07>[</span><span style=color:#2aa198>&#34;name&#34;</span><span style=color:#719e07>]</span>,
                  <span style=color:#2aa198>capital</span>: result<span style=color:#719e07>[</span><span style=color:#2aa198>&#34;capital&#34;</span><span style=color:#719e07>]</span>,
                  <span style=color:#2aa198>region</span>: result<span style=color:#719e07>[</span><span style=color:#2aa198>&#34;region&#34;</span><span style=color:#719e07>]</span>,
                  <span style=color:#2aa198>population</span>: result<span style=color:#719e07>[</span><span style=color:#2aa198>&#34;population&#34;</span><span style=color:#719e07>]</span>,
                  <span style=color:#2aa198>latitude</span>: result<span style=color:#719e07>[</span><span style=color:#2aa198>&#34;latlng&#34;</span><span style=color:#719e07>][</span><span style=color:#2aa198>0</span><span style=color:#719e07>]</span>,
                  <span style=color:#2aa198>longitude</span>: result<span style=color:#719e07>[</span><span style=color:#2aa198>&#34;latlng&#34;</span><span style=color:#719e07>][</span><span style=color:#2aa198>1</span><span style=color:#719e07>]</span>,
                  <span style=color:#2aa198>native_name</span>: result<span style=color:#719e07>[</span><span style=color:#2aa198>&#34;nativeName&#34;</span><span style=color:#719e07>]</span>,
                  <span style=color:#2aa198>currencies</span>: currencies
    })
  <span style=color:#719e07>end</span>
<span style=color:#719e07>end</span></code></pre></div><p>The <code>CapitalsClient</code> will issue a GET request to the API endpoint, get the
result and build a <code>Country</code> object from the results. This is what the JSON
result looks like for London, UK:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>[
    {
        <span style=color:#268bd2>&#34;name&#34;</span>: <span style=color:#2aa198>&#34;United Kingdom&#34;</span>,
        <span style=color:#268bd2>&#34;capital&#34;</span>: <span style=color:#2aa198>&#34;London&#34;</span>,
        <span style=color:#268bd2>&#34;altSpellings&#34;</span>: [
            <span style=color:#2aa198>&#34;GB&#34;</span>,
            <span style=color:#2aa198>&#34;UK&#34;</span>,
            <span style=color:#2aa198>&#34;Great Britain&#34;</span>
        ],
        <span style=color:#268bd2>&#34;relevance&#34;</span>: <span style=color:#2aa198>&#34;2.5&#34;</span>,
        <span style=color:#268bd2>&#34;region&#34;</span>: <span style=color:#2aa198>&#34;Europe&#34;</span>,
        <span style=color:#268bd2>&#34;subregion&#34;</span>: <span style=color:#2aa198>&#34;Northern Europe&#34;</span>,
        <span style=color:#268bd2>&#34;translations&#34;</span>: {
            <span style=color:#268bd2>&#34;de&#34;</span>: <span style=color:#2aa198>&#34;Vereinigtes Königreich&#34;</span>,
            <span style=color:#268bd2>&#34;es&#34;</span>: <span style=color:#2aa198>&#34;Reino Unido&#34;</span>,
            <span style=color:#268bd2>&#34;fr&#34;</span>: <span style=color:#2aa198>&#34;Royaume-Uni&#34;</span>,
            <span style=color:#268bd2>&#34;ja&#34;</span>: <span style=color:#2aa198>&#34;イギリス&#34;</span>,
            <span style=color:#268bd2>&#34;it&#34;</span>: <span style=color:#2aa198>&#34;Regno Unito&#34;</span>
        },
        <span style=color:#268bd2>&#34;population&#34;</span>: <span style=color:#2aa198>64105654</span>,
        <span style=color:#268bd2>&#34;latlng&#34;</span>: [
            <span style=color:#2aa198>54</span>,
            <span style=color:#2aa198>-2</span>
        ],
        <span style=color:#268bd2>&#34;demonym&#34;</span>: <span style=color:#2aa198>&#34;British&#34;</span>,
        <span style=color:#268bd2>&#34;area&#34;</span>: <span style=color:#2aa198>242900</span>,
        <span style=color:#268bd2>&#34;gini&#34;</span>: <span style=color:#2aa198>34</span>,
        <span style=color:#268bd2>&#34;timezones&#34;</span>: [
            <span style=color:#2aa198>&#34;UTC−08:00&#34;</span>,
            <span style=color:#2aa198>&#34;UTC−05:00&#34;</span>,
            <span style=color:#2aa198>&#34;UTC−04:00&#34;</span>,
            <span style=color:#2aa198>&#34;UTC−03:00&#34;</span>,
            <span style=color:#2aa198>&#34;UTC−02:00&#34;</span>,
            <span style=color:#2aa198>&#34;UTC&#34;</span>,
            <span style=color:#2aa198>&#34;UTC+01:00&#34;</span>,
            <span style=color:#2aa198>&#34;UTC+02:00&#34;</span>,
            <span style=color:#2aa198>&#34;UTC+06:00&#34;</span>
        ],
        <span style=color:#268bd2>&#34;borders&#34;</span>: [
            <span style=color:#2aa198>&#34;IRL&#34;</span>
        ],
        <span style=color:#268bd2>&#34;nativeName&#34;</span>: <span style=color:#2aa198>&#34;United Kingdom&#34;</span>,
        <span style=color:#268bd2>&#34;callingCodes&#34;</span>: [
            <span style=color:#2aa198>&#34;44&#34;</span>
        ],
        <span style=color:#268bd2>&#34;topLevelDomain&#34;</span>: [
            <span style=color:#2aa198>&#34;.uk&#34;</span>
        ],
        <span style=color:#268bd2>&#34;alpha2Code&#34;</span>: <span style=color:#2aa198>&#34;GB&#34;</span>,
        <span style=color:#268bd2>&#34;alpha3Code&#34;</span>: <span style=color:#2aa198>&#34;GBR&#34;</span>,
        <span style=color:#268bd2>&#34;currencies&#34;</span>: [
            <span style=color:#2aa198>&#34;GBP&#34;</span>
        ],
        <span style=color:#268bd2>&#34;languages&#34;</span>: [
            <span style=color:#2aa198>&#34;en&#34;</span>
        ]
    }
]</code></pre></div><p>For completeness sake, let&rsquo;s see the <code>Currency</code> and <code>Country</code> classes.</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#719e07>class</span> <span style=color:#268bd2>Currency</span>
  <span style=color:#719e07>def</span> <span style=color:#268bd2>initialize</span> code
    @code <span style=color:#719e07>=</span> code
  <span style=color:#719e07>end</span>

  <span style=color:#719e07>def</span> <span style=color:#268bd2>to_s</span>
    @code
  <span style=color:#719e07>end</span>
<span style=color:#719e07>end</span></code></pre></div><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#719e07>class</span> <span style=color:#268bd2>Country</span>
  <span style=color:#719e07>attr_reader</span> <span style=color:#2aa198>:name</span>, <span style=color:#2aa198>:capital</span>, <span style=color:#2aa198>:region</span>, <span style=color:#2aa198>:population</span>, <span style=color:#2aa198>:latitude</span>, <span style=color:#2aa198>:longitude</span>,
    <span style=color:#2aa198>:native_name</span>, <span style=color:#2aa198>:currencies</span>

  <span style=color:#719e07>def</span> <span style=color:#268bd2>initialize</span> attrs
    @name        <span style=color:#719e07>=</span>  attrs<span style=color:#719e07>.</span>fetch(<span style=color:#2aa198>&#34;name&#34;</span>,<span style=color:#719e07>nil</span>)
    @capital     <span style=color:#719e07>=</span>  attrs<span style=color:#719e07>.</span>fetch(<span style=color:#2aa198>&#34;capital&#34;</span>,<span style=color:#719e07>nil</span>)
    @region      <span style=color:#719e07>=</span>  attrs<span style=color:#719e07>.</span>fetch(<span style=color:#2aa198>&#34;region&#34;</span>,<span style=color:#719e07>nil</span>)
    @population  <span style=color:#719e07>=</span>  attrs<span style=color:#719e07>.</span>fetch(<span style=color:#2aa198>&#34;population&#34;</span>,<span style=color:#719e07>nil</span>)
    @latitude    <span style=color:#719e07>=</span>  attrs<span style=color:#719e07>.</span>fetch(<span style=color:#2aa198>&#34;latlng&#34;</span>,<span style=color:#719e07>[]</span>)<span style=color:#719e07>.</span>first
    @longitude   <span style=color:#719e07>=</span>  attrs<span style=color:#719e07>.</span>fetch(<span style=color:#2aa198>&#34;latlng&#34;</span>,<span style=color:#719e07>[]</span>)<span style=color:#719e07>.</span>last
    @native_name <span style=color:#719e07>=</span>  attrs<span style=color:#719e07>.</span>fetch(<span style=color:#2aa198>&#34;nativeName&#34;</span>,<span style=color:#719e07>nil</span>)
    @currencies  <span style=color:#719e07>=</span>  attrs<span style=color:#719e07>.</span>fetch(<span style=color:#2aa198>&#34;currencies&#34;</span>, <span style=color:#719e07>[]</span>)
  <span style=color:#719e07>end</span>
<span style=color:#719e07>end</span></code></pre></div><p>Now, let&rsquo;s revisit the <code>CountryClient</code> class. We&rsquo;ve all done this - we fetch
the JSON, parse it and build the currencies and country object(s). Now, testing
is interesting.</p><p>First, we&rsquo;ll need to stub the GET request using
<a href=https://github.com/bblimke/webmock>Webmock</a> and assert on the <code>Country</code>
object that we receive as a result of the <code>CapitalsClient::find</code> method.
Another approach is to use VCR and record the request going out and replay it
whenever needed.</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#b58900>require</span> <span style=color:#2aa198>&#39;minitest/autorun&#39;</span>
<span style=color:#b58900>require</span> <span style=color:#2aa198>&#39;webmock/minitest&#39;</span>

<span style=color:#719e07>class</span> <span style=color:#268bd2>CountryClientTest</span> <span style=color:#719e07>&lt;</span> <span style=color:#cb4b16>Minitest</span><span style=color:#719e07>::</span><span style=color:#cb4b16>Test</span>
  <span style=color:#719e07>def</span> <span style=color:#268bd2>test_client_fetches_countries</span>
    response <span style=color:#719e07>=</span> <span style=color:#2aa198>%Q{
</span><span style=color:#2aa198>      [
</span><span style=color:#2aa198>        {
</span><span style=color:#2aa198>          &#34;name&#34;: &#34;United Kingdom&#34;,
</span><span style=color:#2aa198>          &#34;capital&#34;: &#34;London&#34;,
</span><span style=color:#2aa198>          &#34;region&#34;: &#34;Europe&#34;,
</span><span style=color:#2aa198>          &#34;population&#34;: 64105654,
</span><span style=color:#2aa198>          &#34;latlng&#34;: [54, -2],
</span><span style=color:#2aa198>          &#34;nativeName&#34;: &#34;United Kingdom&#34;
</span><span style=color:#2aa198>        }
</span><span style=color:#2aa198>      ]
</span><span style=color:#2aa198>    }</span>
    stub_request(<span style=color:#2aa198>:get</span>, <span style=color:#cb4b16>CountryClient</span><span style=color:#719e07>::</span><span style=color:#cb4b16>API_ENDPOINT</span> <span style=color:#719e07>+</span> <span style=color:#2aa198>&#34;London&#34;</span>)<span style=color:#719e07>.</span>to_return(<span style=color:#2aa198>body</span>: response)
    country <span style=color:#719e07>=</span> <span style=color:#cb4b16>CapitalsClient</span><span style=color:#719e07>.</span>find(<span style=color:#2aa198>&#34;London&#34;</span>)
    assert_equal <span style=color:#2aa198>&#34;London&#34;</span>, country<span style=color:#719e07>.</span>name
    assert_equal <span style=color:#2aa198>&#34;United Kingdom&#34;</span>, country<span style=color:#719e07>.</span>name
    assert_equal <span style=color:#2aa198>&#34;Europe&#34;</span>, country<span style=color:#719e07>.</span>region
  <span style=color:#719e07>end</span>
<span style=color:#719e07>end</span></code></pre></div><p>Now, this works, it&rsquo;s fine. But, what exactly are we testing here? I am sure we
have all done this multiple times. Look at the test class name -
<code>CountryClientTest</code>. We should be testing the client, not setting assertions
on the country object. The <code>CountryClient</code> acts like a factory, not like an
API client.</p><p>Also, think about this - stubbing, although it looks fine, it&rsquo;s basically
isolation. While we cannot completely rely on pulling real data from the API
for each of our tests, we shouldn&rsquo;t also go overboard with it.</p><p>While one can argue that stubbing external services is all good, what would the
case be if you used a library that was actually fetching the data and building
it for you? What would you test if the wrapper was made by someone else and you
are using it in a Rails app? You could go on and stub the library, but you have
no idea if the API and/or the wrapper had any changes made to them.</p><p>But, let&rsquo;s take a step back. How can we apply the humble object pattern here?</p><h2 id=applying-the-pattern>Applying the pattern<a hidden class=anchor aria-hidden=true href=#applying-the-pattern>#</a></h2><p>If you remember, the pattern states that we need to extract most of the logic
near the boundaries of the system, so the code on the boundary itself is so
humble, it doesn&rsquo;t need to be tested. But, the humble object should be
<strong>dependent</strong> on the extracted code.</p><p>Let&rsquo;s try to refactor our code by doing exactly that.</p><p>First, the <code>CountryClient</code>. It sure does more than it should. Let&rsquo;s make it
humble. The first step would be to make it an API client. Exactly that,
nothing more or less. This means that it will only issue HTTP GET to the API.
Hint: think of the Single-responsibility principle.</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#b58900>require</span> <span style=color:#2aa198>&#39;net/http&#39;</span>

<span style=color:#719e07>class</span> <span style=color:#268bd2>CapitalsClient</span>
  <span style=color:#cb4b16>API_ENDPOINT</span> <span style=color:#719e07>=</span> <span style=color:#2aa198>&#34;https://restcountries.eu/rest/v1/capital/&#34;</span>

  <span style=color:#719e07>def</span> <span style=color:#268bd2>self</span><span style=color:#719e07>.</span><span style=color:#268bd2>find</span>(capital_name)
    uri <span style=color:#719e07>=</span> <span style=color:#cb4b16>URI</span>(<span style=color:#cb4b16>API_ENDPOINT</span> <span style=color:#719e07>+</span> capital_name)
    <span style=color:#cb4b16>Net</span><span style=color:#719e07>::</span><span style=color:#cb4b16>HTTP</span><span style=color:#719e07>.</span>get(uri)
  <span style=color:#719e07>end</span>
<span style=color:#719e07>end</span></code></pre></div><p>That&rsquo;s it. Again, <code>CapitalsClient</code> just sends the request and it returns it&rsquo;s
response. Now, the extracted logic.</p><p>Since the code that we extracted was actually building the <code>Country</code> object, we
can create a <code>CountryBuilder</code> class out of it:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#b58900>require</span> <span style=color:#2aa198>&#39;json&#39;</span>

<span style=color:#719e07>class</span> <span style=color:#268bd2>CountryBuilder</span>
  <span style=color:#719e07>def</span> <span style=color:#268bd2>self</span><span style=color:#719e07>.</span><span style=color:#268bd2>build</span> json
    result <span style=color:#719e07>=</span> <span style=color:#cb4b16>JSON</span><span style=color:#719e07>.</span>parse(response)<span style=color:#719e07>.</span>first
    currencies <span style=color:#719e07>=</span> result<span style=color:#719e07>[</span><span style=color:#2aa198>&#39;currencies&#39;</span><span style=color:#719e07>].</span>map {<span style=color:#719e07>|</span>currency<span style=color:#719e07>|</span> <span style=color:#cb4b16>Currency</span><span style=color:#719e07>.</span>new(currency) }

    <span style=color:#cb4b16>Country</span><span style=color:#719e07>.</span>new({ <span style=color:#b58900>name</span>: result<span style=color:#719e07>[</span><span style=color:#2aa198>&#34;name&#34;</span><span style=color:#719e07>]</span>,
                  <span style=color:#2aa198>capital</span>: result<span style=color:#719e07>[</span><span style=color:#2aa198>&#34;capital&#34;</span><span style=color:#719e07>]</span>,
                  <span style=color:#2aa198>region</span>: result<span style=color:#719e07>[</span><span style=color:#2aa198>&#34;region&#34;</span><span style=color:#719e07>]</span>,
                  <span style=color:#2aa198>population</span>: result<span style=color:#719e07>[</span><span style=color:#2aa198>&#34;population&#34;</span><span style=color:#719e07>]</span>,
                  <span style=color:#2aa198>latitude</span>: result<span style=color:#719e07>[</span><span style=color:#2aa198>&#34;latlng&#34;</span><span style=color:#719e07>][</span><span style=color:#2aa198>0</span><span style=color:#719e07>]</span>,
                  <span style=color:#2aa198>longitude</span>: result<span style=color:#719e07>[</span><span style=color:#2aa198>&#34;latlng&#34;</span><span style=color:#719e07>][</span><span style=color:#2aa198>1</span><span style=color:#719e07>]</span>,
                  <span style=color:#2aa198>native_name</span>: result<span style=color:#719e07>[</span><span style=color:#2aa198>&#34;nativeName&#34;</span><span style=color:#719e07>]</span>,
                  <span style=color:#2aa198>currencies</span>: currencies
    })
  <span style=color:#719e07>end</span>
<span style=color:#719e07>end</span></code></pre></div><p>The <code>CountryBuilder.build</code> method will receive the JSON and build the <code>Country</code>
object on it&rsquo;s own. The next, obvious step, is to test this class. If you look
at the test we wrote earlier, you can notice that the test is 90% done, it just
needs some tweaking.</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#b58900>require</span> <span style=color:#2aa198>&#39;minitest/autorun&#39;</span>

<span style=color:#719e07>class</span> <span style=color:#268bd2>CountryBuilderTest</span> <span style=color:#719e07>&lt;</span> <span style=color:#cb4b16>Minitest</span><span style=color:#719e07>::</span><span style=color:#cb4b16>Test</span>
  <span style=color:#719e07>def</span> <span style=color:#268bd2>test_build_builds_the_country</span>
    response <span style=color:#719e07>=</span> <span style=color:#2aa198>%Q{
</span><span style=color:#2aa198>      [
</span><span style=color:#2aa198>        {
</span><span style=color:#2aa198>          &#34;name&#34;: &#34;United Kingdom&#34;,
</span><span style=color:#2aa198>          &#34;capital&#34;: &#34;London&#34;,
</span><span style=color:#2aa198>          &#34;region&#34;: &#34;Europe&#34;,
</span><span style=color:#2aa198>          &#34;population&#34;: 64105654,
</span><span style=color:#2aa198>          &#34;latlng&#34;: [54, -2],
</span><span style=color:#2aa198>          &#34;nativeName&#34;: &#34;United Kingdom&#34;
</span><span style=color:#2aa198>        }
</span><span style=color:#2aa198>      ]
</span><span style=color:#2aa198>    }</span>
    country <span style=color:#719e07>=</span> <span style=color:#cb4b16>CountryBuilder</span><span style=color:#719e07>.</span>build(response)

    <span style=color:#586e75># Sanity check</span>
    assert_equal <span style=color:#cb4b16>Country</span>, country<span style=color:#719e07>.</span>class

    <span style=color:#586e75># Useful assertions</span>
    assert_equal <span style=color:#2aa198>&#34;London&#34;</span>, country<span style=color:#719e07>.</span>name
    assert_equal <span style=color:#2aa198>&#34;United Kingdom&#34;</span>, country<span style=color:#719e07>.</span>name
    assert_equal <span style=color:#2aa198>&#34;Europe&#34;</span>, country<span style=color:#719e07>.</span>region
  <span style=color:#719e07>end</span>
<span style=color:#719e07>end</span></code></pre></div><p>The key differences in the new and old test is that the new one is missing the
Webmock request stub. Also, we are testing the builder class, which does what
it should - receives the response as a JSON, builds an object of a class and
returns it. But, what happens now to the <code>CapitalsClient</code>? Well, nothing too
complicated. If you remember, the pattern states that the humble object should
depend on the extracted code.</p><p>If you look at the code below, it should all make sense:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#b58900>require</span> <span style=color:#2aa198>&#39;net/http&#39;</span>

<span style=color:#719e07>class</span> <span style=color:#268bd2>CapitalsClient</span>
  <span style=color:#cb4b16>API_ENDPOINT</span> <span style=color:#719e07>=</span> <span style=color:#2aa198>&#34;https://restcountries.eu/rest/v1/capital/&#34;</span>

  <span style=color:#719e07>def</span> <span style=color:#268bd2>self</span><span style=color:#719e07>.</span><span style=color:#268bd2>find</span>(capital_name)
    uri <span style=color:#719e07>=</span> <span style=color:#cb4b16>URI</span>(<span style=color:#cb4b16>API_ENDPOINT</span> <span style=color:#719e07>+</span> capital_name)
    response <span style=color:#719e07>=</span> <span style=color:#cb4b16>Net</span><span style=color:#719e07>::</span><span style=color:#cb4b16>HTTP</span><span style=color:#719e07>.</span>get(uri)
    <span style=color:#cb4b16>CountryBuilder</span><span style=color:#719e07>.</span>build(response)
  <span style=color:#719e07>end</span>
<span style=color:#719e07>end</span></code></pre></div><p>So, we add the dependency, making <code>CapitalsClient</code> use <code>CountryBuilder</code> to
create the country out of the JSON payload.</p><p>And, what about testing <code>CapitalsClient</code>? Well, we don&rsquo;t really need to test
it. Even if we wanted to test it, we could only write a test with a test spy
that would expect <code>CountryBuilder.build</code> to be called. But, how useful is that
test? If we wrote it, we would tie our test to the implementation of the
production code. This means that if the implementation of this method changes
in the future, but it&rsquo;s output does not, our tests will fail although we
haven&rsquo;t broken our code.</p><h2 id=outro>Outro<a hidden class=anchor aria-hidden=true href=#outro>#</a></h2><p>As you can see, although very simple, this humble pattern can make a difference
when we want to leave out heavy stubbing to external services, APIs or
interfaces and just focus on our code where &ldquo;the magic&rdquo; happens. Also, at least
for me, this type of refactor comes very natural in these situations. But,
knowing the pattern guides us towards making only one entry point to our code
(or, dependency).</p><div id=revue-embed><form action=https://www.getrevue.co/profile/itsilija/add_subscriber method=post id=revue-form name=revue-form target=_blank><p><b>Liked this article?</b>
Subscribe to my newsletter and get future articles in your inbox. It's a
short and sweet read, going out to hundreds of other engineers.</p><div class=revue-form-group><input class=revue-form-field placeholder="Your email address..." type=email name=member[email] id=member_email></div><div class=revue-form-actions><input type=submit value=Subscribe name=member[subscribe] id=member_submit></div></form></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://ieftimov.com/tags/patterns/>patterns</a></li><li><a href=https://ieftimov.com/tags/humble/>humble</a></li><li><a href=https://ieftimov.com/tags/object/>object</a></li></ul><nav class=paginav><a class=prev href=https://ieftimov.com/post/variable-hoisting-ruby/><span class=title>« Prev Page</span><br><span>Variable hoisting in Ruby</span></a>
<a class=next href=https://ieftimov.com/post/test-doubles-theory-minitest-rspec/><span class=title>Next Page »</span><br><span>Test Doubles: in theory, in Minitest and in RSpec</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share TDD Patterns: Humble Object on twitter" href="https://twitter.com/intent/tweet/?text=TDD%20Patterns%3a%20Humble%20Object&url=https%3a%2f%2fieftimov.com%2fpost%2ftdd-humble-object%2f&hashtags=patterns%2chumble%2cobject"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share TDD Patterns: Humble Object on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fieftimov.com%2fpost%2ftdd-humble-object%2f&title=TDD%20Patterns%3a%20Humble%20Object&summary=TDD%20Patterns%3a%20Humble%20Object&source=https%3a%2f%2fieftimov.com%2fpost%2ftdd-humble-object%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share TDD Patterns: Humble Object on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fieftimov.com%2fpost%2ftdd-humble-object%2f&title=TDD%20Patterns%3a%20Humble%20Object"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share TDD Patterns: Humble Object on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fieftimov.com%2fpost%2ftdd-humble-object%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share TDD Patterns: Humble Object on whatsapp" href="https://api.whatsapp.com/send?text=TDD%20Patterns%3a%20Humble%20Object%20-%20https%3a%2f%2fieftimov.com%2fpost%2ftdd-humble-object%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share TDD Patterns: Humble Object on telegram" href="https://telegram.me/share/url?text=TDD%20Patterns%3a%20Humble%20Object&url=https%3a%2f%2fieftimov.com%2fpost%2ftdd-humble-object%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>Copyright 2022 © Ilija Eftimov</span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>let menu=document.getElementById('menu');menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script></body></html>