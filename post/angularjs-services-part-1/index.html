<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>AngularJS Services Part 1: Provider - Ilija Eftimov</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta property="og:title" content="AngularJS Services Part 1: Provider" />
<meta property="og:description" content="I started using AngularJS couple of months ago, when we got a new client that wanted us to help with building an app written in Angular.
After couple of months of using it, I found myself struggling with uber-phat controllers and I started thinking of solutions about extracting knowledge out of the controller into separate entities. Also, having the ability to easily inject those entities back into the controller is a must." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ieftimov.com/post/angularjs-services-part-1/" />
<meta property="article:published_time" content="2015-02-25T00:00:00+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="AngularJS Services Part 1: Provider"/>
<meta name="twitter:description" content="I started using AngularJS couple of months ago, when we got a new client that wanted us to help with building an app written in Angular.
After couple of months of using it, I found myself struggling with uber-phat controllers and I started thinking of solutions about extracting knowledge out of the controller into separate entities. Also, having the ability to easily inject those entities back into the controller is a must."/>
<link href='https://fonts.googleapis.com/css?family=Playfair+Display:700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" media="screen" href="https://ieftimov.com/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://ieftimov.com/css/main.css" />
		<link rel="stylesheet" type="text/css" href="https://ieftimov.com/css/overrides.css" />
	

	<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
		<script src="https://ieftimov.com/js/main.js"></script><script src="https://ieftimov.com/js/tooltip.js"></script>
</head>

<body>
	<div class="container wrapper">
		<div class="header">
	
		<div class="avatar">
			<a href="https://ieftimov.com/">
				<img src="https://pbs.twimg.com/profile_images/1194757753585225728/JbET17PZ_400x400.jpg" alt="Ilija Eftimov" />
			</a>
		</div>
	
	<h1 class="site-title"><a href="https://ieftimov.com/">Ilija Eftimov</a></h1>
	<div class="site-description"><p>Software engineer, author and open source contributor</p><nav class="nav social">
			<ul class="flat"><li><a href="https://github.com/fteem" title="Github"><i data-feather="github"></i></a></li><li><a href="https://twitter.com/fteem" title="Twitter"><i data-feather="twitter"></i></a></li><li><a href="https://www.linkedin.com/in/ieftimov" title="Linkedin"><i data-feather="linkedin"></i></a></li><li><a href="mailto:blog@ieftimov.com" title="Email"><i data-feather="mail"></i></a></li></ul>
		</nav>
	</div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="/categories/testing-in-go">Testing in Go</a>
			</li>
			
			<li>
				<a href="/posts">Archive</a>
			</li>
			
			<li>
				<a href="/about">About</a>
			</li>
			
			<li>
				<a href="https://forms.gle/orfXK5jh1LRaiFzo8">Suggest a topic</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post">
			<div class="post-header">
				
					<div class="meta">
						<div class="date">
							<span class="day">25</span>
							<span class="rest">Feb 2015</span>
						</div>
					</div>
				
				<div class="matter">
					<h1 class="title">AngularJS Services Part 1: Provider</h1>
				</div>
			</div>
					
			<div class="markdown">
				<p>I started using AngularJS couple of months ago, when
<a href="http://siyelo.com#team">we</a> got a new client that wanted us to help with
building an app written in Angular.</p>
<p>After couple of months of using it, I found myself struggling with uber-phat
controllers and I started thinking of solutions about extracting knowledge out
of the controller into separate entities. Also, having the ability to easily
inject those entities back into the controller is <strong>a must</strong>.</p>
<p>When I found out about services it really reminded me of service/utility
classes that I was used to write in Ruby. Interestingly, the people at Google
added 5 types of services in Angular - to fit all your needs.</p>
<ul>
<li>Provider</li>
<li>Constant</li>
<li>Value</li>
<li>Factory</li>
<li>Service</li>
</ul>
<p>Problem is, this was quite confusing to me, and I guess for any dev that just
got started with AngularJS. So I am writing this blog post that's part of my
learning and understanding of AngularJS services, and also, to help other
fellow AngularJS developers to understand services.</p>
<h2 id="overview">Overview</h2>
<p>Taken from AngularJS&rsquo; <a href="https://docs.angularjs.org/api/auto/service/$provide">documentation on services</a>:</p>
<!-- raw HTML omitted -->
<p>When you request a service, the $injector is responsible for finding the
correct service provider, instantiating it and then calling its $get service
factory function to get the instance of the service.</p>
<!-- raw HTML omitted -->
<p>Mildly confusing. Okay, so, what is important:</p>
<ol>
<li>Every service in Angular is a
<a href="https://en.wikipedia.org/wiki/Singleton_pattern">singleton</a>.</li>
<li>Every service in Angular has a factory.</li>
<li>These factories are functions, that are created by the service providers.</li>
<li>A servide provider contains the constructor function of the factory. This
constructor function is <strong>always called $get</strong>.</li>
</ol>
<p>What happens when you inject your newly created service to (let's say) a
controller:</p>
<ol>
<li>the AngularJS injector finds the provider and instantiates it</li>
<li>then it calls the $get function on the provider instance</li>
<li>$get returns a service instance</li>
<li>Voila! The service is injected in your controller!</li>
</ol>
<h2 id="example-using-provider">Example (using Provider)</h2>
<p>Let's take a look at a tiny example. As we all know, the internet is made for
cats. So, say we have a Cat provider.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">(<span style="font-weight:bold">function</span>(){
	<span style="color:#b84">&#34;use strict&#34;</span>;

	angular.module(<span style="color:#b84">&#34;app&#34;</span>, [])

	.provider(<span style="color:#b84">&#39;cat&#39;</span>, <span style="font-weight:bold">function</span>(){

		<span style="font-weight:bold">this</span>.$get <span style="font-weight:bold">=</span> <span style="font-weight:bold">function</span>() {
			<span style="font-weight:bold">var</span> name <span style="font-weight:bold">=</span> <span style="color:#b84">&#39;Tom&#39;</span>;
			<span style="font-weight:bold">var</span> color <span style="font-weight:bold">=</span> <span style="color:#b84">&#39;Black&#39;</span>;
			<span style="font-weight:bold">var</span> age <span style="font-weight:bold">=</span> <span style="color:#b84">&#34;1&#34;</span>;

			<span style="font-weight:bold">return</span> {
				name<span style="font-weight:bold">:</span> name,
				color<span style="font-weight:bold">:</span> color
			};
		};
	});
})();
</code></pre></div>
<p>As you can see, this provider has a $get function that will return an instance
of the service, which will be an object literal, containing two properties -
the name and the color of the cat.</p>
<p>We can now inject this service in a controller and use it in a template.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">(<span style="font-weight:bold">function</span>(){
	angular.module(<span style="color:#b84">&#39;app&#39;</span>)
		.controller(<span style="color:#b84">&#39;CatsController&#39;</span>, CatsController);

	<span style="font-weight:bold">function</span> CatsController(cat){ <span style="color:#998;font-style:italic">// here we inject the cat service in our controller
</span><span style="color:#998;font-style:italic"></span>		<span style="font-weight:bold">this</span>.name <span style="font-weight:bold">=</span> cat.name;
		<span style="font-weight:bold">this</span>.color <span style="font-weight:bold">=</span> cat.color;
	}
})();
</code></pre></div>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html"><span style="color:#998;font-style:italic">&lt;!--</span><span style="color:#998;font-style:italic"> ...snip.. </span><span style="color:#998;font-style:italic">--&gt;</span>
&lt;<span style="color:#000080">body</span> <span style="color:#008080">ng-app</span><span style="font-weight:bold">=</span><span style="color:#b84">&#39;app&#39;</span>&gt;
	&lt;<span style="color:#000080">div</span> <span style="color:#008080">ng-controller</span><span style="font-weight:bold">=</span><span style="color:#b84">&#34;CatsController as cats&#34;</span>&gt;
		The cat&#39;s name is: {{ cats.name }}.
		The cat&#39;s color is: {{ cats.color }}.
	&lt;/<span style="color:#000080">div</span>&gt;
&lt;/<span style="color:#000080">body</span>&gt;
<span style="color:#998;font-style:italic">&lt;!--</span><span style="color:#998;font-style:italic"> ...snip.. </span><span style="color:#998;font-style:italic">--&gt;</span></code></pre></div>
<p>This is a very simple example of how to create services using the <strong>provider</strong>
built-in service.</p>
<h2 id="provider">Provider</h2>
<p>So we saw how we can easily use <strong>provider</strong>. Let's see what else provider
provides (no pun intended!).</p>
<p>Every provider we create (i.e. see first code snippet) is a module that we can
inject.  What's cool about Angular is that we can configure any injectables
before they are being injected (i.e. in a controller). Basically, the whole
point of <strong>provider</strong> is to enable the developer <strong>to configure the service
provider before it creates the service</strong>, therefore making services much more
flexible.</p>
<p>Take this for example:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">(<span style="font-weight:bold">function</span>(){
	<span style="color:#b84">&#34;use strict&#34;</span>;

	angular.module(<span style="color:#b84">&#34;app&#34;</span>, [])

	.provider(<span style="color:#b84">&#39;cat&#39;</span>, <span style="font-weight:bold">function</span>(){
		<span style="font-weight:bold">var</span> self <span style="font-weight:bold">=</span> <span style="font-weight:bold">this</span>;
		<span style="font-weight:bold">var</span> bornOn <span style="font-weight:bold">=</span> <span style="font-weight:bold">new</span> <span style="color:#999">Date</span>(<span style="color:#b84">&#34;June 18, 2012 22:03:00&#34;</span>);
		<span style="font-weight:bold">var</span> today <span style="font-weight:bold">=</span> <span style="font-weight:bold">new</span> <span style="color:#999">Date</span>();

		self.age <span style="font-weight:bold">=</span> <span style="color:#099">1</span>;

		self.$get <span style="font-weight:bold">=</span> <span style="font-weight:bold">function</span>() {
			<span style="font-weight:bold">var</span> name <span style="font-weight:bold">=</span> <span style="color:#b84">&#39;Tom&#39;</span>;
			<span style="font-weight:bold">var</span> color <span style="font-weight:bold">=</span> <span style="color:#b84">&#39;Black&#39;</span>;

			<span style="font-weight:bold">return</span> {
				name<span style="font-weight:bold">:</span> name,
				color<span style="font-weight:bold">:</span> color,
				age<span style="font-weight:bold">:</span> self.age,
			};
		};

		self.setAge <span style="font-weight:bold">=</span> <span style="font-weight:bold">function</span>(value){
			<span style="font-weight:bold">if</span>(<span style="font-weight:bold">typeof</span> value <span style="font-weight:bold">===</span> <span style="color:#b84">&#39;undefined&#39;</span>){
				self.calculateAge();
			} <span style="font-weight:bold">else</span> {
				self.age <span style="font-weight:bold">=</span> value;
			}
		};

		self.calculateAge <span style="font-weight:bold">=</span> <span style="font-weight:bold">function</span>(){
		  <span style="font-weight:bold">var</span> oneDayInMs <span style="font-weight:bold">=</span> <span style="color:#099">1000</span><span style="font-weight:bold">*</span><span style="color:#099">60</span><span style="font-weight:bold">*</span><span style="color:#099">60</span><span style="font-weight:bold">*</span><span style="color:#099">24</span>;
		  <span style="font-weight:bold">var</span> differenceInMs <span style="font-weight:bold">=</span> today.getTime() <span style="font-weight:bold">-</span> bornOn.getTime();
		  <span style="font-weight:bold">var</span> daysDifference <span style="font-weight:bold">=</span> <span style="color:#999">Math</span>.round(differenceInMs<span style="font-weight:bold">/</span>oneDayInMs);
		  self.age <span style="font-weight:bold">=</span> <span style="color:#999">Math</span>.round(daysDifference<span style="font-weight:bold">/</span><span style="color:#099">365</span>);
		};
	})

	.config(<span style="font-weight:bold">function</span>(catProvider){
		catProvider.setAge();
	});
})();
</code></pre></div>
<p>Let me walk you through this (bear with me!).</p>
<p>This is a Cat service provider, which contains the $get factory function that
will return the actual service object. The object, as you can see on lines
17-21, will contain the name, color and age properties. The name and color are
hardcoded, meaning, they never change.</p>
<p>I mean, who dyes their cat's fur or changes that little cute creature's name?
Right?</p>
<p>But, like any other cat, it ages. So we have a hardcoded date of birth and a
<strong>setAge</strong> method.  Take note that the <strong>setAge</strong> method, as well as the
<strong>calculateAge</strong> are bound/in the scope of the provider, not the factory
function.</p>
<p>The cool thing happens on lines 40-42. The .config block is get executed during
the provider registrations and configuration phase. This means that we can do
any custom configuration to the provider before we <strong>actually use</strong> the service
object that the factory method will return.</p>
<p>Take note that on line 40, we pass in the <strong>catProvider</strong> to the config block,
because it's the provider that we are configuring, not the service. The service
will be an object that the $get function will return.</p>
<p>In our example, the config block calls <strong>setAge</strong> which then calls
<strong>calculateAge</strong> which dynamically calculates the age of the cat.</p>
<p>If one wants to set the age of the cat manually, he can pass a number as a
parameter to the setAge function.</p>
<p>Also, if one completely removes the configuration block, the age of the cat
will be set to 1. I know it doesn't really make sense, but for this example's
sake lets leave it like that.</p>
<h2 id="provider-and-config-in-the-wild">Provider (and config) in the wild</h2>
<p>Take for example <a href="https://github.com/mgonto/restangular">Restangular</a>. For
those who haven't heard of it Restnagular is basically a AngularJS service that
provides a wrapper on top of $http and is made to handle Restful Resources
easily.</p>
<p>In the documentation, in the section
<a href="https://github.com/mgonto/restangular#how-to-configure-them-globally">How to configure them globally</a>
the author wrote a
<a href="https://github.com/mgonto/restangular#configuring-in-the-config">very cool snippet</a>
showing how one can configure the RestangularProvider <strong>before</strong> any
Restangular service is created.</p>
<p>For example:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-javascript" data-lang="javascript">app.config(<span style="font-weight:bold">function</span>(RestangularProvider) {
  RestangularProvider.setBaseUrl(<span style="color:#b84">&#39;/api/v1&#39;</span>);
});
</code></pre></div>
<p>Here, we tell the RestangularProvider that every remote resource that we try to
fetch (i.e. /users ) should have a base URL of <strong>/api/v1</strong>. So, when
Restangular fetches the users, it will hit <strong>/api/v1/users</strong>.</p>
<p>This is just a small and tiny example of the flexibillity that AngularJS
Providers gives us the developers.</p>

			</div>

			<div class="tags">
				
					
						<ul class="flat">
							
							<li><a href="/tags/services">services</a></li>
							
							<li><a href="/tags/provider">provider</a></li>
							
						</ul>
					
				
			</div><div id="disqus_thread"></div>
<script type="text/javascript">
	(function () {
		
		
		if (window.location.hostname == "localhost")
			return;

		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		var disqus_shortname = 'eftimov';
		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
</script>
<noscript>Please enable JavaScript to view the </a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
	</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div> Copyright © 2014 - 2020 Ilija Eftimov |  <a href="https://github.com/knadh/hugo-ink">Ink</a> theme on <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-11264459-2', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<script>feather.replace()</script>
</body>
</html>
