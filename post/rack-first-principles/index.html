<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Rack: First Principles - Ilija Eftimov</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta property="og:title" content="Rack: First Principles" />
<meta property="og:description" content="About three years ago, when I started working with Ruby and Rails, I noticed that the term &ldquo;Rack&rdquo; always came up in my Google searches. Overwhelmed with all of the stuff I needed to learn combined with the awesomeness of Rails, which shields the new Rails devs from it&#39;s internals, I never really understood Rack or writing Rack apps. Although I used to see people mentioning &ldquo;middleware&rdquo; or &ldquo;Rack middleware&rdquo; I never really wrote (or tried to write) any middleware." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ieftimov.com/post/rack-first-principles/" />
<meta property="article:published_time" content="2015-06-16T00:00:00+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Rack: First Principles"/>
<meta name="twitter:description" content="About three years ago, when I started working with Ruby and Rails, I noticed that the term &ldquo;Rack&rdquo; always came up in my Google searches. Overwhelmed with all of the stuff I needed to learn combined with the awesomeness of Rails, which shields the new Rails devs from it&#39;s internals, I never really understood Rack or writing Rack apps. Although I used to see people mentioning &ldquo;middleware&rdquo; or &ldquo;Rack middleware&rdquo; I never really wrote (or tried to write) any middleware."/>
<link href='https://fonts.googleapis.com/css?family=Playfair+Display:700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" media="screen" href="https://ieftimov.com/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://ieftimov.com/css/main.css" />
		<link rel="stylesheet" type="text/css" href="https://ieftimov.com/css/overrides.css" />
	

	<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
		<script src="https://ieftimov.com/js/main.js"></script><script src="https://ieftimov.com/js/tooltip.js"></script>
</head>

<body>
	<div class="container wrapper">
		<div class="header">
	
		<div class="avatar">
			<a href="https://ieftimov.com/">
				<img src="https://ieftimov.com/avatar.png" alt="Ilija Eftimov" />
			</a>
		</div>
	
	<h1 class="site-title"><a href="https://ieftimov.com/">Ilija Eftimov</a></h1>
	<div class="site-description"><p>A human, interested in building products and software.</p><nav class="nav social">
			<ul class="flat"><li><a href="https://github.com/fteem" title="Github"><i data-feather="github"></i></a></li><li><a href="https://twitter.com/fteem" title="Twitter"><i data-feather="twitter"></i></a></li><li><a href="https://www.linkedin.com/in/ieftimov" title="Linkedin"><i data-feather="linkedin"></i></a></li><li><a href="mailto:blog@ieftimov.com" title="Email"><i data-feather="mail"></i></a></li></ul>
		</nav>
	</div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="/categories/testing-in-go">Testing in Go</a>
			</li>
			
			<li>
				<a href="/posts">Archive</a>
			</li>
			
			<li>
				<a href="/about">About</a>
			</li>
			
			<li>
				<a href="https://forms.gle/orfXK5jh1LRaiFzo8">Suggest a topic</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post">
			<div class="post-header">
				
					<div class="meta">
						<div class="date">
							<span class="day">16</span>
							<span class="rest">Jun 2015</span>
						</div>
					</div>
				
				<div class="matter">
					<h1 class="title">Rack: First Principles</h1>
				</div>
			</div>
					
			<div class="markdown">
				<p>About three years ago, when I started working with Ruby and Rails, I noticed
that the term &ldquo;Rack&rdquo; always came up in my Google searches.
Overwhelmed with all of the stuff I needed to learn combined with the awesomeness
of Rails, which shields the new Rails devs from it's internals, I never really
understood Rack or writing Rack apps. Although I used to see people mentioning
&ldquo;middleware&rdquo; or &ldquo;Rack middleware&rdquo; I never really wrote (or tried to write) any
middleware. But, you know what's really funny?</p>
<p>As a Rails developer you use Rack <strong>every single day</strong>, it's just that you're
not aware of it. So, for anyone that is wondering what Rack does and how you can
leverage it's awesomeness, lets take a look at Rack from first principles.</p>
<h2 id="what-is-rack">What is Rack?</h2>
<p>Wait, isn't it Rake, not Rack? Nope, <a href="https://github.com/ruby/rake">Rake</a> is
&ldquo;Make for Ruby&rdquo; and it's basically a task runner. On the other hand Rack is
something else.</p>
<p>Taken from
<a href="http://www.rubydoc.info/github/rack/rack/master/file/README.rdoc">Rack's documentation</a>:</p>
<blockquote>
<p>Rack provides a minimal, modular, and adaptable interface for developing web
applications in Ruby.  By wrapping HTTP requests and responses in the
simplest way possible, it unifies and distills the API for web servers, web
frameworks, and software in between (the so-called middleware) into a single
method call.</p>
</blockquote>
<p>What does this tell us? It wraps HTTP requests and responses. Okay, so you can
actually use the request (as an object) and write/create the response which the
Rack app will return. Cool? Next, has an API for servers, frameworks and
middleware into a single method call.</p>
<h2 id="a-single-method-call">A single method call?</h2>
<p>Yes, a Rack application is <strong>an object</strong> that responds to a method called
<code>call</code>.</p>
<p>Taken from <a href="http://www.rubydoc.info/github/rack/rack/master/file/SPEC">Rack's
specification</a>:</p>
<blockquote>
<p>A Rack application is a Ruby object (not a class) that responds to <code>call</code>.
It takes exactly one argument, the environment and returns an Array of
exactly three values: The <strong>status</strong>, the <strong>headers</strong>, and the <strong>body</strong>.</p>
</blockquote>
<p>What's the environment? Well basically, it's the environment of the server,
because Rack is an interface (or an API) for web servers. More specifically,
it's a Hash that has a lot of headers (key-value pairs). Also, it contains some
Rack specific variables. You can explore the environment
<a href="http://www.rubydoc.info/github/rack/rack/master/file/SPEC#The_Environment">here</a>.</p>
<p>Why does it return exactly three values? That's what always the web clients are
interested in when receiving the response from the server:</p>
<ul>
<li>the status - did the request fail, or was it ok</li>
<li>the headers - <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers">HTTP
headers</a>. Rarely
mentioned, but they are great!</li>
<li>the body - the useful stuff that the server returns (usually a HTTP page or
JSON payload)</li>
</ul>
<p>Makes sense, right?</p>
<h2 id="rack-application">Rack application</h2>
<p>Let's see how we can create a simple Rack application.</p>
<p>First, we need to install Rack. Believe it or not (sarcasm sign!) Rack is a gem
and we can install it by running this command in our command line:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">gem install rack</code></pre></div>
<p>After you have Rack installed, you can use Rack in two ways. What's interesting
is that a Proc can be a Rack application. But why Proc? Well, if you remember,
a Rack application is an object that responds to the <code>call</code> method. ;-)</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#998;font-style:italic"># rack_app.rb</span>
<span style="color:#999">require</span> <span style="color:#b84">&#39;rack&#39;</span>

rack_app <span style="font-weight:bold">=</span> <span style="color:#008080">Proc</span><span style="font-weight:bold">.</span>new <span style="font-weight:bold">do</span> <span style="font-weight:bold">|</span>env<span style="font-weight:bold">|</span>
  <span style="font-weight:bold">[</span><span style="color:#099">200</span><span style="font-weight:bold"></span>, {<span style="color:#b84">&#39;Content-Type&#39;</span> <span style="font-weight:bold">=</span><span style="font-weight:bold">&gt;</span> <span style="color:#b84">&#39;application/json&#39;</span>}, <span style="font-weight:bold">[</span><span style="color:#b84">&#34;</span><span style="color:#b84">{&#39;response&#39;:&#39;OK&#39;}</span><span style="color:#b84">&#34;</span><span style="font-weight:bold">]</span><span style="font-weight:bold">]</span>
<span style="font-weight:bold">end</span>

<span style="color:#008080">Rack</span><span style="font-weight:bold">::</span><span style="color:#008080">Handler</span><span style="font-weight:bold">::</span><span style="color:#008080">WEBrick</span><span style="font-weight:bold">.</span>run rack_app</code></pre></div>
<p>If we run this app in our command line:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ruby rack_app.rb</code></pre></div>
<p>we can see that a webserver booted and it ran the Rack application. This is the
output of my webserver (the output of yours will vary):</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="font-weight:bold">[</span>2015-06-16 21:26:38<span style="font-weight:bold">]</span> INFO  WEBrick 1.3.1
<span style="font-weight:bold">[</span>2015-06-16 21:26:38<span style="font-weight:bold">]</span> INFO  ruby 2.0.0 <span style="font-weight:bold">(</span>2014-09-19<span style="font-weight:bold">)</span> <span style="font-weight:bold">[</span>x86_64-darwin13.4.0<span style="font-weight:bold">]</span>
<span style="font-weight:bold">[</span>2015-06-16 21:26:38<span style="font-weight:bold">]</span> INFO  WEBrick::HTTPServer#start: <span style="color:#008080">pid</span><span style="font-weight:bold">=</span><span style="color:#099">12649</span> <span style="color:#008080">port</span><span style="font-weight:bold">=</span><span style="color:#099">8080</span></code></pre></div>
<p>As you can see, Rack started a WEBrick webserver that is running the Rack
application we wrote.  This happens because WEBrick is built in into Rack, as a
Handler, therefore the last line in the Ruby file is:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="font-weight:bold">**</span><span style="font-weight:bold">*</span> snip <span style="font-weight:bold">**</span><span style="font-weight:bold">*</span>
<span style="color:#008080">Rack</span><span style="font-weight:bold">::</span><span style="color:#008080">Handler</span><span style="font-weight:bold">::</span><span style="color:#008080">WEBrick</span><span style="font-weight:bold">.</span>run rack_app</code></pre></div>
<p>Another way to run this application is using the <code>rackup</code> command. To use this
command we'll need to modify the application a bit:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#998;font-style:italic"># rack_app.ru</span>
app <span style="font-weight:bold">=</span> <span style="color:#008080">Proc</span><span style="font-weight:bold">.</span>new <span style="font-weight:bold">do</span> <span style="font-weight:bold">|</span>env<span style="font-weight:bold">|</span>
  <span style="font-weight:bold">[</span><span style="color:#099">200</span><span style="font-weight:bold"></span>, {<span style="color:#b84">&#39;Content-Type&#39;</span> <span style="font-weight:bold">=</span><span style="font-weight:bold">&gt;</span> <span style="color:#b84">&#39;application/json&#39;</span>}, <span style="font-weight:bold">[</span><span style="color:#b84">&#34;</span><span style="color:#b84">{&#39;response&#39;:&#39;OK&#39;}</span><span style="color:#b84">&#34;</span><span style="font-weight:bold">]</span><span style="font-weight:bold">]</span>
<span style="font-weight:bold">end</span>

run app</code></pre></div>
<p>Much simpler, but what happened? Well, the Proc object still stands in, but the
rest of the stuff is gone. As you can see also the filename changed. Why?</p>
<p>First and foremost, when using the <code>rackup</code> command we need a &ldquo;rackup&rdquo; file,
whose extension is <em><strong>.ru</strong></em>. Yes, just like Russia's TLD! Also, we use the
<code>run</code> method which basically tells <code>rackup</code> to call <code>call</code> on the object that
<code>run</code> takes as a parameter (or, the app).</p>
<p>Booting the server and running the app is trivial, just like before:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">rackup rack_app.ru</code></pre></div>
<p>The output, again, is very similar:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="font-weight:bold">[</span>2015-06-16 21:37:09<span style="font-weight:bold">]</span> INFO  WEBrick 1.3.1
<span style="font-weight:bold">[</span>2015-06-16 21:37:09<span style="font-weight:bold">]</span> INFO  ruby 2.0.0 <span style="font-weight:bold">(</span>2014-09-19<span style="font-weight:bold">)</span> <span style="font-weight:bold">[</span>x86_64-darwin13.4.0<span style="font-weight:bold">]</span>
<span style="font-weight:bold">[</span>2015-06-16 21:37:09<span style="font-weight:bold">]</span> INFO  WEBrick::HTTPServer#start: <span style="color:#008080">pid</span><span style="font-weight:bold">=</span><span style="color:#099">14930</span> <span style="color:#008080">port</span><span style="font-weight:bold">=</span><span style="color:#099">9292</span></code></pre></div>
<p>Oh, and did I mention you can cURL the app or view the app running in the
browser?  WEBrick is a server, which means your Rack application is running on
a webserver.  In fact, notice the last line of the log above - it says that the
server is running on port 9292.  To see your Rack application in action, you
can visit <a href="http://localhost:9292">http://localhost:9292</a> in the browser.  Or,
you can <code>curl 127.0.0.1:9292</code>!</p>
<p>This is what I got when i <em>cURL</em>ed to localhost:9292:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{<span style="color:#a61717;background-color:#e3d2d2">&#39;</span><span style="color:#a61717;background-color:#e3d2d2">r</span><span style="color:#a61717;background-color:#e3d2d2">e</span><span style="color:#a61717;background-color:#e3d2d2">s</span><span style="color:#a61717;background-color:#e3d2d2">p</span><span style="color:#a61717;background-color:#e3d2d2">o</span><span style="color:#a61717;background-color:#e3d2d2">n</span><span style="color:#a61717;background-color:#e3d2d2">s</span><span style="color:#a61717;background-color:#e3d2d2">e</span><span style="color:#a61717;background-color:#e3d2d2">&#39;</span><span style="color:#a61717;background-color:#e3d2d2">:</span><span style="color:#a61717;background-color:#e3d2d2">&#39;</span><span style="color:#a61717;background-color:#e3d2d2">O</span><span style="color:#a61717;background-color:#e3d2d2">K</span><span style="color:#a61717;background-color:#e3d2d2">&#39;</span>}</code></pre></div>
<p>That's it. The server returned the response that the Rack application created.
There you go - this is a very tiny functioning Rack application.</p>
<h2 id="outro">Outro</h2>
<p>I hope this post helped you understand what Rack is and what it's used for.
Next time we will take a look at writing Rack middleware and integrating it
into a Rails application.  Until than, feel free to share your thoughts on Rack
with me and the ways you use it.  Also, I am looking for suggestions for the
middleware example for the next post - what kind of middleware would you like
to me to cover?</p>
<p><strong>EDIT #1 (2015-06-19):</strong> Thanks to <a href="https://disqus.com/by/BlazeBoy/">BlazeBoy</a>
for the Rack vs Rake suggestion. Thanks to
<a href="https://disqus.com/by/andresilveirah/">André</a> for noticing a typo.</p>

			</div>

			<div class="tags">
				
					
						<ul class="flat">
							
							<li><a href="/tags/rack">rack</a></li>
							
							<li><a href="/tags/middleware">middleware</a></li>
							
						</ul>
					
				
			</div><div id="disqus_thread"></div>
<script type="text/javascript">
	(function () {
		
		
		if (window.location.hostname == "localhost")
			return;

		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		var disqus_shortname = 'eftimov';
		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
</script>
<noscript>Please enable JavaScript to view the </a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
	</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div> Copyright © 2014 - 2020 Ilija Eftimov |  <a href="https://github.com/knadh/hugo-ink">Ink</a> theme on <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-11264459-2', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<script>feather.replace()</script>
</body>
</html>
