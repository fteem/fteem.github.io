<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Refactoring in Ruby: TDD your way through Extract Class | Ilija Eftimov ⚡️</title><meta name=keywords content="tdd,extract,class"><meta name=description content="There are a lot of refactoring patterns available out there for us. I assume that most of us use these patterns, at certain times without being aware that those refactoring steps are defined as a pattern in the past. In this post, I will take you through an example of refactoring Ruby code with the Extract Class pattern by using Test-Driven Development.
Let&rsquo;s dive in!
What went wrong at the test?"><meta name=author content="Ilija Eftimov"><link rel=canonical href=https://ieftimov.com/post/tdd-extract-class/><link crossorigin=anonymous href=/assets/css/stylesheet.min.css rel="preload stylesheet" as=style><link rel=icon href=https://ieftimov.com/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://ieftimov.com/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://ieftimov.com/favicon-32x32.png><link rel=apple-touch-icon href=https://ieftimov.com/apple-touch-icon.png><link rel=mask-icon href=https://ieftimov.com/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.83.1"><script async defer data-domain=ieftimov.com src=https://plausible.io/js/plausible.js></script><link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel=stylesheet><meta property="og:title" content="Refactoring in Ruby: TDD your way through Extract Class"><meta property="og:description" content="There are a lot of refactoring patterns available out there for us. I assume that most of us use these patterns, at certain times without being aware that those refactoring steps are defined as a pattern in the past. In this post, I will take you through an example of refactoring Ruby code with the Extract Class pattern by using Test-Driven Development.
Let&rsquo;s dive in!
What went wrong at the test?"><meta property="og:type" content="article"><meta property="og:url" content="https://ieftimov.com/post/tdd-extract-class/"><meta property="article:section" content="posts"><meta name=twitter:card content="summary"><meta name=twitter:title content="Refactoring in Ruby: TDD your way through Extract Class"><meta name=twitter:description content="There are a lot of refactoring patterns available out there for us. I assume that most of us use these patterns, at certain times without being aware that those refactoring steps are defined as a pattern in the past. In this post, I will take you through an example of refactoring Ruby code with the Extract Class pattern by using Test-Driven Development.
Let&rsquo;s dive in!
What went wrong at the test?"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://ieftimov.com/posts/"},{"@type":"ListItem","position":2,"name":"Refactoring in Ruby: TDD your way through Extract Class","item":"https://ieftimov.com/post/tdd-extract-class/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Refactoring in Ruby: TDD your way through Extract Class","name":"Refactoring in Ruby: TDD your way through Extract Class","description":"There are a lot of refactoring patterns available out there for us. I assume that most of us use these patterns, at certain times without being aware that those refactoring steps are defined as a pattern in the past. In this post, I will take you through an example of refactoring Ruby code with the Extract Class pattern by using Test-Driven Development.\nLet\u0026rsquo;s dive in!\nWhat went wrong at the test?","keywords":["tdd","extract","class"],"articleBody":"There are a lot of refactoring patterns available out there for us. I assume that most of us use these patterns, at certain times without being aware that those refactoring steps are defined as a pattern in the past. In this post, I will take you through an example of refactoring Ruby code with the Extract Class pattern by using Test-Driven Development.\nLet’s dive in!\nWhat went wrong at the test? Say we are professors in university and we compile a CSV file with our students' grades. Some of them are good, some are not that good. We want to have a small informal meeting with the students that did not pass the exam, in a classroom and review the tests and discuss what went wrong. Given that there are a lot of students in our class, writing an email for each of the students is painful. Well, good we are programming professors, so we can write our own little program to automate sending those emails:\nrequire 'csv' require 'mail' class Parser def initialize(file_path) @file_path = file_path end def parse! CSV.foreach(@file_path, headers: true) do |row| if failed_test?(row[\"points\"]) Mail.deliver do to row[\"email\"] from 'John Doe ' subject 'Post exam meeting invitation' body failed_exam_body(row[\"first_name\"], row[\"points\"]) end else Mail.deliver do to row[\"email\"] from 'John Doe ' subject 'Exam results' body passed_exam_body(row[\"first_name\"], row[\"points\"]) end end end end private def failed_test?(points) points  50 end def failed_exam_body(student_name, points) %Q{ Hi #{student_name}, On the exam last week you got #{points}points. It seems to me that you ran into some problems with it so I would like to invite you to a meeting in classrom 201, tomorrow at 2PM. Regards, Prof. John Doe } end def passed_exam_body(student_name, points) %Q{ Hi #{student_name}, On the exam last week you got #{scored_points}points. Congratulations, Prof. John Doe } end end As you can see, it’s quite a simple class. It takes a CSV file path and parses it. For each row it checks if the points are less then the minimum amount to pass the exam. If so, then a customised email is sent to each of the students.\nNow, if we take a moment to think about the design of this class, there’s a question that we can ask ourselves: what does this class do? Although the question is simple, the answer can reveal something very interesting.\nThe class parses a CSV file and sends an email to each of the students that failed the test. You see, the word “and” is bolded because it points out to a code smell - violation of the Single Responsibility Principle. If you don’t know what SRP is, I recommend you check out my blog post on SOLID principles.\nSo, how can we refactor our class? Well, one of the options is using the Extract Class pattern. Let’s check it out.\nExtract Class pattern This pattern falls into a group of patterns that are used for moving features (or functionalities) between objects. The benefit of this refactor is to make your classes adhere to the SRP. Classes that adhere to the SRP are much easier to understand and expand onto.\nNow, back to the design of the class. Since we agreed that it breaks the SRP, we need to decide which functionality we will move out into a new class. For our example, we will let the Parser class just parse the CSV, while we will create a new class called Exam which will contain all of the data and behaviour around the exam data that we parse from the CSV. After that, we will create a Mailer class, whose role will be just to send the email.\nWith that, we will have three classes into play - all having just one responsibility, whether is representing an Exam, parsing a CSV or sending emails.\nThe first step will be to wish the interface of the Exam and Mailer classes and use them in the Parser class. This is called “programming by wishful thinking”.\n# parser.rb require 'csv' class Parser def initialize(file_path) @file_path = File.expand_path(file_path) end def parse! CSV.foreach(@file_path, headers: true) do |row| exam = Exam.new(row) if exam.failed? ExamMailer.failed!(exam) else ExamMailer.passed!(exam) end end end end Parser.new(\"grades.csv\").parse! Good. As you can see, we’ve added the new classes in Parser#parse! method which radically simplified the readiness and simplicity of it. Since we now have the classes in place, let’s take a step back and use TDD to create these classes.\nIntroducing the Exam As we said before, the Exam class will hold the data and represent the behaviour of an exam. But what does that mean? Well, simply put, it will have methods that will decide if an exam is failed based on the data (points). Let’s TDD our way through this and write some tests before we implement the class:\n# exam_test.rb class ExamTest  Minitest::Test def test_it_can_be_failed exam = Exam.new({ 'points' = '20' }) assert exam.failed? end def test_it_can_be_passed exam = Exam.new({ 'points' = '51' }) assert exam.passed? end end I assume the tests are quite self explanatory. The constructor will take a hash as an argument and extract the points from it. Then the Exam#passed? and Exam#failed? methods will check if the exam is passed or failed. The rule here is that an exam is failed if it has less than 50 points scored. Let’s implement this:\n# exam.rb class Exam attr_reader :scored_points def initialize(entry) @scored_points = entry['points'].to_i end def failed? @scored_points  50 end def passed? !failed? end end Really easy, right? If we run the tests, they will pass. Additionally we will need the exam to contain the data for the student which has taken the exam. Some of you might think that a student should be a separate object and I would say that you are right. Also, others might say that there can be separate classes for a failed and passed exams.\nBut, for this example we can keep it really simple. Let’s add some tests for the attribute readers:\nclass ExamTest  Minitest::Test def test_student_name student_name = 'Ilija' exam = Exam.new({ 'first_name' = student_name }) assert_equal student_name, exam.student_name end def test_student_email student_email = 'ile@eftimov.net' exam = Exam.new({ 'email' = student_email }) assert_equal student_email, exam.student_email end def test_failure exam = Exam.new({ 'points' = '20' }) assert exam.failed? end def test_success exam = Exam.new({ 'points' = '51' }) assert exam.passed? end end Implementing these methods is quite easy as well:\nclass Exam attr_reader :student_name, :student_email, :scored_points def initialize(entry) @student_name = entry['first_name'] @student_email = entry['email'] @scored_points = entry['points'].to_i end def failed? @scored_points  50 end def passed? !failed? end end That is our Exam class with all of it’s glory. Did you think about what we did in this step? Really simple stuff - noticing that there is room for a class to encapsulate all of the required data so it can answer to the question “is this exam failed or not?”. We first wished what the interfaces of our classes should be and then we created the first class, using TDD.\nThis is the Extract Class pattern at it’s core - reducing complexity and improving readibility by extracting data and behaviour to a new class.\nThat would be it at this moment. The Exam holds enough behaviour and data so we can continue with the other classes.\nBuilding the mailer The next step is the ExamMailer. The mailer should contain only the behaviour required to send the emails - nothing else. As we decided in the first step, the mailer will have two methods: ExamMailer.passed! and ExamMailer.failed!. The mailer class will use the Mail gem to send emails.\nLet’s write some tests around them first and implement them after:\nMail.defaults do delivery_method :test end class MailerTest  Minitest::Test def setup Mail::TestMailer.deliveries.clear @student_mail = 'john@doe.com' @student_name = 'John' end def test_failed_exam_mail points = '49' exam = Exam.new({ 'points' = points, 'email' = @student_mail, 'first_name' = @student_name }) ExamMailer.failed!(exam) mail = Mail::TestMailer.deliveries.first assert_equal @student_mail, mail.to.first assert_equal \"Post exam meeting invitation\", mail.subject assert_match /you got #{points}points/i, mail.body.raw_source end def test_passed_exam_mail points = '50' exam = Exam.new({ 'points' = points, 'email' = @student_mail, 'first_name' = @student_name }) ExamMailer.passed!(exam) mail = Mail::TestMailer.deliveries.first assert_equal @student_mail, mail.to.first assert_equal \"Exam results\", mail.subject assert_match /you got #{points}points/i, mail.body.raw_source end end Now, there’s a bit of boilerplate code here, which deals with the Mail gem. In the beginning of the file, we set the delivery method of the Mail gem to be :test. This means that the gem will hold all of the emails that are sent in memory, without trying to make an actual delivery. Also, in our setup method we invoke the Mail::TestMailer.deliveries.clear method, which clears the deliveries collection before running each test. This is done so we have a fresh collection of sent emails for each test, which helps with avoiding any confusion.\nAs you can notice in the tests, we assert on the recipient email, on the e-mail subject and on the e-mail body. With this step, we want to make sure that the most essential parts of the e-mail (recipient, body and subject) are correct.\nExtracting the mailer logic from the initial script to a new mailer class is rather simple:\nrequire 'mail' class ExamMailer def self.failed!(exam) new(exam).failed! end def self.passed!(exam) new(exam).passed! end def initialize(exam) @exam = exam end def failed! send_mail!('Post exam meeting invitation', failed_exam_email_body) end def passed! send_mail!('Exam results', passed_exam_email_body) end private def send_mail!(subject, body) mail = Mail.new mail.to = @exam.student_email mail.from = 'John Doe ' mail.subject = subject mail.body = body mail.deliver end def passed_exam_email_body %Q{ Hi #{@exam.student_name}, On the exam last week you got #{@exam.scored_points}points. Congratulations, Prof. John Doe } end def failed_exam_email_body %Q{ Hi #{@exam.student_name}, On the exam last week you got #{@exam.scored_points}points. It seems to me that you ran into some problems with it so I would like to invite you to a group meeting in classrom 201, tomorrow at 2PM. Regards, Prof. John Doe } end end Most of the magic lies within the send_mail! method. It builds a new Mail object and delivers it.\nAs you saw in this step, we extracted the mailing logic from the script to a new well-defined class. The next (and last step) is reviewing the original Parser class and pondering a bit with it.\nBack to the parser After we did all of the hard work around extracting two new classes and writing tests for them, it is time to take a look at the Parser class. I would say that improving it further would be over-engineering it, at least in the scope of this article. The only thing that I would like us to think about is the name of the class. Does Parser do it?\nThis is quite subjective and I would guess some of you wouldn’t agree with me, but in my mind the Parser is quite broad term. In this instance, I think that Grader is a better name for it.\nTaking a step back As you could see in this article, there’s quite a bit of work around refactoring existing code. There are more than a two dozen patterns around refactoring, with Extract Class being one of the simplest ones. Having this said, I would like to ask you a question:\nDo you really need to think in patterns? Do we really need to have a “predefined sequence of steps” to make our code better?\nI think that it’s not really about applying a certain pattern, it’s more about caring about the design of the code and writing tests for it. As a rule of thumb, I always try to think about the five SOLID principles when writing my code. And when you are refactoring - understand the motivation and the context behind the code that you are refactoring, without focusing on which pattern you will apply.\nLiked this article? Subscribe to my newsletter and get future articles in your inbox. It's a short and sweet read, going out to +1000 of other engineers.\n    ","wordCount":"1978","inLanguage":"en","datePublished":"0001-01-01T00:00:00Z","dateModified":"0001-01-01T00:00:00Z","author":{"@type":"Person","name":"Ilija Eftimov"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://ieftimov.com/post/tdd-extract-class/"},"publisher":{"@type":"Organization","name":"Ilija Eftimov ⚡️","logo":{"@type":"ImageObject","url":"https://ieftimov.com/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:#1d1e20;--entry:#2e2e33;--primary:rgba(255, 255, 255, 0.84);--secondary:rgba(255, 255, 255, 0.56);--tertiary:rgba(255, 255, 255, 0.16);--content:rgba(255, 255, 255, 0.74);--hljs-bg:#2e2e33;--code-bg:#37383e;--border:#333}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://ieftimov.com/ accesskey=h title="Ilija Eftimov ⚡️ (Alt + H)">Ilija Eftimov ⚡️</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu><li><a href=https://ieftimov.com/ title=About><span>About</span></a></li><li><a href=https://ieftimov.com/posts title=Writing><span>Writing</span></a></li><li><a href=https://ieftimov.com/newsletter title=Newsletter><span>Newsletter</span></a></li><li><a href=https://forms.gle/orfXK5jh1LRaiFzo8 title="Suggest a topic"><span>Suggest a topic</span></a></li><li><a href=https://www.buymeacoffee.com/ieftimov title="Buy me a ☕"><span>Buy me a ☕</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Refactoring in Ruby: TDD your way through Extract Class</h1><div class=post-meta>December 28, 2015&nbsp;·&nbsp;10 min&nbsp;·&nbsp;Ilija Eftimov</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><div class=details>Table of Contents</div></summary><div class=inner><ul><li><a href=#what-went-wrong-at-the-test aria-label="What went wrong at the test?">What went wrong at the test?</a></li><li><a href=#extract-class-pattern aria-label="Extract Class pattern">Extract Class pattern</a></li><li><a href=#introducing-the-exam aria-label="Introducing the Exam">Introducing the Exam</a></li><li><a href=#building-the-mailer aria-label="Building the mailer">Building the mailer</a></li><li><a href=#back-to-the-parser aria-label="Back to the parser">Back to the parser</a></li><li><a href=#taking-a-step-back aria-label="Taking a step back">Taking a step back</a></li></ul></div></details></div><div class=post-content><p>There are a lot of refactoring patterns available out there for us. I assume
that most of us use these patterns, at certain times without being aware that
those refactoring steps are defined as a pattern in the past. In this post, I
will take you through an example of refactoring Ruby code with the Extract
Class pattern by using Test-Driven Development.</p><p>Let&rsquo;s dive in!</p><h2 id=what-went-wrong-at-the-test>What went wrong at the test?<a hidden class=anchor aria-hidden=true href=#what-went-wrong-at-the-test>#</a></h2><p>Say we are professors in university and we compile a CSV file with our
students' grades. Some of them are good, some are not that good. We want to
have a small informal meeting with the students that did not pass the exam, in
a classroom and review the tests and discuss what went wrong. Given that there
are a lot of students in our class, writing an email for each of the students
is painful. Well, good we are programming professors, so we can write our own
little program to automate sending those emails:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#b58900>require</span> <span style=color:#2aa198>&#39;csv&#39;</span>
<span style=color:#b58900>require</span> <span style=color:#2aa198>&#39;mail&#39;</span>

<span style=color:#719e07>class</span> <span style=color:#268bd2>Parser</span>
  <span style=color:#719e07>def</span> <span style=color:#268bd2>initialize</span>(file_path)
    @file_path <span style=color:#719e07>=</span> file_path
  <span style=color:#719e07>end</span>

  <span style=color:#719e07>def</span> <span style=color:#268bd2>parse!</span>
    <span style=color:#cb4b16>CSV</span><span style=color:#719e07>.</span>foreach(@file_path, <span style=color:#2aa198>headers</span>: <span style=color:#719e07>true</span>) <span style=color:#719e07>do</span> <span style=color:#719e07>|</span>row<span style=color:#719e07>|</span>
      <span style=color:#719e07>if</span> failed_test?(row<span style=color:#719e07>[</span><span style=color:#2aa198>&#34;points&#34;</span><span style=color:#719e07>]</span>)
        <span style=color:#cb4b16>Mail</span><span style=color:#719e07>.</span>deliver <span style=color:#719e07>do</span>
          to      row<span style=color:#719e07>[</span><span style=color:#2aa198>&#34;email&#34;</span><span style=color:#719e07>]</span>
          from    <span style=color:#2aa198>&#39;John Doe &lt;john@doe.com&gt;&#39;</span>
          subject <span style=color:#2aa198>&#39;Post exam meeting invitation&#39;</span>
          body    failed_exam_body(row<span style=color:#719e07>[</span><span style=color:#2aa198>&#34;first_name&#34;</span><span style=color:#719e07>]</span>, row<span style=color:#719e07>[</span><span style=color:#2aa198>&#34;points&#34;</span><span style=color:#719e07>]</span>)
        <span style=color:#719e07>end</span>
      <span style=color:#719e07>else</span>
        <span style=color:#cb4b16>Mail</span><span style=color:#719e07>.</span>deliver <span style=color:#719e07>do</span>
          to      row<span style=color:#719e07>[</span><span style=color:#2aa198>&#34;email&#34;</span><span style=color:#719e07>]</span>
          from    <span style=color:#2aa198>&#39;John Doe &lt;john@doe.com&gt;&#39;</span>
          subject <span style=color:#2aa198>&#39;Exam results&#39;</span>
          body    passed_exam_body(row<span style=color:#719e07>[</span><span style=color:#2aa198>&#34;first_name&#34;</span><span style=color:#719e07>]</span>, row<span style=color:#719e07>[</span><span style=color:#2aa198>&#34;points&#34;</span><span style=color:#719e07>]</span>)
        <span style=color:#719e07>end</span>
      <span style=color:#719e07>end</span>
    <span style=color:#719e07>end</span>
  <span style=color:#719e07>end</span>

  <span style=color:#719e07>private</span>

  <span style=color:#719e07>def</span> <span style=color:#268bd2>failed_test?</span>(points)
    points <span style=color:#719e07>&lt;</span> <span style=color:#2aa198>50</span>
  <span style=color:#719e07>end</span>

  <span style=color:#719e07>def</span> <span style=color:#268bd2>failed_exam_body</span>(student_name, points)
    <span style=color:#2aa198>%Q{
</span><span style=color:#2aa198>      Hi </span><span style=color:#2aa198>#{</span>student_name<span style=color:#2aa198>}</span><span style=color:#2aa198>,
</span><span style=color:#2aa198>
</span><span style=color:#2aa198>      On the exam last week you got </span><span style=color:#2aa198>#{</span>points<span style=color:#2aa198>}</span><span style=color:#2aa198> points.
</span><span style=color:#2aa198>      It seems to me that you ran into some problems with it so I would like to
</span><span style=color:#2aa198>      invite you to a meeting in classrom 201, tomorrow at 2PM.
</span><span style=color:#2aa198>
</span><span style=color:#2aa198>      Regards,
</span><span style=color:#2aa198>      Prof. John Doe
</span><span style=color:#2aa198>    }</span>
  <span style=color:#719e07>end</span>

  <span style=color:#719e07>def</span> <span style=color:#268bd2>passed_exam_body</span>(student_name, points)
    <span style=color:#2aa198>%Q{
</span><span style=color:#2aa198>      Hi </span><span style=color:#2aa198>#{</span>student_name<span style=color:#2aa198>}</span><span style=color:#2aa198>,
</span><span style=color:#2aa198>
</span><span style=color:#2aa198>      On the exam last week you got </span><span style=color:#2aa198>#{</span>scored_points<span style=color:#2aa198>}</span><span style=color:#2aa198> points.
</span><span style=color:#2aa198>
</span><span style=color:#2aa198>      Congratulations,
</span><span style=color:#2aa198>      Prof. John Doe
</span><span style=color:#2aa198>    }</span>
  <span style=color:#719e07>end</span>
<span style=color:#719e07>end</span></code></pre></div><p>As you can see, it&rsquo;s quite a simple class. It takes a CSV file path and parses
it. For each row it checks if the points are less then the minimum amount to
pass the exam. If so, then a customised email is sent to each of the students.</p><p>Now, if we take a moment to think about the design of this class, there&rsquo;s a
question that we can ask ourselves: what does this class do? Although the
question is simple, the answer can reveal something very interesting.</p><p>The class parses a CSV file <strong>and</strong> sends an email to each of the students that
failed the test. You see, the word &ldquo;and&rdquo; is bolded because it points out to a
code smell - violation of the Single Responsibility Principle. If you don&rsquo;t
know what SRP is, I recommend you check out my <a href=/solid-principles>blog post</a>
on SOLID principles.</p><p>So, how can we refactor our class? Well, one of the options is using the
Extract Class pattern. Let&rsquo;s check it out.</p><h2 id=extract-class-pattern>Extract Class pattern<a hidden class=anchor aria-hidden=true href=#extract-class-pattern>#</a></h2><p>This pattern falls into a group of patterns that are used for moving features
(or functionalities) between objects. The benefit of this refactor is to make
your classes adhere to the SRP. Classes that adhere to the SRP are much easier
to understand and expand onto.</p><p>Now, back to the design of the class. Since we agreed that it breaks the SRP,
we need to decide which functionality we will move out into a new class. For
our example, we will let the <code>Parser</code> class just parse the CSV, while we will
create a new class called <code>Exam</code> which will contain all of the data and
behaviour around the exam data that we parse from the CSV. After that, we will
create a <code>Mailer</code> class, whose role will be just to send the email.</p><p>With that, we will have three classes into play - all having just <strong>one
responsibility</strong>, whether is representing an <code>Exam</code>, parsing a CSV or sending
emails.</p><p>The first step will be to wish the interface of the <code>Exam</code> and <code>Mailer</code> classes
and use them in the <code>Parser</code> class. This is called &ldquo;programming by <a href=http://c2.com/cgi/wiki?WishfulThinking>wishful
thinking</a>&rdquo;.</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#586e75># parser.rb</span>
<span style=color:#b58900>require</span> <span style=color:#2aa198>&#39;csv&#39;</span>

<span style=color:#719e07>class</span> <span style=color:#268bd2>Parser</span>
  <span style=color:#719e07>def</span> <span style=color:#268bd2>initialize</span>(file_path)
    @file_path <span style=color:#719e07>=</span> <span style=color:#cb4b16>File</span><span style=color:#719e07>.</span>expand_path(file_path)
  <span style=color:#719e07>end</span>

  <span style=color:#719e07>def</span> <span style=color:#268bd2>parse!</span>
    <span style=color:#cb4b16>CSV</span><span style=color:#719e07>.</span>foreach(@file_path, <span style=color:#2aa198>headers</span>: <span style=color:#719e07>true</span>) <span style=color:#719e07>do</span> <span style=color:#719e07>|</span>row<span style=color:#719e07>|</span>
      exam <span style=color:#719e07>=</span> <span style=color:#cb4b16>Exam</span><span style=color:#719e07>.</span>new(row)
      <span style=color:#719e07>if</span> exam<span style=color:#719e07>.</span>failed?
        <span style=color:#cb4b16>ExamMailer</span><span style=color:#719e07>.</span>failed!(exam)
      <span style=color:#719e07>else</span>
        <span style=color:#cb4b16>ExamMailer</span><span style=color:#719e07>.</span>passed!(exam)
      <span style=color:#719e07>end</span>
    <span style=color:#719e07>end</span>
  <span style=color:#719e07>end</span>
<span style=color:#719e07>end</span>

<span style=color:#cb4b16>Parser</span><span style=color:#719e07>.</span>new(<span style=color:#2aa198>&#34;grades.csv&#34;</span>)<span style=color:#719e07>.</span>parse!</code></pre></div><p>Good. As you can see, we&rsquo;ve added the new classes in <code>Parser#parse!</code> method
which radically simplified the readiness and simplicity of it. Since we now
have the classes in place, let&rsquo;s take a step back and use TDD to create these
classes.</p><h2 id=introducing-the-exam>Introducing the Exam<a hidden class=anchor aria-hidden=true href=#introducing-the-exam>#</a></h2><p>As we said before, the <code>Exam</code> class will hold the data and represent the
behaviour of an exam. But what does that mean? Well, simply put, it will have
methods that will decide if an exam is failed based on the data (points). Let&rsquo;s
TDD our way through this and write some tests before we implement the class:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#586e75># exam_test.rb</span>

<span style=color:#719e07>class</span> <span style=color:#268bd2>ExamTest</span> <span style=color:#719e07>&lt;</span> <span style=color:#cb4b16>Minitest</span><span style=color:#719e07>::</span><span style=color:#cb4b16>Test</span>
  <span style=color:#719e07>def</span> <span style=color:#268bd2>test_it_can_be_failed</span>
    exam <span style=color:#719e07>=</span> <span style=color:#cb4b16>Exam</span><span style=color:#719e07>.</span>new({ <span style=color:#2aa198>&#39;points&#39;</span> <span style=color:#719e07>=&gt;</span> <span style=color:#2aa198>&#39;20&#39;</span> })
    assert exam<span style=color:#719e07>.</span>failed?
  <span style=color:#719e07>end</span>

  <span style=color:#719e07>def</span> <span style=color:#268bd2>test_it_can_be_passed</span>
    exam <span style=color:#719e07>=</span> <span style=color:#cb4b16>Exam</span><span style=color:#719e07>.</span>new({ <span style=color:#2aa198>&#39;points&#39;</span> <span style=color:#719e07>=&gt;</span> <span style=color:#2aa198>&#39;51&#39;</span> })
    assert exam<span style=color:#719e07>.</span>passed?
  <span style=color:#719e07>end</span>
<span style=color:#719e07>end</span></code></pre></div><p>I assume the tests are quite self explanatory. The constructor will take a hash
as an argument and extract the points from it. Then the <code>Exam#passed?</code> and
<code>Exam#failed?</code> methods will check if the exam is passed or failed. The rule
here is that an exam is failed if it has less than 50 points scored. Let&rsquo;s
implement this:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#586e75># exam.rb</span>

<span style=color:#719e07>class</span> <span style=color:#268bd2>Exam</span>
  <span style=color:#719e07>attr_reader</span> <span style=color:#2aa198>:scored_points</span>

  <span style=color:#719e07>def</span> <span style=color:#268bd2>initialize</span>(entry)
    @scored_points <span style=color:#719e07>=</span> entry<span style=color:#719e07>[</span><span style=color:#2aa198>&#39;points&#39;</span><span style=color:#719e07>].</span>to_i
  <span style=color:#719e07>end</span>

  <span style=color:#719e07>def</span> <span style=color:#268bd2>failed?</span>
    @scored_points <span style=color:#719e07>&lt;</span> <span style=color:#2aa198>50</span>
  <span style=color:#719e07>end</span>

  <span style=color:#719e07>def</span> <span style=color:#268bd2>passed?</span>
    <span style=color:#719e07>!</span>failed?
  <span style=color:#719e07>end</span>
<span style=color:#719e07>end</span></code></pre></div><p>Really easy, right? If we run the tests, they will pass. Additionally we will
need the exam to contain the data for the student which has taken the exam.
Some of you might think that a student should be a separate object and I would
say that you are right. Also, others might say that there can be separate
classes for a failed and passed exams.</p><p>But, for this example we can keep it really simple. Let&rsquo;s add some tests for
the attribute readers:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#719e07>class</span> <span style=color:#268bd2>ExamTest</span> <span style=color:#719e07>&lt;</span> <span style=color:#cb4b16>Minitest</span><span style=color:#719e07>::</span><span style=color:#cb4b16>Test</span>
  <span style=color:#719e07>def</span> <span style=color:#268bd2>test_student_name</span>
    student_name <span style=color:#719e07>=</span> <span style=color:#2aa198>&#39;Ilija&#39;</span>
    exam <span style=color:#719e07>=</span> <span style=color:#cb4b16>Exam</span><span style=color:#719e07>.</span>new({ <span style=color:#2aa198>&#39;first_name&#39;</span> <span style=color:#719e07>=&gt;</span> student_name })

    assert_equal student_name, exam<span style=color:#719e07>.</span>student_name
  <span style=color:#719e07>end</span>

  <span style=color:#719e07>def</span> <span style=color:#268bd2>test_student_email</span>
    student_email <span style=color:#719e07>=</span> <span style=color:#2aa198>&#39;ile@eftimov.net&#39;</span>
    exam <span style=color:#719e07>=</span> <span style=color:#cb4b16>Exam</span><span style=color:#719e07>.</span>new({ <span style=color:#2aa198>&#39;email&#39;</span> <span style=color:#719e07>=&gt;</span> student_email })

    assert_equal student_email, exam<span style=color:#719e07>.</span>student_email
  <span style=color:#719e07>end</span>

  <span style=color:#719e07>def</span> <span style=color:#268bd2>test_failure</span>
    exam <span style=color:#719e07>=</span> <span style=color:#cb4b16>Exam</span><span style=color:#719e07>.</span>new({ <span style=color:#2aa198>&#39;points&#39;</span> <span style=color:#719e07>=&gt;</span> <span style=color:#2aa198>&#39;20&#39;</span> })
    assert exam<span style=color:#719e07>.</span>failed?
  <span style=color:#719e07>end</span>

  <span style=color:#719e07>def</span> <span style=color:#268bd2>test_success</span>
    exam <span style=color:#719e07>=</span> <span style=color:#cb4b16>Exam</span><span style=color:#719e07>.</span>new({ <span style=color:#2aa198>&#39;points&#39;</span> <span style=color:#719e07>=&gt;</span> <span style=color:#2aa198>&#39;51&#39;</span> })
    assert exam<span style=color:#719e07>.</span>passed?
  <span style=color:#719e07>end</span>
<span style=color:#719e07>end</span></code></pre></div><p>Implementing these methods is quite easy as well:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#719e07>class</span> <span style=color:#268bd2>Exam</span>
  <span style=color:#719e07>attr_reader</span> <span style=color:#2aa198>:student_name</span>, <span style=color:#2aa198>:student_email</span>, <span style=color:#2aa198>:scored_points</span>

  <span style=color:#719e07>def</span> <span style=color:#268bd2>initialize</span>(entry)
    @student_name  <span style=color:#719e07>=</span> entry<span style=color:#719e07>[</span><span style=color:#2aa198>&#39;first_name&#39;</span><span style=color:#719e07>]</span>
    @student_email <span style=color:#719e07>=</span> entry<span style=color:#719e07>[</span><span style=color:#2aa198>&#39;email&#39;</span><span style=color:#719e07>]</span>
    @scored_points <span style=color:#719e07>=</span> entry<span style=color:#719e07>[</span><span style=color:#2aa198>&#39;points&#39;</span><span style=color:#719e07>].</span>to_i
  <span style=color:#719e07>end</span>

  <span style=color:#719e07>def</span> <span style=color:#268bd2>failed?</span>
    @scored_points <span style=color:#719e07>&lt;</span> <span style=color:#2aa198>50</span>
  <span style=color:#719e07>end</span>

  <span style=color:#719e07>def</span> <span style=color:#268bd2>passed?</span>
    <span style=color:#719e07>!</span>failed?
  <span style=color:#719e07>end</span>
<span style=color:#719e07>end</span></code></pre></div><p>That is our <code>Exam</code> class with all of it&rsquo;s glory. Did you think about what we
did in this step? Really simple stuff - noticing that there is room for a class
to encapsulate all of the required data so it can answer to the question &ldquo;is
this exam failed or not?&rdquo;. We first wished what the interfaces of our classes
should be and then we created the first class, using TDD.</p><p>This is the <strong>Extract Class</strong> pattern at it&rsquo;s core - reducing complexity and
improving readibility by extracting data and behaviour to a new class.</p><p>That would be it at this moment. The <code>Exam</code> holds enough behaviour and data so
we can continue with the other classes.</p><h2 id=building-the-mailer>Building the mailer<a hidden class=anchor aria-hidden=true href=#building-the-mailer>#</a></h2><p>The next step is the <code>ExamMailer</code>. The mailer should contain only the behaviour
required to send the emails - nothing else. As we decided in the first step,
the mailer will have two methods: <code>ExamMailer.passed!</code> and
<code>ExamMailer.failed!</code>. The mailer class will use the <a href=https://github.com/mikel/mail>Mail
gem</a> to send emails.</p><p>Let&rsquo;s write some tests around them first and implement them after:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#cb4b16>Mail</span><span style=color:#719e07>.</span>defaults <span style=color:#719e07>do</span>
  delivery_method <span style=color:#2aa198>:test</span>
<span style=color:#719e07>end</span>

<span style=color:#719e07>class</span> <span style=color:#268bd2>MailerTest</span> <span style=color:#719e07>&lt;</span> <span style=color:#cb4b16>Minitest</span><span style=color:#719e07>::</span><span style=color:#cb4b16>Test</span>

  <span style=color:#719e07>def</span> <span style=color:#268bd2>setup</span>
    <span style=color:#cb4b16>Mail</span><span style=color:#719e07>::</span><span style=color:#cb4b16>TestMailer</span><span style=color:#719e07>.</span>deliveries<span style=color:#719e07>.</span>clear
    @student_mail <span style=color:#719e07>=</span> <span style=color:#2aa198>&#39;john@doe.com&#39;</span>
    @student_name <span style=color:#719e07>=</span> <span style=color:#2aa198>&#39;John&#39;</span>
  <span style=color:#719e07>end</span>

  <span style=color:#719e07>def</span> <span style=color:#268bd2>test_failed_exam_mail</span>
    points <span style=color:#719e07>=</span> <span style=color:#2aa198>&#39;49&#39;</span>
    exam <span style=color:#719e07>=</span> <span style=color:#cb4b16>Exam</span><span style=color:#719e07>.</span>new({ <span style=color:#2aa198>&#39;points&#39;</span> <span style=color:#719e07>=&gt;</span> points,
                      <span style=color:#2aa198>&#39;email&#39;</span> <span style=color:#719e07>=&gt;</span> @student_mail,
                      <span style=color:#2aa198>&#39;first_name&#39;</span> <span style=color:#719e07>=&gt;</span> @student_name })
    <span style=color:#cb4b16>ExamMailer</span><span style=color:#719e07>.</span>failed!(exam)
    mail <span style=color:#719e07>=</span> <span style=color:#cb4b16>Mail</span><span style=color:#719e07>::</span><span style=color:#cb4b16>TestMailer</span><span style=color:#719e07>.</span>deliveries<span style=color:#719e07>.</span>first

    assert_equal @student_mail, mail<span style=color:#719e07>.</span>to<span style=color:#719e07>.</span>first
    assert_equal <span style=color:#2aa198>&#34;Post exam meeting invitation&#34;</span>, mail<span style=color:#719e07>.</span>subject
    assert_match <span style=color:#dc322f>/you got </span><span style=color:#2aa198>#{</span>points<span style=color:#2aa198>}</span><span style=color:#dc322f> points/i</span>, mail<span style=color:#719e07>.</span>body<span style=color:#719e07>.</span>raw_source
  <span style=color:#719e07>end</span>

  <span style=color:#719e07>def</span> <span style=color:#268bd2>test_passed_exam_mail</span>
    points <span style=color:#719e07>=</span> <span style=color:#2aa198>&#39;50&#39;</span>
    exam <span style=color:#719e07>=</span> <span style=color:#cb4b16>Exam</span><span style=color:#719e07>.</span>new({ <span style=color:#2aa198>&#39;points&#39;</span> <span style=color:#719e07>=&gt;</span> points,
                      <span style=color:#2aa198>&#39;email&#39;</span> <span style=color:#719e07>=&gt;</span> @student_mail,
                      <span style=color:#2aa198>&#39;first_name&#39;</span> <span style=color:#719e07>=&gt;</span> @student_name })
    <span style=color:#cb4b16>ExamMailer</span><span style=color:#719e07>.</span>passed!(exam)
    mail <span style=color:#719e07>=</span> <span style=color:#cb4b16>Mail</span><span style=color:#719e07>::</span><span style=color:#cb4b16>TestMailer</span><span style=color:#719e07>.</span>deliveries<span style=color:#719e07>.</span>first

    assert_equal @student_mail, mail<span style=color:#719e07>.</span>to<span style=color:#719e07>.</span>first
    assert_equal <span style=color:#2aa198>&#34;Exam results&#34;</span>, mail<span style=color:#719e07>.</span>subject
    assert_match <span style=color:#dc322f>/you got </span><span style=color:#2aa198>#{</span>points<span style=color:#2aa198>}</span><span style=color:#dc322f> points/i</span>, mail<span style=color:#719e07>.</span>body<span style=color:#719e07>.</span>raw_source
  <span style=color:#719e07>end</span>
<span style=color:#719e07>end</span></code></pre></div><p>Now, there&rsquo;s a bit of boilerplate code here, which deals with the Mail gem. In
the beginning of the file, we set the delivery method of the Mail gem to be
<code>:test</code>. This means that the gem will hold all of the emails that are sent in
memory, without trying to make an actual delivery. Also, in our <code>setup</code> method
we invoke the <code>Mail::TestMailer.deliveries.clear</code> method, which clears the
deliveries collection before running each test. This is done so we have a fresh
collection of sent emails for each test, which helps with avoiding any
confusion.</p><p>As you can notice in the tests, we assert on the recipient email, on the e-mail
subject and on the e-mail body. With this step, we want to make sure that the
most essential parts of the e-mail (recipient, body and subject) are correct.</p><p>Extracting the mailer logic from the initial script to a new mailer class is
rather simple:</p><div class=highlight><pre style=color:#93a1a1;background-color:#002b36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ruby data-lang=ruby><span style=color:#b58900>require</span> <span style=color:#2aa198>&#39;mail&#39;</span>

<span style=color:#719e07>class</span> <span style=color:#268bd2>ExamMailer</span>
  <span style=color:#719e07>def</span> <span style=color:#268bd2>self</span><span style=color:#719e07>.</span><span style=color:#268bd2>failed!</span>(exam)
    <span style=color:#719e07>new</span>(exam)<span style=color:#719e07>.</span>failed!
  <span style=color:#719e07>end</span>

  <span style=color:#719e07>def</span> <span style=color:#268bd2>self</span><span style=color:#719e07>.</span><span style=color:#268bd2>passed!</span>(exam)
    <span style=color:#719e07>new</span>(exam)<span style=color:#719e07>.</span>passed!
  <span style=color:#719e07>end</span>

  <span style=color:#719e07>def</span> <span style=color:#268bd2>initialize</span>(exam)
    @exam <span style=color:#719e07>=</span> exam
  <span style=color:#719e07>end</span>

  <span style=color:#719e07>def</span> <span style=color:#268bd2>failed!</span>
    send_mail!(<span style=color:#2aa198>&#39;Post exam meeting invitation&#39;</span>, failed_exam_email_body)
  <span style=color:#719e07>end</span>

  <span style=color:#719e07>def</span> <span style=color:#268bd2>passed!</span>
    send_mail!(<span style=color:#2aa198>&#39;Exam results&#39;</span>, passed_exam_email_body)
  <span style=color:#719e07>end</span>

  <span style=color:#719e07>private</span>

  <span style=color:#719e07>def</span> <span style=color:#268bd2>send_mail!</span>(subject, body)
    mail <span style=color:#719e07>=</span> <span style=color:#cb4b16>Mail</span><span style=color:#719e07>.</span>new
    mail<span style=color:#719e07>.</span>to <span style=color:#719e07>=</span> @exam<span style=color:#719e07>.</span>student_email
    mail<span style=color:#719e07>.</span>from <span style=color:#719e07>=</span> <span style=color:#2aa198>&#39;John Doe &lt;john@doe.com&gt;&#39;</span>
    mail<span style=color:#719e07>.</span>subject <span style=color:#719e07>=</span> subject
    mail<span style=color:#719e07>.</span>body <span style=color:#719e07>=</span> body
    mail<span style=color:#719e07>.</span>deliver
  <span style=color:#719e07>end</span>

  <span style=color:#719e07>def</span> <span style=color:#268bd2>passed_exam_email_body</span>
    <span style=color:#2aa198>%Q{
</span><span style=color:#2aa198>      Hi </span><span style=color:#2aa198>#{</span>@exam<span style=color:#719e07>.</span>student_name<span style=color:#2aa198>}</span><span style=color:#2aa198>,
</span><span style=color:#2aa198>
</span><span style=color:#2aa198>      On the exam last week you got </span><span style=color:#2aa198>#{</span>@exam<span style=color:#719e07>.</span>scored_points<span style=color:#2aa198>}</span><span style=color:#2aa198> points.
</span><span style=color:#2aa198>
</span><span style=color:#2aa198>      Congratulations,
</span><span style=color:#2aa198>      Prof. John Doe
</span><span style=color:#2aa198>    }</span>
  <span style=color:#719e07>end</span>

  <span style=color:#719e07>def</span> <span style=color:#268bd2>failed_exam_email_body</span>
    <span style=color:#2aa198>%Q{
</span><span style=color:#2aa198>      Hi </span><span style=color:#2aa198>#{</span>@exam<span style=color:#719e07>.</span>student_name<span style=color:#2aa198>}</span><span style=color:#2aa198>,
</span><span style=color:#2aa198>
</span><span style=color:#2aa198>      On the exam last week you got </span><span style=color:#2aa198>#{</span>@exam<span style=color:#719e07>.</span>scored_points<span style=color:#2aa198>}</span><span style=color:#2aa198> points.
</span><span style=color:#2aa198>      It seems to me that you ran into some problems with it so I would like to
</span><span style=color:#2aa198>      invite you to a group meeting in classrom 201, tomorrow at 2PM.
</span><span style=color:#2aa198>
</span><span style=color:#2aa198>      Regards,
</span><span style=color:#2aa198>      Prof. John Doe
</span><span style=color:#2aa198>    }</span>
  <span style=color:#719e07>end</span>
<span style=color:#719e07>end</span></code></pre></div><p>Most of the magic lies within the <code>send_mail!</code> method. It builds a new <code>Mail</code>
object and delivers it.</p><p>As you saw in this step, we extracted the mailing logic from the script to a
new well-defined class. The next (and last step) is reviewing the original
<code>Parser</code> class and pondering a bit with it.</p><h2 id=back-to-the-parser>Back to the parser<a hidden class=anchor aria-hidden=true href=#back-to-the-parser>#</a></h2><p>After we did all of the hard work around extracting two new classes and writing
tests for them, it is time to take a look at the <code>Parser</code> class. I would say
that improving it further would be over-engineering it, at least in the scope
of this article. The only thing that I would like us to think about is the name
of the class. Does <code>Parser</code> do it?</p><p>This is quite subjective and I would guess some of you wouldn&rsquo;t agree with me,
but in my mind the <code>Parser</code> is quite broad term. In this instance, I think that
<code>Grader</code> is a better name for it.</p><h2 id=taking-a-step-back>Taking a step back<a hidden class=anchor aria-hidden=true href=#taking-a-step-back>#</a></h2><p>As you could see in this article, there&rsquo;s quite a bit of work around
refactoring existing code. There are more than a two dozen patterns around
refactoring, with Extract Class being one of the simplest ones. Having this
said, I would like to ask you a question:</p><p>Do you really need to think in patterns? Do we really need to have a
&ldquo;predefined sequence of steps&rdquo; to make our code better?</p><p>I think that it&rsquo;s not really about applying a certain pattern, it&rsquo;s more about
caring about the design of the code and writing tests for it. As a rule of
thumb, I always try to think about the five <a href=/solid-principles>SOLID
principles</a> when writing my code. And when you are
refactoring - understand the motivation and the context behind the code that
you are refactoring, without focusing on which pattern you will apply.</p><div id=revue-embed><form action=https://www.getrevue.co/profile/itsilija/add_subscriber method=post id=revue-form name=revue-form target=_blank><p><b>Liked this article?</b>
Subscribe to my newsletter and get future articles in your inbox. It's a
short and sweet read, going out to +1000 of other engineers.</p><div class=revue-form-group><input class=revue-form-field placeholder="Your email address..." type=email name=member[email] id=member_email></div><div class=revue-form-actions><input type=submit value=Subscribe name=member[subscribe] id=member_submit></div></form></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://ieftimov.com/tags/tdd/>tdd</a></li><li><a href=https://ieftimov.com/tags/extract/>extract</a></li><li><a href=https://ieftimov.com/tags/class/>class</a></li></ul><nav class=paginav><a class=prev href=https://ieftimov.com/post/refactoring-smelly-parameters-lists/><span class=title>« Prev Page</span><br><span>Refactoring in Ruby: Smelly Parameters Lists</span></a>
<a class=next href=https://ieftimov.com/post/rails-tls-hsts-cookies/><span class=title>Next Page »</span><br><span>Rails, Secure Cookies, HSTS and friends</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Refactoring in Ruby: TDD your way through Extract Class on twitter" href="https://twitter.com/intent/tweet/?text=Refactoring%20in%20Ruby%3a%20TDD%20your%20way%20through%20Extract%20Class&url=https%3a%2f%2fieftimov.com%2fpost%2ftdd-extract-class%2f&hashtags=tdd%2cextract%2cclass"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Refactoring in Ruby: TDD your way through Extract Class on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fieftimov.com%2fpost%2ftdd-extract-class%2f&title=Refactoring%20in%20Ruby%3a%20TDD%20your%20way%20through%20Extract%20Class&summary=Refactoring%20in%20Ruby%3a%20TDD%20your%20way%20through%20Extract%20Class&source=https%3a%2f%2fieftimov.com%2fpost%2ftdd-extract-class%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Refactoring in Ruby: TDD your way through Extract Class on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fieftimov.com%2fpost%2ftdd-extract-class%2f&title=Refactoring%20in%20Ruby%3a%20TDD%20your%20way%20through%20Extract%20Class"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Refactoring in Ruby: TDD your way through Extract Class on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fieftimov.com%2fpost%2ftdd-extract-class%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Refactoring in Ruby: TDD your way through Extract Class on whatsapp" href="https://api.whatsapp.com/send?text=Refactoring%20in%20Ruby%3a%20TDD%20your%20way%20through%20Extract%20Class%20-%20https%3a%2f%2fieftimov.com%2fpost%2ftdd-extract-class%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Refactoring in Ruby: TDD your way through Extract Class on telegram" href="https://telegram.me/share/url?text=Refactoring%20in%20Ruby%3a%20TDD%20your%20way%20through%20Extract%20Class&url=https%3a%2f%2fieftimov.com%2fpost%2ftdd-extract-class%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>Copyright 2021 © Ilija Eftimov</span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script>let menu=document.getElementById('menu');menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)},document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script></body></html>