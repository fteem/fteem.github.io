<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Testing in Go: WebSockets - Ilija Eftimov</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta property="og:title" content="Testing in Go: WebSockets" />
<meta property="og:description" content="WebSockets offer duplex communication from a non-trusted source to a server that we own across a TCP socket connection. This means that, instead of continually polling the web server for updates and having to perform the whole TCP dance with each request, we can maintain a single TCP socket connection and then send and listen to messages on said connection.
In Go&#39;s ecosystem there are few different implementations of the WebSocket protocol." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ieftimov.com/post/testing-in-go-websockets/" />
<meta property="og:image" content="https://ieftimov.com/cards/testing-in-go-websockets.gif" />
<meta property="article:published_time" content="2020-02-22T12:32:51+01:00" />
<meta property="article:modified_time" content="2020-02-22T12:32:51+01:00" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://ieftimov.com/cards/testing-in-go-websockets.gif"/>

<meta name="twitter:title" content="Testing in Go: WebSockets"/>
<meta name="twitter:description" content="WebSockets offer duplex communication from a non-trusted source to a server that we own across a TCP socket connection. This means that, instead of continually polling the web server for updates and having to perform the whole TCP dance with each request, we can maintain a single TCP socket connection and then send and listen to messages on said connection.
In Go&#39;s ecosystem there are few different implementations of the WebSocket protocol."/>
<link href='https://fonts.googleapis.com/css?family=Playfair+Display:700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" media="screen" href="https://ieftimov.com/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://ieftimov.com/css/main.css" />
		<link rel="stylesheet" type="text/css" href="https://ieftimov.com/css/overrides.css" />
	

	<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
		<script src="https://ieftimov.com/js/main.js"></script><script src="https://ieftimov.com/js/tooltip.js"></script>
</head>

<body>
	<div class="container wrapper">
		<div class="header">
	
		<div class="avatar">
			<a href="https://ieftimov.com/">
				<img src="/avatar.png" alt="Ilija Eftimov" />
			</a>
		</div>
	
	<h1 class="site-title"><a href="https://ieftimov.com/">Ilija Eftimov</a></h1>
	<div class="site-description"><p>A human, interested in building products and software.</p><nav class="nav social">
			<ul class="flat"><li><a href="https://github.com/fteem" title="Github"><i data-feather="github"></i></a></li><li><a href="https://twitter.com/fteem" title="Twitter"><i data-feather="twitter"></i></a></li><li><a href="https://www.linkedin.com/in/ieftimov" title="Linkedin"><i data-feather="linkedin"></i></a></li><li><a href="mailto:blog@ieftimov.com" title="Email"><i data-feather="mail"></i></a></li></ul>
		</nav>
	</div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="/categories/testing-in-go">Testing in Go</a>
			</li>
			
			<li>
				<a href="/posts">Archive</a>
			</li>
			
			<li>
				<a href="/about">About</a>
			</li>
			
			<li>
				<a href="https://forms.gle/orfXK5jh1LRaiFzo8">Suggest a topic</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post">
			<div class="post-header">
				
					<div class="meta">
						<div class="date">
							<span class="day">13</span>
							<span class="rest">Mar 2020</span>
						</div>
					</div>
				
				<div class="matter">
					<h1 class="title">Testing in Go: WebSockets</h1>
				</div>
			</div>
					
			<div class="markdown">
				<p>WebSockets offer duplex communication from a non-trusted source to a server
that we own across a TCP socket connection. This means that, instead of
continually polling the web server for updates and having to perform the whole
TCP dance with each request, we can maintain a single TCP socket connection and
then send and listen to messages on said connection.</p>
<p>In Go's ecosystem there are few different implementations of <a href="https://tools.ietf.org/html/rfc6455">the WebSocket
protocol</a>. Some libraries are pure
implementation of the protocol. Others though, have chosen to build on top of
the WebSocket protocol to create better abstractions for their particular
use-case.</p>
<p>Here's a non-exhaustive list of Go WebSocket protocol implementations:</p>
<ul>
<li><a href="https://pkg.go.dev/golang.org/x/net/websocket"><code>x/net/websocket</code></a> (from
<a href="https://godoc.org/-/subrepo">Go sub-repository packages</a>)</li>
<li><a href="https://github.com/gorilla/websocket"><code>gorilla/websocket</code></a></li>
<li><a href="https://github.com/nhooyr/websocket"><code>nhooyr/websocket</code></a></li>
<li><a href="https://github.com/gobwas/ws"><code>gobwas/ws</code></a></li>
<li><a href="https://github.com/sacOO7/gowebsocket"><code>sacOO7/gowebsocket</code></a></li>
</ul>
<p>In this article we will use the excellent <code>gorilla/websocket</code> implementation of
the WebSocket protocol, from the <a href="https://github.com/gorilla/websocket">Gorilla Web
Toolkit</a> project. You will notice that
testing WebSocket is not much different from <a href="/post/testing-in-go-testing-http-servers">testing HTTP
servers</a>. Still, there are aspects of
WebSockets that we have to take into account while testing.</p>
<h2 id="auctions">Auctions</h2>
<p>One of the businesses whose backbone is real-time communication are online
auction houses. During an auction, seconds make the difference between winning
or losing a collectible item that you have been wanting for so long.</p>
<p>Let's use a simple auction application powered by <code>gorilla/websocket</code> as an
example for this article.</p>
<p>First, we will define two very simple entities <code>Bid</code> and <code>Auction</code> that we will
use in our WebSocket handlers. The <code>Auction</code> will receive a <code>Bid</code> method that
we will use to place a new bid on the <code>Auction</code>.</p>
<h3 id="entities">Entities</h3>
<p>Let's look at the <code>Auction</code> and <code>Bid</code> types, in all of their glory:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="font-weight:bold">type</span> Bid <span style="font-weight:bold">struct</span> {
	UserID <span style="color:#458;font-weight:bold">int</span>     <span style="color:#b84">`</span><span style="color:#b84">json:&#34;user_id&#34;</span><span style="color:#b84">`</span>
	Amount <span style="color:#458;font-weight:bold">float64</span> <span style="color:#b84">`</span><span style="color:#b84">json:&#34;amount&#34;</span><span style="color:#b84">`</span>
}

<span style="font-weight:bold">type</span> Auction <span style="font-weight:bold">struct</span> {
	ItemID  <span style="color:#458;font-weight:bold">int</span>   <span style="color:#b84">`</span><span style="color:#b84">json:&#34;item_id&#34;</span><span style="color:#b84">`</span>
	EndTime <span style="color:#458;font-weight:bold">int64</span> <span style="color:#b84">`</span><span style="color:#b84">json:&#34;end_time&#34;</span><span style="color:#b84">`</span>
	Bids    []<span style="font-weight:bold">*</span>Bid
}

<span style="font-weight:bold">func</span> <span style="color:#900;font-weight:bold">NewAuction</span>(d time.Duration, itemID <span style="color:#458;font-weight:bold">int</span>, b []<span style="font-weight:bold">*</span>Bid) Auction {
	<span style="font-weight:bold">return</span> Auction{
		ItemID:  itemID,
		EndTime: time.<span style="color:#900;font-weight:bold">Now</span>().<span style="color:#900;font-weight:bold">Add</span>(d).<span style="color:#900;font-weight:bold">Unix</span>(),
		Bids:    b,
	}
}</code></pre></div>
<p>Both of the types are fairly simple, encapsulating very little data. The
<code>NewAuction</code> constructor function builds an auction with a duration, <code>itemID</code>
and a slice of <code>*Bid</code>s.</p>
<h3 id="bidding">Bidding</h3>
<p>We will place a bid on an auction through the <code>Bid</code> method:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="font-weight:bold">func</span> (a <span style="font-weight:bold">*</span>Auction) <span style="color:#900;font-weight:bold">Bid</span>(amount <span style="color:#458;font-weight:bold">float64</span>, userID <span style="color:#458;font-weight:bold">int</span>) (<span style="font-weight:bold">*</span>Bid, <span style="color:#458;font-weight:bold">error</span>) {
	<span style="font-weight:bold">if</span> <span style="color:#999">len</span>(a.Bids) &gt; <span style="color:#099">0</span> {
		largestBid <span style="font-weight:bold">:=</span> a.Bids[<span style="color:#999">len</span>(a.Bids)<span style="font-weight:bold">-</span><span style="color:#099">1</span>]
		<span style="font-weight:bold">if</span> largestBid.Amount <span style="font-weight:bold">&gt;=</span> amount {
			<span style="font-weight:bold">return</span> <span style="font-weight:bold">nil</span>, fmt.<span style="color:#900;font-weight:bold">Errorf</span>(<span style="color:#b84">&#34;amount must be larger than %.2f&#34;</span>, largestBid.Amount)
		}
	}

	<span style="font-weight:bold">if</span> a.EndTime &lt; time.<span style="color:#900;font-weight:bold">Now</span>().<span style="color:#900;font-weight:bold">Unix</span>() {
		<span style="font-weight:bold">return</span> <span style="font-weight:bold">nil</span>, fmt.<span style="color:#900;font-weight:bold">Errorf</span>(<span style="color:#b84">&#34;auction already closed&#34;</span>)
	}

	bid <span style="font-weight:bold">:=</span> Bid{
		Amount: amount,
		UserID: userID,
	}

	<span style="color:#998;font-style:italic">// Mutex lock
</span><span style="color:#998;font-style:italic"></span>	a.Bids = <span style="color:#999">append</span>(a.Bids, <span style="font-weight:bold">&amp;</span>bid)
	<span style="color:#998;font-style:italic">// Mutex unlock
</span><span style="color:#998;font-style:italic"></span>
	<span style="font-weight:bold">return</span> <span style="font-weight:bold">&amp;</span>bid, <span style="font-weight:bold">nil</span>
}</code></pre></div>
<p>The <code>Auction</code>'s <code>Bid</code> method is where the bidding magic happens. It takes an
<code>amount</code> and a <code>userID</code> as arguments and adds a <code>Bid</code> to the <code>Auction</code>. Also,
it checks if the <code>Auction</code> has already closed and that the new bid <code>amount</code> is
larger than the <code>amount</code> of the largest bid. If any of these conditions are not
true, it will return an appropriate error to the caller.</p>
<p>Having the types and the <code>Bid</code> method out of the way, let's dive into the
WebSockets mechanics.</p>
<h2 id="handling-websockets">Handling WebSockets</h2>
<p>Imagine a web frontend that can place bids on an auction in real time. With
every JSON message it sends over WebSockets it will supply the identifier of
the user placing the bid (<code>UserID</code>) and the amount (<code>Amount</code>) of the bid. Once
the server accepts the message, it will place the bid and reply with a
meaningful answer to the client.</p>
<p>On the server side, this communication will be done by a <code>net/http</code> <code>Handler</code>.
It will handle all of the WebSocket intricacies, with a few notable steps:</p>
<ol>
<li>Upgrade the incoming HTTP connection to a WebSocket one</li>
<li>Accept incoming messages from a client</li>
<li>Decode bid from the inbound message</li>
<li>Place the bid</li>
<li>Send an outbound message with the reply to the client</li>
</ol>
<p>Let's write such a handler.</p>
<p>First, let's define the <code>inbound</code> and <code>outbound</code> message types:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="font-weight:bold">type</span> inbound <span style="font-weight:bold">struct</span> {
	UserID <span style="color:#458;font-weight:bold">int</span>     <span style="color:#b84">`</span><span style="color:#b84">json:&#34;user_id&#34;</span><span style="color:#b84">`</span>
	Amount <span style="color:#458;font-weight:bold">float64</span> <span style="color:#b84">`</span><span style="color:#b84">json:&#34;amount&#34;</span><span style="color:#b84">`</span>
}

<span style="font-weight:bold">type</span> outbound <span style="font-weight:bold">struct</span> {
	Body <span style="color:#458;font-weight:bold">string</span> <span style="color:#b84">`</span><span style="color:#b84">json:&#34;body&#34;</span><span style="color:#b84">`</span>
}</code></pre></div>
<p>Both of them represent the in/outbound messages respectively, which will be the
data flowing between the client and the server. The <code>inbound</code> message will
represent a bid, while the <code>outbound</code> type represents a simple message with
some text in its <code>Body</code>.</p>
<p>Next, let's define the <code>bidsHandler</code>, including its <code>ServeHTTP</code> method
containing the HTTP connection upgrade:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="font-weight:bold">var</span> upgrader = websocket.Upgrader{}

<span style="font-weight:bold">type</span> bidsHandler <span style="font-weight:bold">struct</span> {
	auction <span style="font-weight:bold">*</span>Auction
}

<span style="font-weight:bold">func</span> (bh bidsHandler) <span style="color:#900;font-weight:bold">ServeHTTP</span>(w http.ResponseWriter, r <span style="font-weight:bold">*</span>http.Request) {
	upgrader.CheckOrigin = <span style="font-weight:bold">func</span>(r <span style="font-weight:bold">*</span>http.Request) <span style="color:#458;font-weight:bold">bool</span> { <span style="font-weight:bold">return</span> <span style="font-weight:bold">true</span> }
	ws, err <span style="font-weight:bold">:=</span> upgrader.<span style="color:#900;font-weight:bold">Upgrade</span>(w, r, <span style="font-weight:bold">nil</span>)
	<span style="font-weight:bold">if</span> err <span style="font-weight:bold">!=</span> <span style="font-weight:bold">nil</span> {
		log.<span style="color:#900;font-weight:bold">Println</span>(<span style="color:#b84">&#34;upgrade:&#34;</span>, err)
		<span style="font-weight:bold">return</span>
	}
	<span style="font-weight:bold">defer</span> ws.<span style="color:#900;font-weight:bold">Close</span>()

	<span style="color:#998;font-style:italic">// More to come...
</span><span style="color:#998;font-style:italic"></span>}</code></pre></div>
<p>First, we define a <code>websocket.Upgrader</code>, which takes the <code>http.ResponseWriter</code>
and the <code>*http.Request</code> from the handler and upgrades the connection. Because
this is just an example application, the <code>upgrader.CheckOrigin</code> method will
only return a <code>true</code> bool, without checking the origin of the incoming request.</p>
<p>Once the <code>upgrader</code> finishes with the connection upgrade, it returns a
<code>*websocket.Conn</code> object, stored in the <code>ws</code> variable. The <code>*websocket.Conn</code>
will receive all of the incoming messages, where our handler will be reading
from. Also, the handler will be writing messages to the <code>*websocket.Conn</code>,
which will send an outbound message to the client.</p>
<p>Let's add the message loop next:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="font-weight:bold">func</span> (bh bidsHandler) <span style="color:#900;font-weight:bold">ServeHTTP</span>(w http.ResponseWriter, r <span style="font-weight:bold">*</span>http.Request) {
	<span style="color:#998;font-style:italic">// Code from above...
</span><span style="color:#998;font-style:italic"></span>
	<span style="font-weight:bold">for</span> {
		_, m, err <span style="font-weight:bold">:=</span> ws.<span style="color:#900;font-weight:bold">ReadMessage</span>()
		<span style="font-weight:bold">if</span> err <span style="font-weight:bold">!=</span> <span style="font-weight:bold">nil</span> {
			<span style="font-weight:bold">if</span> websocket.<span style="color:#900;font-weight:bold">IsUnexpectedCloseError</span>(err, websocket.CloseGoingAway, websocket.CloseAbnormalClosure) {
				log.<span style="color:#900;font-weight:bold">Printf</span>(<span style="color:#b84">&#34;error: %v&#34;</span>, err)
			}
			<span style="font-weight:bold">return</span>
		}

		<span style="font-weight:bold">var</span> in inbound
		err = json.<span style="color:#900;font-weight:bold">Unmarshal</span>(m, <span style="font-weight:bold">&amp;</span>in)
		<span style="font-weight:bold">if</span> err <span style="font-weight:bold">!=</span> <span style="font-weight:bold">nil</span> {
			<span style="color:#900;font-weight:bold">handleError</span>(ws, err)
			<span style="font-weight:bold">continue</span>
		}

		bid, err <span style="font-weight:bold">:=</span> bh.auction.<span style="color:#900;font-weight:bold">Bid</span>(in.Amount, in.UserID)
		<span style="font-weight:bold">if</span> err <span style="font-weight:bold">!=</span> <span style="font-weight:bold">nil</span> {
			<span style="color:#900;font-weight:bold">handleError</span>(ws, err)
			<span style="font-weight:bold">continue</span>
		}

		out, err <span style="font-weight:bold">:=</span> json.<span style="color:#900;font-weight:bold">Marshal</span>(outbound{Body: fmt.<span style="color:#900;font-weight:bold">Sprintf</span>(<span style="color:#b84">&#34;Bid placed: %.2f&#34;</span>, bid.Amount)})
		<span style="font-weight:bold">if</span> err <span style="font-weight:bold">!=</span> <span style="font-weight:bold">nil</span> {
			<span style="color:#900;font-weight:bold">handleError</span>(ws, err)
			<span style="font-weight:bold">continue</span>
		}

		err = ws.<span style="color:#900;font-weight:bold">WriteMessage</span>(websocket.BinaryMessage, out)
		<span style="font-weight:bold">if</span> err <span style="font-weight:bold">!=</span> <span style="font-weight:bold">nil</span> {
			<span style="color:#900;font-weight:bold">handleError</span>(ws, err)
			<span style="font-weight:bold">continue</span>
		}
	}
}</code></pre></div>
<p>This <code>for</code> loop does a few things. First, it reads a new WebSocket message
using <code>ws.ReadMessage()</code>, which returns the type of the message (binary or
text), the message itself (<code>m</code>) and a potential error (<code>err</code>). Then, it checks
the error if the client has closed the connection unexpectedly.</p>
<p>Once the error handling is completed and the message is retrieved, we decode it
using <code>json.Unmarshal</code> into the <code>in</code> inbound message. Once <code>in</code> is available,
we invoke <code>bh.auction.Bid</code> which places a bid on the auction, using the amount
of the bid (<code>in.Amount</code>) and the ID of the bidder (<code>in.UserID</code>) as arguments.
The <code>Bid</code> method returns a bid (<code>bid</code>) and an error (<code>err</code>).</p>
<p>After the bid is placed, we use <code>json.Marshal</code> to convert an <code>outbound</code> message
with the bid confirmation message encapsulated to slice of bytes (<code>[]byte</code>).
Then we send the bytes to the client using the <code>ws.WriteMessage</code> method, which
concludes the request-response server loop.</p>
<p>We can ignore the client side for now. Let's now see how we can test this
WebSockets handler code.</p>
<h2 id="testing-websockets-handlers">Testing WebSockets handlers</h2>
<p>Although writing WebSocket handlers is more involved relative to ordinary HTTP
handlers, testing them is simple. In fact, testing WebSockets handlers is as
simple as testing HTTP handlers. This is because WebSockets are built on HTTP,
so testing WebSockets is done using the same tools that <a href="/post/testing-in-go-testing-http-servers">testing HTTP
servers</a> is done with.</p>
<p>We will begin by adding the test setup:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="font-weight:bold">func</span> <span style="color:#900;font-weight:bold">TestBidsHandler</span>(t <span style="font-weight:bold">*</span>testing.T) {
	tcs <span style="font-weight:bold">:=</span> []<span style="font-weight:bold">struct</span> {
		name     <span style="color:#458;font-weight:bold">string</span>
		bids     []<span style="font-weight:bold">*</span>Bid
		duration time.Duration
		message  inbound
		reply    outbound
	}{
		{
			name:     <span style="color:#b84">&#34;with good bid&#34;</span>,
			bids:     []<span style="font-weight:bold">*</span>Bid{},
			duration: time.Hour <span style="font-weight:bold">*</span> <span style="color:#099">1</span>,
			message:  inbound{UserID: <span style="color:#099">1</span>, Amount: <span style="color:#099">10</span>},
			reply:    outbound{Body: <span style="color:#b84">&#34;Bid placed: 10.00&#34;</span>},
		},
		{
			name: <span style="color:#b84">&#34;with bad bid&#34;</span>,
			bids: []<span style="font-weight:bold">*</span>Bid{
				<span style="font-weight:bold">&amp;</span>Bid{
					UserID: <span style="color:#099">1</span>,
					Amount: <span style="color:#099">20</span>,
				},
			},
			duration: time.Hour <span style="font-weight:bold">*</span> <span style="color:#099">1</span>,
			message:  inbound{UserID: <span style="color:#099">1</span>, Amount: <span style="color:#099">10</span>},
			reply:    outbound{Body: <span style="color:#b84">&#34;amount must be larger than 20.00&#34;</span>},
		},
		{

			name: <span style="color:#b84">&#34;good bid on expired auction&#34;</span>,
			bids: []<span style="font-weight:bold">*</span>Bid{
				<span style="font-weight:bold">&amp;</span>Bid{
					UserID: <span style="color:#099">1</span>,
					Amount: <span style="color:#099">20</span>,
				},
			},
			duration: time.Hour <span style="font-weight:bold">*</span> <span style="font-weight:bold">-</span><span style="color:#099">1</span>,
			message:  inbound{UserID: <span style="color:#099">1</span>, Amount: <span style="color:#099">30</span>},
			reply:    outbound{Body: <span style="color:#b84">&#34;auction already closed&#34;</span>},
		},
	}

	<span style="font-weight:bold">for</span> _, tt <span style="font-weight:bold">:=</span> <span style="font-weight:bold">range</span> tcs {
		t.<span style="color:#900;font-weight:bold">Run</span>(tt.name, <span style="font-weight:bold">func</span>(t <span style="font-weight:bold">*</span>testing.T) {
			a <span style="font-weight:bold">:=</span> <span style="color:#900;font-weight:bold">NewAuction</span>(tt.duration, <span style="color:#099">1</span>, tt.bids)
			h <span style="font-weight:bold">:=</span> bidsHandler{<span style="font-weight:bold">&amp;</span>a}

			<span style="color:#998;font-style:italic">// To be added...
</span><span style="color:#998;font-style:italic"></span>		})
	}
}</code></pre></div>
<p>First, we begin by defining the testcase type. It has a <code>name</code>, which is the
human-readable name of the test case. Also, each testcase has a <code>bids</code> slice
and a <code>duration</code> which will be used to create a test <code>Auction</code> with. The
testcase also has an <code>inbound</code> <code>message</code> and an <code>outbound</code> <code>reply</code> - which is
what the test case will send to and expect in return from the handler.</p>
<p>After, in the <code>TestBidsHandler</code> we add three different test cases â€“ one where
the client wants to place a bad bid, that is lower than the largest bid,
another test case where the client adds a good bid and a third one where the
client bids on an expired auction.</p>
<p>In the <code>for</code> loop, for each of the test cases, we create a subtest which uses
the <code>NewAuction</code> constructor to create a new test auction. We also create a
<code>bidsHandler</code> that takes the newly created <code>Auction</code> as an attribute.</p>
<p>Let's finish off the subtest function:
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="font-weight:bold">func</span> <span style="color:#900;font-weight:bold">TestBidsHandler</span>(t <span style="font-weight:bold">*</span>testing.T) {
	<span style="color:#998;font-style:italic">// Test cases and other setup from above...
</span><span style="color:#998;font-style:italic"></span>
	<span style="font-weight:bold">for</span> _, tt <span style="font-weight:bold">:=</span> <span style="font-weight:bold">range</span> tcs {
		t.<span style="color:#900;font-weight:bold">Run</span>(tt.name, <span style="font-weight:bold">func</span>(t <span style="font-weight:bold">*</span>testing.T) {
			a <span style="font-weight:bold">:=</span> <span style="color:#900;font-weight:bold">NewAuction</span>(tt.duration, <span style="color:#099">1</span>, tt.bids)
			h <span style="font-weight:bold">:=</span> bidsHandler{<span style="font-weight:bold">&amp;</span>a}

			s, ws <span style="font-weight:bold">:=</span> <span style="color:#900;font-weight:bold">newWSServer</span>(t, h)
			<span style="font-weight:bold">defer</span> s.<span style="color:#900;font-weight:bold">Close</span>()
			<span style="font-weight:bold">defer</span> ws.<span style="color:#900;font-weight:bold">Close</span>()

			<span style="color:#900;font-weight:bold">sendMessage</span>(t, ws, tt.message)

			reply <span style="font-weight:bold">:=</span> <span style="color:#900;font-weight:bold">receiveWSMessage</span>(t, ws)

			<span style="font-weight:bold">if</span> reply <span style="font-weight:bold">!=</span> tt.reply {
				t.<span style="color:#900;font-weight:bold">Fatalf</span>(<span style="color:#b84">&#34;Expected &#39;%+v&#39;, got &#39;%+v&#39;&#34;</span>, tt.reply, reply)
			}
		})
	}
}</code></pre></div></p>
<p>We added few new functions to the subtest function body. The <code>newWSServer</code> will
create a test server and upgrade it to a WebSocket connection, returning both
the server and the WebSocket connections. Then, the <code>sendMessage</code> function will
send the message from the test case to the test server throught the WebSocket
connection. After that, through the <code>receiveWSMessage</code> we will retrieve the
reply from the server and assert for its correctness by comparing it to the
<code>reply</code> of the test case.</p>
<p>So, what do each of these small functions do? Let's break them down one by one.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="font-weight:bold">func</span> <span style="color:#900;font-weight:bold">newWSServer</span>(t <span style="font-weight:bold">*</span>testing.T, h http.Handler) (<span style="font-weight:bold">*</span>httptest.Server, <span style="font-weight:bold">*</span>websocket.Conn) {
	t.<span style="color:#900;font-weight:bold">Helper</span>()

	s <span style="font-weight:bold">:=</span> httptest.<span style="color:#900;font-weight:bold">NewServer</span>(h)
	wsURL <span style="font-weight:bold">:=</span> <span style="color:#900;font-weight:bold">httpToWs</span>(t, s.URL)

	ws, _, err <span style="font-weight:bold">:=</span> websocket.DefaultDialer.<span style="color:#900;font-weight:bold">Dial</span>(wsURL, <span style="font-weight:bold">nil</span>)
	<span style="font-weight:bold">if</span> err <span style="font-weight:bold">!=</span> <span style="font-weight:bold">nil</span> {
		t.<span style="color:#900;font-weight:bold">Fatal</span>(err)
	}

	<span style="font-weight:bold">return</span> s, ws
}</code></pre></div>
<p>The <code>newWSServer</code> function will use the
<a href="https://golang.org/pkg/net/http/httptest/#NewServer"><code>httptest.NewServer</code></a>
function to mount the handler on a test HTTP server. Once that is done, it will
convert the server's <code>URL</code> to a WebSocket URL through the <code>httpToWS</code> function.
(It simply replaces the <code>http</code> protocol to a <code>ws</code>, or <code>https</code> to <code>wss</code>, protocol
in the URL.`)</p>
<p>To establish a WebSocket connection, we use the
<a href="https://godoc.org/github.com/gorilla/websocket#pkg-variables"><code>websocket.DefaultDialer</code></a>
which is a dialer with all fields set to the default values. We invoke the
<code>Dial</code> method on the dialer, with the WebSocket server URL (<code>wsURL</code>) which
returns the WebSocket connection.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="font-weight:bold">func</span> <span style="color:#900;font-weight:bold">sendMessage</span>(t <span style="font-weight:bold">*</span>testing.T, ws <span style="font-weight:bold">*</span>websocket.Conn, msg inbound) {
	t.<span style="color:#900;font-weight:bold">Helper</span>()

	m, err <span style="font-weight:bold">:=</span> json.<span style="color:#900;font-weight:bold">Marshal</span>(msg)
	<span style="font-weight:bold">if</span> err <span style="font-weight:bold">!=</span> <span style="font-weight:bold">nil</span> {
		t.<span style="color:#900;font-weight:bold">Fatal</span>(err)
	}

	<span style="font-weight:bold">if</span> err <span style="font-weight:bold">:=</span> ws.<span style="color:#900;font-weight:bold">WriteMessage</span>(websocket.BinaryMessage, m); err <span style="font-weight:bold">!=</span> <span style="font-weight:bold">nil</span> {
		t.<span style="color:#900;font-weight:bold">Fatalf</span>(<span style="color:#b84">&#34;%v&#34;</span>, err)
	}
}</code></pre></div>
<p>The <code>sendMessage</code> function takes an <code>inbound</code> message as argument with the WebSocket
connection (<code>ws</code>). It marshals the message into a JSON and it sends it over the
WebSocket connection as a binary message.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="font-weight:bold">func</span> <span style="color:#900;font-weight:bold">receiveWSMessage</span>(t <span style="font-weight:bold">*</span>testing.T, ws <span style="font-weight:bold">*</span>websocket.Conn) outbound {
	t.<span style="color:#900;font-weight:bold">Helper</span>()

	_, m, err <span style="font-weight:bold">:=</span> ws.<span style="color:#900;font-weight:bold">ReadMessage</span>()
	<span style="font-weight:bold">if</span> err <span style="font-weight:bold">!=</span> <span style="font-weight:bold">nil</span> {
		t.<span style="color:#900;font-weight:bold">Fatalf</span>(<span style="color:#b84">&#34;%v&#34;</span>, err)
	}

	<span style="font-weight:bold">var</span> reply outbound
	err = json.<span style="color:#900;font-weight:bold">Unmarshal</span>(m, <span style="font-weight:bold">&amp;</span>reply)
	<span style="font-weight:bold">if</span> err <span style="font-weight:bold">!=</span> <span style="font-weight:bold">nil</span> {
		t.<span style="color:#900;font-weight:bold">Fatal</span>(err)
	}

	<span style="font-weight:bold">return</span> reply
}</code></pre></div>
<p><code>receiveWSMessage</code> takes the WebSocket connection (<code>ws</code>) as argument and it
fetches a message using <code>ws.ReadMessage()</code>. Once the message is successfully
retrieved, it unmarshals it into a <code>outbound</code> message using <code>json.Unmarshal</code>.
As a last step, <code>receiveWSMessage</code> returns the <code>outbound</code> message to the test,
so the test can continue with its assertions.</p>
<p>If we would run the tests, we will see them passing:</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ go <span style="color:#999">test</span> ./... -v
<span style="font-weight:bold">=</span><span style="font-weight:bold">=</span><span style="font-weight:bold">=</span> RUN   <span style="color:#008080">TestBidsHandler</span>
<span style="font-weight:bold">=</span><span style="font-weight:bold">=</span><span style="font-weight:bold">=</span> RUN   TestBidsHandler/with_good_bid
<span style="font-weight:bold">=</span><span style="font-weight:bold">=</span><span style="font-weight:bold">=</span> RUN   TestBidsHandler/with_bad_bid
<span style="font-weight:bold">=</span><span style="font-weight:bold">=</span><span style="font-weight:bold">=</span> RUN   TestBidsHandler/good_bid_on_expired_auction
--- PASS: TestBidsHandler <span style="font-weight:bold">(</span>0.00s<span style="font-weight:bold">)</span>
    --- PASS: TestBidsHandler/with_good_bid <span style="font-weight:bold">(</span>0.00s<span style="font-weight:bold">)</span>
    --- PASS: TestBidsHandler/with_bad_bid <span style="font-weight:bold">(</span>0.00s<span style="font-weight:bold">)</span>
    --- PASS: TestBidsHandler/good_bid_on_expired_auction <span style="font-weight:bold">(</span>0.00s<span style="font-weight:bold">)</span>
PASS
ok  	github.com/fteem/go-playground/testing-in-go-web-sockets	0.013s</code></pre></div>
<p>You can see the example code <a href="https://github.com/fteem/go-playground/tree/master/testing-in-go-web-sockets">on
Github</a>.</p>
<p>Also, to see another approach at testing WebSockets in Go, you can head over to
<a href="https://quii.gitbook.io/learn-go-with-tests/build-an-application/websockets">the WebSockets
chapter</a>
from the book <a href="https://quii.gitbook.io/learn-go-with-tests/">&ldquo;Learn Go with
tests&rdquo;</a>.</p>
<script src="https://f.convertkit.com/ckjs/ck.5.js"></script>
      <form action="https://app.convertkit.com/forms/1215893/subscriptions" class="seva-form formkit-form" method="post" data-sv-form="1215893" data-uid="f786e71c27" data-format="inline" data-version="5" data-options="{&quot;settings&quot;:{&quot;after_subscribe&quot;:{&quot;action&quot;:&quot;message&quot;,&quot;success_message&quot;:&quot;Success! Now check your email to confirm your subscription.&quot;,&quot;redirect_url&quot;:&quot;&quot;},&quot;analytics&quot;:{&quot;google&quot;:null,&quot;facebook&quot;:null,&quot;segment&quot;:null,&quot;pinterest&quot;:null},&quot;modal&quot;:{&quot;trigger&quot;:&quot;timer&quot;,&quot;scroll_percentage&quot;:null,&quot;timer&quot;:5,&quot;devices&quot;:&quot;all&quot;,&quot;show_once_every&quot;:15},&quot;powered_by&quot;:{&quot;show&quot;:false,&quot;url&quot;:&quot;https://convertkit.com?utm_source=dynamic&amp;utm_medium=referral&amp;utm_campaign=poweredby&amp;utm_content=form&quot;},&quot;recaptcha&quot;:{&quot;enabled&quot;:false},&quot;return_visitor&quot;:{&quot;action&quot;:&quot;show&quot;,&quot;custom_content&quot;:&quot;&quot;},&quot;slide_in&quot;:{&quot;display_in&quot;:&quot;bottom_right&quot;,&quot;trigger&quot;:&quot;timer&quot;,&quot;scroll_percentage&quot;:null,&quot;timer&quot;:5,&quot;devices&quot;:&quot;all&quot;,&quot;show_once_every&quot;:15},&quot;sticky_bar&quot;:{&quot;display_in&quot;:&quot;top&quot;,&quot;trigger&quot;:&quot;timer&quot;,&quot;scroll_percentage&quot;:null,&quot;timer&quot;:5,&quot;devices&quot;:&quot;all&quot;,&quot;show_once_every&quot;:15}},&quot;version&quot;:&quot;5&quot;}" min-width="400 500 600 700 800" style="background-color: rgb(249, 250, 251); border-radius: 4px;"><div class="formkit-background" style="opacity: 0.2;"></div><div data-style="minimal"><div class="formkit-header" data-element="header" style="color: rgb(77, 77, 77); font-size: 27px; font-weight: 700;"><h1>Join the Newsletter</h1></div><div class="formkit-subheader" data-element="subheader" style="color: rgb(104, 104, 104); font-size: 18px;"><p>I write about backend technologies, programming and cloud architectures. Join hundreds of other developers that get my newsletter, once a month.</p></div><ul class="formkit-alert formkit-alert-error" data-element="errors" data-group="alert"></ul><div data-element="fields" data-stacked="false" class="seva-fields formkit-fields"><div class="formkit-field"><input class="formkit-input" name="email_address" placeholder="Your email address" required="" type="email" style="color: rgb(0, 0, 0); border-color: rgb(227, 227, 227); border-radius: 4px; font-weight: 400;"></div><button data-element="submit" class="formkit-submit formkit-submit" style="color: rgb(255, 255, 255); background-color: rgb(22, 119, 190); border-radius: 4px; font-weight: 400;"><div class="formkit-spinner"><div></div><div></div><div></div></div><span>Subscribe</span></button></div><div class="formkit-guarantee" data-element="guarantee" style="color: rgb(77, 77, 77); font-size: 13px; font-weight: 400;">

      <p>I respect your privacy. Never spam. Unsubscribe at any time.</p>
      <p>You can also subscribe <a href="/index.xml">via RSS</a> or <a href="https://t.me/ieftimovcom">to my Telegram channel</a>.</p>

      </div></div><style>.formkit-form[data-uid="f786e71c27"] *{box-sizing:border-box;}.formkit-form[data-uid="f786e71c27"]{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale;}.formkit-form[data-uid="f786e71c27"] legend{border:none;font-size:inherit;margin-bottom:10px;padding:0;position:relative;display:table;}.formkit-form[data-uid="f786e71c27"] fieldset{border:0;padding:0.01em 0 0 0;margin:0;min-width:0;}.formkit-form[data-uid="f786e71c27"] body:not(:-moz-handler-blocked) fieldset{display:table-cell;}.formkit-form[data-uid="f786e71c27"] h1,.formkit-form[data-uid="f786e71c27"] h2,.formkit-form[data-uid="f786e71c27"] h3,.formkit-form[data-uid="f786e71c27"] h4,.formkit-form[data-uid="f786e71c27"] h5,.formkit-form[data-uid="f786e71c27"] h6{color:inherit;font-size:inherit;font-weight:inherit;}.formkit-form[data-uid="f786e71c27"] p{color:inherit;font-size:inherit;font-weight:inherit;}.formkit-form[data-uid="f786e71c27"] ol:not([template-default]),.formkit-form[data-uid="f786e71c27"] ul:not([template-default]),.formkit-form[data-uid="f786e71c27"] blockquote:not([template-default]){text-align:left;}.formkit-form[data-uid="f786e71c27"] p:not([template-default]),.formkit-form[data-uid="f786e71c27"] hr:not([template-default]),.formkit-form[data-uid="f786e71c27"] blockquote:not([template-default]),.formkit-form[data-uid="f786e71c27"] ol:not([template-default]),.formkit-form[data-uid="f786e71c27"] ul:not([template-default]){color:inherit;font-style:initial;}.formkit-form[data-uid="f786e71c27"][data-format="modal"]{display:none;}.formkit-form[data-uid="f786e71c27"][data-format="slide in"]{display:none;}.formkit-form[data-uid="f786e71c27"] .formkit-input,.formkit-form[data-uid="f786e71c27"] .formkit-select,.formkit-form[data-uid="f786e71c27"] .formkit-checkboxes{width:100%;}.formkit-form[data-uid="f786e71c27"] .formkit-button,.formkit-form[data-uid="f786e71c27"] .formkit-submit{border:0;border-radius:5px;color:#ffffff;cursor:pointer;display:inline-block;text-align:center;font-size:15px;font-weight:500;cursor:pointer;margin-bottom:15px;overflow:hidden;padding:0;position:relative;vertical-align:middle;line-height:1.5;}.formkit-form[data-uid="f786e71c27"] .formkit-button:hover,.formkit-form[data-uid="f786e71c27"] .formkit-submit:hover,.formkit-form[data-uid="f786e71c27"] .formkit-button:focus,.formkit-form[data-uid="f786e71c27"] .formkit-submit:focus{outline:none;}.formkit-form[data-uid="f786e71c27"] .formkit-button:hover > span,.formkit-form[data-uid="f786e71c27"] .formkit-submit:hover > span,.formkit-form[data-uid="f786e71c27"] .formkit-button:focus > span,.formkit-form[data-uid="f786e71c27"] .formkit-submit:focus > span{background-color:rgba(0,0,0,0.1);}.formkit-form[data-uid="f786e71c27"] .formkit-button > span,.formkit-form[data-uid="f786e71c27"] .formkit-submit > span{display:block;-webkit-transition:all 300ms ease-in-out;transition:all 300ms ease-in-out;padding:12px 24px;}.formkit-form[data-uid="f786e71c27"] .formkit-input{background:#ffffff;font-size:15px;padding:12px;border:1px solid #e3e3e3;-webkit-flex:1 0 auto;-ms-flex:1 0 auto;flex:1 0 auto;line-height:1.4;margin:0;-webkit-transition:border-color ease-out 300ms;transition:border-color ease-out 300ms;}.formkit-form[data-uid="f786e71c27"] .formkit-input:focus{outline:none;border-color:#1677be;-webkit-transition:border-color ease 300ms;transition:border-color ease 300ms;}.formkit-form[data-uid="f786e71c27"] .formkit-input::-webkit-input-placeholder{color:inherit;opacity:0.8;}.formkit-form[data-uid="f786e71c27"] .formkit-input::-moz-placeholder{color:inherit;opacity:0.8;}.formkit-form[data-uid="f786e71c27"] .formkit-input:-ms-input-placeholder{color:inherit;opacity:0.8;}.formkit-form[data-uid="f786e71c27"] .formkit-input::placeholder{color:inherit;opacity:0.8;}.formkit-form[data-uid="f786e71c27"] [data-group="dropdown"]{position:relative;display:inline-block;width:100%;}.formkit-form[data-uid="f786e71c27"] [data-group="dropdown"]::before{content:"";top:calc(50% - 2.5px);right:10px;position:absolute;pointer-events:none;border-color:#4f4f4f transparent transparent transparent;border-style:solid;border-width:6px 6px 0 6px;height:0;width:0;z-index:999;}.formkit-form[data-uid="f786e71c27"] [data-group="dropdown"] select{height:auto;width:100%;cursor:pointer;color:#333333;line-height:1.4;margin-bottom:0;padding:0 6px;-webkit-appearance:none;-moz-appearance:none;appearance:none;font-size:15px;padding:12px;padding-right:25px;border:1px solid #e3e3e3;background:#ffffff;}.formkit-form[data-uid="f786e71c27"] [data-group="dropdown"] select:focus{outline:none;}.formkit-form[data-uid="f786e71c27"] [data-group="checkboxes"]{text-align:left;margin:0;}.formkit-form[data-uid="f786e71c27"] [data-group="checkboxes"] [data-group="checkbox"]{margin-bottom:10px;}.formkit-form[data-uid="f786e71c27"] [data-group="checkboxes"] [data-group="checkbox"] *{cursor:pointer;}.formkit-form[data-uid="f786e71c27"] [data-group="checkboxes"] [data-group="checkbox"]:last-of-type{margin-bottom:0;}.formkit-form[data-uid="f786e71c27"] [data-group="checkboxes"] [data-group="checkbox"] input[type="checkbox"]{display:none;}.formkit-form[data-uid="f786e71c27"] [data-group="checkboxes"] [data-group="checkbox"] input[type="checkbox"] + label::after{content:none;}.formkit-form[data-uid="f786e71c27"] [data-group="checkboxes"] [data-group="checkbox"] input[type="checkbox"]:checked + label::after{border-color:#ffffff;content:"";}.formkit-form[data-uid="f786e71c27"] [data-group="checkboxes"] [data-group="checkbox"] input[type="checkbox"]:checked + label::before{background:#10bf7a;border-color:#10bf7a;}.formkit-form[data-uid="f786e71c27"] [data-group="checkboxes"] [data-group="checkbox"] label{position:relative;display:inline-block;padding-left:28px;}.formkit-form[data-uid="f786e71c27"] [data-group="checkboxes"] [data-group="checkbox"] label::before,.formkit-form[data-uid="f786e71c27"] [data-group="checkboxes"] [data-group="checkbox"] label::after{position:absolute;content:"";display:inline-block;}.formkit-form[data-uid="f786e71c27"] [data-group="checkboxes"] [data-group="checkbox"] label::before{height:16px;width:16px;border:1px solid #e3e3e3;background:#ffffff;left:0px;top:3px;}.formkit-form[data-uid="f786e71c27"] [data-group="checkboxes"] [data-group="checkbox"] label::after{height:4px;width:8px;border-left:2px solid #4d4d4d;border-bottom:2px solid #4d4d4d;-webkit-transform:rotate(-45deg);-ms-transform:rotate(-45deg);transform:rotate(-45deg);left:4px;top:8px;}.formkit-form[data-uid="f786e71c27"] .formkit-alert{background:#f9fafb;border:1px solid #e3e3e3;border-radius:5px;-webkit-flex:1 0 auto;-ms-flex:1 0 auto;flex:1 0 auto;list-style:none;margin:25px auto;padding:12px;text-align:center;width:100%;}.formkit-form[data-uid="f786e71c27"] .formkit-alert:empty{display:none;}.formkit-form[data-uid="f786e71c27"] .formkit-alert-success{background:#d3fbeb;border-color:#10bf7a;color:#0c905c;}.formkit-form[data-uid="f786e71c27"] .formkit-alert-error{background:#fde8e2;border-color:#f2643b;color:#ea4110;}.formkit-form[data-uid="f786e71c27"] .formkit-spinner{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;height:0px;width:0px;margin:0 auto;position:absolute;top:0;left:0;right:0;width:0px;overflow:hidden;text-align:center;-webkit-transition:all 300ms ease-in-out;transition:all 300ms ease-in-out;}.formkit-form[data-uid="f786e71c27"] .formkit-spinner > div{margin:auto;width:12px;height:12px;background-color:#fff;opacity:0.3;border-radius:100%;display:inline-block;-webkit-animation:formkit-bouncedelay-formkit-form-data-uid-f786e71c27- 1.4s infinite ease-in-out both;animation:formkit-bouncedelay-formkit-form-data-uid-f786e71c27- 1.4s infinite ease-in-out both;}.formkit-form[data-uid="f786e71c27"] .formkit-spinner > div:nth-child(1){-webkit-animation-delay:-0.32s;animation-delay:-0.32s;}.formkit-form[data-uid="f786e71c27"] .formkit-spinner > div:nth-child(2){-webkit-animation-delay:-0.16s;animation-delay:-0.16s;}.formkit-form[data-uid="f786e71c27"] .formkit-submit[data-active] .formkit-spinner{opacity:1;height:100%;width:50px;}.formkit-form[data-uid="f786e71c27"] .formkit-submit[data-active] .formkit-spinner ~ span{opacity:0;}.formkit-form[data-uid="f786e71c27"] .formkit-powered-by[data-active="false"]{opacity:0.35;}@-webkit-keyframes formkit-bouncedelay-formkit-form-data-uid-f786e71c27-{0%,80%,100%{-webkit-transform:scale(0);-ms-transform:scale(0);transform:scale(0);}40%{-webkit-transform:scale(1);-ms-transform:scale(1);transform:scale(1);}}@keyframes formkit-bouncedelay-formkit-form-data-uid-f786e71c27-{0%,80%,100%{-webkit-transform:scale(0);-ms-transform:scale(0);transform:scale(0);}40%{-webkit-transform:scale(1);-ms-transform:scale(1);transform:scale(1);}}.formkit-form[data-uid="f786e71c27"] blockquote{padding:10px 20px;margin:0 0 20px;border-left:5px solid #e1e1e1;} .formkit-form[data-uid="f786e71c27"]{border:1px solid #e3e3e3;max-width:700px;position:relative;overflow:hidden;margin:0 auto;}.formkit-form[data-uid="f786e71c27"] .formkit-background{width:100%;height:100%;position:absolute;top:0;left:0;background-size:cover;background-position:center;opacity:0.3;z-index:1;}.formkit-form[data-uid="f786e71c27"] [data-style="minimal"]{padding:20px;width:100%;z-index:2;position:relative;}.formkit-form[data-uid="f786e71c27"] .formkit-header{margin:0 0 27px 0;text-align:center;}.formkit-form[data-uid="f786e71c27"] .formkit-subheader{margin:18px 0;text-align:center;}.formkit-form[data-uid="f786e71c27"] .formkit-guarantee{font-size:13px;margin:10px 0 15px 0;text-align:center;}.formkit-form[data-uid="f786e71c27"] .formkit-guarantee > p{margin:0;}.formkit-form[data-uid="f786e71c27"] .formkit-powered-by{color:#7d7d7d;display:block;font-size:12px;margin:10px 0 0 0;text-align:center;}.formkit-form[data-uid="f786e71c27"] .formkit-fields{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;margin:25px auto 0 auto;}.formkit-form[data-uid="f786e71c27"] .formkit-field{min-width:220px;}.formkit-form[data-uid="f786e71c27"] .formkit-field,.formkit-form[data-uid="f786e71c27"] .formkit-submit{margin:0 0 15px 0;-webkit-flex:1 0 100%;-ms-flex:1 0 100%;flex:1 0 100%;}.formkit-form[data-uid="f786e71c27"][min-width~="600"] [data-style="minimal"]{}.formkit-form[data-uid="f786e71c27"][min-width~="600"] .formkit-fields[data-stacked="false"]{margin-left:-5px;margin-right:-5px;}.formkit-form[data-uid="f786e71c27"][min-width~="600"] .formkit-fields[data-stacked="false"] .formkit-field,.formkit-form[data-uid="f786e71c27"][min-width~="600"] .formkit-fields[data-stacked="false"] .formkit-submit{margin:0 5px 15px 5px;}.formkit-form[data-uid="f786e71c27"][min-width~="600"] .formkit-fields[data-stacked="false"] .formkit-field{-webkit-flex:100 1 auto;-ms-flex:100 1 auto;flex:100 1 auto;}.formkit-form[data-uid="f786e71c27"][min-width~="600"] .formkit-fields[data-stacked="false"] .formkit-submit{-webkit-flex:1 1 auto;-ms-flex:1 1 auto;flex:1 1 auto;} </style></form>

<h2 id="more-websockets-reading">More WebSockets reading</h2>
<p>If you would like to learn more about the details of the WebSocket protocol,
I recommend reading <a href="https://tools.ietf.org/html/rfc6455"><code>RFC 6455</code></a> which defines
the protocol itself. In addition, you can read more in follow-up RFCs regarding
the WebSocket protocol:</p>
<ul>
<li><a href="https://tools.ietf.org/html/rfc7936">Clarifying Registry Procedures for the WebSocket Subprotocol Name Registry</a></li>
<li><a href="https://tools.ietf.org/html/rfc8307">Well-Known URIs for the WebSocket Protocol</a></li>
<li><a href="https://tools.ietf.org/html/rfc8441">Bootstrapping WebSockets with HTTP/2</a></li>
</ul>

			</div>

			<div class="tags">
				
					
						<ul class="flat">
							
							<li><a href="/tags/websockets">websockets</a></li>
							
						</ul>
					
				
			</div><div id="disqus_thread"></div>
<script type="text/javascript">
	(function () {
		
		
		if (window.location.hostname == "localhost")
			return;

		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		var disqus_shortname = 'eftimov';
		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
</script>
<noscript>Please enable JavaScript to view the </a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
	</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div> Copyright Â© 2014 - 2020 Ilija Eftimov |  <a href="https://github.com/knadh/hugo-ink">Ink</a> theme on <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-11264459-2', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<script>feather.replace()</script>
</body>
</html>
