<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>How to: YourGem.configure - Ilija Eftimov</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta property="og:title" content="How to: YourGem.configure" />
<meta property="og:description" content="Really cool gems, like Carrierwave for example, have this neat feature of configuring the gem in runtime. It allows you to easily configure how the gem will behave in your app. For example, you can add various authentication keys, how errors should be handled and what not. If you want to add this cool functionality in your gems, read on to find out more.
Personally, I love to implement (and use) this way of configuring libraries in runtime." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ieftimov.com/post/how-to-yourgem-configure/" />
<meta property="article:published_time" content="2015-05-18T00:00:00+00:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="How to: YourGem.configure"/>
<meta name="twitter:description" content="Really cool gems, like Carrierwave for example, have this neat feature of configuring the gem in runtime. It allows you to easily configure how the gem will behave in your app. For example, you can add various authentication keys, how errors should be handled and what not. If you want to add this cool functionality in your gems, read on to find out more.
Personally, I love to implement (and use) this way of configuring libraries in runtime."/>
<link href='https://fonts.googleapis.com/css?family=Playfair+Display:700' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" media="screen" href="https://ieftimov.com/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://ieftimov.com/css/main.css" />
		<link rel="stylesheet" type="text/css" href="https://ieftimov.com/css/overrides.css" />
	

	<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
		<script src="https://ieftimov.com/js/main.js"></script><script src="https://ieftimov.com/js/tooltip.js"></script>
</head>

<body>
	<div class="container wrapper">
		<div class="header">
	
		<div class="avatar">
			<a href="https://ieftimov.com/">
				<img src="https://ieftimov.com/avatar.png" alt="Ilija Eftimov" />
			</a>
		</div>
	
	<h1 class="site-title"><a href="https://ieftimov.com/">Ilija Eftimov</a></h1>
	<div class="site-description"><p>A human, interested in building products and software.</p><nav class="nav social">
			<ul class="flat"><li><a href="https://github.com/fteem" title="Github"><i data-feather="github"></i></a></li><li><a href="https://twitter.com/fteem" title="Twitter"><i data-feather="twitter"></i></a></li><li><a href="https://www.linkedin.com/in/ieftimov" title="Linkedin"><i data-feather="linkedin"></i></a></li><li><a href="mailto:blog@ieftimov.com" title="Email"><i data-feather="mail"></i></a></li></ul>
		</nav>
	</div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="/categories/testing-in-go">Testing in Go</a>
			</li>
			
			<li>
				<a href="/posts">Archive</a>
			</li>
			
			<li>
				<a href="/about">About</a>
			</li>
			
			<li>
				<a href="https://forms.gle/orfXK5jh1LRaiFzo8">Suggest a topic</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post">
			<div class="post-header">
				
					<div class="meta">
						<div class="date">
							<span class="day">18</span>
							<span class="rest">May 2015</span>
						</div>
					</div>
				
				<div class="matter">
					<h1 class="title">How to: YourGem.configure</h1>
				</div>
			</div>
					
			<div class="markdown">
				<p>Really cool gems, like Carrierwave for example, have this neat feature of
configuring the gem in runtime. It allows you to easily configure how the gem
will behave in your app.  For example, you can add various authentication keys,
how errors should be handled and what not.  If you want to add this cool
functionality in your gems, read on to find out more.</p>
<p>Personally, I love to implement (and use) this way of configuring libraries in
runtime.  Although people have used and blogged about this &ldquo;pattern&rdquo; so many
times, I am writing another how-to because I really like this type of
configuring external libs/gems.  So, if you've ever wondered how to implement
it, here is another how-to.</p>
<h2 id="randomizer">Randomizer</h2>
<p>Lets build a gem that generates random numbers. We'll call it Randomizer.
Basically, every gem is a module, that namespaces bunch of classes and methods.
So, say we want our gem to have one method, called generate! that will return
our random number.  Under the hood, we'll just use the built in rand method.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="font-weight:bold">module</span> <span style="color:#555">Randomizer</span>
  <span style="font-weight:bold">class</span> <span style="font-weight:bold">&lt;&lt;</span> <span style="color:#999">self</span>
    <span style="font-weight:bold">def</span> <span style="color:#458;font-weight:bold"></span><span style="font-weight:bold"></span><span style="color:#900;font-weight:bold">generate!</span>
      <span style="color:#999">rand</span>
    <span style="font-weight:bold">end</span>
  <span style="font-weight:bold">end</span>
<span style="font-weight:bold">end</span></code></pre></div>
<p>This is all good, the rand method will generate a really long Float. But, lets
say that we want the generate! method to return a number up to a maximum
number? We can change the method to accept a number as an argument and pass
that number as an argument to the rand method.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="font-weight:bold">module</span> <span style="color:#555">Randomizer</span>
  <span style="font-weight:bold">class</span> <span style="font-weight:bold">&lt;&lt;</span> <span style="color:#999">self</span>
    <span style="font-weight:bold">def</span> <span style="color:#458;font-weight:bold"></span><span style="font-weight:bold"></span><span style="color:#900;font-weight:bold">generate!</span> max
      <span style="color:#999">rand</span> max
    <span style="font-weight:bold">end</span>
  <span style="font-weight:bold">end</span>
<span style="font-weight:bold">end</span></code></pre></div>
<p>Again, really simple. But, what if we want to set a range for the random number
that will be generated? For example, for whatever reason an user might want the
method to return random numbers between 50 and 60. How can we do this?</p>
<p>Well, one approach is to make the generate! method accept two arguments, which
is fine.  But, instead of passing the arguments every time we make the call, we
can add a configuration block so the gem always returns random numbers in a
range. This is where we need to introduce the configure block.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="font-weight:bold">module</span> <span style="color:#555">Randomizer</span>
  <span style="font-weight:bold">class</span> <span style="font-weight:bold">&lt;&lt;</span> <span style="color:#999">self</span>
    <span style="font-weight:bold">attr_accessor</span> <span style="color:#b84">:configuration</span>

    <span style="font-weight:bold">def</span> <span style="color:#458;font-weight:bold"></span><span style="font-weight:bold"></span><span style="color:#900;font-weight:bold">configure</span>
      @config <span style="font-weight:bold">||</span><span style="font-weight:bold">=</span> <span style="color:#008080">Configuration</span><span style="font-weight:bold">.</span>new
      <span style="font-weight:bold">yield</span>(@config)
    <span style="font-weight:bold">end</span>
  <span style="font-weight:bold">end</span>

  <span style="font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Configuration</span>
    <span style="font-weight:bold">attr_accessor</span> <span style="color:#b84">:from</span>, <span style="color:#b84">:to</span>
  <span style="font-weight:bold">end</span>
<span style="font-weight:bold">end</span></code></pre></div>
<p>How does this work? The configure class method stores a Configuration object
inside the Randomizer module. Anything set from the configure block is an
attr_accessor on the Configuration class. Now, lets add the generate! method
back in and see how we can use the configure block.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="font-weight:bold">module</span> <span style="color:#555">Randomizer</span>
  <span style="font-weight:bold">class</span> <span style="font-weight:bold">&lt;&lt;</span> <span style="color:#999">self</span>
    <span style="font-weight:bold">attr_accessor</span> <span style="color:#b84">:configuration</span>

    <span style="font-weight:bold">def</span> <span style="color:#458;font-weight:bold"></span><span style="font-weight:bold"></span><span style="color:#900;font-weight:bold">configure</span>
      @configuration <span style="font-weight:bold">||</span><span style="font-weight:bold">=</span> <span style="color:#008080">Configuration</span><span style="font-weight:bold">.</span>new
      <span style="font-weight:bold">yield</span>(@configuration)
    <span style="font-weight:bold">end</span>

    <span style="font-weight:bold">def</span> <span style="color:#458;font-weight:bold"></span><span style="font-weight:bold"></span><span style="color:#900;font-weight:bold">generate!</span>
      (configuration<span style="font-weight:bold">.</span>from<span style="font-weight:bold">..</span>configuration<span style="font-weight:bold">.</span>to)<span style="font-weight:bold">.</span>to_a<span style="font-weight:bold">.</span>sample
    <span style="font-weight:bold">end</span>
  <span style="font-weight:bold">end</span>

  <span style="font-weight:bold">class</span> <span style="color:#458;font-weight:bold">Configuration</span>
    <span style="font-weight:bold">attr_accessor</span> <span style="color:#b84">:from</span>, <span style="color:#b84">:to</span>
  <span style="font-weight:bold">end</span>
<span style="font-weight:bold">end</span></code></pre></div>
<p>Now, the generate! method takes the from and to attributes from the
configuration object and creates an array of it. Then, we use the Array#sample
method which picks a random item from an array object. So, say you have a
Rails app where you want to use the Randomizer gem. Configuring the gem can be
done by adding a randomizer.rb file in the config/initializers folder.  Then,
we need to use the configure block in the file.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ruby" data-lang="ruby"><span style="color:#008080">Randomizer</span><span style="font-weight:bold">.</span>configure <span style="font-weight:bold">do</span> <span style="font-weight:bold">|</span>config<span style="font-weight:bold">|</span>
  config<span style="font-weight:bold">.</span>from <span style="font-weight:bold">=</span> <span style="color:#099">100</span>
  <span style="font-weight:bold"></span>config<span style="font-weight:bold">.</span>to <span style="font-weight:bold">=</span> <span style="color:#099">200</span>
<span style="font-weight:bold"></span><span style="font-weight:bold">end</span></code></pre></div>
<p>Now, when we call Randomizer.generate! the method will return a random number
between 100 and 200. Hope my explanation was good and you understood how you
can use this &ldquo;pattern&rdquo;.</p>
<p>What do you think, how we can adjust the gem so the method returns an array of
two random numbers? And how we can adjust the gem so the method will return a
custom number of random numbers in an array?</p>
<p>Feel free to share your solution in the comments. Thanks for reading!</p>

			</div>

			<div class="tags">
				
					
						<ul class="flat">
							
							<li><a href="/tags/gem">gem</a></li>
							
						</ul>
					
				
			</div><div id="disqus_thread"></div>
<script type="text/javascript">
	(function () {
		
		
		if (window.location.hostname == "localhost")
			return;

		var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
		var disqus_shortname = 'eftimov';
		dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	})();
</script>
<noscript>Please enable JavaScript to view the </a></noscript>
<a href="http://disqus.com/" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
	</div>
	<div class="footer wrapper">
	<nav class="nav">
		<div> Copyright © 2014 - 2020 Ilija Eftimov |  <a href="https://github.com/knadh/hugo-ink">Ink</a> theme on <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-11264459-2', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>
<script>feather.replace()</script>
</body>
</html>
