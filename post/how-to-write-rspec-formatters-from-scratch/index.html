<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>How to write RSpec formatters from scratch - Ilija Eftimov</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="Ilija Eftimov" />
  <meta name="description" content="Recently I did an experiment with RSpec&amp;rsquo;s formatters. Turns out, the output that RSpec returns when you run your specs can be very customized for your own needs. Read on to learn how you can write custom RSpec formatters.
Writing custom formatters RSpec allows customization of the output by creating your own Formatter class. Yep, it&amp;rsquo;s that easy. You just need to write one class and than require it into RSpec&amp;rsquo;s configuration to use it." />

  <meta name="keywords" content="Software, Programming, Computer Science, Products" />






<meta name="generator" content="Hugo 0.54.0" />


<link rel="canonical" href="https://ieftimov.com/post/how-to-write-rspec-formatters-from-scratch/" />



<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.ec807d8b802a40889537c26e014f733206312ea440d42e1f0dabed80918de1ac.css" integrity="sha256-7IB9i4AqQIiVN8JuAU9zMgYxLqRA1C4fDavtgJGN4aw=" media="screen" crossorigin="anonymous">




<link rel="stylesheet" href="/css/overrides.css">

<link rel="stylesheet" href="/css/subscribe.css">


<meta property="og:title" content="How to write RSpec formatters from scratch" />
<meta property="og:description" content="Recently I did an experiment with RSpec&rsquo;s formatters. Turns out, the output that RSpec returns when you run your specs can be very customized for your own needs. Read on to learn how you can write custom RSpec formatters.
Writing custom formatters RSpec allows customization of the output by creating your own Formatter class. Yep, it&rsquo;s that easy. You just need to write one class and than require it into RSpec&rsquo;s configuration to use it." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ieftimov.com/post/how-to-write-rspec-formatters-from-scratch/" />
<meta property="article:published_time" content="2015-04-28T00:00:00&#43;00:00"/>


<meta itemprop="name" content="How to write RSpec formatters from scratch">
<meta itemprop="description" content="Recently I did an experiment with RSpec&rsquo;s formatters. Turns out, the output that RSpec returns when you run your specs can be very customized for your own needs. Read on to learn how you can write custom RSpec formatters.
Writing custom formatters RSpec allows customization of the output by creating your own Formatter class. Yep, it&rsquo;s that easy. You just need to write one class and than require it into RSpec&rsquo;s configuration to use it.">



<meta itemprop="wordCount" content="2897">



<meta itemprop="keywords" content="testing,formatters," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="How to write RSpec formatters from scratch"/>
<meta name="twitter:description" content="Recently I did an experiment with RSpec&rsquo;s formatters. Turns out, the output that RSpec returns when you run your specs can be very customized for your own needs. Read on to learn how you can write custom RSpec formatters.
Writing custom formatters RSpec allows customization of the output by creating your own Formatter class. Yep, it&rsquo;s that easy. You just need to write one class and than require it into RSpec&rsquo;s configuration to use it."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-11264459-2', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>



</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Ilija Eftimov</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://ieftimov.com/">Home</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://ieftimov.com/post/">Archives</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://ieftimov.com/about/">About</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://ieftimov.com/subscribe/">Subscribe</a>
          
        
      </li>
    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      Ilija Eftimov
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://ieftimov.com/">Home</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://ieftimov.com/post/">Archives</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://ieftimov.com/about/">About</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://ieftimov.com/subscribe/">Subscribe</a>
          

        

      </li>
    
    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">How to write RSpec formatters from scratch</h1>
      
      <div class="post-meta">
        <time datetime="2015-04-28" class="post-time">
          28-04-2015
        </time>
        <div class="post-category">
            <a href="https://ieftimov.com/categories/ruby/"> Ruby </a>
            <a href="https://ieftimov.com/categories/rspec/"> RSpec </a>
            
          </div>
        

        
        

        
        
      </div>
    </header>

    
    

    
    <div class="post-content">
      

<p>Recently I did an experiment with RSpec&rsquo;s formatters. Turns out, the output
that RSpec returns when you run your specs can be very customized for your own
needs. Read on to learn how you can write custom RSpec formatters.</p>

<h2 id="writing-custom-formatters">Writing custom formatters</h2>

<p>RSpec allows customization of the output by creating your own Formatter class.
Yep, it&rsquo;s that easy. You just need to write one class and than require it into
RSpec&rsquo;s configuration to use it. Lets explore couple of key concepts about the
formatters and it&rsquo;s internals.</p>

<h3 id="the-protocol">The Protocol</h3>

<p>First thing to be aware of is the protocol (the order) that RSpec uses when
calling methods from the formatter. Keep in mind that every method receives
one argument, which is a Notification object. This is sent by the RSpec
reporter which notifies the formatter of the outcome of the example. On the
beginning <strong>Formatter#start </strong>is called. This method takes a notification
argument of the
class <a href="http://www.rubydoc.info/gems/rspec-core/RSpec/Core/Notifications/StartNotification">StartNotification</a>.
On every example group, <strong>Formatter#example_group_started</strong> is called. This
method takes a notification argument of the class
<a href="http://www.rubydoc.info/gems/rspec-core/RSpec/Core/Notifications/GroupNotification">GroupNotification</a>.
When an example is ran, one of these methods is called, based on the result of
the example:</p>

<ul>
<li>If the example passes, <strong>Formatter#example_passed </strong>is called. The
notification argument is of class
<a href="http://www.rubydoc.info/gems/rspec-core/RSpec/Core/Notifications/ExampleNotification">ExampleNotification</a>.</li>
<li>If the example fails, <strong>Formatter#example_failed </strong>is called. The
notification argument is of class
 <a href="http://www.rubydoc.info/gems/rspec-core/RSpec/Core/Notifications/FailedExampleNotification">FailedExampleNotification</a>.</li>
<li>If the example is pending, <strong>Formatter#example_pending </strong>is called. The
notification argument is of
class <a href="http://www.rubydoc.info/gems/rspec-core/RSpec/Core/Notifications/ExampleNotification">ExampleNotification</a>.</li>
</ul>

<p>At the end of the spec suite, these methods are called in this order:</p>

<ul>
<li><strong>Formatter#stop</strong>. The notification passed as argument is of
class <a href="http://www.rubydoc.info/gems/rspec-core/RSpec/Core/Notifications/ExamplesNotification">ExamplesNotification</a>.</li>
<li><strong>Formatter#start_dump</strong>. The notification passed as argument is of class
<a href="http://www.rubydoc.info/gems/rspec-core/RSpec/Core/Notifications/NullNotification">NullNotification</a>.</li>
<li><strong>Formatter#dump_pending</strong>. The notification passed as argument is of class
<a href="http://www.rubydoc.info/gems/rspec-core/RSpec/Core/Notifications/ExamplesNotification">ExamplesNotification</a>.</li>
<li><strong>Formatter#dump_failures</strong>. The notification passed as argument is of
class
<a href="http://www.rubydoc.info/gems/rspec-core/RSpec/Core/Notifications/ExamplesNotification">ExamplesNotification</a>.</li>
<li><strong>Formatter#dump_summary</strong>. The notification passed as argument is of class
<a href="http://www.rubydoc.info/gems/rspec-core/RSpec/Core/Notifications/SummaryNotification">SummaryNotification</a>.</li>
<li><strong>Formatter#seed</strong>. The notification passed as argument is of class
<a href="http://www.rubydoc.info/gems/rspec-core/RSpec/Core/Notifications/SeedNotification">SeedNotification</a>.</li>
<li><strong>Formatter#close</strong>. The notification passed as argument is of class
<a href="http://www.rubydoc.info/gems/rspec-core/RSpec/Core/Notifications/NullNotification">NullNotification</a>.</li>
</ul>

<p>I wont go into detail for every of the notification classes. You can dive in
the details about each of them in the links that I have attached.</p>

<h3 id="registering-your-formatter-class-to-rspec">Registering your formatter class to RSpec</h3>

<p>RSpec provides this neat feature of registering a class as a formatter. This is
done by creating the class and calling:</p>

<div class="highlight"><pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="no">RSpec</span><span class="o">::</span><span class="no">Formatters</span><span class="o">.</span><span class="n">register</span> <span class="o">&lt;</span><span class="n">the</span> <span class="k">class</span> <span class="nb">name</span><span class="o">&gt;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">array</span> <span class="n">of</span> <span class="n">symbols</span> <span class="n">representing</span> <span class="n">the</span> <span class="nb">methods</span> <span class="n">that</span> <span class="n">this</span> <span class="n">formatter</span> <span class="n">will</span> <span class="n">provide</span><span class="o">&gt;</span></code></pre></div>

<p>So, say we want a formatter that shows the progress of the suite, just like the
built-in progress formatter, but it will group the failing and the pending
specs in the summary of the suite.</p>

<h3 id="creating-the-the-groupingformatter-class">Creating the the GroupingFormatter class</h3>

<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">GroupingFormatter</span>
  <span class="no">RSpec</span><span class="o">::</span><span class="no">Formatters</span><span class="o">.</span><span class="n">register</span> <span class="nb">self</span><span class="p">,</span> <span class="ss">:dump_summary</span><span class="p">,</span> <span class="ss">:close</span>

  <span class="k">def</span> <span class="nf">initialize</span> <span class="n">output</span>
    <span class="vi">@output</span> <span class="o">=</span> <span class="n">output</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">dump_summary</span> <span class="n">notification</span> <span class="c1"># SummaryNotification</span>
    <span class="vi">@output</span> <span class="o">&lt;&lt;</span> <span class="s2">&#34;</span><span class="se">\n\n</span><span class="s2">Finished in </span><span class="si">#{</span><span class="n">notification</span><span class="o">.</span><span class="n">duration</span><span class="si">}</span><span class="s2">.&#34;</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">close</span> <span class="n">notification</span> <span class="c1"># NullNotification</span>
    <span class="vi">@output</span> <span class="o">&lt;&lt;</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></td></tr></table>
</div>
</div>

<p>As you can see, the GroupingFormatter is just a class. In it&rsquo;s initializer
it takes the output as an argument and sets it as an instance variable. Also,
on line 2, you can see the aforementioned <strong>RSpec.register</strong> call. We pass
<em>self</em> as the first argument, because we want to register this class as a
formatter. The rest of the arguments are method names that RSpec will call when
using this formatter. What this means is that when you define a method for
<strong>the protocol, </strong>if you don&rsquo;t register it - it will not be called. Basically,
RSpec won&rsquo;t know it exists at all. Next, the <strong>dump_summary</strong> method calls the
duration method on the notification object, which returns a number representing
the time of the specs&rsquo; duration in seconds. So, how can we test if this is
working? The command is:</p>

<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">rspec some_file.rb --require ./grouping_formatter.rb --format GroupingFormatter</code></pre></div>

<p>And the output is:</p>

<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">Finished in <span class="m">0</span>.007552.</code></pre></div>

<p>Now, this doesn&rsquo;t tell much. Let&rsquo;s use RSpec&rsquo;s built in helpers to format this
number in a meaningful string.</p>

<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">GroupingFormatter</span>
  <span class="no">RSpec</span><span class="o">::</span><span class="no">Formatters</span><span class="o">.</span><span class="n">register</span> <span class="nb">self</span><span class="p">,</span> <span class="ss">:dump_summary</span><span class="p">,</span> <span class="ss">:close</span>

  <span class="k">def</span> <span class="nf">initialize</span> <span class="n">output</span>
    <span class="vi">@output</span> <span class="o">=</span> <span class="n">output</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">dump_summary</span> <span class="n">notification</span> <span class="c1"># SummaryNotification</span>
    <span class="vi">@output</span> <span class="o">&lt;&lt;</span> <span class="s2">&#34;</span><span class="se">\n\n</span><span class="s2">Finished in </span><span class="si">#{</span><span class="no">RSpec</span><span class="o">::</span><span class="no">Helpers</span><span class="o">.</span><span class="n">format_duration</span><span class="p">(</span><span class="n">notification</span><span class="o">.</span><span class="n">duration</span><span class="p">)</span><span class="si">}</span><span class="s2">.&#34;</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">close</span> <span class="n">notification</span> <span class="c1"># NullNotification</span>
    <span class="vi">@output</span> <span class="o">&lt;&lt;</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></td></tr></table>
</div>
</div>

<p>In the <strong>dump_summary</strong> method we use the
<a href="http://www.rubydoc.info/gems/rspec-core/RSpec/Core/Formatters/Helpers">RSpec::Core::Formatters::Helpers</a>
module which has some methods that can help us turn the duration number into a
meaningful string. The output now looks like:</p>

<pre>Finished in 0.00758 seconds.</pre>

<p>Okay, great. Now, lets make this formatter mimic the reporting formatter that
comes with RSpec. We need the formatter to show a dot for every passing
example, F for every failing example and an asterisk for every pending example.</p>

<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">GroupingFormatter</span>
  <span class="no">RSpec</span><span class="o">::</span><span class="no">Formatters</span><span class="o">.</span><span class="n">register</span> <span class="nb">self</span><span class="p">,</span> <span class="ss">:dump_summary</span><span class="p">,</span> <span class="ss">:close</span><span class="p">,</span> <span class="ss">:example_passed</span><span class="p">,</span> <span class="ss">:example_failed</span><span class="p">,</span> <span class="ss">:example_pending</span>

  <span class="k">def</span> <span class="nf">initialize</span> <span class="n">output</span>
    <span class="vi">@output</span> <span class="o">=</span> <span class="n">output</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">example_passed</span> <span class="n">notification</span> <span class="c1"># ExampleNotification</span>
    <span class="vi">@output</span> <span class="o">&lt;&lt;</span> <span class="s2">&#34;.&#34;</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">example_failed</span> <span class="n">notification</span> <span class="c1"># FailedExampleNotification</span>
    <span class="vi">@output</span> <span class="o">&lt;&lt;</span> <span class="s2">&#34;F&#34;</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">example_pending</span> <span class="n">notification</span> <span class="c1"># ExampleNotification</span>
    <span class="vi">@output</span> <span class="o">&lt;&lt;</span> <span class="s2">&#34;*&#34;</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">dump_summary</span> <span class="n">notification</span> <span class="c1"># SummaryNotification</span>
    <span class="vi">@output</span> <span class="o">&lt;&lt;</span> <span class="s2">&#34;</span><span class="se">\n\n</span><span class="s2">Finished in </span><span class="si">#{</span><span class="no">RSpec</span><span class="o">::</span><span class="no">Helpers</span><span class="o">.</span><span class="n">format_duration</span><span class="p">(</span><span class="n">notification</span><span class="o">.</span><span class="n">duration</span><span class="p">)</span><span class="si">}</span><span class="s2">.&#34;</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">close</span> <span class="n">notification</span> <span class="c1"># NullNotification</span>
    <span class="vi">@output</span> <span class="o">&lt;&lt;</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></td></tr></table>
</div>
</div>

<p>So, the reporter (the algorithm that follows the protocol) will call
<strong>example_failed</strong> when an example fails, <strong>example_pending</strong> when an example
is pending and <strong>example_passed </strong>when an example passes. This is really
self-explanatory - we add the case specific character to the output for every
example. Take note that I added the method names to
the <strong>RSpec.register</strong> call. If I didn&rsquo;t - they&rsquo;d be ignored. The output will
now look like:</p>

<pre>.....FF*..

Finished in 0.0207 seconds.</pre>

<p>Looking good, things are starting to take shape! Now for the more complicated
part. How can we group the pending/failing specs? First, lets group the pending
specs.</p>

<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">GroupingFormatter</span>
  <span class="no">RSpec</span><span class="o">::</span><span class="no">Formatters</span><span class="o">.</span><span class="n">register</span> <span class="nb">self</span><span class="p">,</span> <span class="ss">:dump_summary</span><span class="p">,</span> <span class="ss">:close</span><span class="p">,</span> <span class="ss">:example_passed</span><span class="p">,</span>
    <span class="ss">:example_failed</span><span class="p">,</span> <span class="ss">:example_pending</span><span class="p">,</span> <span class="ss">:dump_pending</span>

  <span class="k">def</span> <span class="nf">initialize</span> <span class="n">output</span>
    <span class="vi">@output</span> <span class="o">=</span> <span class="n">output</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">example_passed</span> <span class="n">notification</span> <span class="c1"># ExampleNotification</span>
    <span class="vi">@output</span> <span class="o">&lt;&lt;</span> <span class="s2">&#34;.&#34;</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">example_failed</span> <span class="n">notification</span> <span class="c1"># FailedExampleNotification</span>
    <span class="vi">@output</span> <span class="o">&lt;&lt;</span> <span class="s2">&#34;F&#34;</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">example_pending</span> <span class="n">notification</span> <span class="c1"># ExampleNotification</span>
    <span class="vi">@output</span> <span class="o">&lt;&lt;</span> <span class="s2">&#34;*&#34;</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">dump_pending</span> <span class="n">notification</span> <span class="c1"># ExamplesNotification</span>
    <span class="vi">@output</span> <span class="o">&lt;&lt;</span> <span class="s2">&#34;</span><span class="se">\n\n</span><span class="s2">PENDING:</span><span class="se">\n\t</span><span class="s2">&#34;</span>
    <span class="vi">@output</span> <span class="o">&lt;&lt;</span> <span class="n">notification</span><span class="o">.</span><span class="n">pending_examples</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span><span class="o">|</span><span class="n">example</span><span class="o">|</span> <span class="n">example</span><span class="o">.</span><span class="n">full_description</span> <span class="o">+</span> <span class="s2">&#34; - &#34;</span> <span class="o">+</span> <span class="n">example</span><span class="o">.</span><span class="n">location</span> <span class="p">}</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n\t</span><span class="s2">&#34;</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">dump_summary</span> <span class="n">notification</span> <span class="c1"># SummaryNotification</span>
    <span class="vi">@output</span> <span class="o">&lt;&lt;</span> <span class="s2">&#34;</span><span class="se">\n\n</span><span class="s2">Finished in </span><span class="si">#{</span><span class="no">RSpec</span><span class="o">::</span><span class="no">Helpers</span><span class="o">.</span><span class="n">format_duration</span><span class="p">(</span><span class="n">notification</span><span class="o">.</span><span class="n">duration</span><span class="p">)</span><span class="si">}</span><span class="s2">.&#34;</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">close</span> <span class="n">notification</span> <span class="c1"># NullNotification</span>
    <span class="vi">@output</span> <span class="o">&lt;&lt;</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></td></tr></table>
</div>
</div>

<p>Lets look at the <strong>dump_pending</strong> method now. First, it adds &ldquo;PENDING&rdquo; to the
output. Next, it loops through the _pending<em>examples</em> array and creates an
array of strings for each of the pending examples. Note that I added the new
method to the RSpec.register call, it would be ignored otherwise. Each string
in the array will look something like this:</p>

<pre>Something is pending - ./something_spec.rb:90</pre>

<p>At the end, we call _join _on the array of strings to build a single formatted
string that we append to the output. Now when we run the specs with the
formatter, the output will look like:</p>

<pre>.....FF*..

PENDING:
  Something is pending - ./something_spec.rb:90

Finished in 0.01121 seconds.</pre>

<p>Looking good. Now, for the trickiest part, grouping the failing specs and
adding the error underneath every failing spec.</p>

<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">GroupingFormatter</span>
  <span class="no">RSpec</span><span class="o">::</span><span class="no">Formatters</span><span class="o">.</span><span class="n">register</span> <span class="nb">self</span><span class="p">,</span> <span class="ss">:dump_pending</span><span class="p">,</span> <span class="ss">:dump_failures</span><span class="p">,</span> <span class="ss">:close</span><span class="p">,</span> <span class="ss">:dump_summary</span><span class="p">,</span> <span class="ss">:example_passed</span><span class="p">,</span> <span class="ss">:example_failed</span><span class="p">,</span> <span class="ss">:example_pending</span>

  <span class="k">def</span> <span class="nf">initialize</span> <span class="n">output</span>
    <span class="vi">@output</span> <span class="o">=</span> <span class="n">output</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">example_passed</span> <span class="n">notification</span> <span class="c1"># ExampleNotification</span>
    <span class="vi">@output</span> <span class="o">&lt;&lt;</span> <span class="s2">&#34;.&#34;</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">example_failed</span> <span class="n">notification</span> <span class="c1"># FailedExampleNotification</span>
    <span class="vi">@output</span> <span class="o">&lt;&lt;</span> <span class="s2">&#34;F&#34;</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">example_pending</span> <span class="n">notification</span> <span class="c1"># ExampleNotification</span>
    <span class="vi">@output</span> <span class="o">&lt;&lt;</span> <span class="s2">&#34;*&#34;</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">dump_pending</span> <span class="n">notification</span> <span class="c1"># ExamplesNotification</span>
    <span class="vi">@output</span> <span class="o">&lt;&lt;</span> <span class="s2">&#34;</span><span class="se">\n\n</span><span class="s2">PENDING:</span><span class="se">\n\t</span><span class="s2">&#34;</span>
    <span class="vi">@output</span> <span class="o">&lt;&lt;</span> <span class="n">notification</span><span class="o">.</span><span class="n">pending_examples</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span><span class="o">|</span><span class="n">example</span><span class="o">|</span> <span class="n">example</span><span class="o">.</span><span class="n">full_description</span> <span class="o">+</span> <span class="s2">&#34; - &#34;</span> <span class="o">+</span> <span class="n">example</span><span class="o">.</span><span class="n">location</span> <span class="p">}</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n\t</span><span class="s2">&#34;</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">dump_failures</span> <span class="n">notification</span> <span class="c1"># ExamplesNotification</span>
    <span class="vi">@output</span> <span class="o">&lt;&lt;</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">FAILING</span><span class="se">\n\t</span><span class="s2">&#34;</span>
    <span class="c1"># For every failed example...</span>
    <span class="vi">@output</span> <span class="o">&lt;&lt;</span> <span class="n">notification</span><span class="o">.</span><span class="n">failed_examples</span><span class="o">.</span><span class="n">map</span> <span class="k">do</span> <span class="o">|</span><span class="n">example</span><span class="o">|</span>
      <span class="c1"># Extract the full description of the example</span>
      <span class="n">full_description</span> <span class="o">=</span> <span class="n">example</span><span class="o">.</span><span class="n">full_description</span>
      <span class="c1"># Extract the example location in the file</span>
      <span class="n">location</span> <span class="o">=</span> <span class="n">example</span><span class="o">.</span><span class="n">location</span>

      <span class="s2">&#34;</span><span class="si">#{</span><span class="n">full_description</span><span class="si">}</span><span class="s2"> - </span><span class="si">#{</span><span class="n">location</span><span class="si">}</span><span class="s2">&#34;</span>
    <span class="k">end</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n\n\t</span><span class="s2">&#34;</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">dump_summary</span> <span class="n">notification</span> <span class="c1"># SummaryNotification</span>
    <span class="vi">@output</span> <span class="o">&lt;&lt;</span> <span class="s2">&#34;</span><span class="se">\n\n</span><span class="s2">Finished in </span><span class="si">#{</span><span class="no">RSpec</span><span class="o">::</span><span class="no">Helpers</span><span class="o">.</span><span class="n">format_duration</span><span class="p">(</span><span class="n">notification</span><span class="o">.</span><span class="n">duration</span><span class="p">)</span><span class="si">}</span><span class="s2">.&#34;</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">close</span> <span class="n">notification</span> <span class="c1"># NullNotification</span>
    <span class="vi">@output</span> <span class="o">&lt;&lt;</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></td></tr></table>
</div>
</div>

<p>In the new <strong>dump_failures</strong> method we loop through every failed example. Then,
we extract the description and the location of the failed example and we build
a string that we append to the output. After this change, the output will look
like this:</p>

<pre>.....FF*..

PENDING:
 Something - pending - ./something_spec.rb:90
FAILING
 Something - first that fails - ./something_spec.rb:82
 Something - second that fails - ./something_spec.rb:86</pre>

<p>Next thing, how do we add the error messages underneath every failing spec?
Lets expand the <strong>dump_failures </strong>method just a bit.</p>

<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">GroupingFormatter</span>
  <span class="no">RSpec</span><span class="o">::</span><span class="no">Formatters</span><span class="o">.</span><span class="n">register</span> <span class="nb">self</span><span class="p">,</span> <span class="ss">:dump_pending</span><span class="p">,</span> <span class="ss">:dump_failures</span><span class="p">,</span> <span class="ss">:close</span><span class="p">,</span> <span class="ss">:dump_summary</span><span class="p">,</span> <span class="ss">:example_passed</span><span class="p">,</span> <span class="ss">:example_failed</span><span class="p">,</span> <span class="ss">:example_pending</span>

  <span class="k">def</span> <span class="nf">initialize</span> <span class="n">output</span>
    <span class="vi">@output</span> <span class="o">=</span> <span class="n">output</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">example_passed</span> <span class="n">notification</span> <span class="c1"># ExampleNotification</span>
    <span class="vi">@output</span> <span class="o">&lt;&lt;</span> <span class="s2">&#34;.&#34;</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">example_failed</span> <span class="n">notification</span> <span class="c1"># FailedExampleNotification</span>
    <span class="vi">@output</span> <span class="o">&lt;&lt;</span> <span class="s2">&#34;F&#34;</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">example_pending</span> <span class="n">notification</span> <span class="c1"># ExampleNotification</span>
    <span class="vi">@output</span> <span class="o">&lt;&lt;</span> <span class="s2">&#34;*&#34;</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">dump_pending</span> <span class="n">notification</span> <span class="c1"># ExamplesNotification</span>
    <span class="vi">@output</span> <span class="o">&lt;&lt;</span> <span class="s2">&#34;</span><span class="se">\n\n</span><span class="s2">PENDING:</span><span class="se">\n\t</span><span class="s2">&#34;</span>
    <span class="vi">@output</span> <span class="o">&lt;&lt;</span> <span class="n">notification</span><span class="o">.</span><span class="n">pending_examples</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span><span class="o">|</span><span class="n">example</span><span class="o">|</span> <span class="n">example</span><span class="o">.</span><span class="n">full_description</span> <span class="o">+</span> <span class="s2">&#34; - &#34;</span> <span class="o">+</span> <span class="n">example</span><span class="o">.</span><span class="n">location</span> <span class="p">}</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n\t</span><span class="s2">&#34;</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">dump_failures</span> <span class="n">notification</span> <span class="c1"># ExamplesNotification</span>
    <span class="vi">@output</span> <span class="o">&lt;&lt;</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">FAILING</span><span class="se">\n\t</span><span class="s2">&#34;</span>
    <span class="c1"># For every failed example...</span>
    <span class="vi">@output</span> <span class="o">&lt;&lt;</span> <span class="n">notification</span><span class="o">.</span><span class="n">failed_examples</span><span class="o">.</span><span class="n">map</span> <span class="k">do</span> <span class="o">|</span><span class="n">example</span><span class="o">|</span>
      <span class="c1"># Extract the full description of the example</span>
      <span class="n">full_description</span> <span class="o">=</span> <span class="n">example</span><span class="o">.</span><span class="n">full_description</span>
      <span class="c1"># Extract the example location in the file</span>
      <span class="n">location</span> <span class="o">=</span> <span class="n">example</span><span class="o">.</span><span class="n">location</span>
      <span class="c1"># Get the Exception message</span>
      <span class="n">message</span> <span class="o">=</span> <span class="n">example</span><span class="o">.</span><span class="n">execution_result</span><span class="o">.</span><span class="n">exception</span><span class="o">.</span><span class="n">message</span>

      <span class="s2">&#34;</span><span class="si">#{</span><span class="n">full_description</span><span class="si">}</span><span class="s2"> - </span><span class="si">#{</span><span class="n">location</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">message</span><span class="si">}</span><span class="s2">&#34;</span>
    <span class="k">end</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n\n\t</span><span class="s2">&#34;</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">dump_summary</span> <span class="n">notification</span> <span class="c1"># SummaryNotification</span>
    <span class="vi">@output</span> <span class="o">&lt;&lt;</span> <span class="s2">&#34;</span><span class="se">\n\n</span><span class="s2">Finished in </span><span class="si">#{</span><span class="no">RSpec</span><span class="o">::</span><span class="no">Helpers</span><span class="o">.</span><span class="n">format_duration</span><span class="p">(</span><span class="n">notification</span><span class="o">.</span><span class="n">duration</span><span class="p">)</span><span class="si">}</span><span class="s2">.&#34;</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">close</span> <span class="n">notification</span> <span class="c1"># NullNotification</span>
    <span class="vi">@output</span> <span class="o">&lt;&lt;</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre></td></tr></table>
</div>
</div>

<p>The only addition is on line 34 - we extract the result of the execution of the
example, then we get the message of the exception that RSpec raised when the
example failed. Now, lets test it:</p>

<pre>.....FF*..

PENDING:
 Boxer is pending - ./boxer_spec.rb:90
FAILING
 Boxer first that fails - ./boxer_spec.rb:82
expected: false
 got: true
(compared using ==)

 Boxer second that fails - ./boxer_spec.rb:86
expected: false
 got: true
(compared using ==)

Finished in 0.0203 seconds.</pre>

<p>This is all good, but you can see that the text alignment is broken a bit. If
you look at the picture at the beginning, you will notice that the exceptions
should appear indented underneath the description of the failing example. Lets
fix this.</p>

<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="k">class</span> <span class="nc">GroupingFormatter</span>
  <span class="no">RSpec</span><span class="o">::</span><span class="no">Formatters</span><span class="o">.</span><span class="n">register</span> <span class="nb">self</span><span class="p">,</span> <span class="ss">:dump_pending</span><span class="p">,</span> <span class="ss">:dump_failures</span><span class="p">,</span> <span class="ss">:close</span><span class="p">,</span>
    <span class="ss">:dump_summary</span><span class="p">,</span> <span class="ss">:example_passed</span><span class="p">,</span> <span class="ss">:example_failed</span><span class="p">,</span> <span class="ss">:example_pending</span>

  <span class="k">def</span> <span class="nf">initialize</span> <span class="n">output</span>
    <span class="vi">@output</span> <span class="o">=</span> <span class="n">output</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">example_passed</span> <span class="n">notification</span> <span class="c1"># ExampleNotification</span>
    <span class="vi">@output</span> <span class="o">&lt;&lt;</span> <span class="s2">&#34;.&#34;</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">example_failed</span> <span class="n">notification</span> <span class="c1"># FailedExampleNotification</span>
    <span class="vi">@output</span> <span class="o">&lt;&lt;</span> <span class="s2">&#34;F&#34;</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">example_pending</span> <span class="n">notification</span> <span class="c1"># ExampleNotification</span>
    <span class="vi">@output</span> <span class="o">&lt;&lt;</span> <span class="s2">&#34;*&#34;</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">dump_pending</span> <span class="n">notification</span> <span class="c1"># ExamplesNotification</span>
    <span class="vi">@output</span> <span class="o">&lt;&lt;</span> <span class="s2">&#34;</span><span class="se">\n\n</span><span class="s2">PENDING:</span><span class="se">\n\t</span><span class="s2">&#34;</span>
    <span class="vi">@output</span> <span class="o">&lt;&lt;</span> <span class="n">notification</span><span class="o">.</span><span class="n">pending_examples</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span><span class="o">|</span><span class="n">example</span><span class="o">|</span> <span class="n">example</span><span class="o">.</span><span class="n">full_description</span> <span class="o">+</span> <span class="s2">&#34; - &#34;</span> <span class="o">+</span> <span class="n">example</span><span class="o">.</span><span class="n">location</span> <span class="p">}</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n\t</span><span class="s2">&#34;</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">dump_failures</span> <span class="n">notification</span> <span class="c1"># ExamplesNotification</span>
    <span class="vi">@output</span> <span class="o">&lt;&lt;</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">FAILING</span><span class="se">\n\t</span><span class="s2">&#34;</span>
    <span class="vi">@output</span> <span class="o">&lt;&lt;</span> <span class="n">failed_examples_output</span><span class="p">(</span><span class="n">notification</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">dump_summary</span> <span class="n">notification</span> <span class="c1"># SummaryNotification</span>
    <span class="vi">@output</span> <span class="o">&lt;&lt;</span> <span class="s2">&#34;</span><span class="se">\n\n</span><span class="s2">Finished in </span><span class="si">#{</span><span class="no">RSpec</span><span class="o">::</span><span class="no">Helpers</span><span class="o">.</span><span class="n">format_duration</span><span class="p">(</span><span class="n">notification</span><span class="o">.</span><span class="n">duration</span><span class="p">)</span><span class="si">}</span><span class="s2">.&#34;</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">close</span> <span class="n">notification</span> <span class="c1"># NullNotification</span>
    <span class="vi">@output</span> <span class="o">&lt;&lt;</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span>
  <span class="k">end</span>

  <span class="kp">private</span>

  <span class="c1"># Loops through all of the failed examples and rebuilds the exception message</span>
  <span class="k">def</span> <span class="nf">failed_examples_output</span> <span class="n">notification</span>
    <span class="n">failed_examples_output</span> <span class="o">=</span> <span class="n">notification</span><span class="o">.</span><span class="n">failed_examples</span><span class="o">.</span><span class="n">map</span> <span class="k">do</span> <span class="o">|</span><span class="n">example</span><span class="o">|</span>
      <span class="n">failed_example_output</span> <span class="n">example</span>
    <span class="k">end</span>
    <span class="n">build_examples_output</span><span class="p">(</span><span class="n">failed_examples_output</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="c1"># Joins all exception messages</span>
  <span class="k">def</span> <span class="nf">build_examples_output</span> <span class="n">output</span>
    <span class="n">output</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n\n\t</span><span class="s2">&#34;</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="c1"># Extracts the full_description, location and formats the message of each example exception</span>
  <span class="k">def</span> <span class="nf">failed_example_output</span> <span class="n">example</span>
    <span class="n">full_description</span> <span class="o">=</span> <span class="n">example</span><span class="o">.</span><span class="n">full_description</span>
    <span class="n">location</span> <span class="o">=</span> <span class="n">example</span><span class="o">.</span><span class="n">location</span>
    <span class="n">formatted_message</span> <span class="o">=</span> <span class="n">strip_message_from_whitespace</span><span class="p">(</span><span class="n">example</span><span class="o">.</span><span class="n">execution_result</span><span class="o">.</span><span class="n">exception</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>

    <span class="s2">&#34;</span><span class="si">#{</span><span class="n">full_description</span><span class="si">}</span><span class="s2"> - </span><span class="si">#{</span><span class="n">location</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">  </span><span class="si">#{</span><span class="n">formatted_message</span><span class="si">}</span><span class="s2">&#34;</span>
  <span class="k">end</span>

  <span class="c1"># Removes whitespace from each of the exception message lines and reformats it</span>
  <span class="k">def</span> <span class="nf">strip_message_from_whitespace</span> <span class="n">msg</span>
    <span class="n">msg</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:strip</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="si">#{</span><span class="n">add_spaces</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">add_spaces</span> <span class="n">n</span>
    <span class="s2">&#34; &#34;</span> <span class="o">*</span> <span class="n">n</span>
  <span class="k">end</span>

<span class="k">end</span></code></pre></td></tr></table>
</div>
</div>

<p>In the example above we took the extra step to format the error messages
nicely. Basically, we split the exception message on a new-line character,
we remove all the whitespace and we rejoin the pieces with a newline between
them and add 10 spaces at the beginning of the message (for the indentation).
Now, the output will look like this:</p>

<pre>.....FF*..

PENDING:
 Boxer is pending - ./boxer_spec.rb:90
FAILING
  Boxer first that fails - ./boxer_spec.rb:82
    expected: false
     got: true
    (compared using ==)

  Boxer second that fails - ./boxer_spec.rb:86
    expected: false
     got: true
    (compared using ==)

Finished in 0.02068 seconds.</pre>

<p>And voila, the formatter is working as supposed. Or, is it? :) Lets add some
colors! Adding colors is really easy, we just need to require the
<a href="http://www.rubydoc.info/gems/rspec-core/RSpec/Core/Formatters/ConsoleCodes">ConsoleCodes</a> module.
The ConsoleCodes module provides helpers for formatting console output with
ANSI codes, for example colors and bold. So, the final version of our
GroupingFormatter is:</p>

<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-ruby" data-lang="ruby"><span class="nb">require</span> <span class="s1">&#39;rspec/core/formatters/console_codes&#39;</span>

<span class="k">class</span> <span class="nc">GroupingFormatter</span>
  <span class="no">RSpec</span><span class="o">::</span><span class="no">Formatters</span><span class="o">.</span><span class="n">register</span> <span class="nb">self</span><span class="p">,</span> <span class="ss">:dump_pending</span><span class="p">,</span> <span class="ss">:dump_failures</span><span class="p">,</span> <span class="ss">:close</span><span class="p">,</span>
    <span class="ss">:dump_summary</span><span class="p">,</span> <span class="ss">:example_passed</span><span class="p">,</span> <span class="ss">:example_failed</span><span class="p">,</span> <span class="ss">:example_pending</span>

  <span class="k">def</span> <span class="nf">initialize</span> <span class="n">output</span>
    <span class="vi">@output</span> <span class="o">=</span> <span class="n">output</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">example_passed</span> <span class="n">notification</span> <span class="c1"># ExampleNotification</span>
    <span class="vi">@output</span> <span class="o">&lt;&lt;</span> <span class="no">RSpec</span><span class="o">::</span><span class="no">ConsoleCodes</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="s2">&#34;.&#34;</span><span class="p">,</span> <span class="ss">:success</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">example_failed</span> <span class="n">notification</span> <span class="c1"># FailedExampleNotification</span>
    <span class="vi">@output</span> <span class="o">&lt;&lt;</span> <span class="no">RSpec</span><span class="o">::</span><span class="no">ConsoleCodes</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="s2">&#34;F&#34;</span><span class="p">,</span> <span class="ss">:failure</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">example_pending</span> <span class="n">notification</span> <span class="c1"># ExampleNotification</span>
    <span class="vi">@output</span> <span class="o">&lt;&lt;</span> <span class="no">RSpec</span><span class="o">::</span><span class="no">ConsoleCodes</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="s2">&#34;*&#34;</span><span class="p">,</span> <span class="ss">:pending</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">dump_pending</span> <span class="n">notification</span> <span class="c1"># ExamplesNotification</span>
    <span class="k">if</span> <span class="n">notification</span><span class="o">.</span><span class="n">pending_examples</span><span class="o">.</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="vi">@output</span> <span class="o">&lt;&lt;</span> <span class="s2">&#34;</span><span class="se">\n\n</span><span class="si">#{</span><span class="no">RSpec</span><span class="o">::</span><span class="no">ConsoleCodes</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="s2">&#34;PENDING:&#34;</span><span class="p">,</span> <span class="ss">:pending</span><span class="p">)</span><span class="si">}</span><span class="se">\n\t</span><span class="s2">&#34;</span>
      <span class="vi">@output</span> <span class="o">&lt;&lt;</span> <span class="n">notification</span><span class="o">.</span><span class="n">pending_examples</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span><span class="o">|</span><span class="n">example</span><span class="o">|</span> <span class="n">example</span><span class="o">.</span><span class="n">full_description</span> <span class="o">+</span> <span class="s2">&#34; - &#34;</span> <span class="o">+</span> <span class="n">example</span><span class="o">.</span><span class="n">location</span> <span class="p">}</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n\t</span><span class="s2">&#34;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">dump_failures</span> <span class="n">notification</span> <span class="c1"># ExamplesNotification</span>
    <span class="k">if</span> <span class="n">notification</span><span class="o">.</span><span class="n">failed_examples</span><span class="o">.</span><span class="n">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
      <span class="vi">@output</span> <span class="o">&lt;&lt;</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="si">#{</span><span class="no">RSpec</span><span class="o">::</span><span class="no">ConsoleCodes</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="s2">&#34;FAILING:&#34;</span><span class="p">,</span> <span class="ss">:failure</span><span class="p">)</span><span class="si">}</span><span class="se">\n\t</span><span class="s2">&#34;</span>
      <span class="vi">@output</span> <span class="o">&lt;&lt;</span> <span class="n">failed_examples_output</span><span class="p">(</span><span class="n">notification</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">dump_summary</span> <span class="n">notification</span> <span class="c1"># SummaryNotification</span>
    <span class="vi">@output</span> <span class="o">&lt;&lt;</span> <span class="s2">&#34;</span><span class="se">\n\n</span><span class="s2">Finished in </span><span class="si">#{</span><span class="no">RSpec</span><span class="o">::</span><span class="no">Helpers</span><span class="o">.</span><span class="n">format_duration</span><span class="p">(</span><span class="n">notification</span><span class="o">.</span><span class="n">duration</span><span class="p">)</span><span class="si">}</span><span class="s2">.&#34;</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">close</span> <span class="n">notification</span> <span class="c1"># NullNotification</span>
    <span class="vi">@output</span> <span class="o">&lt;&lt;</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span>
  <span class="k">end</span>

  <span class="kp">private</span>

  <span class="c1"># Loops through all of the failed examples and rebuilds the exception message</span>
  <span class="k">def</span> <span class="nf">failed_examples_output</span> <span class="n">notification</span>
    <span class="n">failed_examples_output</span> <span class="o">=</span> <span class="n">notification</span><span class="o">.</span><span class="n">failed_examples</span><span class="o">.</span><span class="n">map</span> <span class="k">do</span> <span class="o">|</span><span class="n">example</span><span class="o">|</span>
      <span class="n">failed_example_output</span> <span class="n">example</span>
    <span class="k">end</span>
    <span class="n">build_examples_output</span><span class="p">(</span><span class="n">failed_examples_output</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="c1"># Joins all exception messages</span>
  <span class="k">def</span> <span class="nf">build_examples_output</span> <span class="n">output</span>
    <span class="n">output</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n\n\t</span><span class="s2">&#34;</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="c1"># Extracts the full_description, location and formats the message of each example exception</span>
  <span class="k">def</span> <span class="nf">failed_example_output</span> <span class="n">example</span>
    <span class="n">full_description</span> <span class="o">=</span> <span class="n">example</span><span class="o">.</span><span class="n">full_description</span>
    <span class="n">location</span> <span class="o">=</span> <span class="n">example</span><span class="o">.</span><span class="n">location</span>
    <span class="n">formatted_message</span> <span class="o">=</span> <span class="n">strip_message_from_whitespace</span><span class="p">(</span><span class="n">example</span><span class="o">.</span><span class="n">execution_result</span><span class="o">.</span><span class="n">exception</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>

    <span class="s2">&#34;</span><span class="si">#{</span><span class="n">full_description</span><span class="si">}</span><span class="s2"> - </span><span class="si">#{</span><span class="n">location</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">  </span><span class="si">#{</span><span class="n">formatted_message</span><span class="si">}</span><span class="s2">&#34;</span>
  <span class="k">end</span>

  <span class="c1"># Removes whitespace from each of the exception message lines and reformats it</span>
  <span class="k">def</span> <span class="nf">strip_message_from_whitespace</span> <span class="n">msg</span>
    <span class="n">msg</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:strip</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="si">#{</span><span class="n">add_spaces</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">add_spaces</span> <span class="n">n</span>
    <span class="s2">&#34; &#34;</span> <span class="o">*</span> <span class="n">n</span>
  <span class="k">end</span>

<span class="k">end</span></code></pre></td></tr></table>
</div>
</div>

<p>As you can see, we are using the <em>ConsoleCodes.wrap</em> method which wraps a piece
of text in ANSI codes with the supplied code in the arguments. You can now test
our new colored formatter:</p>

<pre>rspec some_file.rb --require ./grouping_formatter.rb --format GroupingFormatter</pre>

<h2 id="using-your-new-groupingformatter">Using your new GroupingFormatter</h2>

<p>Our formatter is now working, but how can we put it to use? One way to use it
is by running the specs and requiring the formatter in the RSpec command:</p>

<pre>rspec some_spec.rb --color --require ./grouping_formatter.rb --format GroupingFormatter</pre>

<p>This works alright. But, requiring your formatter every time you run your specs is boring.</p>

<h3 id="meet-rspec">Meet .rspec</h3>

<p>RSpec&rsquo;s documentation says that RSpec reads command line configuration options
from files in three different locations:</p>

<ul>
<li>Local: <code>./.rspec-local - </code>This file should exist in the project&rsquo;s root
directory. It can contain some private customizations (in the scope of the
project) of RSpec and should be ignored by git.</li>
<li>Project: <code>./.rspec</code>  - This file should exist in the project&rsquo;s root
directory. It usually contains public project-wide customizations of RSpec and
is usually checked into the git repo.</li>
<li>Global: <code>~/.rspec</code> - This file exists in the user&rsquo;s home directory. It can
contain some personal customizations of your RSpec and is applied to every
project where RSpec is used on your machine.</li>
</ul>

<p>So, we can add a <em>.rspec</em> file in our project&rsquo;s folder with the following
contents:</p>

<pre>--color
--require ./grouping_formatter.rb
--format GroupingFormatter</pre>

<p>RSpec will read this file every time we run our specs, so this means that we
can run our specs without specifying these options in the rspec command:</p>

<pre>rspec some_spec.rb</pre>

<p>This will now work with our new formatter.</p>

<h3 id="using-it-in-a-rails-app">Using it in a Rails app</h3>

<p>Lets integrate our new formatter in a Rails application. Using the formatter in
your Rails application is done in two steps:</p>

<ol>
<li>The formatter class must either be in Rails&rsquo; autoload path, or manually
required in the _spec<em>helper</em>. My personal preference is to require it manually
because it&rsquo;s more verbose.</li>

<li><p>In the <strong>RSpec.configure</strong> block in the _spec<em>helper</em>, you need to register
the formatter to RSpec. This is done by:</p>

<div class="highlight"><pre class="chroma"><code class="language-ruby" data-lang="ruby">    <span class="n">config</span><span class="o">.</span><span class="n">formatter</span> <span class="o">=</span> <span class="no">NameOfTheClass</span>
    </code></pre></div></li>
</ol>

<p>or, in our case:</p>

<pre><code><div class="highlight"><pre class="chroma"><code class="language-ruby" data-lang="ruby">    <span class="n">config</span><span class="o">.</span><span class="n">formatter</span> <span class="o">=</span> <span class="no">GroupingFormatter</span>
    </code></pre></div>
</code></pre>

<p>That&rsquo;s it. Now when you run your specs the new formatter will be used by RSpec.</p>

<h2 id="outro">Outro</h2>

<p>I hope you found this (quite long) post informative and interesting. If any of
you wrote your own RSpec formatters, please, share them with me and the
others in the comments - I am very curious to see what you&rsquo;ve come up with.
Thanks for reading to the very end!</p>

    </div>

    
    


    
    

    <footer class="post-footer">
      <div class="post-tags">
          <a href="https://ieftimov.com/tags/testing/">testing</a>
          <a href="https://ieftimov.com/tags/formatters/">formatters</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/railsconf-2015-talks-that-you-should-watch/">
            
            <i class="iconfont">
              <svg  class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417 757.434875 204.940602c11.338233-12.190647 11.035334-32.285311-0.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-0.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891 0.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"></path>
</svg>

            </i>
            <span class="prev-text nav-default">RailsConf 2015 talks that you should watch</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        
          <a class="next" href="/post/pattern-to-pattern-template-method-and-strategy/">
            <span class="next-text nav-default">Pattern to pattern: Template Method &amp; Strategy</span>
            <span class="prev-text nav-mobile">Next</span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  

  
  

  
  

  

  

  <div class="disqus-comment">
  <div class="disqus-button" id="load_disqus" onclick="load_disqus()">
    Show Disqus Comments
  </div>
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_config = function () {
      this.page.url = "https://ieftimov.com/post/how-to-write-rspec-formatters-from-scratch/";
    };
    function load_disqus() {
      
      
      if (window.location.hostname === 'localhost') return;

      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      var disqus_shortname = 'eftimov';
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);

      $('#load_disqus').remove();
    };
  </script>
  <noscript>Please enable JavaScript to view the
    <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
  </noscript>
  
  </div>
  
    



        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="icon-links">
  
  
    <a href="mailto:hi@ilija.io" rel="me noopener" class="iconfont"
      title="email" >
      <svg class="icon" viewBox="0 0 1451 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M664.781909 681.472759 0 97.881301C0 3.997201 71.046997 0 71.046997 0L474.477909 0 961.649408 0 1361.641813 0C1361.641813 0 1432.688811 3.997201 1432.688811 97.881301L771.345323 681.472759C771.345323 681.472759 764.482731 685.154773 753.594283 688.65053L753.594283 688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858L682.561621 688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759L664.781909 681.472759ZM718.063616 811.603883C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633 0 212.052267 0 212.052267L0 942.809523C0 942.809523 0 1024 83.726336 1024L682.532949 1024 753.579947 1024 1348.948139 1024C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523L1432.688811 212.052267C1432.688811 212.052267 893.138176 701.759633 817.019477 767.734955 777.248 802.205449 742.347691 811.03081 718.063616 811.603883L718.063616 811.603883Z"></path>
</svg>

    </a>
  
    <a href="https://stackoverflow.com/users/601555/ilija-eftimov" rel="me noopener" class="iconfont"
      title="stack-overflow"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M809.714286 932.571429l-638.857143 0 0-274.285714-91.428571 0 0 365.714286 821.714286 0 0-365.714286-91.428571 0 0 274.285714zm-538.285714-299.428571l18.857143-89.714286 447.428571 94.285714-18.857143 89.142857zm58.857143-213.714286l38.285714-83.428571 414.285714 193.714286-38.285714 82.857143zm114.857143-203.428571l58.285714-70.285714 350.857143 293.142857-58.285714 70.285714zm226.857143-216l272.571429 366.285714-73.142857 54.857143-272.571429-366.285714zm-410.285714 840.571429l0-90.857143 457.142857 0 0 90.857143-457.142857 0z"></path>
</svg>

    </a>
  
    <a href="https://twitter.com/fteem" rel="me noopener" class="iconfont"
      title="twitter"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1264 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M1229.8616 18.043658c0 0-117.852626 63.135335-164.151872 67.344358-105.225559-164.151872-505.082682-92.598492-437.738325 223.078185C278.622548 312.675223 89.216542 47.506814 89.216542 47.506814s-117.852626 189.406006 75.762402 345.139833C127.097743 396.85567 55.544363 371.601535 55.544363 371.601535S26.081207 535.753407 253.368414 615.724832c-21.045112 29.463156-113.643603 8.418045-113.643603 8.418045s25.254134 143.10676 231.496229 180.987961c-143.10676 130.479693-387.230056 92.598492-370.393967 105.225559 206.242095 189.406006 1119.599946 231.496229 1128.01799-643.98042C1179.353331 249.539887 1263.533778 123.269217 1263.533778 123.269217s-130.479693 37.881201-138.897738 33.672179C1225.652577 98.015083 1229.8616 18.043658 1229.8616 18.043658"></path>
</svg>

    </a>
  
    <a href="https://www.linkedin.com/in/ieftimov/" rel="me noopener" class="iconfont"
      title="linkedin"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="33" height="33">
  <path d="M872.405333 872.618667h-151.637333v-237.610667c0-56.661333-1.152-129.578667-79.018667-129.578667-79.061333 0-91.136 61.653333-91.136 125.397334v241.792H398.976V384h145.664v66.602667h1.962667c20.352-38.4 69.845333-78.933333 143.786666-78.933334 153.642667 0 182.058667 101.12 182.058667 232.746667v268.202667zM227.712 317.141333a87.978667 87.978667 0 0 1-88.021333-88.106666 88.064 88.064 0 1 1 88.021333 88.106666z m76.032 555.477334H151.68V384h152.064v488.618667zM948.266667 0H75.562667C33.792 0 0 33.024 0 73.770667v876.458666C0 991.018667 33.792 1024 75.562667 1024h872.576C989.866667 1024 1024 991.018667 1024 950.229333V73.770667C1024 33.024 989.866667 0 948.138667 0h0.128z"></path>
</svg>

    </a>
  
    <a href="https://github.com/fteem" rel="me noopener" class="iconfont"
      title="github"  target="_blank"
      >
      <svg class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M512 12.672c-282.88 0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667 0-12.16-0.426667-44.373333-0.64-87.04-142.421333 30.890667-172.458667-68.693333-172.458667-68.693333C188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333 0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333 0 0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52 0.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667 0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72 0 68.522667-0.64 123.562667-0.64 140.202666 0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"></path>
</svg>

    </a>


<a href="https://ieftimov.com/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
   
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
      2014 -
    2019
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        Ilija Eftimov
        
      </span></span>

  
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js" integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin="anonymous"></script>






  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  









  <script id="dsq-count-scr" src="//eftimov.disqus.com/count.js" async></script>





</body>
</html>
